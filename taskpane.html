<!-- src/taskpane/taskpane.html -->
<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Neurow</title>

    <!-- Optional: Fabric for Office-like typography -->
    <link rel="stylesheet" href="https://appsforoffice.microsoft.com/fabric/2.6.3/fabric.min.css" />
    <link rel="stylesheet" href="https://appsforoffice.microsoft.com/fabric/2.6.3/fabric.components.min.css" />

    <link rel="stylesheet" href="taskpane.css" />
  </head>

  <body class="ms-Fabric" dir="ltr">
    <div class="app">
      <header class="app__header">
        <div class="brand">
          <div class="brand__mark">N</div>
          <div class="brand__text">
            <div class="brand__headline">
              <div class="app__title">Neurow</div>
              <div class="app__header-actions">
                <button id="settingsButton" class="icon-button icon-button--gear" type="button" title="Réglages" aria-label="Ouvrir les réglages">
                  &#9881;
                </button>
              </div>
            </div>
            <div class="app__subtitle">Fonctions IA personnalisées pour Excel, prêtes à l'emploi</div>
          </div>
        </div>
      </header>

      <main class="app__main">
        <button
          class="section-alert section-alert--error section-alert--action section-alert--banner is-hidden"
          data-key-alert
          type="button"
          role="alert"
          title="Ouvrir Mise en route"
        >
          Aucune clé API enregistrée · Ouvrir Mise en route
        </button>
        <section class="card card--license" data-collapsible data-section="onboarding" data-section-title="Mise en route">
          <div class="card__header">
            <div>
              <div class="card__title">Mise en route</div>
              <div class="card__subtitle">Activez votre licence et ajoutez vos clés API pour démarrer sur Neurow</div>
            </div>
            <div class="card__actions">
              <button
                class="collapse-toggle"
                type="button"
                data-collapse-toggle
                aria-expanded="true"
                aria-controls="onboardingBody"
                title="Masquer"
              >
                <span class="chevron"></span>
              </button>
            </div>
          </div>
          <div id="onboardingBody" class="card__body setup">
            <div class="setup-step">
              <div class="setup-step__header">
                <span class="setup-step__badge">1</span>
                <div class="setup-step__titles">
                  <div class="setup-step__title">Activer votre licence</div>
                  <div class="setup-step__subtitle">L'essai gratuit est limité à 5 formules par jour</div>
                </div>
                <div id="licenseKeyStatus" class="key-status">Aucune licence enregistrée</div>
              </div>
              <div class="setup-step__content">
                <div class="setup-offer">
                  <div class="setup-offer__headline">Passez en illimité</div>
                  <div class="setup-offer__pricing">
                    <span class="setup-pill setup-pill--accent">5,99 $/mois</span>
                    <span class="setup-pill">59 $/an</span>
                    <span class="setup-pill setup-pill--trial">Essai : 5 formules/jour</span>
                  </div>
                  <ul class="setup-offer__list">
                    <li>Accès complet aux fonctions Neurow</li>
                    <li>Usage illimité des formules</li>
                    <li>Annulation à tout moment</li>
                  </ul>
                  <div class="setup-offer__actions">
                    <a
                      id="licenseCheckoutLink"
                      class="btn btn--primary"
                      href="https://neurow.lemonsqueezy.com/checkout/buy/e132080e-77c6-4fa7-bafa-98de45abe7d8?discount=0"
                      target="_blank"
                      rel="noreferrer"
                    >
                      Acheter une licence
                    </a>
                    <button
                      id="licenseRevealBtn"
                      class="btn btn--ghost"
                      type="button"
                      aria-expanded="false"
                      aria-controls="licenseEntry"
                    >
                      J'ai déjà une licence
                    </button>
                  </div>
                </div>

                <div id="licenseEntry" class="setup-license is-hidden">
                  <div class="form-row">
                    <label for="licenseKeyInput">Clé de licence</label>
                    <div class="setup-license__row">
                      <input
                        id="licenseKeyInput"
                        class="input setup-license__input"
                        type="text"
                        placeholder="AAAA-BBBB-CCCC-DDDD"
                        spellcheck="false"
                      />
                      <button id="licenseActivateBtn" class="btn btn--primary" type="button">Activer</button>
                    </div>
                  </div>
                  <div class="setup-license__actions">
                    <button id="licenseTestBtn" class="btn" type="button">Tester</button>
                    <button id="licenseClearBtn" class="btn btn--ghost" type="button">Effacer</button>
                  </div>
                  <div id="licenseKeyMeta" class="hint">Clé reçue par email après achat (mensuel ou annuel)</div>
                </div>
              </div>
            </div>

            <div class="setup-step">
              <div class="setup-step__header">
                <span class="setup-step__badge">2</span>
                <div class="setup-step__titles">
                  <div class="setup-step__title">Ajouter une API key Gemini ou OpenAI</div>
                  <div class="setup-step__subtitle">Les clés sont stockées localement sur cette machine</div>
                </div>
              </div>
              <div class="setup-step__content">
                <div class="setup-keys">
                  <div class="setup-key-card">
                    <div class="setup-key-card__header">
                      <div class="setup-key-card__title">Gemini</div>
                      <div id="geminiKeyStatus" class="key-status">Clé manquante</div>
                    </div>
                    <div class="form-row">
                      <label for="geminiKey">Clé API Gemini</label>
                      <input id="geminiKey" class="input" type="password" placeholder="AIza..." spellcheck="false" />
                      <div class="hint">Générée dans votre console Google</div>
                    </div>
                    <div class="actions">
                      <button id="testGemini" class="btn" type="button">Tester</button>
                      <button id="clearGemini" class="btn btn--ghost" type="button">Effacer</button>
                    </div>
                  </div>

                  <div class="setup-key-card">
                    <div class="setup-key-card__header">
                      <div class="setup-key-card__title">OpenAI</div>
                      <div id="openaiKeyStatus" class="key-status">Clé manquante</div>
                    </div>
                    <div class="form-row">
                      <label for="openaiKey">Clé API OpenAI</label>
                      <input id="openaiKey" class="input" type="password" placeholder="sk-..." spellcheck="false" />
                      <div class="hint">Disponible sur platform.openai.com</div>
                    </div>
                    <div class="actions">
                      <button id="testOpenAI" class="btn" type="button">Tester</button>
                      <button id="clearOpenAI" class="btn btn--ghost" type="button">Effacer</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section class="card card--config is-collapsed" data-collapsible data-section="config" data-section-title="Configuration" data-section-locked="true">
          <div class="card__header">
            <div>
              <div class="card__title">Configuration</div>
              <div class="card__subtitle">Choisissez le fournisseur, les modèles et les limites de génération</div>
              <div class="card__note">Si vous n'avez pas le résultat attendu, changez de modèle ou augmentez l'effort de raisonnement.</div>
            </div>
            <div class="card__actions">
              <button id="pricingHelp" class="icon-button" type="button" title="Détails des coûts" aria-label="Voir les détails des coûts">?</button>
              <button
                class="collapse-toggle"
                type="button"
                data-collapse-toggle
                aria-expanded="false"
                aria-controls="configBody"
                title="Masquer"
              >
                <span class="chevron"></span>
              </button>
            </div>
          </div>

          <div id="configBody" class="card__body">
            <div class="config-grid">
              <div class="form-row">
                <div class="label-row">
                  <label>Fournisseur par défaut</label>
                  <span class="help" data-help>
                    <button class="icon-button icon-button--tiny help__button" type="button" aria-label="Aide fournisseur par défaut" aria-expanded="false">?</button>
                    <span class="help__popup" role="tooltip">
                      Définit le fournisseur utilisé par défaut dans les formules AI.* (modifiable sans changer vos formules)
                    </span>
                  </span>
                </div>
                <div class="segmented" role="group" aria-label="Fournisseur par défaut">
                  <button id="providerGemini" class="segmented__btn" type="button" data-provider="gemini">
                    <span class="segmented__label">Gemini</span>
                    <span class="favorite-icon" title="Mod&egrave;le recommand&eacute;" aria-label="Mod&egrave;le recommand&eacute;" role="img">&#9733;</span>
                  </button>
                  <button id="providerOpenAI" class="segmented__btn" type="button" data-provider="openai">
                    <span class="segmented__label">OpenAI</span>
                  </button>
                </div>
              </div>

              <div class="form-row form-row--full">
                <div class="label-row">
                  <label for="maxTokensRange">Max output tokens</label>
                  <span class="help" data-help>
                    <button class="icon-button icon-button--tiny help__button" type="button" aria-label="Aide max tokens" aria-expanded="false">?</button>
                    <span class="help__popup" role="tooltip">
                      Limite la longueur des réponses pour Gemini et OpenAI · Plus haut = réponses plus longues, coût et latence plus élevés
                    </span>
                  </span>
                </div>
                <div class="range">
                  <input id="maxTokensRange" class="range__input" type="range" min="7" max="17" step="1" value="12" />
                  <div class="range__value">
                    <span id="maxTokensValue">4096</span> tokens
                  </div>
                </div>
                <div class="hint">Conseil : 512–4096 pour la plupart des usages · Plus = réponses plus longues</div>
              </div>
            </div>

          </div>
        </section>

        <section class="card card--usage" data-collapsible data-section="usage" data-section-title="Utilisation" data-section-locked="true">
          <div class="card__header">
            <div>
              <div class="card__title">Utilisation</div>
              <div class="card__subtitle">Suivez les tokens et les coûts estimés par fournisseur</div>
            </div>
            <div class="card__actions">
              <button
                class="collapse-toggle"
                type="button"
                data-collapse-toggle
                aria-expanded="true"
                aria-controls="usageBody"
                title="Masquer"
              >
                <span class="chevron"></span>
              </button>
            </div>
          </div>

          <div id="usageBody" class="card__body">
            <div class="stats-grid">
              <div class="stat">
                <div class="stat__label">Tokens totaux</div>
                <div id="usageTokensTotal" class="stat__value">0</div>
                <div class="stat__meta">
                  <span id="usageTokensInTotal">0</span> entrée · <span id="usageTokensReasoningTotal">0</span> raisonnement · <span id="usageTokensOutTotal">0</span> sortie
                </div>
              </div>
              <div class="stat stat--accent">
                <div class="stat__label">Coût estimé total</div>
                <div id="usageCostTotal" class="stat__value">€0.0000</div>
                <div class="stat__meta">
                  Gemini <span id="usageCostGemini">€0.0000</span> · OpenAI <span id="usageCostOpenAI">€0.0000</span>
                </div>
              </div>
            </div>

            <div class="breakdown">
              <div id="usageBreakdown" class="breakdown__list"></div>
            </div>

            <div class="chart">
              <div class="chart__header">
                <div class="chart__title">Activité sur 60 minutes</div>
                <div class="chart__legend">Tokens (entrée + raisonnement + sortie)</div>
              </div>
              <canvas id="usageChart" class="chart__canvas" aria-label="Graphique d'utilisation dernière heure"></canvas>
            </div>
          </div>
        </section>

        <section class="card card--logs is-collapsed" data-collapsible data-section="logs" data-section-title="Logs">
          <div class="card__header">
            <div>
            <div class="card__title">Logs</div>
              <div class="card__subtitle">Consultez l'historique des appels et erreurs récentes</div>
            </div>
            <div class="card__actions">
              <button id="clearLogs" class="btn btn--ghost" type="button">Effacer</button>
              <button
                class="collapse-toggle"
                type="button"
                data-collapse-toggle
                aria-expanded="false"
                aria-controls="logsBody"
                title="Masquer"
              >
                <span class="chevron"></span>
              </button>
            </div>
          </div>

          <div id="logsBody" class="card__body">
            <div class="log">
              <div id="logList" class="log__list"></div>
            </div>
          </div>
        </section>

        <section class="card card--cache is-collapsed" data-collapsible data-section="cache" data-section-title="Cache intelligent">
          <div class="card__header">
            <div>
              <div class="card__title">Cache intelligent</div>
              <div class="card__subtitle">Gérez le cache local pour accélérer les réponses</div>
            </div>
            <div class="card__actions">
              <div id="cacheStatus" class="chip chip--success">Actif</div>
              <button
                class="collapse-toggle"
                type="button"
                data-collapse-toggle
                aria-expanded="false"
                aria-controls="cacheBody"
                title="Masquer"
              >
                <span class="chevron"></span>
              </button>
            </div>
          </div>

          <div id="cacheBody" class="card__body">
            <div class="stats-grid">
              <div class="stat">
                <div class="stat__label">Entrées en cache</div>
                <div id="cacheEntries" class="stat__value">0</div>
                <div class="stat__meta">
                  Gemini <span id="cacheGeminiEntries">0</span> · OpenAI <span id="cacheOpenAIEntries">0</span>
                </div>
              </div>
              <div class="stat">
                <div class="stat__label">Taille approx</div>
                <div id="cacheSize" class="stat__value">0 KB</div>
                <div class="stat__meta">TTL standard 7 jours · Web 1 heure</div>
              </div>
            </div>

            <div class="actions actions--right">
              <button id="refreshCache" class="btn btn--ghost" type="button">Actualiser</button>
              <button id="clearCache" class="btn btn--danger" type="button">Vider le cache</button>
            </div>
          </div>
        </section>

        <section class="card card--functions is-collapsed" data-collapsible data-section="functions" data-section-title="Fonctions Neurow">
          <div class="card__header">
            <div>
              <div class="card__title">Fonctions Neurow</div>
              <div class="card__subtitle">Retrouvez les fonctions prêtes à l'emploi dans Excel</div>
            </div>
            <div class="card__actions">
              <button
                class="collapse-toggle"
                type="button"
                data-collapse-toggle
                aria-expanded="false"
                aria-controls="functionsBody"
                title="Masquer"
              >
                <span class="chevron"></span>
              </button>
            </div>
          </div>

          <div id="functionsBody" class="card__body">
            <div class="function-list">
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.ASK</span>(prompt, [context])</code>
                <div class="function-item__desc">Pose une question et renvoie une réponse unique, le contexte peut être une cellule ou une plage Excel</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.WEB</span>(query, [focus], [showSource])</code>
                <div class="function-item__desc">Recherche sur le web à partir de query, focus précise l'angle, showSource=1 renvoie les sources</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.TRANSLATE</span>(textOrRange, targetLang)</code>
                <div class="function-item__desc">Traduit un texte ou une plage vers targetLang (ex : "en"), renvoie une traduction par cellule</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.CLASSIFY</span>(textOrRange, labels)</code>
                <div class="function-item__desc">Attribue à chaque texte le label le plus proche parmi labels, renvoie le label exact</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.EXTRACT</span>(textOrRange, instruction)</code>
                <div class="function-item__desc">Extrait les informations demandées selon l'instruction, renvoie une réponse structurée ou concise</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.CLEAN</span>(textOrRange)</code>
                <div class="function-item__desc">Nettoie et normalise le texte (espaces, retours, bruit) pour une version prête à utiliser</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.CONSISTENT</span>(textOrRange)</code>
                <div class="function-item__desc">Harmonise des libellés proches dans une plage pour obtenir des valeurs cohérentes</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.SUMMARIZE</span>(textOrRange, [mode])</code>
                <div class="function-item__desc">Mode 0 résume chaque cellule, mode 1 produit un résumé global de la plage</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.FORMULA</span>(description, [context])</code>
                <div class="function-item__desc">Génère une formule Excel prête à coller à partir d'une description, avec contexte optionnel</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.TABLE</span>(description, [context])</code>
                <div class="function-item__desc">Crée un tableau structuré (en-têtes + lignes) depuis un brief, renvoie une plage prête à coller</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.FILL</span>(exampleRange, targetRange, instruction)</code>
                <div class="function-item__desc">Complète une plage cible en imitant les exemples de exampleRange et l'instruction</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.KEYSTATUS</span>()</code>
                <div class="function-item__desc">Retourne l'état des clés, du fournisseur et du modèle actif pour diagnostic</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.TEST</span>()</code>
                <div class="function-item__desc">Teste la connexion au fournisseur sélectionné et renvoie un statut simple</div>
              </div>
              <div class="function-item">
                <code class="function-item__name">=<span class="function-item__fn">AI.COUNT</span>(range, value)</code>
                <div class="function-item__desc">Compte les occurrences exactes de value dans range, renvoie un nombre</div>
              </div>
            </div>
          </div>
        </section>

        <section class="section-settings is-collapsed" data-collapsible data-section-settings>
          <div class="section-settings__header">
            <button
              class="section-settings__toggle"
              type="button"
              data-collapse-toggle
              aria-expanded="false"
              aria-controls="sectionSettingsBody"
            >
              <span>Personnaliser les sections</span>
              <span class="chevron"></span>
            </button>
            <button id="sectionManagerReset" class="text-button" type="button">Reset</button>
          </div>
          <div id="sectionSettingsBody" class="section-settings__body">
            <div class="section-manager">
              <div id="sectionManagerList" class="section-manager__list" role="list"></div>
              <div class="hint">Configuration et Utilisation restent toujours visibles</div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="settingsModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="settingsTitle">
      <div class="modal__backdrop" data-settings-close></div>
      <div class="modal__panel" role="document">
        <div class="modal__header">
          <div>
            <div id="settingsTitle" class="modal__title">Réglages</div>
            <div class="modal__subtitle">Modèles et effort de raisonnement</div>
          </div>
          <button class="icon-button" type="button" data-settings-close aria-label="Fermer">x</button>
        </div>
        <div class="modal__body">
          <div class="tabs" role="tablist" aria-label="Fournisseurs">
            <button id="tabGemini" class="tab tab--active" type="button" role="tab" aria-selected="true" aria-controls="panelGemini">
              Gemini
            </button>
            <button id="tabOpenAI" class="tab" type="button" role="tab" aria-selected="false" aria-controls="panelOpenAI">
              OpenAI
            </button>
          </div>

          <div id="panelGemini" class="tab-panel tab-panel--active" role="tabpanel" aria-labelledby="tabGemini">
            <div class="settings-block">
              <div class="settings-block__title">Modèles</div>
              <div class="form-row">
                <div class="label-row">
                  <label for="geminiModel">Modèle Gemini</label>
                  <span
                    id="geminiModelWarning"
                    class="warning-mark is-hidden"
                    role="img"
                    aria-label="Modèle à fort raisonnement, coût élevé"
                    title="Modèle à fort raisonnement, coût élevé"
                  >
                    !
                  </span>
                  <span class="help" data-help>
                    <button class="icon-button icon-button--tiny help__button" type="button" aria-label="Aide modèle Gemini" aria-expanded="false">?</button>
                    <span class="help__popup" role="tooltip">
                      Choisissez le modèle Gemini : certains sont plus rapides, d'autres plus précis · $ = coût, &#129504; = raisonnement
                    </span>
                  </span>
                </div>
                <select id="geminiModel" class="input input--select"></select>
                <div class="hint">Indicateurs : $ = co&ucirc;t, &#129504; = r&eacute;flexion</div>
              </div>
            </div>

            <div class="settings-block">
              <div class="settings-block__title">Effort de raisonnement</div>
              <div class="form-row">
                <div class="label-row">
                  <label for="geminiReasoningEffort">Effort de raisonnement</label>
                  <span class="help" data-help>
                    <button class="icon-button icon-button--tiny help__button" type="button" aria-label="Aide effort de raisonnement Gemini" aria-expanded="false">?</button>
                    <span class="help__popup" role="tooltip">
                      Auto = comportement par défaut · Gemini 3 utilise thinkingLevel, Gemini 2.5 utilise thinkingBudget
                    </span>
                  </span>
                </div>
                <div class="reasoning">
                  <div class="reasoning__control">
                    <input id="geminiReasoningEffort" class="reasoning__input" type="range" min="0" max="4" step="1" />
                    <div class="reasoning__track" aria-hidden="true">
                      <span class="reasoning__dot" data-value="auto"></span>
                      <span class="reasoning__dot" data-value="minimal"></span>
                      <span class="reasoning__dot" data-value="low"></span>
                      <span class="reasoning__dot" data-value="medium"></span>
                      <span class="reasoning__dot" data-value="high"></span>
                    </div>
                  </div>
                  <div class="reasoning__labels" aria-hidden="true">
                    <span data-value="auto">auto</span>
                    <span data-value="minimal">minimal</span>
                    <span data-value="low">low</span>
                    <span data-value="medium" title="Raisonnement élevé, coût plus important"><span class="warning-mark" aria-hidden="true">!</span> medium</span>
                    <span data-value="high" title="Raisonnement élevé, coût plus important"><span class="warning-mark" aria-hidden="true">!</span> high</span>
                  </div>
                </div>
                <div class="hint">Les niveaux exacts dépendent du modèle (certains sont ajustés automatiquement)</div>
              </div>
            </div>

          </div>

          <div id="panelOpenAI" class="tab-panel" role="tabpanel" aria-labelledby="tabOpenAI">
            <div class="settings-block">
              <div class="settings-block__title">Modèles</div>
              <div class="form-row">
                <div class="label-row">
                  <label for="openaiModel">Modèle OpenAI</label>
                  <span
                    id="openaiModelWarning"
                    class="warning-mark is-hidden"
                    role="img"
                    aria-label="Modèle à fort raisonnement, coût élevé"
                    title="Modèle à fort raisonnement, coût élevé"
                  >
                    !
                  </span>
                  <span class="help" data-help>
                    <button class="icon-button icon-button--tiny help__button" type="button" aria-label="Aide modèle OpenAI" aria-expanded="false">?</button>
                    <span class="help__popup" role="tooltip">
                      Choisissez le modèle OpenAI : impact direct sur le coût et la qualité · $ = coût, &#129504; = raisonnement
                    </span>
                  </span>
                </div>
                <select id="openaiModel" class="input input--select"></select>
                <div class="hint">Indicateurs : $ = co&ucirc;t, &#129504; = r&eacute;flexion</div>
              </div>
            </div>

            <div class="settings-block">
              <div class="settings-block__title">Effort de raisonnement</div>
              <div class="form-row">
                <div class="label-row">
                  <label for="openaiReasoningEffort">Effort de raisonnement</label>
                  <span class="help" data-help>
                    <button class="icon-button icon-button--tiny help__button" type="button" aria-label="Aide effort de raisonnement" aria-expanded="false">?</button>
                    <span class="help__popup" role="tooltip">
                      Ajuste la profondeur de raisonnement pour OpenAI · Plus élevé = réponses plus détaillées mais plus lentes et coûteuses · Certains modèles n'acceptent pas "none"
                    </span>
                  </span>
                </div>
                <div class="reasoning">
                  <div class="reasoning__control">
                    <input id="openaiReasoningEffort" class="reasoning__input" type="range" min="0" max="4" step="1" />
                    <div class="reasoning__track" aria-hidden="true">
                      <span class="reasoning__dot" data-value="none"></span>
                      <span class="reasoning__dot" data-value="minimal"></span>
                      <span class="reasoning__dot" data-value="low"></span>
                      <span class="reasoning__dot" data-value="medium"></span>
                      <span class="reasoning__dot" data-value="high"></span>
                    </div>
                  </div>
                  <div class="reasoning__labels" aria-hidden="true">
                    <span data-value="none">none</span>
                    <span data-value="minimal">minimal</span>
                    <span data-value="low">low</span>
                    <span data-value="medium" title="Raisonnement élevé, coût plus important"><span class="warning-mark" aria-hidden="true">!</span> medium</span>
                    <span data-value="high" title="Raisonnement élevé, coût plus important"><span class="warning-mark" aria-hidden="true">!</span> high</span>
                  </div>
                </div>
                <div class="hint">Docs : low/medium/high · Autres valeurs peuvent échouer</div>
              </div>
            </div>

          </div>

          <div class="status" aria-live="polite">
            <div id="statusLine" class="status__line">Chargement…</div>
            <div class="status__meta">Stockage : <span id="storageBackend">?</span></div>
            <details class="status__details">
              <summary>Détails</summary>
              <pre id="statusDetails" class="status__pre"></pre>
            </details>
          </div>
        </div>
      </div>
    </div>

    <div id="onboardingModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="onboardingTitle">
      <div class="modal__backdrop" data-onboarding-close></div>
      <div class="modal__panel" role="document">
        <div class="modal__header">
            <div>
              <div id="onboardingTitle" class="modal__title">Bienvenue dans Neurow</div>
              <div class="modal__subtitle">Configurez l'extension en quelques secondes</div>
            </div>
          <button id="onboardingClose" class="icon-button" type="button" aria-label="Fermer">x</button>
        </div>
        <div class="modal__body onboarding">
          <div class="onboarding__steps">
            <div class="onboarding-step">
              <div class="onboarding-step__title">1. Activez votre licence</div>
              <div class="onboarding-step__text">Essai gratuit : 5 formules/jour · Abonnement : 5,99 $/mois ou 59 $/an</div>
            </div>
            <div class="onboarding-step">
              <div class="onboarding-step__title">2. Ajoutez vos clés API</div>
              <div class="onboarding-step__text">Entrez une clé Gemini et/ou OpenAI pour activer Neurow</div>
            </div>
            <div class="onboarding-step">
              <div class="onboarding-step__title">3. Choisissez vos modèles</div>
              <div class="onboarding-step__text">Sélectionnez un modèle et lancez vos formules Neurow dans Excel</div>
            </div>
          </div>

          <div class="onboarding__actions">
            <button id="onboardingKeysButton" class="btn btn--ghost" type="button">Ouvrir Mise en route</button>
            <button id="onboardingDone" class="btn btn--primary" type="button">C'est parti</button>
          </div>
        </div>
      </div>
    </div>

    <div id="onboardingKeysModal" class="modal modal--narrow modal--stacked" aria-hidden="true" role="dialog" aria-labelledby="onboardingKeysTitle">
      <div class="modal__backdrop" data-onboarding-keys-close></div>
      <div class="modal__panel" role="document">
        <div class="modal__header">
          <div>
            <div id="onboardingKeysTitle" class="modal__title">Ajoutez vos clés API</div>
            <div class="modal__subtitle">Aucune clé détectée · Vous pouvez entrer une ou deux clés</div>
          </div>
          <button class="icon-button" type="button" data-onboarding-keys-close aria-label="Fermer">x</button>
        </div>
        <div class="modal__body">
          <div class="form-row">
            <label for="onboardingGeminiKey">Clé API Gemini</label>
            <input id="onboardingGeminiKey" class="input" type="password" placeholder="AIza..." spellcheck="false" />
          </div>
          <div class="form-row">
            <label for="onboardingOpenAIKey">Clé API OpenAI</label>
            <input id="onboardingOpenAIKey" class="input" type="password" placeholder="sk-..." spellcheck="false" />
          </div>
          <div class="hint">Les clés sont stockées localement sur cette machine</div>
          <div class="actions actions--right">
            <button id="onboardingKeysLater" class="btn btn--ghost" type="button">Plus tard</button>
            <button id="onboardingKeysSave" class="btn btn--primary" type="button">Valider</button>
          </div>
        </div>
      </div>
    </div>

    <div id="pricingModal" class="modal" aria-hidden="true" role="dialog" aria-labelledby="pricingTitle">
      <div class="modal__backdrop" data-modal-close></div>
      <div class="modal__panel" role="document">
        <div class="modal__header">
          <div>
            <div id="pricingTitle" class="modal__title">Détails des coûts</div>
            <div class="modal__subtitle">Tarifs par 1M tokens, en euros</div>
          </div>
          <button class="icon-button" type="button" data-modal-close aria-label="Fermer">x</button>
        </div>
        <div class="modal__body">
          <div class="pricing-legend">Indicateurs : $ = co&ucirc;t, &#129504; = r&eacute;flexion</div>
          <div class="pricing-section">
            <div class="pricing-section__title">Gemini</div>
            <div class="pricing-table__wrap">
              <table class="pricing-table">
                <thead>
                  <tr>
                    <th>MDL</th>
                    <th class="pricing-table__col-price">IN</th>
                    <th class="pricing-table__col-price">OUT</th>
                    <th class="pricing-table__col-icon">$</th>
                    <th class="pricing-table__col-icon">&#129504;</th>
                  </tr>
                </thead>
                <tbody id="pricingTableBodyGemini"></tbody>
              </table>
            </div>
          </div>
          <div class="pricing-section">
            <div class="pricing-section__title">OpenAI</div>
            <div class="pricing-table__wrap">
              <table class="pricing-table">
                <thead>
                  <tr>
                    <th>MDL</th>
                    <th class="pricing-table__col-price">IN</th>
                    <th class="pricing-table__col-price">OUT</th>
                    <th class="pricing-table__col-icon">$</th>
                    <th class="pricing-table__col-icon">&#129504;</th>
                  </tr>
                </thead>
                <tbody id="pricingTableBodyOpenAI"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Shared Runtime: functions.js is loaded into the same long-lived runtime as taskpane -->
    <script src="functions.js"></script>
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <script src="taskpane.js"></script>
  </body>
</html>
