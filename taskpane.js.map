{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://excel-ai-gemini-addin/./src/shared/core.js","webpack://excel-ai-gemini-addin/./src/shared/providers.js","webpack://excel-ai-gemini-addin/./src/license.js","webpack://excel-ai-gemini-addin/./src/taskpane/taskpane.js"],"sourcesContent":["// src/shared/core.js\n// Shared utilities + persisted configuration for the Neurow add-in.\n//\n// Key design goals:\n// - Two providers (Gemini + OpenAI) can coexist.\n// - The default provider is chosen in the taskpane (not in formulas).\n// - No temperature / sampling controls anywhere (per requirements).\n// - A single \"max output tokens\" setting applies to both providers.\n\nexport const PROVIDERS = Object.freeze({\n  GEMINI: \"gemini\",\n  OPENAI: \"openai\"\n});\n\nexport const DEFAULTS = Object.freeze({\n  provider: PROVIDERS.GEMINI,\n  // Default models (User specified future versions)\n  geminiModel: \"gemini-3-flash-preview\",\n  openaiModel: \"gpt-5-mini\",\n  geminiReasoningEffort: \"minimal\",\n  openaiReasoningEffort: \"low\",\n  maxOutputTokens: 4096,\n\n  // Execution / UX\n  retry: 2,\n  timeoutMs: 120000,\n\n  // In-memory cache (per runtime). Note: Office custom functions can run in a long-lived runtime.\n  cache: true,\n  cacheTtlSec: 7 * 24 * 3600, // 7 days\n  webCacheTtlSec: 3600 // 1 hour (web results change more often)\n});\n\nconst STORAGE_KEYS = Object.freeze({\n  DEFAULT_PROVIDER: \"AI_DEFAULT_PROVIDER_V3\",\n  GEMINI_API_KEY: \"AI_GEMINI_API_KEY_V3\",\n  OPENAI_API_KEY: \"AI_OPENAI_API_KEY_V3\",\n  GEMINI_MODEL: \"AI_GEMINI_MODEL_V3\",\n  OPENAI_MODEL: \"AI_OPENAI_MODEL_V3\",\n  GEMINI_REASONING_EFFORT: \"AI_GEMINI_REASONING_EFFORT_V3\",\n  OPENAI_REASONING_EFFORT: \"AI_OPENAI_REASONING_EFFORT_V3\",\n  MAX_OUTPUT_TOKENS: \"AI_MAX_OUTPUT_TOKENS_V3\",\n  ONBOARDING_SEEN: \"AI_ONBOARDING_SEEN_V1\",\n  ONBOARDING_KEYS_CONFIRMED: \"AI_ONBOARDING_KEYS_CONFIRMED_V1\",\n  SECTION_ORDER: \"AI_SECTION_ORDER_V1\",\n  SECTION_HIDDEN: \"AI_SECTION_HIDDEN_V1\",\n  LICENSE: \"AI_LICENSE_V1\",\n  PRIVACY_MODE: \"AI_PRIVACY_MODE_V1\",\n\n  // Prevent re-running migrations each time.\n  MIGRATION_DONE: \"AI_MIGRATION_DONE_V3\",\n\n  // Diagnostics + cache metadata\n  REQUEST_LOG: \"AI_REQUEST_LOG_V1\",\n  REQUEST_LOG_CLEAR_AT: \"AI_REQUEST_LOG_CLEAR_AT_V1\",\n  USAGE_TOTALS: \"AI_USAGE_TOTALS_V1\",\n  CACHE_INDEX: \"AI_CACHE_INDEX_V1\",\n  CACHE_CLEAR_AT: \"AI_CACHE_CLEAR_AT_V1\"\n});\n\nconst SENSITIVE_KEYS = new Set([STORAGE_KEYS.GEMINI_API_KEY, STORAGE_KEYS.OPENAI_API_KEY, STORAGE_KEYS.LICENSE]);\n\n// Older keys used by previous versions (best-effort migration).\nconst LEGACY_KEYS = Object.freeze({\n  GEMINI_API_KEY: \"GEMINI_API_KEY\",\n  MAX_OUTPUT_TOKENS: \"MAX_OUTPUT_TOKENS\",\n\n  DEFAULT_PROVIDER_V2: \"AI_DEFAULT_PROVIDER_V2\",\n  GEMINI_API_KEY_V2: \"AI_GEMINI_API_KEY_V2\",\n  OPENAI_API_KEY_V2: \"AI_OPENAI_API_KEY_V2\",\n  GEMINI_MODEL_V2: \"AI_GEMINI_MODEL_V2\",\n  OPENAI_MODEL_V2: \"AI_OPENAI_MODEL_V2\",\n\n  GEMINI_MAX_TOKENS_V2: \"AI_GEMINI_MAX_OUTPUT_TOKENS_V2\",\n  OPENAI_MAX_TOKENS_V2: \"AI_OPENAI_MAX_OUTPUT_TOKENS_V2\"\n});\n\nlet _migrationPromise = null;\nlet _officeStorageFailed = false;\nlet _privacyModeCache = null;\nlet _privacyModeCacheAt = 0;\n\nfunction markOfficeStorageFailed() {\n  _officeStorageFailed = true;\n}\n\nfunction isSensitiveKey(key) {\n  return SENSITIVE_KEYS.has(key);\n}\n\nfunction getRuntimeStorage() {\n  if (!_officeStorageFailed) {\n    try {\n      if (typeof OfficeRuntime !== \"undefined\" && OfficeRuntime?.storage?.getItem) {\n        return { kind: \"office\", storage: OfficeRuntime.storage };\n      }\n    } catch {\n      // ignore\n    }\n  }\n\n  try {\n    if (typeof window !== \"undefined\" && window?.localStorage?.getItem) {\n      return { kind: \"local\", storage: window.localStorage };\n    }\n  } catch {\n    // ignore\n  }\n\n  // Extremely defensive fallback (in-memory only).\n  const mem = new Map();\n  return {\n    kind: \"memory\",\n    storage: {\n      async getItem(k) {\n        return mem.has(k) ? mem.get(k) : null;\n      },\n      async setItem(k, v) {\n        mem.set(k, String(v));\n      },\n      async removeItem(k) {\n        mem.delete(k);\n      }\n    }\n  };\n}\n\nfunction getLocalStorageSafe() {\n  try {\n    if (typeof window !== \"undefined\" && window?.localStorage?.getItem) {\n      return window.localStorage;\n    }\n  } catch {\n    return null;\n  }\n  return null;\n}\n\nfunction localGet(local, key) {\n  try {\n    return local.getItem(key);\n  } catch {\n    return null;\n  }\n}\n\nfunction localSet(local, key, value) {\n  try {\n    local.setItem(key, value);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction localRemove(local, key) {\n  try {\n    local.removeItem(key);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function storageBackendName() {\n  return getRuntimeStorage().kind;\n}\n\nasync function rawGet(key, options = {}) {\n  const { kind, storage } = getRuntimeStorage();\n  const sensitive = options.sensitive ?? isSensitiveKey(key);\n  const allowLocalFallback = options.allowLocalFallback !== false;\n\n  if (kind === \"local\") {\n    return localGet(storage, key);\n  }\n\n  if (kind === \"office\") {\n    let result = null;\n    try {\n      result = await storage.getItem(key);\n    } catch {\n      markOfficeStorageFailed();\n    }\n    if (result != null) {\n      if (sensitive) {\n        const local = getLocalStorageSafe();\n        if (local) localRemove(local, key);\n      }\n      return result;\n    }\n    if (!allowLocalFallback) return null;\n\n    const local = getLocalStorageSafe();\n    if (!local) return null;\n    const localValue = localGet(local, key);\n    if (localValue == null) return null;\n\n    if (!_officeStorageFailed) {\n      try {\n        await storage.setItem(key, String(localValue));\n        localRemove(local, key);\n      } catch {\n        markOfficeStorageFailed();\n      }\n    }\n\n    return localValue;\n  }\n\n  try {\n    return await storage.getItem(key);\n  } catch {\n    return null;\n  }\n}\n\nasync function rawSet(key, value, options = {}) {\n  const { kind, storage } = getRuntimeStorage();\n  const v = value == null ? \"\" : String(value);\n  const allowLocalFallback = options.allowLocalFallback !== false;\n\n  if (kind === \"local\") {\n    localSet(storage, key, v);\n    return;\n  }\n\n  if (kind === \"office\") {\n    let stored = false;\n    try {\n      await storage.setItem(key, v);\n      stored = true;\n    } catch {\n      markOfficeStorageFailed();\n    }\n\n    const local = getLocalStorageSafe();\n    if (stored) {\n      if (local) localRemove(local, key);\n      return;\n    }\n\n    if (!allowLocalFallback || !local) return;\n    localSet(local, key, v);\n    return;\n  }\n\n  try {\n    await storage.setItem(key, v);\n  } catch {\n    // ignore\n  }\n}\n\nasync function rawRemove(key) {\n  const { kind, storage } = getRuntimeStorage();\n\n  if (kind === \"local\") {\n    localRemove(storage, key);\n    return;\n  }\n\n  if (kind === \"office\") {\n    let removed = false;\n    try {\n      await storage.removeItem(key);\n      removed = true;\n    } catch {\n      markOfficeStorageFailed();\n    }\n\n    const local = getLocalStorageSafe();\n    if (local) localRemove(local, key);\n    return;\n  }\n\n  try {\n    await storage.removeItem(key);\n  } catch {\n    // ignore\n  }\n}\n\nasync function ensureMigrated() {\n  if (_migrationPromise) return _migrationPromise;\n\n  _migrationPromise = (async () => {\n    // Fast exit if already migrated\n    const done = await rawGet(STORAGE_KEYS.MIGRATION_DONE);\n    if (done === \"1\") return;\n\n    // Migrate provider\n    const currentProvider = normalizeProvider(await rawGet(STORAGE_KEYS.DEFAULT_PROVIDER));\n    if (!currentProvider) {\n      const legacyProvider = normalizeProvider(await rawGet(LEGACY_KEYS.DEFAULT_PROVIDER_V2));\n      await rawSet(STORAGE_KEYS.DEFAULT_PROVIDER, legacyProvider || DEFAULTS.provider);\n    }\n\n    // Migrate keys\n    const gKey = await rawGet(STORAGE_KEYS.GEMINI_API_KEY);\n    if (!gKey) {\n      const legacy = (await rawGet(LEGACY_KEYS.GEMINI_API_KEY_V2)) || (await rawGet(LEGACY_KEYS.GEMINI_API_KEY));\n      if (legacy) await rawSet(STORAGE_KEYS.GEMINI_API_KEY, legacy);\n    }\n\n    const oKey = await rawGet(STORAGE_KEYS.OPENAI_API_KEY);\n    if (!oKey) {\n      const legacy = await rawGet(LEGACY_KEYS.OPENAI_API_KEY_V2);\n      if (legacy) await rawSet(STORAGE_KEYS.OPENAI_API_KEY, legacy);\n    }\n\n    // Migrate models\n    const gModel = await rawGet(STORAGE_KEYS.GEMINI_MODEL);\n    if (!gModel) {\n      const legacy = await rawGet(LEGACY_KEYS.GEMINI_MODEL_V2);\n      await rawSet(STORAGE_KEYS.GEMINI_MODEL, legacy || DEFAULTS.geminiModel);\n    }\n\n    const oModel = await rawGet(STORAGE_KEYS.OPENAI_MODEL);\n    if (!oModel) {\n      const legacy = await rawGet(LEGACY_KEYS.OPENAI_MODEL_V2);\n      await rawSet(STORAGE_KEYS.OPENAI_MODEL, legacy || DEFAULTS.openaiModel);\n    }\n\n    // Migrate max tokens (unified)\n    const tok = await rawGet(STORAGE_KEYS.MAX_OUTPUT_TOKENS);\n    if (!tok) {\n      const legacyUnified = await rawGet(LEGACY_KEYS.MAX_OUTPUT_TOKENS);\n      const legacyGem = await rawGet(LEGACY_KEYS.GEMINI_MAX_TOKENS_V2);\n      const legacyOai = await rawGet(LEGACY_KEYS.OPENAI_MAX_TOKENS_V2);\n\n      const candidates = [legacyUnified, legacyGem, legacyOai]\n        .map((x) => parseInt(String(x || \"\").trim(), 10))\n        .filter((n) => Number.isFinite(n) && n > 0);\n\n      const migrated = candidates.length ? Math.max(...candidates) : DEFAULTS.maxOutputTokens;\n      await rawSet(STORAGE_KEYS.MAX_OUTPUT_TOKENS, String(migrated));\n    }\n\n    await rawSet(STORAGE_KEYS.MIGRATION_DONE, \"1\");\n  })();\n\n  try {\n    await _migrationPromise;\n  } finally {\n    _migrationPromise = null;\n  }\n}\n\nexport function normalizeProvider(p) {\n  if (!p) return \"\";\n  const s = String(p).trim().toLowerCase();\n  if (s === PROVIDERS.GEMINI) return PROVIDERS.GEMINI;\n  if (s === PROVIDERS.OPENAI) return PROVIDERS.OPENAI;\n  // Common aliases (defensive)\n  if (s === \"google\" || s === \"gem\") return PROVIDERS.GEMINI;\n  if (s === \"oai\" || s === \"chatgpt\") return PROVIDERS.OPENAI;\n  return \"\";\n}\n\nconst GEMINI_REASONING_EFFORTS = new Set([\"auto\", \"minimal\", \"low\", \"medium\", \"high\"]);\nconst OPENAI_REASONING_EFFORTS = new Set([\"none\", \"minimal\", \"low\", \"medium\", \"high\"]);\n\nfunction normalizeGeminiReasoningEffort(value) {\n  const v = String(value || \"\").trim().toLowerCase();\n  if (!v) return DEFAULTS.geminiReasoningEffort;\n  return GEMINI_REASONING_EFFORTS.has(v) ? v : DEFAULTS.geminiReasoningEffort;\n}\n\nfunction normalizeReasoningEffort(value) {\n  const v = String(value || \"\").trim().toLowerCase();\n  if (!v) return DEFAULTS.openaiReasoningEffort;\n  return OPENAI_REASONING_EFFORTS.has(v) ? v : DEFAULTS.openaiReasoningEffort;\n}\n\nexport async function getDefaultProvider() {\n  await ensureMigrated();\n  const p = normalizeProvider(await rawGet(STORAGE_KEYS.DEFAULT_PROVIDER));\n  return p || DEFAULTS.provider;\n}\n\nexport async function setDefaultProvider(provider) {\n  const p = normalizeProvider(provider) || DEFAULTS.provider;\n  await rawSet(STORAGE_KEYS.DEFAULT_PROVIDER, p);\n  return p;\n}\n\nfunction keyKey(provider) {\n  const p = normalizeProvider(provider);\n  if (p === PROVIDERS.OPENAI) return STORAGE_KEYS.OPENAI_API_KEY;\n  return STORAGE_KEYS.GEMINI_API_KEY;\n}\n\nexport async function getApiKey(provider) {\n  await ensureMigrated();\n  const k = await rawGet(keyKey(provider));\n  return (k || \"\").trim();\n}\n\nexport async function hasApiKey(provider) {\n  const k = await getApiKey(provider);\n  return !!k;\n}\n\nexport async function setApiKey(provider, apiKey) {\n  const k = (apiKey || \"\").trim();\n  await rawSet(keyKey(provider), k);\n  return k;\n}\n\nexport async function clearApiKey(provider) {\n  await rawRemove(keyKey(provider));\n}\n\nfunction modelKey(provider) {\n  const p = normalizeProvider(provider);\n  if (p === PROVIDERS.OPENAI) return STORAGE_KEYS.OPENAI_MODEL;\n  return STORAGE_KEYS.GEMINI_MODEL;\n}\n\nexport async function getModel(provider) {\n  await ensureMigrated();\n  const p = normalizeProvider(provider);\n  const raw = await rawGet(modelKey(p));\n  if (raw && String(raw).trim()) return String(raw).trim();\n  return p === PROVIDERS.OPENAI ? DEFAULTS.openaiModel : DEFAULTS.geminiModel;\n}\n\nexport async function getGeminiReasoningEffort() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.GEMINI_REASONING_EFFORT);\n  return normalizeGeminiReasoningEffort(raw || DEFAULTS.geminiReasoningEffort);\n}\n\nexport async function getOpenAIReasoningEffort() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.OPENAI_REASONING_EFFORT);\n  return normalizeReasoningEffort(raw || DEFAULTS.openaiReasoningEffort);\n}\n\nexport async function setModel(provider, model) {\n  const p = normalizeProvider(provider);\n  const v = String(model || \"\").trim();\n  if (!v) {\n    // Reset to default if emptied\n    await rawSet(modelKey(p), p === PROVIDERS.OPENAI ? DEFAULTS.openaiModel : DEFAULTS.geminiModel);\n    return;\n  }\n  await rawSet(modelKey(p), v);\n}\n\nexport async function setOpenAIReasoningEffort(value) {\n  const v = normalizeReasoningEffort(value);\n  await rawSet(STORAGE_KEYS.OPENAI_REASONING_EFFORT, v);\n  return v;\n}\n\nexport async function setGeminiReasoningEffort(value) {\n  const v = normalizeGeminiReasoningEffort(value);\n  await rawSet(STORAGE_KEYS.GEMINI_REASONING_EFFORT, v);\n  return v;\n}\n\nexport async function getMaxOutputTokens() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.MAX_OUTPUT_TOKENS);\n  const n = parseInt(String(raw || \"\").trim(), 10);\n  return clampInt(n, 1, 128000, DEFAULTS.maxOutputTokens);\n}\n\nexport async function setMaxOutputTokens(value) {\n  const n = clampInt(value, 1, 128000, DEFAULTS.maxOutputTokens);\n  await rawSet(STORAGE_KEYS.MAX_OUTPUT_TOKENS, String(n));\n  return n;\n}\n\nexport async function getOnboardingSeen() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.ONBOARDING_SEEN);\n  return raw === \"1\";\n}\n\nexport async function setOnboardingSeen(seen = true) {\n  await rawSet(STORAGE_KEYS.ONBOARDING_SEEN, seen ? \"1\" : \"0\");\n  return seen;\n}\n\nexport async function getOnboardingKeysConfirmed() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.ONBOARDING_KEYS_CONFIRMED);\n  return raw === \"1\";\n}\n\nexport async function setOnboardingKeysConfirmed(confirmed = true) {\n  await rawSet(STORAGE_KEYS.ONBOARDING_KEYS_CONFIRMED, confirmed ? \"1\" : \"0\");\n  return confirmed;\n}\n\nconst PRIVACY_MODE_CACHE_TTL_MS = 2000;\n\nasync function loadPrivacyMode() {\n  const now = nowMs();\n  if (_privacyModeCache != null && now - _privacyModeCacheAt < PRIVACY_MODE_CACHE_TTL_MS) {\n    return _privacyModeCache;\n  }\n  const raw = await rawGet(STORAGE_KEYS.PRIVACY_MODE);\n  const enabled = raw === \"1\";\n  _privacyModeCache = enabled;\n  _privacyModeCacheAt = now;\n  return enabled;\n}\n\nexport async function getPrivacyMode() {\n  return await loadPrivacyMode();\n}\n\nexport async function setPrivacyMode(enabled = false) {\n  const next = !!enabled;\n  _privacyModeCache = next;\n  _privacyModeCacheAt = nowMs();\n  await rawSet(STORAGE_KEYS.PRIVACY_MODE, next ? \"1\" : \"0\");\n  return next;\n}\n\nfunction normalizeSectionList(value) {\n  if (!Array.isArray(value)) return [];\n  const out = [];\n  const seen = new Set();\n  for (const item of value) {\n    const key = String(item || \"\").trim();\n    if (!key || seen.has(key)) continue;\n    seen.add(key);\n    out.push(key);\n  }\n  return out;\n}\n\nexport async function getSectionOrder() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.SECTION_ORDER);\n  if (!raw) return [];\n  try {\n    return normalizeSectionList(JSON.parse(raw));\n  } catch {\n    return [];\n  }\n}\n\nexport async function setSectionOrder(order) {\n  const normalized = normalizeSectionList(order);\n  await rawSet(STORAGE_KEYS.SECTION_ORDER, JSON.stringify(normalized));\n  return normalized;\n}\n\nexport async function getHiddenSections() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.SECTION_HIDDEN);\n  if (!raw) return [];\n  try {\n    return normalizeSectionList(JSON.parse(raw));\n  } catch {\n    return [];\n  }\n}\n\nexport async function setHiddenSections(list) {\n  const normalized = normalizeSectionList(list);\n  await rawSet(STORAGE_KEYS.SECTION_HIDDEN, JSON.stringify(normalized));\n  return normalized;\n}\n\nexport async function getLicense() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.LICENSE);\n  if (!raw) return null;\n  try {\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}\n\nexport async function setLicense(license) {\n  if (!license) {\n    await rawRemove(STORAGE_KEYS.LICENSE);\n    return null;\n  }\n  await rawSet(STORAGE_KEYS.LICENSE, JSON.stringify(license));\n  return license;\n}\n\nexport async function clearLicense() {\n  await rawRemove(STORAGE_KEYS.LICENSE);\n}\n\n// ---------- Small utilities ----------\nexport function nowMs() {\n  return Date.now();\n}\n\nexport function sleep(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nexport function clamp(value, min, max, fallback = min) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return fallback;\n  return Math.max(min, Math.min(max, n));\n}\n\nexport function clampInt(value, min, max, fallback = min) {\n  const n = parseInt(String(value), 10);\n  if (!Number.isFinite(n)) return fallback;\n  return Math.max(min, Math.min(max, n));\n}\n\nconst REDACT_PATTERNS = [\n  /\\bsk-[A-Za-z0-9-_]{1,}\\b/gi,\n  /\\bAIza[0-9A-Za-z_-]{1,}\\b/gi,\n  /\\b[A-Z0-9]{4}(?:-[A-Z0-9]{4}){1,3}\\b/gi\n];\n\nexport function redactSensitiveText(value) {\n  if (value == null) return \"\";\n  let text = String(value);\n  for (const pattern of REDACT_PATTERNS) {\n    text = text.replace(pattern, \"[REDACTED]\");\n  }\n  return text;\n}\n\nexport function redactSensitiveValue(value) {\n  if (value == null) return value;\n  if (typeof value === \"string\") return redactSensitiveText(value);\n  if (Array.isArray(value)) return value.map(redactSensitiveValue);\n  if (typeof value === \"object\") {\n    const out = {};\n    for (const [key, entry] of Object.entries(value)) {\n      out[key] = redactSensitiveValue(entry);\n    }\n    return out;\n  }\n  return value;\n}\n\nfunction parseTimestampMs(raw) {\n  const n = parseInt(String(raw || \"\").trim(), 10);\n  return Number.isFinite(n) && n > 0 ? n : 0;\n}\n\n// ---------- LRU cache with TTL ----------\nexport class LRUCache {\n  constructor(maxEntries = 500) {\n    this.maxEntries = maxEntries;\n    this.map = new Map(); // key => {value, expiresAtMs}\n  }\n\n  get(key) {\n    if (!this.map.has(key)) return null;\n    const entry = this.map.get(key);\n\n    if (entry?.expiresAtMs && entry.expiresAtMs <= nowMs()) {\n      this.map.delete(key);\n      return null;\n    }\n\n    // Refresh key order (most recent)\n    this.map.delete(key);\n    this.map.set(key, entry);\n    return entry.value;\n  }\n\n  set(key, value, ttlMs) {\n    const expiresAtMs = typeof ttlMs === \"number\" && ttlMs > 0 ? nowMs() + ttlMs : null;\n    if (this.map.has(key)) this.map.delete(key);\n    this.map.set(key, { value, expiresAtMs });\n\n    // Evict LRU\n    while (this.map.size > this.maxEntries) {\n      const oldestKey = this.map.keys().next().value;\n      this.map.delete(oldestKey);\n    }\n  }\n\n  clear() {\n    this.map.clear();\n  }\n}\n\n// ---------- Persistent cache (survives reloads) ----------\nconst CACHE_ENTRY_PREFIX = \"AI_CACHE_ENTRY_V1:\";\nconst CACHE_INDEX_MAX = 250;\nlet _cacheClearMs = 0;\n\nasync function syncCacheClearMarker() {\n  const clearedAt = parseTimestampMs(await rawGet(STORAGE_KEYS.CACHE_CLEAR_AT));\n  if (clearedAt > _cacheClearMs) _cacheClearMs = clearedAt;\n  return _cacheClearMs;\n}\n\nexport async function getCacheClearAt() {\n  return await syncCacheClearMarker();\n}\n\nasync function loadCacheIndex() {\n  const raw = await rawGet(STORAGE_KEYS.CACHE_INDEX);\n  if (!raw) return [];\n  try {\n    const arr = JSON.parse(raw);\n    return Array.isArray(arr) ? arr : [];\n  } catch {\n    return [];\n  }\n}\n\nasync function saveCacheIndex(entries) {\n  try {\n    await rawSet(STORAGE_KEYS.CACHE_INDEX, JSON.stringify(entries));\n  } catch {\n    // ignore\n  }\n}\n\nfunction pruneCacheIndex(entries, clearedAt = 0) {\n  const now = nowMs();\n  const kept = [];\n  const removedKeys = [];\n\n  for (const entry of entries || []) {\n    if (!entry || !entry.key) continue;\n    const savedAt = Number(entry.savedAtMs || 0);\n    if (clearedAt && (!Number.isFinite(savedAt) || savedAt <= clearedAt)) {\n      removedKeys.push(entry.key);\n      continue;\n    }\n    if (entry.expiresAtMs && entry.expiresAtMs <= now) {\n      removedKeys.push(entry.key);\n      continue;\n    }\n    kept.push(entry);\n  }\n\n  if (kept.length > CACHE_INDEX_MAX) {\n    kept.sort((a, b) => (a.savedAtMs || 0) - (b.savedAtMs || 0));\n    const over = kept.length - CACHE_INDEX_MAX;\n    const toRemove = kept.slice(0, over);\n    for (const r of toRemove) removedKeys.push(r.key);\n    return { list: kept.slice(over), removedKeys };\n  }\n\n  return { list: kept, removedKeys };\n}\n\nasync function removeCacheEntry(key) {\n  if (!key) return;\n  await rawRemove(CACHE_ENTRY_PREFIX + key);\n}\n\nasync function removeFromCacheIndex(key) {\n  const index = await loadCacheIndex();\n  const next = (index || []).filter((item) => item?.key !== key);\n  if (next.length !== index.length) await saveCacheIndex(next);\n}\n\nexport async function getPersistentCache(cacheKey) {\n  if (!cacheKey) return null;\n  if (await getPrivacyMode()) return null;\n  const clearedAt = await syncCacheClearMarker();\n  const raw = await rawGet(CACHE_ENTRY_PREFIX + cacheKey);\n  if (!raw) {\n    await removeFromCacheIndex(cacheKey);\n    return null;\n  }\n\n  try {\n    const entry = JSON.parse(raw);\n    if (!entry || typeof entry !== \"object\") throw new Error(\"Invalid entry\");\n    const savedAt = Number(entry.savedAtMs || 0);\n    if (clearedAt && (!Number.isFinite(savedAt) || savedAt <= clearedAt)) {\n      await removeCacheEntry(cacheKey);\n      await removeFromCacheIndex(cacheKey);\n      return null;\n    }\n    if (entry.expiresAtMs && entry.expiresAtMs <= nowMs()) {\n      await removeCacheEntry(cacheKey);\n      await removeFromCacheIndex(cacheKey);\n      return null;\n    }\n    return entry.value || null;\n  } catch {\n    await removeCacheEntry(cacheKey);\n    await removeFromCacheIndex(cacheKey);\n    return null;\n  }\n}\n\nexport async function setPersistentCache(cacheKey, value, ttlMs, meta = {}) {\n  if (!cacheKey) return;\n  if (await getPrivacyMode()) return;\n  const now = nowMs();\n  const clearedAt = await syncCacheClearMarker();\n  const savedAtMs = clearedAt && now <= clearedAt ? clearedAt + 1 : now;\n  const expiresAtMs = typeof ttlMs === \"number\" && ttlMs > 0 ? savedAtMs + ttlMs : null;\n  const entry = {\n    v: 1,\n    savedAtMs,\n    expiresAtMs,\n    value\n  };\n\n  const raw = JSON.stringify(entry);\n  await rawSet(CACHE_ENTRY_PREFIX + cacheKey, raw);\n\n  const index = await loadCacheIndex();\n  const provider = meta.provider || value?.provider || \"\";\n  const model = meta.model || value?.model || \"\";\n  const size = raw.length;\n\n  let updated = false;\n  const next = (index || []).map((item) => {\n    if (item?.key !== cacheKey) return item;\n    updated = true;\n    return {\n      key: cacheKey,\n      provider,\n      model,\n      size,\n      savedAtMs,\n      expiresAtMs\n    };\n  });\n\n  if (!updated) {\n    next.push({\n      key: cacheKey,\n      provider,\n      model,\n      size,\n      savedAtMs,\n      expiresAtMs\n    });\n  }\n\n  const pruned = pruneCacheIndex(next, clearedAt);\n  for (const key of pruned.removedKeys) await removeCacheEntry(key);\n  await saveCacheIndex(pruned.list);\n}\n\nexport async function clearPersistentCache() {\n  const clearedAt = nowMs();\n  _cacheClearMs = clearedAt;\n  await rawSet(STORAGE_KEYS.CACHE_CLEAR_AT, String(clearedAt));\n  const index = await loadCacheIndex();\n  for (const item of index || []) {\n    if (!item?.key) continue;\n    await removeCacheEntry(item.key);\n  }\n  await rawRemove(STORAGE_KEYS.CACHE_INDEX);\n}\n\nexport async function getPersistentCacheStats() {\n  if (await getPrivacyMode()) {\n    return {\n      entries: 0,\n      sizeBytes: 0,\n      providers: {\n        gemini: { entries: 0, sizeBytes: 0 },\n        openai: { entries: 0, sizeBytes: 0 }\n      },\n      oldestMs: null,\n      newestMs: null\n    };\n  }\n  const index = await loadCacheIndex();\n  const clearedAt = await syncCacheClearMarker();\n  const pruned = pruneCacheIndex(index, clearedAt);\n  if (pruned.removedKeys.length) {\n    for (const key of pruned.removedKeys) await removeCacheEntry(key);\n    await saveCacheIndex(pruned.list);\n  }\n\n  const stats = {\n    entries: 0,\n    sizeBytes: 0,\n    providers: {\n      gemini: { entries: 0, sizeBytes: 0 },\n      openai: { entries: 0, sizeBytes: 0 }\n    },\n    oldestMs: null,\n    newestMs: null\n  };\n\n  for (const item of pruned.list || []) {\n    if (!item?.key) continue;\n    stats.entries += 1;\n    stats.sizeBytes += Number(item.size || 0);\n    const provider = String(item.provider || \"\").toLowerCase();\n    if (provider === PROVIDERS.GEMINI) {\n      stats.providers.gemini.entries += 1;\n      stats.providers.gemini.sizeBytes += Number(item.size || 0);\n    } else if (provider === PROVIDERS.OPENAI) {\n      stats.providers.openai.entries += 1;\n      stats.providers.openai.sizeBytes += Number(item.size || 0);\n    }\n\n    const savedAt = Number(item.savedAtMs || 0);\n    if (savedAt) {\n      stats.oldestMs = stats.oldestMs == null ? savedAt : Math.min(stats.oldestMs, savedAt);\n      stats.newestMs = stats.newestMs == null ? savedAt : Math.max(stats.newestMs, savedAt);\n    }\n  }\n\n  return stats;\n}\n\n// ---------- Stable stringify + hashing (for cache keys) ----------\nfunction isPlainObject(v) {\n  return Object.prototype.toString.call(v) === \"[object Object]\";\n}\n\nexport function stableStringify(value) {\n  return JSON.stringify(sortKeysDeep(value));\n}\n\nfunction sortKeysDeep(value) {\n  if (Array.isArray(value)) return value.map(sortKeysDeep);\n  if (isPlainObject(value)) {\n    const out = {};\n    for (const k of Object.keys(value).sort()) out[k] = sortKeysDeep(value[k]);\n    return out;\n  }\n  return value;\n}\n\nfunction fnv1a32(str) {\n  let h = 2166136261;\n  for (let i = 0; i < str.length; i++) {\n    h ^= str.charCodeAt(i);\n    h = Math.imul(h, 16777619);\n  }\n  // Unsigned\n  return (h >>> 0).toString(16).padStart(8, \"0\");\n}\n\nexport async function hashKey(input) {\n  const text = typeof input === \"string\" ? input : stableStringify(input);\n\n  // Prefer SHA-256 when available (browser/Office runtime)\n  try {\n    if (typeof crypto !== \"undefined\" && crypto?.subtle?.digest && typeof TextEncoder !== \"undefined\") {\n      const enc = new TextEncoder();\n      const bytes = enc.encode(text);\n      const digest = await crypto.subtle.digest(\"SHA-256\", bytes);\n      const arr = Array.from(new Uint8Array(digest));\n      return arr.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n    }\n  } catch {\n    // ignore and fallback\n  }\n\n  return `fnv1a:${fnv1a32(text)}`;\n}\n\n// ---------- Lightweight diagnostics log (persisted) ----------\nconst REQUEST_LOG_MAX = 100;\nconst REQUEST_LOG_TTL_MS = Infinity; // Kept until manual reset (capped by count)\nlet _requestLog = [];\nlet _requestLogLoading = null;\nlet _requestLogLoaded = false;\nlet _requestLogLastLoadedMs = 0;\nlet _requestLogClearMs = 0;\nconst USAGE_TOTALS_CACHE_TTL_MS = 1500;\nlet _usageTotals = createEmptyUsageTotals();\nlet _usageTotalsLoading = null;\nlet _usageTotalsLoaded = false;\nlet _usageTotalsLastLoadedMs = 0;\n\nasync function syncRequestLogClearMarker(options = {}) {\n  const clearedAt = parseTimestampMs(await rawGet(STORAGE_KEYS.REQUEST_LOG_CLEAR_AT));\n  if (clearedAt > _requestLogClearMs) {\n    _requestLogClearMs = clearedAt;\n    _requestLog = [];\n    if (options.reset) {\n      _requestLogLoaded = true;\n      _requestLogLoading = null;\n      _requestLogLastLoadedMs = nowMs();\n    } else {\n      _requestLogLoaded = false;\n    }\n  }\n  return _requestLogClearMs;\n}\n\nasync function loadRequestLog(force = false) {\n  if (_requestLogLoading) return _requestLogLoading;\n\n  _requestLogLoading = (async () => {\n    const privacyMode = await getPrivacyMode();\n    if (privacyMode) {\n      if (force || !_requestLogLoaded) {\n        _requestLogLoaded = true;\n        _requestLogLastLoadedMs = nowMs();\n      }\n      return _requestLog;\n    }\n    const clearedAt = await syncRequestLogClearMarker();\n    if (!force && _requestLogLoaded) return _requestLog;\n    const raw = await rawGet(STORAGE_KEYS.REQUEST_LOG);\n    let arr = [];\n    if (raw) {\n      try {\n        const parsed = JSON.parse(raw);\n        if (Array.isArray(parsed)) arr = parsed;\n      } catch {\n        arr = [];\n      }\n    }\n    const now = nowMs();\n    arr = arr\n      .map((e) => {\n        if (!e) return null;\n        let ts = e.ts;\n        if (typeof ts === \"string\") {\n          const parsed = Date.parse(ts);\n          if (Number.isFinite(parsed)) ts = parsed;\n        }\n        if (typeof ts !== \"number\") return null;\n        return { ...e, ts };\n      })\n      .filter((e) => e && typeof e.ts === \"number\" && e.ts > clearedAt && now - e.ts <= REQUEST_LOG_TTL_MS)\n      .map((e) => sanitizeLogEntry(e));\n    _requestLog = arr.slice(-REQUEST_LOG_MAX);\n    _requestLogLoaded = true;\n    _requestLogLastLoadedMs = nowMs();\n    return _requestLog;\n  })();\n\n  try {\n    return await _requestLogLoading;\n  } finally {\n    _requestLogLoading = null;\n  }\n}\n\nasync function persistRequestLog() {\n  try {\n    if (await getPrivacyMode()) return;\n    await rawSet(STORAGE_KEYS.REQUEST_LOG, JSON.stringify(_requestLog.slice(-REQUEST_LOG_MAX)));\n  } catch {\n    // ignore\n  }\n}\n\nfunction pruneRequestLog() {\n  const now = nowMs();\n  const clearedAt = _requestLogClearMs || 0;\n  _requestLog = (_requestLog || []).filter(\n    (e) => e && typeof e.ts === \"number\" && e.ts > clearedAt && now - e.ts <= REQUEST_LOG_TTL_MS\n  );\n  if (_requestLog.length > REQUEST_LOG_MAX) {\n    _requestLog = _requestLog.slice(-REQUEST_LOG_MAX);\n  }\n}\n\n// ---------- Persistent usage totals ----------\nfunction toNonNegInt(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n) || n <= 0) return 0;\n  return Math.floor(n);\n}\n\nfunction createEmptyUsageTotals() {\n  return {\n    inputTokens: 0,\n    outputTokens: 0,\n    reasoningTokens: 0,\n    cachedInputTokens: 0,\n    requests: 0,\n    byProvider: {\n      [PROVIDERS.GEMINI]: {\n        inputTokens: 0,\n        outputTokens: 0,\n        reasoningTokens: 0,\n        cachedInputTokens: 0,\n        requests: 0,\n        models: {}\n      },\n      [PROVIDERS.OPENAI]: {\n        inputTokens: 0,\n        outputTokens: 0,\n        reasoningTokens: 0,\n        cachedInputTokens: 0,\n        requests: 0,\n        models: {}\n      }\n    }\n  };\n}\n\nfunction normalizeUsageTotals(raw) {\n  const base = createEmptyUsageTotals();\n  if (!raw || typeof raw !== \"object\") return base;\n\n  base.inputTokens = toNonNegInt(raw.inputTokens);\n  base.outputTokens = toNonNegInt(raw.outputTokens);\n  base.reasoningTokens = toNonNegInt(raw.reasoningTokens);\n  base.cachedInputTokens = toNonNegInt(raw.cachedInputTokens);\n  base.requests = toNonNegInt(raw.requests);\n\n  const providers = raw.byProvider && typeof raw.byProvider === \"object\" ? raw.byProvider : {};\n  for (const provider of [PROVIDERS.GEMINI, PROVIDERS.OPENAI]) {\n    const rawProvider = providers[provider];\n    if (!rawProvider || typeof rawProvider !== \"object\") continue;\n    const target = base.byProvider[provider];\n    target.inputTokens = toNonNegInt(rawProvider.inputTokens);\n    target.outputTokens = toNonNegInt(rawProvider.outputTokens);\n    target.reasoningTokens = toNonNegInt(rawProvider.reasoningTokens);\n    target.cachedInputTokens = toNonNegInt(rawProvider.cachedInputTokens);\n    target.requests = toNonNegInt(rawProvider.requests);\n\n    const rawModels = rawProvider.models && typeof rawProvider.models === \"object\" ? rawProvider.models : {};\n    for (const [key, value] of Object.entries(rawModels)) {\n      if (!value || typeof value !== \"object\") continue;\n      const label = typeof value.label === \"string\" ? value.label : String(key || \"\");\n      const modelKey = String(key || label || \"\").toLowerCase();\n      if (!modelKey) continue;\n      target.models[modelKey] = {\n        label,\n        inputTokens: toNonNegInt(value.inputTokens),\n        outputTokens: toNonNegInt(value.outputTokens),\n        reasoningTokens: toNonNegInt(value.reasoningTokens),\n        cachedInputTokens: toNonNegInt(value.cachedInputTokens),\n        requests: toNonNegInt(value.requests)\n      };\n    }\n  }\n\n  return base;\n}\n\nfunction cloneUsageTotals(value) {\n  try {\n    return JSON.parse(JSON.stringify(value || createEmptyUsageTotals()));\n  } catch {\n    return createEmptyUsageTotals();\n  }\n}\n\nasync function loadUsageTotals(force = false) {\n  if (_usageTotalsLoading) return _usageTotalsLoading;\n\n  _usageTotalsLoading = (async () => {\n    const privacyMode = await getPrivacyMode();\n    if (privacyMode) {\n      if (force || !_usageTotalsLoaded) {\n        _usageTotalsLoaded = true;\n        _usageTotalsLastLoadedMs = nowMs();\n      }\n      return _usageTotals;\n    }\n\n    if (!force && _usageTotalsLoaded) return _usageTotals;\n\n    const raw = await rawGet(STORAGE_KEYS.USAGE_TOTALS);\n    let parsed = null;\n    if (raw) {\n      try {\n        parsed = JSON.parse(raw);\n      } catch {\n        parsed = null;\n      }\n    }\n\n    _usageTotals = normalizeUsageTotals(parsed);\n    _usageTotalsLoaded = true;\n    _usageTotalsLastLoadedMs = nowMs();\n    return _usageTotals;\n  })();\n\n  try {\n    return await _usageTotalsLoading;\n  } finally {\n    _usageTotalsLoading = null;\n  }\n}\n\nasync function persistUsageTotals() {\n  try {\n    if (await getPrivacyMode()) return;\n    await rawSet(STORAGE_KEYS.USAGE_TOTALS, JSON.stringify(_usageTotals));\n  } catch {\n    // ignore\n  }\n}\n\nasync function updateUsageTotals(entry) {\n  try {\n    if (!entry || typeof entry !== \"object\") return;\n\n    const inputTokens = toNonNegInt(entry.inputTokens);\n    const outputTokens = toNonNegInt(entry.outputTokens);\n    const reasoningTokens = toNonNegInt(entry.reasoningTokens);\n    const cachedInputTokens = toNonNegInt(entry.cachedInputTokens);\n    const hasUsage = inputTokens + outputTokens + reasoningTokens + cachedInputTokens > 0;\n    if (!hasUsage) return;\n\n    const provider = String(entry.provider || \"\").toLowerCase();\n    if (provider !== PROVIDERS.GEMINI && provider !== PROVIDERS.OPENAI) return;\n\n    const modelLabel = String(entry.model || \"\").trim();\n    const modelKey = (modelLabel || \"unknown\").toLowerCase();\n\n    await loadUsageTotals();\n\n    _usageTotals.inputTokens += inputTokens;\n    _usageTotals.outputTokens += outputTokens;\n    _usageTotals.reasoningTokens += reasoningTokens;\n    _usageTotals.cachedInputTokens += cachedInputTokens;\n    _usageTotals.requests += 1;\n\n    const providerTotals = _usageTotals.byProvider[provider];\n    providerTotals.inputTokens += inputTokens;\n    providerTotals.outputTokens += outputTokens;\n    providerTotals.reasoningTokens += reasoningTokens;\n    providerTotals.cachedInputTokens += cachedInputTokens;\n    providerTotals.requests += 1;\n\n    const models = providerTotals.models || {};\n    const existing = models[modelKey] || {\n      label: modelLabel,\n      inputTokens: 0,\n      outputTokens: 0,\n      reasoningTokens: 0,\n      cachedInputTokens: 0,\n      requests: 0\n    };\n    if (!existing.label && modelLabel) existing.label = modelLabel;\n    existing.inputTokens += inputTokens;\n    existing.outputTokens += outputTokens;\n    existing.reasoningTokens += reasoningTokens;\n    existing.cachedInputTokens += cachedInputTokens;\n    existing.requests += 1;\n    models[modelKey] = existing;\n    providerTotals.models = models;\n\n    _usageTotalsLastLoadedMs = nowMs();\n    await persistUsageTotals();\n  } catch {\n    // ignore\n  }\n}\n\nexport async function getUsageTotals(options = {}) {\n  const force = !!options?.fresh;\n  const now = nowMs();\n  if (force || !_usageTotalsLoaded || now - _usageTotalsLastLoadedMs > USAGE_TOTALS_CACHE_TTL_MS) {\n    await loadUsageTotals(true);\n  } else {\n    await loadUsageTotals(false);\n  }\n  return cloneUsageTotals(_usageTotals);\n}\n\nexport async function clearUsageTotals() {\n  _usageTotals = createEmptyUsageTotals();\n  _usageTotalsLoaded = true;\n  _usageTotalsLoading = null;\n  _usageTotalsLastLoadedMs = nowMs();\n  await rawRemove(STORAGE_KEYS.USAGE_TOTALS);\n}\n\nexport function logRequest(entry) {\n  void logRequestAsync(entry);\n}\n\nfunction sanitizeLogEntry(entry) {\n  if (!entry || typeof entry !== \"object\") return entry;\n  return redactSensitiveValue(entry);\n}\n\nasync function logRequestAsync(entry) {\n  try {\n    const logEntry = sanitizeLogEntry({ ts: nowMs(), ...entry });\n    await updateUsageTotals(logEntry);\n    const privacyMode = await getPrivacyMode();\n    if (privacyMode) {\n      _requestLog.push(logEntry);\n      pruneRequestLog();\n      _requestLogLoaded = true;\n      _requestLogLastLoadedMs = nowMs();\n      return;\n    }\n\n    await syncRequestLogClearMarker({ reset: true });\n\n    if (_requestLogLoaded) {\n      _requestLog.push(logEntry);\n      pruneRequestLog();\n      _requestLogLastLoadedMs = nowMs();\n      await persistRequestLog();\n      return;\n    }\n\n    await loadRequestLog();\n    _requestLog.push(logEntry);\n    pruneRequestLog();\n    _requestLogLastLoadedMs = nowMs();\n    await persistRequestLog();\n  } catch {\n    // ignore\n  }\n}\n\nexport async function getRequestLog(options = {}) {\n  const force = !!options?.fresh;\n  const now = nowMs();\n  if (force || !_requestLogLoaded || now - _requestLogLastLoadedMs > 1500) {\n    await loadRequestLog(true);\n  } else {\n    await loadRequestLog(false);\n  }\n  return _requestLog.slice();\n}\n\nexport async function clearRequestLog() {\n  const clearedAt = nowMs();\n  _requestLog = [];\n  _requestLogLoaded = true;\n  _requestLogLoading = null;\n  _requestLogClearMs = clearedAt;\n  _requestLogLastLoadedMs = clearedAt;\n  await rawSet(STORAGE_KEYS.REQUEST_LOG_CLEAR_AT, String(clearedAt));\n  await rawRemove(STORAGE_KEYS.REQUEST_LOG);\n}\n","// src/shared/providers.js\n// Provider implementations (Gemini + OpenAI) and shared request orchestration.\n//\n// Requirements implemented:\n// - Gemini 3 Flash (via Google Generative Language API)\n// - OpenAI GPT-5 Mini (via OpenAI Responses API)\n// - No temperature / sampling parameters are ever sent\n// - Provider selection happens via taskpane default provider (formulas cannot override)\n// - AI.WEB uses provider-native web search mechanisms:\n//   - Gemini: google_search tool\n//   - OpenAI: web_search tool\n\nimport {\n  PROVIDERS,\n  DEFAULTS,\n  normalizeProvider,\n  getDefaultProvider,\n  getApiKey,\n  getModel,\n  getGeminiReasoningEffort,\n  getOpenAIReasoningEffort,\n  getMaxOutputTokens,\n  clampInt,\n  nowMs,\n  sleep,\n  LRUCache,\n  hashKey,\n  logRequest,\n  getCacheClearAt,\n  getPersistentCache,\n  setPersistentCache,\n  clearPersistentCache,\n  redactSensitiveText\n} from \"./core.js\";\n\n// ---- In-memory cache (per runtime) ----\nconst CACHE = new LRUCache(800);\nlet _cacheClearLocalMs = 0;\n\nasync function syncCacheClearMarker() {\n  const clearedAt = await getCacheClearAt();\n  if (clearedAt > _cacheClearLocalMs) {\n    _cacheClearLocalMs = clearedAt;\n    CACHE.clear();\n  }\n}\n\n// Deduplicate in-flight identical requests to avoid bursts (per runtime)\nconst INFLIGHT = new Map(); // key => Promise<AIResult>\n\n// Basic concurrency limiter (per runtime)\nconst MAX_CONCURRENCY = 4;\nlet active = 0;\nconst queue = [];\n\nasync function withConcurrencyLimit(fn) {\n  if (active >= MAX_CONCURRENCY) await new Promise((resolve) => queue.push(resolve));\n  active++;\n  try {\n    return await fn();\n  } finally {\n    active--;\n    const next = queue.shift();\n    if (next) next();\n  }\n}\n\nfunction isNonEmptyString(s) {\n  return typeof s === \"string\" && s.trim().length > 0;\n}\n\nfunction normalizeBoolean(v, def = false) {\n  if (typeof v === \"boolean\") return v;\n  if (typeof v === \"number\") return v !== 0;\n  if (typeof v === \"string\") {\n    const s = v.trim().toLowerCase();\n    if ([\"1\", \"true\", \"yes\", \"y\", \"on\"].includes(s)) return true;\n    if ([\"0\", \"false\", \"no\", \"n\", \"off\"].includes(s)) return false;\n  }\n  return def;\n}\n\nfunction normalizeTimeoutMs(v) {\n  return clampInt(v, 1000, 120000, DEFAULTS.timeoutMs);\n}\n\nfunction normalizeRetry(v) {\n  return clampInt(v, 0, 5, DEFAULTS.retry);\n}\n\nfunction normalizeMaxOutputTokens(v) {\n  return clampInt(v, 1, 128000, DEFAULTS.maxOutputTokens);\n}\n\nfunction toLowerMsg(v) {\n  return String(v || \"\").toLowerCase();\n}\n\nfunction looksLikeStructuredOutputUnsupported(message) {\n  const s = toLowerMsg(message);\n  if (!s) return false;\n  return (\n    s.includes(\"responseschema\") ||\n    s.includes(\"response schema\") ||\n    s.includes(\"response_schema\") ||\n    s.includes(\"responsemime\") ||\n    s.includes(\"response mime\") ||\n    s.includes(\"response_mime\") ||\n    s.includes(\"response_mime_type\") ||\n    s.includes(\"json_schema\") ||\n    s.includes(\"response_format\") ||\n    s.includes(\"text.format\")\n  );\n}\n\nfunction looksLikeWebSearchUnsupported(message) {\n  const s = toLowerMsg(message);\n  if (!s) return false;\n  if (!(s.includes(\"web_search\") || s.includes(\"google_search\") || s.includes(\"web search\") || s.includes(\"google search\"))) {\n    return false;\n  }\n  return (\n    s.includes(\"not supported\") ||\n    s.includes(\"unsupported\") ||\n    s.includes(\"unknown\") ||\n    s.includes(\"unrecognized\") ||\n    s.includes(\"invalid\") ||\n    s.includes(\"not enabled\") ||\n    s.includes(\"not available\")\n  );\n}\n\nfunction ensureJsonInstruction(system) {\n  const suffix = \" Return valid JSON only.\";\n  if (!isNonEmptyString(system)) return \"Return valid JSON only.\";\n  const s = String(system).trim();\n  if (/json/i.test(s)) return s;\n  return s + suffix;\n}\n\nfunction extractFormulaFromText(text) {\n  if (!isNonEmptyString(text)) return \"\";\n  const raw = String(text).trim();\n  const match = raw.match(/=[^\\n\\r]+/);\n  const formula = (match ? match[0] : raw).trim();\n  if (!formula.startsWith(\"=\")) return \"\";\n  return formula;\n}\n\nfunction getFormulaForLog(fnName, text) {\n  if (fnName !== \"AI.FORMULA\") return \"\";\n  return extractFormulaFromText(text);\n}\n\nfunction resolveGeminiThinkingConfig(model, effort) {\n  const level = String(effort || \"\").trim().toLowerCase();\n  if (!level || level === \"auto\" || level === \"none\") return null;\n\n  const modelId = String(model || \"\").trim().toLowerCase();\n  if (!modelId.includes(\"gemini\")) return null;\n\n  if (modelId.includes(\"gemini-3\")) {\n    if (modelId.includes(\"flash\")) {\n      const allowed = new Set([\"minimal\", \"low\", \"medium\", \"high\"]);\n      const normalized = allowed.has(level) ? level : \"low\";\n      return { thinkingLevel: normalized.toUpperCase() };\n    }\n    const normalized = level === \"high\" || level === \"medium\" ? \"high\" : \"low\";\n    return { thinkingLevel: normalized.toUpperCase() };\n  }\n\n  if (modelId.includes(\"gemini-2.5\")) {\n    const budgets = {\n      minimal: 512,\n      low: 2048,\n      medium: 8192,\n      high: 24576\n    };\n    let budget = budgets[level];\n    if (!budget) return null;\n    if (modelId.includes(\"flash-lite\")) budget = Math.max(512, budget);\n    if (modelId.includes(\"pro\")) budget = Math.max(128, budget);\n    return { thinkingBudget: budget };\n  }\n\n  return null;\n}\n\n// ---- Public API ----\n\n/**\n * @typedef {Object} AIGenerateRequest\n * @property {string=} provider Optional override (should only be used by taskpane tests, not formulas).\n * @property {string=} system System instruction.\n * @property {string} user User prompt.\n * @property {boolean=} webSearch Enable provider web search tool.\n * @property {number=} maxOutputTokens Override max tokens (optional; normally from panel).\n * @property {number=} timeoutMs\n * @property {number=} retry\n * @property {boolean=} cache\n * @property {number=} cacheTtlSec\n * @property {string=} responseMimeType e.g., \"application/json\"\n * @property {Object=} responseJsonSchema JSON schema (strict) for structured output.\n * @property {string=} functionName Name for diagnostics.\n * @property {string=} functionCall Excel-style function call for diagnostics.\n */\n\n/**\n * @typedef {Object} AIResult\n * @property {boolean} ok\n * @property {string=} text\n * @property {Array<{title?: string, url: string}>=} sources\n * @property {string=} provider\n * @property {string=} model\n * @property {Object=} usage\n * @property {string=} code\n * @property {string=} message\n */\n\nexport async function aiGenerate(req) {\n  const start = nowMs();\n  const provider = normalizeProvider(req?.provider) || (await getDefaultProvider());\n  const model = await getModel(provider);\n  const apiKey = await getApiKey(provider);\n  const fnName = req?.functionName || \"aiGenerate\";\n  const functionCall = isNonEmptyString(req?.functionCall) ? String(req.functionCall) : \"\";\n  const reasoningEffort = provider === PROVIDERS.OPENAI ? await getOpenAIReasoningEffort() : \"\";\n  const geminiReasoningEffort = provider === PROVIDERS.GEMINI ? await getGeminiReasoningEffort() : \"\";\n  const reasoningEffortLabel = provider === PROVIDERS.OPENAI ? reasoningEffort : geminiReasoningEffort;\n\n  if (!apiKey) {\n    logRequest({\n      fn: fnName,\n      provider,\n      model,\n      ok: false,\n      ms: nowMs() - start,\n      cache: false,\n      reasoningEffort: reasoningEffortLabel || undefined,\n      call: functionCall || undefined,\n      code: \"API_KEY_MISSING\",\n      message: `Cl API manquante pour le fournisseur ${provider}.`\n    });\n    return {\n      ok: false,\n      provider,\n      model,\n      code: \"API_KEY_MISSING\",\n      message: `Cl API manquante pour le fournisseur ${provider}.`\n    };\n  }\n\n  const user = String(req?.user || \"\");\n  const system = isNonEmptyString(req?.system) ? String(req.system) : \"\";\n\n  const webSearch = normalizeBoolean(req?.webSearch, false);\n  const timeoutMs = normalizeTimeoutMs(req?.timeoutMs);\n  const retry = normalizeRetry(req?.retry);\n\n  const cfgMax = await getMaxOutputTokens();\n  const maxOutputTokens = normalizeMaxOutputTokens(req?.maxOutputTokens ?? cfgMax);\n  const thinkingConfig = provider === PROVIDERS.GEMINI ? resolveGeminiThinkingConfig(model, geminiReasoningEffort) : null;\n\n  const cacheEnabled = normalizeBoolean(req?.cache, DEFAULTS.cache);\n  const ttlSec = clampInt(\n    req?.cacheTtlSec ?? (webSearch ? DEFAULTS.webCacheTtlSec : DEFAULTS.cacheTtlSec),\n    1,\n    365 * 24 * 3600,\n    webSearch ? DEFAULTS.webCacheTtlSec : DEFAULTS.cacheTtlSec\n  );\n\n  await syncCacheClearMarker();\n\n  // Cache key (no temperature anywhere)\n  const cacheKeyPayload = {\n    v: 3,\n    provider,\n    model,\n    maxOutputTokens,\n    reasoningEffort,\n    geminiReasoningEffort,\n    webSearch,\n    system,\n    user,\n    responseMimeType: req?.responseMimeType || \"\",\n    responseJsonSchema: req?.responseJsonSchema || null\n  };\n\n  const cacheKey = await hashKey(cacheKeyPayload);\n\n  if (cacheEnabled) {\n    const cached = CACHE.get(cacheKey);\n    if (cached) {\n      const formula = getFormulaForLog(fnName, cached?.text);\n      logRequest({\n        fn: fnName,\n        provider,\n        model,\n        ok: true,\n        ms: nowMs() - start,\n        cache: true,\n        cacheKind: \"memory\",\n        reasoningEffort: reasoningEffortLabel || undefined,\n        call: functionCall || undefined,\n        inputTokens: 0,\n        outputTokens: 0,\n        reasoningTokens: 0,\n        totalTokens: 0,\n        formula: formula || undefined\n      });\n      return { ...cached, cached: true, cacheKind: \"memory\" };\n    }\n    const persisted = await getPersistentCache(cacheKey);\n    if (persisted) {\n      const formula = getFormulaForLog(fnName, persisted?.text);\n      CACHE.set(cacheKey, persisted, ttlSec * 1000);\n      logRequest({\n        fn: fnName,\n        provider,\n        model,\n        ok: true,\n        ms: nowMs() - start,\n        cache: true,\n        cacheKind: \"persistent\",\n        reasoningEffort: reasoningEffortLabel || undefined,\n        call: functionCall || undefined,\n        inputTokens: 0,\n        outputTokens: 0,\n        reasoningTokens: 0,\n        totalTokens: 0,\n        formula: formula || undefined\n      });\n      return { ...persisted, cached: true, cacheKind: \"persistent\" };\n    }\n  }\n\n  if (INFLIGHT.has(cacheKey)) return INFLIGHT.get(cacheKey);\n\n  const p = withConcurrencyLimit(async () => {\n    let attempt = 0;\n    let lastErr = null;\n\n    const callProvider = async (opts) =>\n      provider === PROVIDERS.OPENAI ? callOpenAI(opts) : callGemini(opts);\n\n    while (attempt <= retry) {\n      attempt++;\n      try {\n        const baseOpts = {\n          apiKey,\n          model,\n          system,\n          user,\n          maxOutputTokens,\n          reasoningEffort,\n          thinkingConfig,\n          timeoutMs,\n          webSearch,\n          responseMimeType: req?.responseMimeType,\n          responseJsonSchema: req?.responseJsonSchema\n        };\n\n        let result = await callProvider(baseOpts);\n\n        if (!result.ok) {\n          let opts = baseOpts;\n\n          // Fallback #1: if web search fails, retry without tools.\n          if (opts.webSearch) {\n            const shouldRetryNoWeb =\n              looksLikeWebSearchUnsupported(result.message) || result.code === \"API_ERROR\" || result.code === \"EMPTY_RESPONSE\";\n            if (shouldRetryNoWeb) {\n              opts = { ...opts, webSearch: false };\n              result = await callProvider(opts);\n            }\n          }\n\n          // Fallback #2: if structured output fails, retry without schema/responseMimeType.\n          const wantsStructured = opts.responseMimeType || opts.responseJsonSchema;\n          if (!result.ok && wantsStructured) {\n            const shouldRetryPlainJson =\n              looksLikeStructuredOutputUnsupported(result.message) ||\n              result.code === \"API_ERROR\" ||\n              result.code === \"EMPTY_RESPONSE\";\n            if (shouldRetryPlainJson) {\n              opts = {\n                ...opts,\n                responseMimeType: undefined,\n                responseJsonSchema: undefined,\n                system: ensureJsonInstruction(opts.system)\n              };\n              result = await callProvider(opts);\n            }\n          }\n        }\n\n        // Log (best-effort)\n        const usage = normalizeUsage(result?.usage);\n        const formula = result.ok ? getFormulaForLog(fnName, result.text) : \"\";\n        logRequest({\n          fn: fnName,\n          provider,\n          model,\n          ok: result.ok,\n          ms: nowMs() - start,\n          attempt,\n          cache: false,\n          reasoningEffort: reasoningEffortLabel || undefined,\n          call: functionCall || undefined,\n          inputTokens: usage.inputTokens,\n          outputTokens: usage.outputTokens,\n          reasoningTokens: usage.reasoningTokens,\n          cachedInputTokens: usage.cachedInputTokens,\n          totalTokens: usage.totalTokens,\n          code: result.code,\n          message: result.message,\n          formula: formula || undefined\n        });\n\n        if (result.ok && cacheEnabled) {\n          CACHE.set(cacheKey, result, ttlSec * 1000);\n          await setPersistentCache(cacheKey, result, ttlSec * 1000, { provider, model });\n        }\n\n        return result;\n      } catch (e) {\n        lastErr = e;\n        if (attempt <= retry) await sleep(250 * attempt);\n      }\n    }\n\n    const msg = redactSensitiveText(lastErr?.message ? String(lastErr.message) : \"Erreur inconnue.\");\n    logRequest({\n      fn: fnName,\n      provider,\n      model,\n      ok: false,\n      ms: nowMs() - start,\n      cache: false,\n      reasoningEffort: reasoningEffortLabel || undefined,\n      call: functionCall || undefined,\n      code: \"API_ERROR\",\n      message: msg\n    });\n    return { ok: false, provider, model, code: \"API_ERROR\", message: msg };\n  });\n\n  INFLIGHT.set(cacheKey, p);\n\n  try {\n    return await p;\n  } finally {\n    INFLIGHT.delete(cacheKey);\n  }\n}\n\n/**\n * Lightweight connectivity test for a provider (used from taskpane and AI.TEST()).\n */\nexport async function aiMinimalTest(providerOverride) {\n  const provider = normalizeProvider(providerOverride) || (await getDefaultProvider());\n  const model = await getModel(provider);\n  const apiKey = await getApiKey(provider);\n\n  if (!apiKey) {\n    return {\n      ok: false,\n      provider,\n      model,\n      code: \"API_KEY_MISSING\",\n      message: `Cl API manquante pour le fournisseur ${provider}.`\n    };\n  }\n\n  // Tiny request\n  return await aiGenerate({\n    provider,\n    system: \"You are a test endpoint. Reply with exactly: OK\",\n    user: \"OK\",\n    maxOutputTokens: 500,\n    cache: false,\n    webSearch: false,\n    functionName: \"AI.MINIMAL_TEST\"\n  });\n}\n\n// ---- Provider: Gemini (Google Generative Language API) ----\n\nfunction geminiEndpoint(model) {\n  return `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(model)}:generateContent`;\n}\n\nasync function callGemini({\n  apiKey,\n  model,\n  system,\n  user,\n  maxOutputTokens,\n  thinkingConfig,\n  timeoutMs,\n  webSearch,\n  responseMimeType,\n  responseJsonSchema\n}) {\n  const url = geminiEndpoint(model);\n\n  const body = {\n    contents: [{ role: \"user\", parts: [{ text: user }] }],\n    generationConfig: {\n      maxOutputTokens\n    }\n  };\n\n  if (thinkingConfig && typeof thinkingConfig === \"object\") {\n    body.generationConfig.thinkingConfig = thinkingConfig;\n  }\n\n  if (isNonEmptyString(system)) {\n    // API uses lowerCamelCase for this field in JSON representation\n    // Force explicit JSON instruction for robustness\n    const sysText = (responseMimeType === \"application/json\" || responseJsonSchema)\n      ? system + \" You must return valid JSON.\"\n      : system;\n    body.systemInstruction = { role: \"system\", parts: [{ text: sysText }] };\n  }\n\n  // Structured output (JSON) when requested\n  if (responseMimeType) {\n    body.generationConfig.responseMimeType = responseMimeType;\n  }\n  if (responseJsonSchema) {\n    body.generationConfig.responseSchema = responseJsonSchema;\n  }\n\n  // Web grounding tool\n  if (webSearch) {\n    // For REST v1beta, the tool name is usually google_search (snake_case).\n    // Note: Some newer endpoints might respect googleSearch, but snake_case is safer for REST.\n    body.tools = [{ google_search: {} }];\n  }\n\n  const res = await fetchWithTimeout(url, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"x-goog-api-key\": apiKey\n    },\n    body: JSON.stringify(body)\n  }, timeoutMs);\n\n  const json = await safeJson(res);\n\n  if (!res.ok) {\n    const msg = extractGeminiError(json) || `Gemini API error (${res.status}).`;\n    return { ok: false, provider: PROVIDERS.GEMINI, model, code: \"API_ERROR\", message: redactSensitiveText(msg) };\n  }\n\n  const text = extractGeminiText(json);\n  const sources = extractGeminiSources(json);\n  const usage = extractGeminiUsage(json);\n\n  if (!isNonEmptyString(text)) {\n    return { ok: false, provider: PROVIDERS.GEMINI, model, code: \"EMPTY_RESPONSE\", message: \"Rponse vide de Gemini.\" };\n  }\n\n  return { ok: true, provider: PROVIDERS.GEMINI, model, text: text.trim(), sources, usage };\n}\n\nfunction extractGeminiText(json) {\n  try {\n    const c = json?.candidates?.[0];\n    const parts = c?.content?.parts;\n    if (Array.isArray(parts)) {\n      return parts.map((p) => p?.text || \"\").join(\"\");\n    }\n    return \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nfunction extractGeminiError(json) {\n  try {\n    const msg = json?.error?.message;\n    return msg ? String(msg) : \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nfunction extractGeminiSources(json) {\n  try {\n    const c = json?.candidates?.[0];\n    const md = c?.groundingMetadata;\n    const chunks = md?.groundingChunks;\n    if (!Array.isArray(chunks)) return [];\n\n    const out = [];\n    for (const ch of chunks) {\n      const web = ch?.web;\n      if (!web?.uri) continue;\n      out.push({ title: web?.title || \"\", url: web.uri });\n    }\n\n    return dedupeSources(out);\n  } catch {\n    return [];\n  }\n}\n\n// ---- Provider: OpenAI (Responses API) ----\n\nasync function callOpenAI({\n  apiKey,\n  model,\n  system,\n  user,\n  maxOutputTokens,\n  reasoningEffort,\n  timeoutMs,\n  webSearch,\n  responseMimeType,\n  responseJsonSchema\n}) {\n  const url = \"https://api.openai.com/v1/responses\";\n\n  const body = {\n    model,\n    input: user, // Responses API uses 'input' (string or array of objects)\n    max_output_tokens: maxOutputTokens,\n    store: false\n  };\n\n  if (isNonEmptyString(reasoningEffort)) {\n    body.reasoning = { effort: reasoningEffort };\n  }\n\n  // System prompt\n  if (isNonEmptyString(system)) {\n    const sysText = (responseMimeType === \"application/json\" || responseJsonSchema)\n      ? system + \" You must return valid JSON.\"\n      : system;\n    body.instructions = sysText;\n  }\n\n  // Structured output (JSON)\n  // - If a JSON schema is provided: use json_schema strict mode.\n  // - Else if responseMimeType is JSON: request a json_object.\n  if (responseJsonSchema) {\n    // For GPT-5 Mini / v1/responses, we try to use the most standard way if possible.\n    // If body.text format fails, we rely on the prompt.\n    // We kept the previous implementation but added prompt reinforcement.\n    body.text = {\n      format: {\n        type: \"json_schema\",\n        name: \"excel_ai_schema\",\n        strict: true,\n        schema: responseJsonSchema\n      }\n    };\n  } else if (responseMimeType === \"application/json\") {\n    body.text = { format: { type: \"json_object\" } };\n  }\n\n  // Web search tool\n  if (webSearch) {\n    body.tools = [{ type: \"web_search\" }];\n    body.include = [\"web_search_call.action.sources\"];\n  }\n\n  const res = await fetchWithTimeout(url, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${apiKey}`\n    },\n    body: JSON.stringify(body)\n  }, timeoutMs);\n\n  const json = await safeJson(res);\n\n  if (!res.ok) {\n    const msg = extractOpenAIError(json) || `OpenAI API error (${res.status}).`;\n    return { ok: false, provider: PROVIDERS.OPENAI, model, code: \"API_ERROR\", message: redactSensitiveText(msg) };\n  }\n\n  const text = extractOpenAIText(json);\n  const sources = webSearch ? extractOpenAISources(json) : [];\n  const usage = extractOpenAIUsage(json);\n\n  if (!isNonEmptyString(text)) {\n    return {\n      ok: false,\n      provider: PROVIDERS.OPENAI,\n      model,\n      code: \"EMPTY_RESPONSE\",\n      message: \"Rponse vide d'OpenAI.\"\n    };\n  }\n\n  return { ok: true, provider: PROVIDERS.OPENAI, model, text: text.trim(), sources, usage };\n}\n\nfunction extractOpenAIText(json) {\n  // 1. Try direct output_text (common in simple Responses)\n  try {\n    if (typeof json?.output_text === \"string\" && json.output_text.trim()) {\n      return json.output_text;\n    }\n  } catch {\n    // ignore\n  }\n\n  // 2. Try iterating over 'output' items (complex/agentic responses)\n  try {\n    const out = json?.output;\n    if (Array.isArray(out)) {\n      const texts = [];\n      for (const item of out) {\n        if (typeof item?.text === \"string\" && item.text.trim()) texts.push(item.text);\n        if (typeof item?.output_text === \"string\" && item.output_text.trim()) texts.push(item.output_text);\n        if (item?.type === \"output_text\" && typeof item?.text === \"string\") texts.push(item.text);\n        if (item?.type === \"text\" && typeof item?.text === \"string\") texts.push(item.text);\n\n        // Standard message output\n        if (item?.type === \"message\") {\n          const content = item?.content;\n          if (Array.isArray(content)) {\n            for (const part of content) {\n              if (part?.type === \"text\" && part?.text) texts.push(part.text);\n              if (part?.type === \"output_text\" && part?.text) texts.push(part.text);\n            }\n          } else if (typeof content === \"string\") {\n            texts.push(content);\n          }\n        }\n\n        if (item?.type !== \"message\") {\n          const content = item?.content;\n          if (Array.isArray(content)) {\n            for (const part of content) {\n              if (part?.type === \"text\" && part?.text) texts.push(part.text);\n              if (part?.type === \"output_text\" && part?.text) texts.push(part.text);\n            }\n          } else if (typeof content === \"string\") {\n            texts.push(content);\n          }\n        }\n      }\n      if (texts.length > 0) return texts.join(\"\\n\").trim();\n    }\n  } catch {\n    // ignore\n  }\n\n  // 3. Fallback: Chat Completions style (just in case model acts differently)\n  try {\n    return json?.choices?.[0]?.message?.content || \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nfunction extractOpenAIError(json) {\n  try {\n    const msg = json?.error?.message;\n    return msg ? String(msg) : \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nfunction extractOpenAISources(json) {\n  try {\n    const out = json?.output;\n    if (!Array.isArray(out)) return [];\n\n    const sources = [];\n    for (const item of out) {\n      if (item?.type !== \"web_search_call\") continue;\n      const s = item?.action?.sources;\n      if (!Array.isArray(s)) continue;\n      for (const src of s) {\n        if (!src?.url) continue;\n        sources.push({ title: src?.title || \"\", url: src.url });\n      }\n    }\n\n    return dedupeSources(sources);\n  } catch {\n    return [];\n  }\n}\n\nfunction extractGeminiUsage(json) {\n  try {\n    const u = json?.usageMetadata;\n    if (!u) return null;\n    return {\n      inputTokens: toInt(u?.promptTokenCount),\n      outputTokens: toInt(u?.candidatesTokenCount),\n      reasoningTokens: toInt(u?.thoughtsTokenCount),\n      totalTokens: toInt(u?.totalTokenCount),\n      cachedInputTokens: toInt(u?.cachedContentTokenCount)\n    };\n  } catch {\n    return null;\n  }\n}\n\nfunction extractOpenAIUsage(json) {\n  try {\n    const u = json?.usage;\n    if (!u) return null;\n    const rawOutputTokens = toInt(u?.output_tokens);\n    const reasoningTokens = toInt(u?.output_tokens_details?.reasoning_tokens);\n    const outputTokens = Math.max(0, rawOutputTokens - reasoningTokens);\n    return {\n      inputTokens: toInt(u?.input_tokens),\n      outputTokens,\n      reasoningTokens,\n      totalTokens: toInt(u?.total_tokens),\n      cachedInputTokens: toInt(u?.input_tokens_details?.cached_tokens)\n    };\n  } catch {\n    return null;\n  }\n}\n\nfunction normalizeUsage(usage) {\n  if (!usage || typeof usage !== \"object\") {\n    return { inputTokens: 0, outputTokens: 0, reasoningTokens: 0, totalTokens: 0, cachedInputTokens: 0 };\n  }\n  const inputTokens = toInt(usage.inputTokens);\n  const outputTokens = toInt(usage.outputTokens);\n  const reasoningTokens = toInt(usage.reasoningTokens);\n  const cachedInputTokens = toInt(usage.cachedInputTokens);\n  const reportedTotal = toInt(usage.totalTokens);\n  const computedTotal = inputTokens + outputTokens + reasoningTokens;\n  const totalTokens = Math.max(reportedTotal, computedTotal);\n  return {\n    inputTokens,\n    outputTokens,\n    reasoningTokens,\n    totalTokens,\n    cachedInputTokens\n  };\n}\n\nfunction toInt(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n) || n <= 0) return 0;\n  return Math.floor(n);\n}\n\nexport async function clearAllCaches() {\n  CACHE.clear();\n  await clearPersistentCache();\n}\n\nfunction dedupeSources(list) {\n  const seen = new Set();\n  const out = [];\n  for (const s of list || []) {\n    const url = String(s?.url || \"\").trim();\n    if (!url) continue;\n    const key = url.toLowerCase();\n    if (seen.has(key)) continue;\n    seen.add(key);\n    out.push({ title: String(s?.title || \"\").trim(), url });\n  }\n  return out;\n}\n\n// ---- Helpers: fetch + timeout + JSON parsing ----\n\nasync function fetchWithTimeout(url, options, timeoutMs) {\n  const t = normalizeTimeoutMs(timeoutMs);\n\n  if (typeof AbortController === \"undefined\") {\n    // Basic fetch without cancellation (should be rare in modern Office runtimes)\n    return await fetch(url, options);\n  }\n\n  const ctrl = new AbortController();\n  const id = setTimeout(() => ctrl.abort(), t);\n\n  try {\n    return await fetch(url, { ...options, signal: ctrl.signal });\n  } finally {\n    clearTimeout(id);\n  }\n}\n\nasync function safeJson(res) {\n  try {\n    return await res.json();\n  } catch {\n    return {};\n  }\n}\n","// src/license.js\n// Lemon Squeezy license activation + validation helpers.\n\nimport { getLicense, setLicense, clearLicense } from \"./shared/core\";\n\nconst LS_ACTIVATE_ENDPOINT = \"https://api.lemonsqueezy.com/v1/licenses/activate\";\nconst LS_VALIDATE_ENDPOINT = \"https://api.lemonsqueezy.com/v1/licenses/validate\";\nconst INSTANCE_NAME = \"Neurow Add-in\";\nconst MIN_LICENSE_LENGTH = 5;\n\nfunction normalizeKey(key) {\n  return String(key || \"\").trim();\n}\n\nfunction normalizeExpiresAt(value) {\n  const raw = String(value || \"\").trim();\n  if (!raw) return \"\";\n  const ts = Date.parse(raw);\n  if (!Number.isFinite(ts)) return \"\";\n  return new Date(ts).toISOString();\n}\n\nfunction extractError(data, fallback) {\n  if (!data) return fallback;\n  if (typeof data.error === \"string\" && data.error.trim()) return data.error.trim();\n  if (typeof data.message === \"string\" && data.message.trim()) return data.message.trim();\n  if (Array.isArray(data.errors) && data.errors.length) {\n    const first = data.errors[0] || {};\n    const detail = first.detail || first.title || first.message;\n    if (detail) return String(detail).trim();\n  }\n  return fallback;\n}\n\nasync function postLicense(endpoint, payload) {\n  const formData = new FormData();\n  Object.entries(payload || {}).forEach(([key, value]) => {\n    if (value == null || value === \"\") return;\n    formData.append(key, value);\n  });\n\n  const response = await fetch(endpoint, { method: \"POST\", body: formData });\n  let data = null;\n  try {\n    data = await response.json();\n  } catch {\n    data = null;\n  }\n  return { ok: response.ok, status: response.status, data };\n}\n\nfunction buildLicense(key, data, overrides = {}) {\n  const instanceId = overrides.instanceId || data?.instance?.id || data?.instance_id || \"\";\n  const instanceName = data?.instance?.name || overrides.instanceName || INSTANCE_NAME;\n  const expiresAt = normalizeExpiresAt(data?.license_key?.expires_at || overrides.expiresAt);\n  const now = new Date().toISOString();\n\n  return {\n    key,\n    instanceId,\n    instanceName,\n    expiresAt,\n    valid: true,\n    activatedAt: overrides.activatedAt || now,\n    lastCheckedAt: now\n  };\n}\n\nfunction normalizeLicense(raw) {\n  if (!raw || typeof raw !== \"object\") return null;\n  const key = normalizeKey(raw.key);\n  if (!key) return null;\n\n  return {\n    key,\n    instanceId: String(raw.instanceId || \"\").trim(),\n    instanceName: String(raw.instanceName || INSTANCE_NAME).trim(),\n    expiresAt: normalizeExpiresAt(raw.expiresAt),\n    valid: raw.valid !== false,\n    activatedAt: String(raw.activatedAt || \"\").trim(),\n    lastCheckedAt: String(raw.lastCheckedAt || \"\").trim()\n  };\n}\n\nexport async function getStoredLicense() {\n  const stored = await getLicense();\n  return normalizeLicense(stored);\n}\n\nexport async function saveStoredLicense(license) {\n  const normalized = normalizeLicense(license);\n  if (!normalized) {\n    await clearLicense();\n    return null;\n  }\n  await setLicense(normalized);\n  return normalized;\n}\n\nexport async function clearStoredLicense() {\n  await clearLicense();\n}\n\nexport function isLicenseValid(license) {\n  if (!license || !license.key) return false;\n  if (license.valid === false) return false;\n  if (license.expiresAt) {\n    const ts = Date.parse(license.expiresAt);\n    if (Number.isFinite(ts) && ts <= Date.now()) return false;\n  }\n  return true;\n}\n\nexport async function hasValidLicense() {\n  const stored = await getStoredLicense();\n  return isLicenseValid(stored);\n}\n\nexport async function activateLicense(key, options = {}) {\n  const trimmed = normalizeKey(key);\n  if (!trimmed || trimmed.length < MIN_LICENSE_LENGTH) {\n    return { success: false, error: \"Cle trop courte\" };\n  }\n\n  const stored = await getStoredLicense();\n  if (!options.force && stored && stored.key === trimmed && isLicenseValid(stored)) {\n    return { success: true, license: stored, cached: true };\n  }\n\n  try {\n    const { ok, status, data } = await postLicense(LS_ACTIVATE_ENDPOINT, {\n      license_key: trimmed,\n      instance_name: INSTANCE_NAME\n    });\n\n    if (!ok) {\n      return { success: false, error: extractError(data, `Erreur API (${status})`) };\n    }\n\n    if (data?.activated) {\n      const license = buildLicense(trimmed, data, { activatedAt: stored?.activatedAt });\n      await setLicense(license);\n      return { success: true, license };\n    }\n\n    return { success: false, error: extractError(data, \"Cle invalide\") };\n  } catch {\n    return { success: false, error: \"Erreur de connexion internet\" };\n  }\n}\n\nexport async function validateLicense(key, options = {}) {\n  const trimmed = normalizeKey(key);\n  if (!trimmed || trimmed.length < MIN_LICENSE_LENGTH) {\n    return { success: false, error: \"Cle trop courte\" };\n  }\n\n  const stored = await getStoredLicense();\n  const instanceId = options.instanceId || stored?.instanceId || \"\";\n\n  try {\n    const { ok, status, data } = await postLicense(LS_VALIDATE_ENDPOINT, {\n      license_key: trimmed,\n      instance_id: instanceId || undefined\n    });\n\n    if (!ok) {\n      return { success: false, error: extractError(data, `Erreur API (${status})`) };\n    }\n\n    if (data?.valid) {\n      const license = buildLicense(trimmed, data, { instanceId, activatedAt: stored?.activatedAt });\n      return { success: true, license };\n    }\n\n    return { success: false, error: extractError(data, \"Cle invalide\") };\n  } catch {\n    return { success: false, error: \"Erreur de connexion internet\" };\n  }\n}\n","// src/taskpane/taskpane.js\n// Taskpane logic: provider selection + keys/models + shared max tokens.\n//\n// Requirements implemented:\n// - Default provider selection only in panel (not in formulas)\n// - Two tabs: Gemini and OpenAI\n// - Single max output tokens setting shared by both providers\n// - No temperature/top-p controls\n\nimport {\n  PROVIDERS,\n  DEFAULTS,\n  storageBackendName,\n  getDefaultProvider,\n  setDefaultProvider,\n  getMaxOutputTokens,\n  setMaxOutputTokens,\n  getOnboardingSeen,\n  setOnboardingSeen,\n  getOnboardingKeysConfirmed,\n  setOnboardingKeysConfirmed,\n  getSectionOrder,\n  setSectionOrder,\n  getHiddenSections,\n  setHiddenSections,\n  hasApiKey,\n  setApiKey,\n  clearApiKey,\n  getModel,\n  setModel,\n  getGeminiReasoningEffort,\n  setGeminiReasoningEffort,\n  getOpenAIReasoningEffort,\n  setOpenAIReasoningEffort,\n  getPrivacyMode,\n  setPrivacyMode,\n  getRequestLog,\n  clearRequestLog,\n  getUsageTotals,\n  clearUsageTotals,\n  getPersistentCacheStats,\n  redactSensitiveText,\n  redactSensitiveValue\n} from \"../shared/core\";\n\nimport { aiMinimalTest, clearAllCaches } from \"../shared/providers\";\n\nimport {\n  activateLicense,\n  validateLicense,\n  getStoredLicense,\n  saveStoredLicense,\n  clearStoredLicense,\n  isLicenseValid\n} from \"../license\";\n\nfunction el(id) {\n  return document.getElementById(id);\n}\n\nfunction setStatus(line, detailsObj) {\n  const safeLine = redactSensitiveText(line || \"\");\n  el(\"statusLine\").textContent = safeLine;\n  if (detailsObj) {\n    try {\n      const safeDetails = redactSensitiveValue(detailsObj);\n      el(\"statusDetails\").textContent = JSON.stringify(safeDetails, null, 2);\n    } catch {\n      el(\"statusDetails\").textContent = redactSensitiveText(detailsObj);\n    }\n  } else {\n    el(\"statusDetails\").textContent = \"\";\n  }\n}\n\nfunction showToast(message, options = {}) {\n  const { duration = 2600 } = options;\n  const toast = el(\"statusToast\");\n  if (!toast) return;\n  toast.textContent = message || \"\";\n  toast.classList.add(\"is-visible\");\n  if (toastTimer) {\n    clearTimeout(toastTimer);\n    toastTimer = null;\n  }\n  toastTimer = setTimeout(() => {\n    toast.classList.remove(\"is-visible\");\n  }, duration);\n}\n\nfunction formatNumber(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return \"0\";\n  return Math.round(n).toLocaleString(\"en-US\");\n}\n\nconst CURRENCY_SYMBOL = \"\";\nconst COST_ICON = \"$\";\nconst REASON_ICON = \"\\uD83E\\uDDE0\";\nconst TOKEN_IN_ICON = \"IN\";\nconst TOKEN_REASON_ICON = \"REF\";\nconst TOKEN_OUT_ICON = \"OUT\";\nconst LICENSE_PLACEHOLDER = \"AAAA-BBBB-CCCC-DDDD\";\n\nconst FAVORITE_ICON = \"\\u2605\";\n\nfunction formatCost(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return `${CURRENCY_SYMBOL}0.0000`;\n  return `${CURRENCY_SYMBOL}${n.toFixed(4)}`;\n}\n\nfunction formatDuration(ms) {\n  const n = Number(ms);\n  if (!Number.isFinite(n)) return \"0.00s\";\n  return `${(n / 1000).toFixed(2)}s`;\n}\n\nfunction formatTime(ts) {\n  try {\n    const d = new Date(ts);\n    return d.toLocaleTimeString(\"fr-FR\", { hour: \"2-digit\", minute: \"2-digit\" });\n  } catch {\n    return \"--:--\";\n  }\n}\n\nfunction formatDate(ts) {\n  try {\n    const d = new Date(ts);\n    return d.toLocaleDateString(\"fr-FR\", { year: \"numeric\", month: \"short\", day: \"2-digit\" });\n  } catch {\n    return \"\";\n  }\n}\n\nfunction formatBytes(bytes) {\n  const n = Number(bytes);\n  if (!Number.isFinite(n) || n <= 0) return \"0 KB\";\n  if (n < 1024) return `${n} B`;\n  if (n < 1024 * 1024) return `${(n / 1024).toFixed(1)} KB`;\n  return `${(n / (1024 * 1024)).toFixed(2)} MB`;\n}\n\nfunction getSectionKey(section) {\n  return String(section?.dataset?.section || \"\").trim();\n}\n\nfunction getSectionTitle(section) {\n  const label = section?.dataset?.sectionTitle;\n  if (label) return label;\n  const title = section?.querySelector?.(\".card__title\");\n  return title ? title.textContent.trim() : getSectionKey(section);\n}\n\nfunction isSectionLocked(section) {\n  return section?.dataset?.sectionLocked === \"true\";\n}\n\nfunction normalizeSectionOrder(storedOrder, keysInDom) {\n  const order = [];\n  const seen = new Set();\n  if (Array.isArray(storedOrder)) {\n    for (const key of storedOrder) {\n      if (!key || seen.has(key) || !sectionElements.has(key)) continue;\n      seen.add(key);\n      order.push(key);\n    }\n  }\n  for (const key of keysInDom) {\n    if (!key || seen.has(key)) continue;\n    seen.add(key);\n    order.push(key);\n  }\n  return order;\n}\n\nfunction applySectionOrder(order) {\n  if (!sectionMain) sectionMain = document.querySelector(\".app__main\");\n  if (!sectionMain) return;\n  const settingsCard = document.querySelector(SECTION_SETTINGS_SELECTOR);\n  for (const key of order) {\n    const section = sectionElements.get(key);\n    if (!section) continue;\n    if (settingsCard) sectionMain.insertBefore(section, settingsCard);\n    else sectionMain.appendChild(section);\n  }\n}\n\nfunction applySectionVisibility(hidden) {\n  sectionElements.forEach((section, key) => {\n    const locked = isSectionLocked(section);\n    const shouldHide = hidden.has(key) && !locked;\n    section.classList.toggle(SECTION_HIDDEN_CLASS, shouldHide);\n  });\n}\n\nfunction pruneHiddenSections() {\n  let changed = false;\n  for (const key of Array.from(hiddenSections)) {\n    const section = sectionElements.get(key);\n    if (!section || isSectionLocked(section)) {\n      hiddenSections.delete(key);\n      changed = true;\n    }\n  }\n  if (changed) void setHiddenSections(Array.from(hiddenSections));\n}\n\nfunction updateSectionOrder(nextOrder, options = {}) {\n  const { persist = true } = options;\n  sectionOrder = nextOrder.slice();\n  applySectionOrder(sectionOrder);\n  renderSectionManager();\n  if (persist) void setSectionOrder(sectionOrder);\n}\n\nfunction resetSectionOrder() {\n  if (!defaultSectionOrder.length) return;\n  updateSectionOrder(defaultSectionOrder);\n}\n\nfunction updateHiddenSections(nextHidden, options = {}) {\n  const { persist = true } = options;\n  hiddenSections = new Set(nextHidden);\n  pruneHiddenSections();\n  applySectionVisibility(hiddenSections);\n  renderSectionManager();\n  if (persist) void setHiddenSections(Array.from(hiddenSections));\n  updateOnboardingVisibility();\n}\n\nfunction moveSection(key, delta) {\n  const idx = sectionOrder.indexOf(key);\n  if (idx < 0) return;\n  const nextIdx = idx + delta;\n  if (nextIdx < 0 || nextIdx >= sectionOrder.length) return;\n  const next = sectionOrder.slice();\n  next.splice(idx, 1);\n  next.splice(nextIdx, 0, key);\n  updateSectionOrder(next);\n}\n\nfunction reorderSectionList(order, draggedKey, targetKey, before) {\n  const next = order.filter((key) => key !== draggedKey);\n  const targetIndex = next.indexOf(targetKey);\n  if (targetIndex < 0) {\n    next.push(draggedKey);\n    return next;\n  }\n  const insertIndex = before ? targetIndex : targetIndex + 1;\n  next.splice(insertIndex, 0, draggedKey);\n  return next;\n}\n\nfunction moveSectionToEnd(order, key) {\n  const next = order.filter((item) => item !== key);\n  next.push(key);\n  return next;\n}\n\nfunction clearDropIndicators(list) {\n  list.querySelectorAll(\".section-row\").forEach((row) => {\n    row.classList.remove(\"is-drop-before\", \"is-drop-after\");\n  });\n}\n\nfunction clearDragState(list) {\n  list.querySelectorAll(\".section-row\").forEach((row) => {\n    row.classList.remove(\"is-drop-before\", \"is-drop-after\", \"is-dragging\");\n  });\n}\n\nfunction renderSectionManager() {\n  const list = el(\"sectionManagerList\");\n  if (!list) return;\n  list.innerHTML = \"\";\n\n  const order = sectionOrder.length ? sectionOrder : Array.from(sectionElements.keys());\n  order.forEach((key, index) => {\n    const section = sectionElements.get(key);\n    if (!section) return;\n\n    const label = getSectionTitle(section);\n    const locked = isSectionLocked(section);\n    const visible = !hiddenSections.has(key) || locked;\n\n    const row = document.createElement(\"div\");\n    row.className = \"section-row\";\n    row.dataset.sectionKey = key;\n    row.setAttribute(\"role\", \"listitem\");\n\n    const handle = document.createElement(\"button\");\n    handle.type = \"button\";\n    handle.className = \"section-row__handle\";\n    handle.draggable = true;\n    handle.setAttribute(\"title\", \"Glisser pour dplacer\");\n    handle.setAttribute(\"aria-label\", `Dplacer ${label}`);\n\n    const labelEl = document.createElement(\"div\");\n    labelEl.className = \"section-row__label\";\n    labelEl.textContent = label;\n\n    const controls = document.createElement(\"div\");\n    controls.className = \"section-row__controls\";\n\n    const upBtn = document.createElement(\"button\");\n    upBtn.type = \"button\";\n    upBtn.className = \"move-btn move-btn--up\";\n    upBtn.disabled = index === 0;\n    upBtn.setAttribute(\"title\", \"Monter\");\n    upBtn.setAttribute(\"aria-label\", `Monter ${label}`);\n    upBtn.addEventListener(\"click\", () => moveSection(key, -1));\n\n    const downBtn = document.createElement(\"button\");\n    downBtn.type = \"button\";\n    downBtn.className = \"move-btn move-btn--down\";\n    downBtn.disabled = index === order.length - 1;\n    downBtn.setAttribute(\"title\", \"Descendre\");\n    downBtn.setAttribute(\"aria-label\", `Descendre ${label}`);\n    downBtn.addEventListener(\"click\", () => moveSection(key, 1));\n\n    const toggleWrap = document.createElement(\"label\");\n    toggleWrap.className = \"visibility-toggle\";\n    toggleWrap.setAttribute(\"title\", locked ? \"Toujours visible\" : visible ? \"Masquer\" : \"Afficher\");\n    const toggleInput = document.createElement(\"input\");\n    toggleInput.type = \"checkbox\";\n    toggleInput.checked = visible;\n    toggleInput.disabled = locked;\n    toggleInput.setAttribute(\"aria-label\", locked ? `${label} toujours visible` : `Afficher ${label}`);\n    const toggleSlider = document.createElement(\"span\");\n    toggleSlider.className = \"visibility-toggle__slider\";\n    toggleWrap.appendChild(toggleInput);\n    toggleWrap.appendChild(toggleSlider);\n    toggleInput.addEventListener(\"change\", () => {\n      if (locked) return;\n      if (toggleInput.checked) hiddenSections.delete(key);\n      else hiddenSections.add(key);\n      applySectionVisibility(hiddenSections);\n      void setHiddenSections(Array.from(hiddenSections));\n      renderSectionManager();\n    });\n\n    controls.appendChild(upBtn);\n    controls.appendChild(downBtn);\n    if (locked) {\n      const lockTag = document.createElement(\"span\");\n      lockTag.className = \"section-row__lock\";\n      lockTag.textContent = \"Fixe\";\n      lockTag.setAttribute(\"title\", \"Toujours visible\");\n      controls.appendChild(lockTag);\n    }\n    controls.appendChild(toggleWrap);\n\n    row.appendChild(handle);\n    row.appendChild(labelEl);\n    row.appendChild(controls);\n    list.appendChild(row);\n  });\n}\n\nfunction initSectionDrag() {\n  const list = el(\"sectionManagerList\");\n  if (!list) return;\n\n  list.addEventListener(\"dragstart\", (event) => {\n    const handle = event.target.closest(\".section-row__handle\");\n    if (!handle) return;\n    const row = handle.closest(\".section-row\");\n    if (!row) return;\n    draggingSectionKey = row.dataset.sectionKey || \"\";\n    row.classList.add(\"is-dragging\");\n    if (event.dataTransfer) {\n      event.dataTransfer.effectAllowed = \"move\";\n      event.dataTransfer.setData(\"text/plain\", draggingSectionKey);\n    }\n  });\n\n  list.addEventListener(\"dragover\", (event) => {\n    if (!draggingSectionKey) return;\n    event.preventDefault();\n    const row = event.target.closest(\".section-row\");\n    if (!row || row.dataset.sectionKey === draggingSectionKey) return;\n    clearDropIndicators(list);\n    const rect = row.getBoundingClientRect();\n    const before = event.clientY < rect.top + rect.height / 2;\n    row.classList.toggle(\"is-drop-before\", before);\n    row.classList.toggle(\"is-drop-after\", !before);\n  });\n\n  list.addEventListener(\"dragleave\", (event) => {\n    const row = event.target.closest(\".section-row\");\n    if (!row) return;\n    row.classList.remove(\"is-drop-before\", \"is-drop-after\");\n  });\n\n  list.addEventListener(\"drop\", (event) => {\n    if (!draggingSectionKey) return;\n    event.preventDefault();\n    const row = event.target.closest(\".section-row\");\n    const targetKey = row ? row.dataset.sectionKey || \"\" : \"\";\n    const key = draggingSectionKey;\n    draggingSectionKey = \"\";\n    clearDragState(list);\n\n    let nextOrder = sectionOrder.slice();\n    if (!targetKey) {\n      nextOrder = moveSectionToEnd(nextOrder, key);\n    } else {\n      const rect = row.getBoundingClientRect();\n      const before = event.clientY < rect.top + rect.height / 2;\n      nextOrder = reorderSectionList(nextOrder, key, targetKey, before);\n    }\n    updateSectionOrder(nextOrder);\n  });\n\n  list.addEventListener(\"dragend\", () => {\n    draggingSectionKey = \"\";\n    clearDragState(list);\n  });\n}\n\nasync function initSectionManager() {\n  sectionMain = document.querySelector(\".app__main\");\n  if (!sectionMain) return;\n  const sections = Array.from(sectionMain.querySelectorAll(SECTION_SELECTOR));\n  sectionElements = new Map();\n  sections.forEach((section) => {\n    const key = getSectionKey(section);\n    if (key) sectionElements.set(key, section);\n  });\n\n  const storedOrder = await getSectionOrder();\n  const domKeys = sections.map((section) => getSectionKey(section)).filter(Boolean);\n  defaultSectionOrder = domKeys.slice();\n  sectionOrder = normalizeSectionOrder(storedOrder, domKeys);\n  applySectionOrder(sectionOrder);\n\n  hiddenSections = new Set(await getHiddenSections());\n  pruneHiddenSections();\n  applySectionVisibility(hiddenSections);\n\n  renderSectionManager();\n  initSectionDrag();\n}\n\nconst TOKEN_EXP_MIN = 7;\nconst TOKEN_EXP_MAX = 17;\nconst UNKNOWN_MODEL_LABEL = \"modele inconnu\";\nconst GEMINI_REASONING_LEVELS = [\"auto\", \"minimal\", \"low\", \"medium\", \"high\"];\nconst OPENAI_REASONING_LEVELS = [\"none\", \"minimal\", \"low\", \"medium\", \"high\"];\nconst HELP_SELECTOR = \"[data-help]\";\nconst SECTION_SELECTOR = \"[data-section]\";\nconst SECTION_SETTINGS_SELECTOR = \"[data-section-settings]\";\nconst SECTION_HIDDEN_CLASS = \"is-section-hidden\";\nconst KEY_INPUT_SELECTOR = \"[data-key-input]\";\nconst KEY_STATUS_SELECTOR = \"[data-key-status]\";\nconst KEY_SAVE_SELECTOR = \"[data-key-save]\";\nconst LICENSE_INPUT_SELECTOR = \"[data-license-input]\";\nconst LICENSE_STATUS_SELECTOR = \"[data-license-status]\";\nconst LICENSE_META_SELECTOR = \"[data-license-meta]\";\n\nlet keyState = { gemini: false, openai: false };\nlet licenseState = null;\nlet licenseEntryChoice = null;\nlet keysLoaded = false;\nlet licenseLoaded = false;\nlet onboardingKeysConfirmed = false;\nlet onboardingKeysLoaded = false;\nlet privacyModeEnabled = false;\nlet sectionOrder = [];\nlet defaultSectionOrder = [];\nlet hiddenSections = new Set();\nlet sectionElements = new Map();\nlet draggingSectionKey = \"\";\nlet sectionMain = null;\nconst expandedLogKeys = new Set();\nlet toastTimer = null;\n\nconst DEFAULT_MODELS = {\n  gemini: DEFAULTS.geminiModel,\n  openai: DEFAULTS.openaiModel\n};\n\nconst MODEL_CATALOG = {\n  gemini: [\n    {\n      id: \"gemini-3-pro-preview\",\n      label: \"Gemini 3 Pro Preview\",\n      prices: { input: 2, output: 12, cachedInput: 0.2 },\n      costLevel: 3,\n      reasoningLevel: 3,\n      warning: true\n    },\n    {\n      id: \"gemini-3-flash-preview\",\n      label: \"Gemini 3 Flash Preview\",\n      prices: { input: 0.5, output: 3, cachedInput: 0.05 },\n      costLevel: 2,\n      reasoningLevel: 2,\n      recommended: true\n    },\n    {\n      id: \"gemini-2.5-flash-lite\",\n      label: \"Gemini 2.5 Flash Lite\",\n      prices: { input: 0.1, output: 0.4, cachedInput: 0.01 },\n      costLevel: 1,\n      reasoningLevel: 1\n    }\n  ],\n  openai: [\n    {\n      id: \"gpt-5.2\",\n      label: \"GPT-5.2\",\n      prices: { input: 1.75, output: 14, cachedInput: 0.175 },\n      costLevel: 3,\n      reasoningLevel: 3,\n      supportsReasoningNone: true,\n      warning: true\n    },\n    {\n      id: \"gpt-5-mini\",\n      label: \"GPT-5 Mini\",\n      prices: { input: 0.25, output: 2, cachedInput: 0.025 },\n      costLevel: 2,\n      reasoningLevel: 2,\n      recommended: true,\n      supportsReasoningNone: false\n    },\n    {\n      id: \"gpt-5-nano\",\n      label: \"GPT-5 Nano\",\n      prices: { input: 0.05, output: 0.4, cachedInput: 0.005 },\n      costLevel: 1,\n      reasoningLevel: 1,\n      supportsReasoningNone: false\n    }\n  ]\n};\n\nconst MODEL_LOOKUP = {\n  gemini: new Map(MODEL_CATALOG.gemini.map((m) => [m.id.toLowerCase(), m])),\n  openai: new Map(MODEL_CATALOG.openai.map((m) => [m.id.toLowerCase(), m]))\n};\n\nconst PROVIDER_LABELS = {\n  gemini: \"Gemini\",\n  openai: \"OpenAI\"\n};\n\nfunction repeatIcon(icon, level) {\n  const count = Math.max(1, Number(level) || 1);\n  return new Array(count + 1).join(icon);\n}\n\nfunction getModelMeta(provider, model) {\n  const p = String(provider || \"\").toLowerCase();\n  const key = String(model || \"\").trim().toLowerCase();\n  const map = MODEL_LOOKUP[p];\n  if (map && key && map.has(key)) return map.get(key);\n  const fallback = DEFAULT_MODELS[p];\n  if (map && fallback && map.has(fallback.toLowerCase())) return map.get(fallback.toLowerCase());\n  return null;\n}\n\nfunction openaiModelAllowsNone(model) {\n  const key = String(model || \"\").trim().toLowerCase();\n  const meta = MODEL_LOOKUP.openai?.get(key);\n  if (meta && typeof meta.supportsReasoningNone === \"boolean\") return meta.supportsReasoningNone;\n  return true;\n}\n\nfunction getGeminiAllowedReasoningLevels(modelId) {\n  const key = String(modelId || \"\").trim().toLowerCase();\n  if (key.includes(\"gemini-3\") && key.includes(\"flash\")) {\n    return [\"auto\", \"minimal\", \"low\", \"medium\", \"high\"];\n  }\n  if (key.includes(\"gemini-3\")) {\n    return [\"auto\", \"low\", \"high\"];\n  }\n  if (key.includes(\"gemini-2.5\")) {\n    return [\"auto\", \"minimal\", \"low\", \"medium\", \"high\"];\n  }\n  return [\"auto\", \"low\", \"high\"];\n}\n\nfunction coerceReasoningLabel(label, allowed, levels) {\n  if (!label) return allowed[0] || \"\";\n  if (allowed.includes(label)) return label;\n  const idx = levels.indexOf(label);\n  if (idx < 0) return allowed[0] || \"\";\n  let best = allowed[0] || \"\";\n  let bestDist = Number.POSITIVE_INFINITY;\n  for (const option of allowed) {\n    const optIdx = levels.indexOf(option);\n    if (optIdx < 0) continue;\n    const dist = Math.abs(optIdx - idx);\n    if (dist < bestDist) {\n      bestDist = dist;\n      best = option;\n    }\n  }\n  return best;\n}\n\nfunction syncGeminiReasoningEffort(modelId, preferred) {\n  const effortEl = el(\"geminiReasoningEffort\");\n  if (!effortEl) return \"\";\n  const allowed = getGeminiAllowedReasoningLevels(modelId);\n  let label = getReasoningEffortLabel(preferred, GEMINI_REASONING_LEVELS);\n  if (!label) label = GEMINI_REASONING_LEVELS[0];\n  if (!allowed.includes(label)) {\n    if (label === \"minimal\") label = \"low\";\n    if (label === \"medium\") label = \"high\";\n  }\n  label = coerceReasoningLabel(label, allowed, GEMINI_REASONING_LEVELS);\n  const index = GEMINI_REASONING_LEVELS.indexOf(label);\n  effortEl.value = String(index >= 0 ? index : 0);\n  effortEl.setAttribute(\"aria-valuetext\", label);\n  return label;\n}\n\nfunction getReasoningEffortLabel(value, levels = OPENAI_REASONING_LEVELS) {\n  const raw = String(value || \"\").trim().toLowerCase();\n  if (!raw) return \"\";\n  const idx = Number(raw);\n  if (Number.isFinite(idx)) {\n    const clamped = Math.min(levels.length - 1, Math.max(0, Math.round(idx)));\n    return levels[clamped] || \"\";\n  }\n  return raw;\n}\n\nfunction syncOpenAIReasoningEffort(modelId, preferred) {\n  const effortEl = el(\"openaiReasoningEffort\");\n  if (!effortEl) return \"\";\n  const allowNone = openaiModelAllowsNone(modelId);\n  const wrap = effortEl.closest(\".reasoning\");\n  if (wrap) wrap.classList.toggle(\"reasoning--no-none\", !allowNone);\n  effortEl.dataset.allowNone = allowNone ? \"1\" : \"0\";\n\n  const allowed = allowNone ? OPENAI_REASONING_LEVELS : OPENAI_REASONING_LEVELS.slice(1);\n  let next = getReasoningEffortLabel(preferred);\n  if (!allowed.includes(next)) {\n    next = allowed[0] || \"minimal\";\n  }\n  const index = OPENAI_REASONING_LEVELS.indexOf(next);\n  effortEl.value = String(index >= 0 ? index : 0);\n  effortEl.setAttribute(\"aria-valuetext\", next);\n  return next;\n}\n\nfunction formatRate(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return `${CURRENCY_SYMBOL}0`;\n  const decimals = n >= 1 ? 2 : 3;\n  let text = n.toFixed(decimals);\n  text = text.replace(/\\.?0+$/, \"\");\n  return `${CURRENCY_SYMBOL}${text}`;\n}\n\nfunction modelIndicators(meta) {\n  return {\n    cost: repeatIcon(COST_ICON, meta.costLevel),\n    reasoning: repeatIcon(REASON_ICON, meta.reasoningLevel)\n  };\n}\n\nfunction modelOptionLabel(meta) {\n  const indicators = modelIndicators(meta);\n  const favorite = meta.recommended ? `${FAVORITE_ICON} ` : \"\";\n  const warning = meta.warning ? \"! \" : \"\";\n  return `${warning}${favorite}${meta.id} | ${indicators.cost} | ${indicators.reasoning}`;\n}\n\nfunction updateModelWarningBadge(provider, modelId) {\n  const isGemini = provider === PROVIDERS.GEMINI;\n  const selectEl = isGemini ? el(\"geminiModel\") : el(\"openaiModel\");\n  const warningEl = isGemini ? el(\"geminiModelWarning\") : el(\"openaiModelWarning\");\n  if (!selectEl || !warningEl) return;\n  const meta = getModelMeta(provider, modelId || selectEl.value);\n  const show = !!meta?.warning;\n  warningEl.classList.toggle(\"is-hidden\", !show);\n  selectEl.classList.toggle(\"input--warning\", show);\n}\n\nfunction estimateCost(entry) {\n  if (!entry) return 0;\n  const provider = String(entry.provider || \"\").toLowerCase();\n  const meta = getModelMeta(provider, entry.model);\n  if (!meta) return 0;\n\n  const inputTokens = Math.max(0, Number(entry.inputTokens || 0));\n  const outputTokens = Math.max(0, Number(entry.outputTokens || 0));\n  const reasoningTokens = Math.max(0, Number(entry.reasoningTokens || 0));\n  const cachedInputTokens = Math.max(0, Number(entry.cachedInputTokens || 0));\n  const billableOutputTokens = outputTokens + reasoningTokens;\n\n  const cached = Math.min(cachedInputTokens, inputTokens);\n  const uncached = Math.max(0, inputTokens - cached);\n\n  const prices = meta.prices || {};\n  const inputRate = Number(prices.input || 0);\n  const cachedRate = Number(prices.cachedInput ?? prices.input ?? 0);\n  const outputRate = Number(prices.output || 0);\n\n  return (uncached / 1e6) * inputRate + (cached / 1e6) * cachedRate + (billableOutputTokens / 1e6) * outputRate;\n}\n\nfunction coerceCount(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n) || n <= 0) return 0;\n  return Math.floor(n);\n}\n\nfunction buildUsageFromTotals(totals) {\n  const safeTotals = totals && typeof totals === \"object\" ? totals : {};\n  const breakdown = {\n    gemini: { tokens: 0, cost: 0, models: new Map() },\n    openai: { tokens: 0, cost: 0, models: new Map() }\n  };\n\n  const total = {\n    inputTokens: coerceCount(safeTotals.inputTokens),\n    reasoningTokens: coerceCount(safeTotals.reasoningTokens),\n    outputTokens: coerceCount(safeTotals.outputTokens),\n    cachedInputTokens: coerceCount(safeTotals.cachedInputTokens),\n    cost: 0,\n    requests: coerceCount(safeTotals.requests),\n    byProvider: {\n      gemini: { tokens: 0, cost: 0 },\n      openai: { tokens: 0, cost: 0 }\n    }\n  };\n\n  const providerSums = {\n    gemini: { input: 0, output: 0, reasoning: 0, cached: 0 },\n    openai: { input: 0, output: 0, reasoning: 0, cached: 0 }\n  };\n\n  for (const provider of [PROVIDERS.GEMINI, PROVIDERS.OPENAI]) {\n    const providerTotals = safeTotals.byProvider && typeof safeTotals.byProvider === \"object\" ? safeTotals.byProvider[provider] : null;\n    const inputTokens = coerceCount(providerTotals?.inputTokens);\n    const outputTokens = coerceCount(providerTotals?.outputTokens);\n    const reasoningTokens = coerceCount(providerTotals?.reasoningTokens);\n    const cachedInputTokens = coerceCount(providerTotals?.cachedInputTokens);\n    providerSums[provider] = { input: inputTokens, output: outputTokens, reasoning: reasoningTokens, cached: cachedInputTokens };\n\n    const models = providerTotals?.models && typeof providerTotals.models === \"object\" ? providerTotals.models : {};\n    let providerTokens = 0;\n    let providerCost = 0;\n\n    for (const [key, value] of Object.entries(models)) {\n      if (!value || typeof value !== \"object\") continue;\n      const modelInput = coerceCount(value.inputTokens);\n      const modelOutput = coerceCount(value.outputTokens);\n      const modelReasoning = coerceCount(value.reasoningTokens);\n      const modelCached = coerceCount(value.cachedInputTokens);\n      const tokens = modelInput + modelOutput + modelReasoning;\n      if (tokens <= 0 && modelCached <= 0) continue;\n\n      const rawLabel = typeof value.label === \"string\" ? value.label : \"\";\n      const modelKey = String(key || \"\").trim();\n      const modelId = (rawLabel || modelKey).trim();\n      const isUnknown = !modelId || modelId.toLowerCase() === \"unknown\";\n      const label = isUnknown ? UNKNOWN_MODEL_LABEL : modelId;\n      const cost = estimateCost({\n        provider,\n        model: isUnknown ? \"\" : modelId,\n        inputTokens: modelInput,\n        outputTokens: modelOutput,\n        reasoningTokens: modelReasoning,\n        cachedInputTokens: modelCached\n      });\n\n      const mapKey = label.toLowerCase();\n      const modelEntry = breakdown[provider].models.get(mapKey) || { label, tokens: 0, cost: 0 };\n      modelEntry.tokens += tokens;\n      modelEntry.cost += cost;\n      breakdown[provider].models.set(mapKey, modelEntry);\n\n      providerTokens += tokens;\n      providerCost += cost;\n    }\n\n    if (providerTokens === 0) {\n      providerTokens = inputTokens + outputTokens + reasoningTokens;\n    }\n\n    breakdown[provider].tokens = providerTokens;\n    breakdown[provider].cost = providerCost;\n    total.byProvider[provider].tokens = providerTokens;\n    total.byProvider[provider].cost = providerCost;\n  }\n\n  if (!total.inputTokens) {\n    total.inputTokens = providerSums.gemini.input + providerSums.openai.input;\n  }\n  if (!total.outputTokens) {\n    total.outputTokens = providerSums.gemini.output + providerSums.openai.output;\n  }\n  if (!total.reasoningTokens) {\n    total.reasoningTokens = providerSums.gemini.reasoning + providerSums.openai.reasoning;\n  }\n  if (!total.cachedInputTokens) {\n    total.cachedInputTokens = providerSums.gemini.cached + providerSums.openai.cached;\n  }\n\n  total.cost = total.byProvider.gemini.cost + total.byProvider.openai.cost;\n  return { total, breakdown };\n}\n\nfunction normalizeUsageEntry(entry) {\n  return {\n    provider: entry?.provider || \"\",\n    inputTokens: Number(entry?.inputTokens || 0),\n    outputTokens: Number(entry?.outputTokens || 0),\n    reasoningTokens: Number(entry?.reasoningTokens || 0),\n    cachedInputTokens: Number(entry?.cachedInputTokens || 0),\n    totalTokens: Number(entry?.totalTokens || 0),\n    ok: !!entry?.ok,\n    cache: !!entry?.cache,\n    ms: Number(entry?.ms || 0),\n    fn: entry?.fn || \"AI\",\n    model: entry?.model || \"\",\n    ts: Number(entry?.ts || 0),\n    message: entry?.message || \"\",\n    reasoningEffort: entry?.reasoningEffort || \"\",\n    call: entry?.call || \"\",\n    formula: entry?.formula || \"\"\n  };\n}\n\nfunction populateModelSelect(provider, selectEl, currentModel) {\n  if (!selectEl) return;\n  const list = MODEL_CATALOG[provider] || [];\n  const requested = String(currentModel || \"\").trim();\n  const requestedKey = requested.toLowerCase();\n  const fallback = DEFAULT_MODELS[provider] || \"\";\n\n  selectEl.innerHTML = \"\";\n  let matched = false;\n\n  for (const meta of list) {\n    const option = document.createElement(\"option\");\n    option.value = meta.id;\n    option.textContent = modelOptionLabel(meta);\n    if (meta.warning) {\n      option.dataset.warning = \"1\";\n      option.style.color = \"#b03524\";\n      option.style.fontWeight = \"700\";\n    }\n    if (meta.id.toLowerCase() === requestedKey) {\n      option.selected = true;\n      matched = true;\n    }\n    selectEl.appendChild(option);\n  }\n\n  if (requested && !matched) {\n    const option = document.createElement(\"option\");\n    option.value = requested;\n    option.textContent = `${requested} | hors liste`;\n    option.selected = true;\n    selectEl.appendChild(option);\n    return;\n  }\n\n  if (!requested && fallback) {\n    selectEl.value = fallback;\n  }\n}\n\nfunction renderPricingTable() {\n  const gemBody = el(\"pricingTableBodyGemini\");\n  const oaiBody = el(\"pricingTableBodyOpenAI\");\n  if (!gemBody && !oaiBody) return;\n  if (gemBody) gemBody.innerHTML = \"\";\n  if (oaiBody) oaiBody.innerHTML = \"\";\n\n  const renderProvider = (provider, body) => {\n    if (!body) return;\n    const list = MODEL_CATALOG[provider] || [];\n    for (const meta of list) {\n      const row = document.createElement(\"tr\");\n      const indicators = modelIndicators(meta);\n\n      const cellModel = document.createElement(\"td\");\n      cellModel.textContent = meta.id;\n\n      const cellInput = document.createElement(\"td\");\n      cellInput.className = \"pricing-table__col-price\";\n      cellInput.textContent = formatRate(meta.prices?.input);\n\n      const cellOutput = document.createElement(\"td\");\n      cellOutput.className = \"pricing-table__col-price\";\n      cellOutput.textContent = formatRate(meta.prices?.output);\n\n      const cellCost = document.createElement(\"td\");\n      cellCost.className = \"pricing-table__col-icon\";\n      cellCost.textContent = indicators.cost;\n\n      const cellReason = document.createElement(\"td\");\n      cellReason.className = \"pricing-table__col-icon\";\n      cellReason.textContent = indicators.reasoning;\n\n      row.appendChild(cellModel);\n      row.appendChild(cellInput);\n      row.appendChild(cellOutput);\n      row.appendChild(cellCost);\n      row.appendChild(cellReason);\n      body.appendChild(row);\n    }\n  };\n\n  renderProvider(PROVIDERS.GEMINI, gemBody);\n  renderProvider(PROVIDERS.OPENAI, oaiBody);\n}\n\nfunction setModalOpen(id, isOpen) {\n  const modal = el(id);\n  if (!modal) return;\n  modal.classList.toggle(\"is-open\", isOpen);\n  modal.setAttribute(\"aria-hidden\", isOpen ? \"false\" : \"true\");\n}\n\nfunction isModalOpen(id) {\n  const modal = el(id);\n  return !!modal && modal.classList.contains(\"is-open\");\n}\n\nfunction setSettingsModalOpen(isOpen) {\n  setModalOpen(\"settingsModal\", isOpen);\n}\n\nfunction setPricingModalOpen(isOpen) {\n  setModalOpen(\"pricingModal\", isOpen);\n}\n\nfunction setOnboardingModalOpen(isOpen) {\n  setModalOpen(\"onboardingModal\", isOpen);\n}\n\nfunction setOnboardingKeysModalOpen(isOpen) {\n  setModalOpen(\"onboardingKeysModal\", isOpen);\n}\n\nfunction openPricingModal() {\n  renderPricingTable();\n  setPricingModalOpen(true);\n}\n\nfunction closePricingModal() {\n  setPricingModalOpen(false);\n}\n\nfunction setKeyStatus(provider, hasKey) {\n  const ok = !!hasKey;\n  document.querySelectorAll(`${KEY_STATUS_SELECTOR}[data-key-status=\"${provider}\"]`).forEach((node) => {\n    node.textContent = ok ? \"Cl enregistre\" : \"Cl manquante\";\n    node.classList.toggle(\"key-status--ok\", ok);\n    node.classList.toggle(\"key-status--missing\", !ok);\n  });\n}\n\nfunction updateKeyPlaceholders() {\n  document.querySelectorAll(KEY_INPUT_SELECTOR).forEach((input) => {\n    const provider = String(input.dataset.keyInput || \"\").trim().toLowerCase();\n    if (provider === PROVIDERS.GEMINI) {\n      input.placeholder = keyState.gemini ? \"Cl enregistre (laisser vide pour conserver)\" : \"AIza...\";\n    } else if (provider === PROVIDERS.OPENAI) {\n      input.placeholder = keyState.openai ? \"Cl enregistre (laisser vide pour conserver)\" : \"sk-...\";\n    }\n  });\n}\n\nfunction setKeyState(geminiPresent, openaiPresent) {\n  keyState = {\n    gemini: !!geminiPresent,\n    openai: !!openaiPresent\n  };\n  updateKeyPlaceholders();\n}\n\nfunction hasAnyApiKey() {\n  return !!keyState.gemini || !!keyState.openai;\n}\n\nfunction hasBothApiKeys() {\n  return !!keyState.gemini && !!keyState.openai;\n}\n\nfunction hasCompletedApiSetup() {\n  return hasBothApiKeys() || (onboardingKeysConfirmed && hasAnyApiKey());\n}\n\nfunction hasStoredLicense() {\n  return !!(licenseState && licenseState.key && isLicenseValid(licenseState));\n}\n\nfunction updateOnboardingVisibility() {\n  const section = document.querySelector('[data-section=\"onboarding\"]');\n  if (!section) return;\n  if (!licenseLoaded || !keysLoaded || !onboardingKeysLoaded) return;\n  const shouldShow = !hasStoredLicense() || !hasCompletedApiSetup();\n  section.classList.toggle(\"is-hidden\", !shouldShow);\n  if (shouldShow && section.classList.contains(SECTION_HIDDEN_CLASS)) {\n    hiddenSections.delete(\"onboarding\");\n    updateHiddenSections(Array.from(hiddenSections));\n  }\n}\n\nfunction setModelGate(provider, hasKey) {\n  const isGemini = provider === PROVIDERS.GEMINI;\n  const modelEl = el(isGemini ? \"geminiModel\" : \"openaiModel\");\n  const effortEl = el(isGemini ? \"geminiReasoningEffort\" : \"openaiReasoningEffort\");\n  const gateEl = el(isGemini ? \"geminiModelGate\" : \"openaiModelGate\");\n  const disabled = !hasKey;\n  if (modelEl) modelEl.disabled = disabled;\n  if (effortEl) effortEl.disabled = disabled;\n  if (gateEl) gateEl.classList.toggle(\"is-hidden\", !disabled);\n}\n\nfunction updateConfigProviderGate() {\n  const geminiBtn = el(\"providerGemini\");\n  const openaiBtn = el(\"providerOpenAI\");\n  const hasGemini = !!keyState.gemini;\n  const hasOpenAI = !!keyState.openai;\n\n  if (geminiBtn) geminiBtn.disabled = !hasGemini;\n  if (openaiBtn) openaiBtn.disabled = !hasOpenAI;\n\n  const gateEl = el(\"configProviderGate\");\n  if (!gateEl) return;\n  const textEl = el(\"configProviderGateText\");\n\n  let message = \"\";\n  if (!hasGemini && !hasOpenAI) {\n    message = \"Ajoutez une cl API pour activer Gemini ou OpenAI.\";\n  }\n\n  gateEl.classList.toggle(\"is-hidden\", !message);\n  if (textEl) textEl.textContent = message;\n}\n\nfunction updateModelGates() {\n  setModelGate(PROVIDERS.GEMINI, !!keyState.gemini);\n  setModelGate(PROVIDERS.OPENAI, !!keyState.openai);\n  updateConfigProviderGate();\n}\n\nfunction parseLicenseExpiryMs(expiresAt) {\n  const raw = String(expiresAt || \"\").trim();\n  if (!raw) return 0;\n  const ts = Date.parse(raw);\n  return Number.isFinite(ts) ? ts : 0;\n}\n\nfunction formatLicenseExpiry(expiresAt) {\n  const ts = parseLicenseExpiryMs(expiresAt);\n  if (!ts) return \"\";\n  return formatDate(ts);\n}\n\nfunction licenseStatusSummary(license) {\n  if (!license || !license.key) {\n    return { ok: false, text: \"Aucune licence enregistre\" };\n  }\n\n  if (isLicenseValid(license)) {\n    const expiry = formatLicenseExpiry(license.expiresAt);\n    const suffix = expiry ? `  renouvellement le ${expiry}` : \"\";\n    return { ok: true, text: `Licence active${suffix}` };\n  }\n\n  const expiresAt = parseLicenseExpiryMs(license.expiresAt);\n  const expired = expiresAt && expiresAt <= Date.now();\n  return { ok: false, text: expired ? \"Licence expire\" : \"Licence invalide\" };\n}\n\nfunction setLicenseStatus(node, text, ok) {\n  if (!node) return;\n  node.textContent = text || \"\";\n  node.classList.toggle(\"key-status--ok\", ok);\n  node.classList.toggle(\"key-status--missing\", !ok);\n}\n\nfunction setLicenseStatusAll(text, ok) {\n  document.querySelectorAll(LICENSE_STATUS_SELECTOR).forEach((node) => {\n    setLicenseStatus(node, text, ok);\n  });\n}\n\nfunction updateLicenseStatusNodes(license) {\n  const summary = licenseStatusSummary(license);\n  document.querySelectorAll(LICENSE_STATUS_SELECTOR).forEach((node) => {\n    setLicenseStatus(node, summary.text, summary.ok);\n  });\n}\n\nfunction setLicenseEntryVisible(isVisible, options = {}) {\n  const { focus = false, persist = true } = options;\n  const entry = el(\"licenseEntry\");\n  const subscribe = el(\"licenseSubscribe\");\n  if (!entry) return;\n  entry.classList.toggle(\"is-hidden\", !isVisible);\n  if (persist) licenseEntryChoice = isVisible;\n  if (subscribe) subscribe.classList.toggle(\"is-hidden\", isVisible);\n  const subscribeBtn = el(\"licenseModeSubscribe\");\n  const haveBtn = el(\"licenseModeHave\");\n  if (subscribeBtn && haveBtn) {\n    subscribeBtn.classList.toggle(\"segmented__btn--active\", !isVisible);\n    haveBtn.classList.toggle(\"segmented__btn--active\", isVisible);\n    subscribeBtn.setAttribute(\"aria-selected\", !isVisible ? \"true\" : \"false\");\n    haveBtn.setAttribute(\"aria-selected\", isVisible ? \"true\" : \"false\");\n  }\n  if (isVisible && focus) {\n    const input = el(\"licenseKeyInput\");\n    if (input) input.focus();\n  }\n}\n\nfunction updateLicensePlaceholders(license) {\n  const placeholder = license?.key ? \"Cl enregistre (laisser vide pour conserver)\" : LICENSE_PLACEHOLDER;\n  document.querySelectorAll(LICENSE_INPUT_SELECTOR).forEach((input) => {\n    input.placeholder = placeholder;\n  });\n}\n\nfunction updateLicenseMeta(license) {\n  const nodes = document.querySelectorAll(LICENSE_META_SELECTOR);\n  if (!nodes.length) return;\n  let text = \"Cl reue par email aprs achat (mensuel ou annuel)\";\n  if (license && isLicenseValid(license) && license.expiresAt) {\n    const expiry = formatLicenseExpiry(license.expiresAt);\n    text = expiry ? `Renouvellement le ${expiry}` : \"Licence active\";\n  } else if (license && !isLicenseValid(license)) {\n    const expiry = formatLicenseExpiry(license.expiresAt);\n    text = expiry ? `Licence expire le ${expiry}` : \"Licence invalide\";\n  }\n  nodes.forEach((meta) => {\n    meta.textContent = text;\n  });\n}\n\nfunction updateLicenseStepVisibility(license) {\n  const step = el(\"setupLicenseStep\");\n  if (!step) return;\n  const shouldHide = !!(license && isLicenseValid(license));\n  step.classList.toggle(\"is-hidden\", shouldHide);\n}\n\nasync function refreshLicenseUI(options = {}) {\n  const { silent = false } = options;\n  const stored = await getStoredLicense();\n  licenseState = stored;\n  licenseLoaded = true;\n  updateLicenseStatusNodes(stored);\n  const autoVisible = !!(stored && stored.key && !isLicenseValid(stored));\n  const shouldShow = licenseEntryChoice === null ? autoVisible : licenseEntryChoice;\n  setLicenseEntryVisible(shouldShow, { persist: false });\n  updateLicensePlaceholders(stored);\n  updateLicenseMeta(stored);\n  updateLicenseStepVisibility(stored);\n  updateOnboardingVisibility();\n  if (!silent && stored && isLicenseValid(stored)) {\n    setStatus(\"Licence active\", { expiresAt: stored.expiresAt || \"n/a\" });\n  }\n}\n\nfunction clampExp(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return TOKEN_EXP_MIN;\n  return Math.min(TOKEN_EXP_MAX, Math.max(TOKEN_EXP_MIN, Math.round(n)));\n}\n\nfunction expToTokens(exp) {\n  return 2 ** clampExp(exp);\n}\n\nfunction tokensToExp(tokens) {\n  const n = Number(tokens);\n  if (!Number.isFinite(n) || n <= 0) return TOKEN_EXP_MIN;\n  return clampExp(Math.log2(n));\n}\n\nfunction setProviderButtons(provider) {\n  const isGemini = provider === PROVIDERS.GEMINI;\n  el(\"providerGemini\").classList.toggle(\"segmented__btn--active\", isGemini);\n  el(\"providerOpenAI\").classList.toggle(\"segmented__btn--active\", !isGemini);\n  el(\"providerGemini\").setAttribute(\"aria-pressed\", isGemini ? \"true\" : \"false\");\n  el(\"providerOpenAI\").setAttribute(\"aria-pressed\", !isGemini ? \"true\" : \"false\");\n}\n\nfunction getSelectedProvider() {\n  const geminiActive = el(\"providerGemini\").classList.contains(\"segmented__btn--active\");\n  return geminiActive ? PROVIDERS.GEMINI : PROVIDERS.OPENAI;\n}\n\nfunction updateMaxTokensValue() {\n  const exp = clampExp(el(\"maxTokensRange\").value);\n  const tokens = expToTokens(exp);\n  el(\"maxTokensValue\").textContent = formatNumber(tokens);\n  return tokens;\n}\n\nfunction activateTab(tab) {\n  const isGemini = tab === \"gemini\";\n  el(\"tabGemini\").classList.toggle(\"tab--active\", isGemini);\n  el(\"tabOpenAI\").classList.toggle(\"tab--active\", !isGemini);\n\n  el(\"tabGemini\").setAttribute(\"aria-selected\", isGemini ? \"true\" : \"false\");\n  el(\"tabOpenAI\").setAttribute(\"aria-selected\", !isGemini ? \"true\" : \"false\");\n\n  el(\"panelGemini\").classList.toggle(\"tab-panel--active\", isGemini);\n  el(\"panelOpenAI\").classList.toggle(\"tab-panel--active\", !isGemini);\n}\n\nasync function refreshUI(options = {}) {\n  const { preserveKeyInputs = false, silent = false } = options;\n  el(\"storageBackend\").textContent = storageBackendName();\n\n  const [\n    provider,\n    maxTok,\n    gemModel,\n    oaiModel,\n    gemKeyPresent,\n    oaiKeyPresent,\n    gemReasoningEffort,\n    oaiReasoningEffort,\n    keysConfirmed\n  ] = await Promise.all([\n    getDefaultProvider(),\n    getMaxOutputTokens(),\n    getModel(PROVIDERS.GEMINI),\n    getModel(PROVIDERS.OPENAI),\n    hasApiKey(PROVIDERS.GEMINI),\n    hasApiKey(PROVIDERS.OPENAI),\n    getGeminiReasoningEffort(),\n    getOpenAIReasoningEffort(),\n    getOnboardingKeysConfirmed()\n  ]);\n\n  setProviderButtons(provider);\n\n  const exp = tokensToExp(maxTok);\n  const normalizedTokens = expToTokens(exp);\n  el(\"maxTokensRange\").value = String(exp);\n  el(\"maxTokensValue\").textContent = formatNumber(normalizedTokens);\n  if (normalizedTokens !== maxTok) {\n    await setMaxOutputTokens(normalizedTokens);\n  }\n\n  // Models\n  const geminiModelEl = el(\"geminiModel\");\n  const openaiModelEl = el(\"openaiModel\");\n  populateModelSelect(PROVIDERS.GEMINI, geminiModelEl, gemModel);\n  populateModelSelect(PROVIDERS.OPENAI, openaiModelEl, oaiModel);\n  const selectedGeminiModel = geminiModelEl ? geminiModelEl.value : gemModel;\n  const selectedOpenAIModel = openaiModelEl ? openaiModelEl.value : oaiModel;\n  const safeGeminiEffort = syncGeminiReasoningEffort(selectedGeminiModel, gemReasoningEffort);\n  if (safeGeminiEffort && safeGeminiEffort !== gemReasoningEffort) {\n    await setGeminiReasoningEffort(safeGeminiEffort);\n  }\n  const safeEffort = syncOpenAIReasoningEffort(selectedOpenAIModel, oaiReasoningEffort);\n  const effectiveEffort = safeEffort || oaiReasoningEffort;\n  if (safeEffort && safeEffort !== oaiReasoningEffort) {\n    await setOpenAIReasoningEffort(safeEffort);\n  }\n\n  updateModelWarningBadge(PROVIDERS.GEMINI, selectedGeminiModel);\n  updateModelWarningBadge(PROVIDERS.OPENAI, selectedOpenAIModel);\n\n  // Keys are not displayed back (security / UX). Use placeholder to indicate presence.\n  if (!preserveKeyInputs) {\n    document.querySelectorAll(KEY_INPUT_SELECTOR).forEach((input) => {\n      input.value = \"\";\n    });\n  }\n\n  setKeyState(gemKeyPresent, oaiKeyPresent);\n  onboardingKeysConfirmed = !!keysConfirmed;\n  onboardingKeysLoaded = true;\n  if (!gemKeyPresent && !oaiKeyPresent && keysConfirmed) {\n    onboardingKeysConfirmed = false;\n    await setOnboardingKeysConfirmed(false);\n  }\n  keysLoaded = true;\n\n  setKeyStatus(PROVIDERS.GEMINI, gemKeyPresent);\n  setKeyStatus(PROVIDERS.OPENAI, oaiKeyPresent);\n  updateModelGates();\n  updateOnboardingVisibility();\n\n  if (!silent) {\n    setStatus(\"Configuration charge\", {\n      defaultProvider: provider,\n      maxOutputTokens: normalizedTokens,\n      gemini: { key: gemKeyPresent ? \"set\" : \"missing\", model: gemModel, reasoningEffort: safeGeminiEffort },\n      openai: { key: oaiKeyPresent ? \"set\" : \"missing\", model: oaiModel, reasoningEffort: effectiveEffort }\n    });\n  }\n}\n\nfunction buildBreakdownRow(label, tokens, cost, isSub) {\n  const row = document.createElement(\"div\");\n  row.className = `breakdown__row ${isSub ? \"breakdown__row--sub\" : \"breakdown__row--total\"}`;\n\n  const name = document.createElement(\"div\");\n  name.className = \"breakdown__name\";\n  if (isSub) {\n    const model = document.createElement(\"span\");\n    model.className = \"breakdown__model\";\n    model.textContent = label;\n    name.appendChild(model);\n  } else {\n    name.textContent = label;\n  }\n\n  const tokensEl = document.createElement(\"div\");\n  tokensEl.className = \"breakdown__tokens\";\n  tokensEl.textContent = `${formatNumber(tokens)} tokens`;\n\n  const costEl = document.createElement(\"div\");\n  costEl.className = \"breakdown__cost\";\n  costEl.textContent = formatCost(cost);\n\n  row.appendChild(name);\n  row.appendChild(tokensEl);\n  row.appendChild(costEl);\n  return row;\n}\n\nfunction renderUsageBreakdown(breakdown) {\n  const container = el(\"usageBreakdown\");\n  if (!container) return;\n  container.innerHTML = \"\";\n\n  const providers = [PROVIDERS.GEMINI, PROVIDERS.OPENAI];\n  for (const provider of providers) {\n    const data = breakdown[provider] || { tokens: 0, cost: 0, models: new Map() };\n    container.appendChild(buildBreakdownRow(PROVIDER_LABELS[provider] || provider, data.tokens, data.cost, false));\n\n    const models = Array.from(data.models.values())\n      .filter((model) => (model.tokens || 0) > 0 || (model.cost || 0) > 0)\n      .sort((a, b) => b.tokens - a.tokens || a.label.localeCompare(b.label));\n\n    for (const model of models) {\n      container.appendChild(buildBreakdownRow(model.label, model.tokens, model.cost, true));\n    }\n  }\n}\n\nasync function refreshUsage() {\n  const rawLogs = await getRequestLog({ fresh: true });\n  const logs = rawLogs.map(normalizeUsageEntry).sort((a, b) => b.ts - a.ts);\n\n  const usageTotals = await getUsageTotals({ fresh: true });\n  const { total, breakdown } = buildUsageFromTotals(usageTotals);\n\n  el(\"usageTokensTotal\").textContent = formatNumber(total.inputTokens + total.reasoningTokens + total.outputTokens);\n  el(\"usageTokensInTotal\").textContent = formatNumber(total.inputTokens);\n  el(\"usageTokensReasoningTotal\").textContent = formatNumber(total.reasoningTokens);\n  el(\"usageTokensOutTotal\").textContent = formatNumber(total.outputTokens);\n  el(\"usageCostTotal\").textContent = formatCost(total.cost);\n  const summary = el(\"usageSummary\");\n  if (summary) summary.textContent = formatCost(total.cost);\n  el(\"usageCostGemini\").textContent = formatCost(total.byProvider.gemini.cost);\n  el(\"usageCostOpenAI\").textContent = formatCost(total.byProvider.openai.cost);\n\n  renderUsageBreakdown(breakdown);\n  renderLogList(logs);\n  drawUsageChart(logs);\n}\n\nfunction getTokenHeatClass(tokensTotal) {\n  const n = Number(tokensTotal || 0);\n  if (n >= 8000) return \"token-heat--extreme\";\n  if (n >= 4000) return \"token-heat--hot\";\n  if (n >= 1500) return \"token-heat--warm\";\n  return \"token-heat--cool\";\n}\n\nfunction logEntryKey(entry) {\n  const formulaText = entry.call || entry.formula || \"\";\n  return [entry.ts || 0, entry.fn || \"\", entry.provider || \"\", entry.model || \"\", formulaText].join(\"|\");\n}\n\nfunction renderLogList(logs) {\n  const list = el(\"logList\");\n  list.innerHTML = \"\";\n\n  if (!logs.length) {\n    const empty = document.createElement(\"div\");\n    empty.className = \"log-item log-item--empty\";\n    empty.textContent = \"Aucune activit enregistre pour le moment\";\n    list.appendChild(empty);\n    return;\n  }\n\n  const buildTokenFlow = (iconText, value) => {\n    const wrap = document.createElement(\"span\");\n    wrap.className = \"token-flow\";\n\n    const icon = document.createElement(\"span\");\n    icon.className = \"token-flow__icon\";\n    icon.textContent = iconText;\n\n    const val = document.createElement(\"span\");\n    val.className = \"token-flow__value\";\n    val.textContent = formatNumber(value);\n\n    wrap.appendChild(icon);\n    wrap.appendChild(val);\n    return wrap;\n  };\n\n  const slice = logs.slice(0, 40);\n  const activeKeys = new Set();\n  for (const entry of slice) {\n    const item = document.createElement(\"div\");\n    const cacheClass = entry.cache ? \" log-item--cache\" : \"\";\n    item.className = `log-item ${entry.ok ? \"log-item--ok\" : \"log-item--error\"}${cacheClass}`;\n\n    const top = document.createElement(\"div\");\n    top.className = \"log-item__top\";\n\n    const title = document.createElement(\"div\");\n    title.className = \"log-item__title\";\n\n    const titleText = document.createElement(\"span\");\n    titleText.className = \"log-item__title-text\";\n    titleText.textContent = entry.fn;\n    title.appendChild(titleText);\n\n    const formulaText = String(entry.call || entry.formula || \"\").trim();\n    let detail = null;\n    if (formulaText) {\n      const entryKey = logEntryKey(entry);\n      activeKeys.add(entryKey);\n      const toggle = document.createElement(\"button\");\n      toggle.className = \"log-item__toggle\";\n      toggle.type = \"button\";\n      toggle.setAttribute(\"aria-expanded\", \"false\");\n      toggle.setAttribute(\"aria-label\", \"Afficher la fonction\");\n\n      const chevron = document.createElement(\"span\");\n      chevron.className = \"log-item__chevron\";\n      toggle.appendChild(chevron);\n\n      const wasExpanded = expandedLogKeys.has(entryKey);\n      if (wasExpanded) {\n        item.classList.add(\"log-item--expanded\");\n        toggle.setAttribute(\"aria-expanded\", \"true\");\n        toggle.setAttribute(\"aria-label\", \"Masquer la fonction\");\n      }\n\n      toggle.addEventListener(\"click\", () => {\n        const isOpen = item.classList.toggle(\"log-item--expanded\");\n        toggle.setAttribute(\"aria-expanded\", isOpen ? \"true\" : \"false\");\n        toggle.setAttribute(\"aria-label\", isOpen ? \"Masquer la fonction\" : \"Afficher la fonction\");\n        if (isOpen) expandedLogKeys.add(entryKey);\n        else expandedLogKeys.delete(entryKey);\n      });\n\n      title.appendChild(toggle);\n\n      detail = document.createElement(\"div\");\n      detail.className = \"log-item__detail\";\n      detail.textContent = formulaText;\n    }\n\n    const tags = document.createElement(\"div\");\n    tags.style.display = \"flex\";\n    tags.style.gap = \"6px\";\n\n    const providerTag = document.createElement(\"span\");\n    providerTag.className = \"tag\";\n    providerTag.textContent = entry.provider ? entry.provider.toUpperCase() : \"\";\n    tags.appendChild(providerTag);\n\n    const statusTag = document.createElement(\"span\");\n    statusTag.className = `tag ${entry.ok ? \"\" : \"tag--error\"}`;\n    statusTag.textContent = entry.ok ? \"OK\" : \"Erreur\";\n    tags.appendChild(statusTag);\n\n    if (entry.cache) {\n      const cacheTag = document.createElement(\"span\");\n      cacheTag.className = \"tag tag--cache\";\n      cacheTag.textContent = \"Cache\";\n      tags.appendChild(cacheTag);\n    }\n\n    top.appendChild(title);\n    top.appendChild(tags);\n\n    const meta = document.createElement(\"div\");\n    meta.className = \"log-item__meta\";\n\n    const tokensTotal = Math.max(0, entry.inputTokens + entry.reasoningTokens + entry.outputTokens);\n    const modelLabel = entry.model ? entry.model : \"\";\n    const effortLabel = entry.reasoningEffort ? entry.reasoningEffort : \"\";\n    const durationLabel = formatDuration(entry.ms);\n    const modelEffortLabel = [modelLabel, effortLabel].filter(Boolean).join(\"  \");\n\n    const right = document.createElement(\"div\");\n    right.className = \"log-item__info\";\n    const baseMeta = `${formatTime(entry.ts)}  ${durationLabel}`;\n    const detailMeta = modelEffortLabel ? `  ${modelEffortLabel}` : \"\";\n    if (!entry.ok && entry.message) {\n      right.textContent = `${baseMeta}${detailMeta}  ${entry.message.slice(0, 60)}`;\n    } else {\n      right.textContent = `${baseMeta}${detailMeta}`;\n    }\n\n    if (entry.cache) {\n      const cacheNote = document.createElement(\"div\");\n      cacheNote.className = \"log-item__cache\";\n      cacheNote.textContent = \"Cache local\";\n      meta.appendChild(cacheNote);\n    } else {\n      const tokensWrap = document.createElement(\"div\");\n      tokensWrap.className = \"log-item__tokens\";\n\n      const tokensLine = document.createElement(\"div\");\n      tokensLine.className = \"log-item__tokens-line\";\n\n      const heatDot = document.createElement(\"span\");\n      heatDot.className = `log-item__heat ${getTokenHeatClass(tokensTotal)}`;\n\n      const tokensTotalEl = document.createElement(\"span\");\n      tokensTotalEl.className = \"log-item__tokens-total\";\n      tokensTotalEl.textContent = `${formatNumber(tokensTotal)} tokens`;\n\n      const tokensDetailEl = document.createElement(\"span\");\n      tokensDetailEl.className = \"log-item__tokens-detail\";\n      tokensDetailEl.appendChild(document.createTextNode(\"(\"));\n      tokensDetailEl.appendChild(buildTokenFlow(TOKEN_IN_ICON, entry.inputTokens));\n      tokensDetailEl.appendChild(document.createTextNode(\" / \"));\n      tokensDetailEl.appendChild(buildTokenFlow(TOKEN_REASON_ICON, entry.reasoningTokens));\n      tokensDetailEl.appendChild(document.createTextNode(\" / \"));\n      tokensDetailEl.appendChild(buildTokenFlow(TOKEN_OUT_ICON, entry.outputTokens));\n      tokensDetailEl.appendChild(document.createTextNode(\")\"));\n\n      tokensLine.appendChild(heatDot);\n      tokensLine.appendChild(tokensTotalEl);\n      tokensLine.appendChild(tokensDetailEl);\n      tokensWrap.appendChild(tokensLine);\n      meta.appendChild(tokensWrap);\n    }\n\n    meta.appendChild(right);\n\n    item.appendChild(top);\n    if (detail) item.appendChild(detail);\n    item.appendChild(meta);\n    list.appendChild(item);\n  }\n\n  expandedLogKeys.forEach((key) => {\n    if (!activeKeys.has(key)) expandedLogKeys.delete(key);\n  });\n}\n\nfunction drawUsageChart(logs) {\n  const canvas = el(\"usageChart\");\n  if (!canvas) return;\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) return;\n\n  const width = canvas.clientWidth || 320;\n  const height = canvas.clientHeight || 140;\n  const dpr = window.devicePixelRatio || 1;\n  canvas.width = width * dpr;\n  canvas.height = height * dpr;\n  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\n\n  const now = Date.now();\n  const start = now - 60 * 60 * 1000;\n  const buckets = new Array(60).fill(0);\n\n  for (const entry of logs) {\n    if (!entry.ts || entry.ts < start) continue;\n    const index = Math.floor((entry.ts - start) / 60000);\n    if (index >= 0 && index < buckets.length) {\n      buckets[index] += Math.max(0, entry.inputTokens + entry.reasoningTokens + entry.outputTokens);\n    }\n  }\n\n  const maxValue = Math.max(...buckets, 1);\n  const styles = getComputedStyle(document.documentElement);\n  const lineColor = styles.getPropertyValue(\"--accent-2\").trim() || \"#2a9d8f\";\n  const gridColor = \"rgba(38, 70, 83, 0.12)\";\n\n  ctx.clearRect(0, 0, width, height);\n\n  ctx.strokeStyle = gridColor;\n  ctx.lineWidth = 1;\n  for (let i = 1; i <= 3; i++) {\n    const y = (height / 4) * i;\n    ctx.beginPath();\n    ctx.moveTo(0, y);\n    ctx.lineTo(width, y);\n    ctx.stroke();\n  }\n\n  ctx.beginPath();\n  buckets.forEach((value, i) => {\n    const x = (i / (buckets.length - 1)) * width;\n    const y = height - (value / maxValue) * (height - 12) - 6;\n    if (i === 0) ctx.moveTo(x, y);\n    else ctx.lineTo(x, y);\n  });\n\n  const gradient = ctx.createLinearGradient(0, 0, 0, height);\n  gradient.addColorStop(0, \"rgba(42, 157, 143, 0.35)\");\n  gradient.addColorStop(1, \"rgba(42, 157, 143, 0.02)\");\n\n  ctx.lineWidth = 2;\n  ctx.strokeStyle = lineColor;\n  ctx.stroke();\n\n  ctx.lineTo(width, height);\n  ctx.lineTo(0, height);\n  ctx.closePath();\n  ctx.fillStyle = gradient;\n  ctx.fill();\n}\n\nfunction updatePrivacyModeUI(enabled) {\n  privacyModeEnabled = !!enabled;\n  const toggle = el(\"privacyModeToggle\");\n  if (toggle) toggle.checked = privacyModeEnabled;\n\n  const status = el(\"privacyModeStatus\");\n  if (status) {\n    status.textContent = privacyModeEnabled ? \"Activ\" : \"Dsactiv\";\n    status.classList.toggle(\"is-active\", privacyModeEnabled);\n  }\n\n  const hint = el(\"privacyModeHint\");\n  if (hint) {\n    hint.textContent = privacyModeEnabled\n      ? \"Journal et cache persistants dsactivs.\"\n      : \"Journal et cache persistants activs.\";\n  }\n\n  const cacheStatus = el(\"cacheStatus\");\n  if (cacheStatus) {\n    cacheStatus.textContent = privacyModeEnabled ? \"Dsactiv\" : \"Actif\";\n    cacheStatus.classList.toggle(\"chip--success\", !privacyModeEnabled);\n    cacheStatus.classList.toggle(\"chip--muted\", privacyModeEnabled);\n  }\n}\n\nasync function refreshPrivacyMode() {\n  const enabled = await getPrivacyMode();\n  updatePrivacyModeUI(enabled);\n}\n\nasync function initPrivacyMode() {\n  const toggle = el(\"privacyModeToggle\");\n  if (!toggle) return;\n  await refreshPrivacyMode();\n  toggle.addEventListener(\"change\", async () => {\n    const next = !!toggle.checked;\n    await setPrivacyMode(next);\n    updatePrivacyModeUI(next);\n    if (next) {\n      await clearRequestLog();\n      await clearAllCaches();\n    }\n    await refreshUsage();\n    await refreshCacheStats();\n    setStatus(next ? \"Mode confidentialit activ\" : \"Mode confidentialit dsactiv\", { privacyMode: next });\n  });\n}\n\nasync function refreshCacheStats() {\n  const stats = await getPersistentCacheStats();\n  el(\"cacheEntries\").textContent = formatNumber(stats.entries);\n  el(\"cacheSize\").textContent = formatBytes(stats.sizeBytes);\n  el(\"cacheGeminiEntries\").textContent = formatNumber(stats.providers.gemini.entries);\n  el(\"cacheOpenAIEntries\").textContent = formatNumber(stats.providers.openai.entries);\n}\n\nasync function saveCommon(options = {}) {\n  const { silent = false, message = \"Configuration enregistre\" } = options;\n  const provider = getSelectedProvider();\n  const exp = clampExp(el(\"maxTokensRange\").value);\n  const maxTok = expToTokens(exp);\n\n  const savedProvider = await setDefaultProvider(provider);\n  const savedTokens = await setMaxOutputTokens(maxTok);\n\n  if (!silent) {\n    setStatus(message, { defaultProvider: savedProvider, maxOutputTokens: savedTokens });\n  }\n\n  return { savedProvider, savedTokens };\n}\n\nfunction initCollapsibles() {\n  const toggles = document.querySelectorAll(\"[data-collapse-toggle]\");\n  toggles.forEach((btn) => {\n    const targetId = btn.getAttribute(\"aria-controls\");\n    const container = btn.closest(\"[data-collapsible]\");\n    if (!targetId || !container) return;\n    const body = document.getElementById(targetId);\n    if (!body) return;\n\n    const collapsed = container.classList.contains(\"is-collapsed\");\n    btn.setAttribute(\"aria-expanded\", collapsed ? \"false\" : \"true\");\n\n    btn.addEventListener(\"click\", () => {\n      const nextCollapsed = !container.classList.contains(\"is-collapsed\");\n      container.classList.toggle(\"is-collapsed\", nextCollapsed);\n      btn.setAttribute(\"aria-expanded\", nextCollapsed ? \"false\" : \"true\");\n    });\n  });\n}\n\nfunction openOnboardingSection(options = {}) {\n  const { focusKey = false } = options;\n  const section = document.querySelector('[data-section=\"onboarding\"]');\n  if (!section) return;\n  section.classList.remove(\"is-hidden\");\n  if (section.classList.contains(SECTION_HIDDEN_CLASS)) {\n    hiddenSections.delete(\"onboarding\");\n    updateHiddenSections(Array.from(hiddenSections));\n  }\n  if (section.classList.contains(\"is-collapsed\")) {\n    section.classList.remove(\"is-collapsed\");\n    const toggle = section.querySelector(\"[data-collapse-toggle]\");\n    if (toggle) toggle.setAttribute(\"aria-expanded\", \"true\");\n  }\n  if (typeof section.scrollIntoView === \"function\") {\n    section.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n  }\n  if (focusKey) {\n    const input = section.querySelector(KEY_INPUT_SELECTOR);\n    if (input) input.focus();\n  }\n}\n\nfunction attachStorageListeners() {\n  let queued = false;\n  const triggerRefresh = () => {\n    if (queued) return;\n    queued = true;\n    setTimeout(async () => {\n      queued = false;\n      await refreshUsage();\n      await refreshCacheStats();\n      await refreshPrivacyMode();\n      await refreshLicenseUI({ silent: true });\n    }, 250);\n  };\n\n  try {\n    if (typeof OfficeRuntime !== \"undefined\" && OfficeRuntime?.storage?.onChanged) {\n      const onChanged = OfficeRuntime.storage.onChanged;\n      if (typeof onChanged.add === \"function\") onChanged.add(() => triggerRefresh());\n      else if (typeof onChanged.addListener === \"function\") onChanged.addListener(() => triggerRefresh());\n      else if (typeof onChanged === \"function\") onChanged(() => triggerRefresh());\n    }\n  } catch {\n    // ignore\n  }\n\n  try {\n    window.addEventListener(\"storage\", () => triggerRefresh());\n  } catch {\n    // ignore\n  }\n}\n\nfunction closeAllHelpPopups() {\n  document.querySelectorAll(HELP_SELECTOR).forEach((help) => {\n    help.classList.remove(\"is-open\");\n    const btn = help.querySelector(\"button\");\n    if (btn) btn.setAttribute(\"aria-expanded\", \"false\");\n  });\n}\n\nfunction initHelpPopups() {\n  document.querySelectorAll(HELP_SELECTOR).forEach((help) => {\n    const btn = help.querySelector(\"button\");\n    if (!btn) return;\n    btn.setAttribute(\"aria-expanded\", \"false\");\n    btn.addEventListener(\"click\", (event) => {\n      event.stopPropagation();\n      const wasOpen = help.classList.contains(\"is-open\");\n      closeAllHelpPopups();\n      const nextOpen = !wasOpen;\n      help.classList.toggle(\"is-open\", nextOpen);\n      btn.setAttribute(\"aria-expanded\", nextOpen ? \"true\" : \"false\");\n    });\n  });\n\n  document.addEventListener(\"click\", (event) => {\n    if (event.target.closest(HELP_SELECTOR)) return;\n    closeAllHelpPopups();\n  });\n}\n\nasync function confirmOnboardingKeys(options = {}) {\n  const { silent = false } = options;\n  if (!hasAnyApiKey()) {\n    if (!silent) {\n      setStatus(\"Ajoutez au moins une cl API avant de valider\", { ok: false });\n    }\n    return false;\n  }\n  onboardingKeysConfirmed = true;\n  onboardingKeysLoaded = true;\n  await setOnboardingKeysConfirmed(true);\n  updateOnboardingVisibility();\n  return true;\n}\n\nasync function persistApiKey(provider, value) {\n  const trimmed = (value || \"\").trim();\n  if (!trimmed) return false;\n  await setApiKey(provider, trimmed);\n  keyState[provider] = true;\n  keysLoaded = true;\n  updateKeyPlaceholders();\n  updateModelGates();\n  updateOnboardingVisibility();\n  return true;\n}\n\nasync function saveProviderKey(provider, inputEl) {\n  const key = await persistApiKey(provider, inputEl?.value || \"\");\n  if (!key) return;\n  if (inputEl) inputEl.value = \"\";\n  setKeyStatus(provider, key);\n  setStatus(\"Cl enregistre\", { provider });\n}\n\nasync function saveProviderModel(provider) {\n  const isGemini = provider === PROVIDERS.GEMINI;\n  const modelEl = isGemini ? el(\"geminiModel\") : el(\"openaiModel\");\n  if (!modelEl) return;\n  const newModel = (modelEl.value || \"\").trim();\n  await setModel(provider, newModel);\n\n  let effort = \"\";\n  if (isGemini) {\n    const effortEl = el(\"geminiReasoningEffort\");\n    const rawEffort = effortEl ? effortEl.value : \"\";\n    effort = syncGeminiReasoningEffort(newModel, rawEffort);\n    if (effort) await setGeminiReasoningEffort(effort);\n  } else {\n    const effortEl = el(\"openaiReasoningEffort\");\n    const rawEffort = effortEl ? effortEl.value : \"\";\n    effort = syncOpenAIReasoningEffort(newModel, rawEffort);\n    if (effort) await setOpenAIReasoningEffort(effort);\n  }\n\n  setStatus(\"Configuration enregistre\", {\n    provider,\n    model: newModel,\n    reasoningEffort: effort || undefined\n  });\n\n  updateModelWarningBadge(provider, newModel);\n}\n\nasync function saveGeminiReasoningEffort() {\n  const modelEl = el(\"geminiModel\");\n  const effortEl = el(\"geminiReasoningEffort\");\n  if (!effortEl) return;\n  const label = syncGeminiReasoningEffort(modelEl ? modelEl.value : \"\", effortEl.value);\n  if (label) await setGeminiReasoningEffort(label);\n  setStatus(\"Effort de raisonnement enregistr\", { geminiReasoningEffort: label });\n}\n\nasync function saveOpenAIReasoningEffort() {\n  const modelEl = el(\"openaiModel\");\n  const effortEl = el(\"openaiReasoningEffort\");\n  if (!effortEl) return;\n  const label = syncOpenAIReasoningEffort(modelEl ? modelEl.value : \"\", effortEl.value);\n  if (label) await setOpenAIReasoningEffort(label);\n  setStatus(\"Effort de raisonnement enregistr\", { openaiReasoningEffort: label });\n}\n\nfunction setInputWarning(inputEl, isWarning) {\n  if (!inputEl) return;\n  inputEl.classList.toggle(\"input--warning\", isWarning);\n}\n\nasync function handleLicenseActivate(inputEl, buttonEl) {\n  const key = (inputEl?.value || \"\").trim();\n  setInputWarning(inputEl, false);\n\n  if (!key) {\n    setInputWarning(inputEl, true);\n    setLicenseStatusAll(\"Entrez votre cl de licence\", false);\n    setStatus(\"Cl de licence manquante\", { ok: false });\n    return;\n  }\n\n  const originalLabel = buttonEl?.textContent || \"\";\n  if (buttonEl) {\n    buttonEl.disabled = true;\n    buttonEl.textContent = \"Activation...\";\n  }\n\n  const result = await activateLicense(key);\n\n  if (buttonEl) {\n    buttonEl.disabled = false;\n    buttonEl.textContent = originalLabel;\n  }\n\n  if (result.success) {\n    if (inputEl) inputEl.value = \"\";\n    await refreshLicenseUI({ silent: true });\n    setStatus(\"Licence active\", { expiresAt: result.license?.expiresAt || \"n/a\" });\n    showToast(\"Licence enregistre\");\n    return;\n  }\n\n  const errorText = result.error || \"Cl invalide\";\n  setInputWarning(inputEl, true);\n  setLicenseStatusAll(errorText, false);\n  setStatus(\"chec de l'activation\", { error: errorText });\n}\n\nasync function handleLicenseTest(inputEl, buttonEl) {\n  if (!inputEl || !buttonEl) return;\n\n  const inputKey = (inputEl.value || \"\").trim();\n  const stored = licenseState || (await getStoredLicense());\n  const keyToTest = inputKey || stored?.key || \"\";\n\n  setInputWarning(inputEl, false);\n\n  if (!keyToTest) {\n    setInputWarning(inputEl, true);\n    setStatus(\"Cl de licence manquante\", { ok: false });\n    return;\n  }\n\n  const originalLabel = buttonEl.textContent;\n  buttonEl.disabled = true;\n  buttonEl.textContent = \"Test...\";\n\n  const result = await validateLicense(keyToTest);\n\n  buttonEl.disabled = false;\n  buttonEl.textContent = originalLabel;\n\n  if (result.success) {\n    const expiry = result.license?.expiresAt || \"n/a\";\n    if (stored && keyToTest === stored.key) {\n      await saveStoredLicense({\n        ...stored,\n        ...result.license,\n        valid: true,\n        lastCheckedAt: new Date().toISOString()\n      });\n      await refreshLicenseUI({ silent: true });\n    } else if (!stored || !stored.key) {\n      setLicenseStatusAll(\"Licence valide (non enregistre)\", true);\n    }\n    if (inputKey && (!stored || keyToTest !== stored.key)) {\n      setStatus(\"Licence valide. Cliquez sur Activer pour l'enregistrer.\", { expiresAt: expiry });\n    } else {\n      setStatus(\"Licence valide\", { expiresAt: expiry });\n    }\n    return;\n  }\n\n  const errorText = result.error || \"Cl invalide\";\n  setStatus(\"Licence invalide\", { error: errorText });\n  if (stored && keyToTest === stored.key) {\n    await saveStoredLicense({\n      ...stored,\n      valid: false,\n      lastCheckedAt: new Date().toISOString()\n    });\n    await refreshLicenseUI({ silent: true });\n  } else if (!stored || !stored.key) {\n    setLicenseStatusAll(errorText, false);\n  }\n}\n\nasync function handleLicenseClear() {\n  await clearStoredLicense();\n  licenseState = null;\n  document.querySelectorAll(LICENSE_INPUT_SELECTOR).forEach((input) => {\n    input.value = \"\";\n    setInputWarning(input, false);\n  });\n  await refreshLicenseUI({ silent: true });\n  setStatus(\"Licence efface\", { ok: true });\n}\n\nasync function saveOnboardingKeys() {\n  const geminiInput = el(\"onboardingGeminiKey\");\n  const openaiInput = el(\"onboardingOpenAIKey\");\n\n  const geminiKey = await persistApiKey(PROVIDERS.GEMINI, geminiInput?.value || \"\");\n  const openaiKey = await persistApiKey(PROVIDERS.OPENAI, openaiInput?.value || \"\");\n\n  if (geminiInput) geminiInput.value = \"\";\n  if (openaiInput) openaiInput.value = \"\";\n\n  setKeyStatus(PROVIDERS.GEMINI, keyState.gemini);\n  setKeyStatus(PROVIDERS.OPENAI, keyState.openai);\n\n  if (geminiKey || openaiKey) {\n    setStatus(\"Cls enregistres\", { gemini: !!geminiKey, openai: !!openaiKey });\n  }\n\n  if (keyState.gemini || keyState.openai) {\n    await confirmOnboardingKeys({ silent: true });\n    setOnboardingKeysModalOpen(false);\n  }\n}\n\nasync function dismissOnboarding(markSeen = true) {\n  if (markSeen) await setOnboardingSeen(true);\n  setOnboardingKeysModalOpen(false);\n  setOnboardingModalOpen(false);\n}\n\nasync function maybeShowOnboarding() {\n  const seen = await getOnboardingSeen();\n  if (seen) return;\n  setOnboardingModalOpen(true);\n}\n\nasync function clearProvider(provider) {\n  await clearApiKey(provider);\n  await refreshUI({ silent: true });\n  setStatus(\"Cl efface\", { provider });\n}\n\nasync function testProvider(provider) {\n  setStatus(\"Test en cours\", { provider });\n\n  const r = await aiMinimalTest(provider);\n  if (r.ok) {\n    setStatus(\"OK\", { provider: r.provider, model: r.model, response: r.text });\n  } else {\n    setStatus(\"chec\", { provider: r.provider, model: r.model, error: r.message, code: r.code });\n  }\n}\n\nasync function safeOfficeReady() {\n  try {\n    if (typeof Office !== \"undefined\" && Office?.onReady) {\n      await Office.onReady();\n    }\n  } catch {\n    // Running outside Office host (e.g., direct browser open)\n  }\n}\n\nasync function init() {\n  initCollapsibles();\n  attachStorageListeners();\n  initHelpPopups();\n  await initSectionManager();\n  await initPrivacyMode();\n\n  const settingsButton = el(\"settingsButton\");\n  if (settingsButton) {\n    settingsButton.addEventListener(\"click\", () => setSettingsModalOpen(true));\n  }\n\n  document.querySelectorAll(\"[data-settings-open]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => setSettingsModalOpen(true));\n  });\n\n  document.querySelectorAll(\"[data-settings-close]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => setSettingsModalOpen(false));\n  });\n\n  const sectionReset = el(\"sectionManagerReset\");\n  if (sectionReset) {\n    sectionReset.addEventListener(\"click\", () => resetSectionOrder());\n  }\n\n  const pricingHelp = el(\"pricingHelp\");\n  if (pricingHelp) {\n    pricingHelp.addEventListener(\"click\", () => openPricingModal());\n  }\n\n  document.querySelectorAll(\"[data-modal-close]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => closePricingModal());\n  });\n\n  document.querySelectorAll(\"[data-onboarding-close]\").forEach((btn) => {\n    btn.addEventListener(\"click\", async () => dismissOnboarding(true));\n  });\n\n  document.querySelectorAll(\"[data-onboarding-keys-close]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => setOnboardingKeysModalOpen(false));\n  });\n\n  const onboardingClose = el(\"onboardingClose\");\n  if (onboardingClose) {\n    onboardingClose.addEventListener(\"click\", async () => dismissOnboarding(true));\n  }\n\n  const onboardingDone = el(\"onboardingDone\");\n  if (onboardingDone) {\n    onboardingDone.addEventListener(\"click\", async () => dismissOnboarding(true));\n  }\n\n  const onboardingKeysButton = el(\"onboardingKeysButton\");\n  if (onboardingKeysButton) {\n    onboardingKeysButton.addEventListener(\"click\", async () => {\n      await dismissOnboarding(true);\n      openOnboardingSection({ focusKey: true });\n    });\n  }\n\n  document.querySelectorAll(\"[data-onboarding-open]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => {\n      setSettingsModalOpen(false);\n      openOnboardingSection({ focusKey: true });\n    });\n  });\n\n  const onboardingKeysSave = el(\"onboardingKeysSave\");\n  if (onboardingKeysSave) {\n    onboardingKeysSave.addEventListener(\"click\", async () => saveOnboardingKeys());\n  }\n\n  const onboardingKeysLater = el(\"onboardingKeysLater\");\n  if (onboardingKeysLater) {\n    onboardingKeysLater.addEventListener(\"click\", () => setOnboardingKeysModalOpen(false));\n  }\n\n  document.addEventListener(\"keydown\", async (e) => {\n    if (e.key !== \"Escape\") return;\n    closeAllHelpPopups();\n    if (isModalOpen(\"onboardingKeysModal\")) {\n      setOnboardingKeysModalOpen(false);\n      return;\n    }\n    if (isModalOpen(\"onboardingModal\")) {\n      await dismissOnboarding(true);\n      return;\n    }\n    if (isModalOpen(\"settingsModal\")) {\n      setSettingsModalOpen(false);\n      return;\n    }\n    if (isModalOpen(\"pricingModal\")) {\n      closePricingModal();\n    }\n  });\n\n  // Tabs\n  el(\"tabGemini\").addEventListener(\"click\", () => activateTab(\"gemini\"));\n  el(\"tabOpenAI\").addEventListener(\"click\", () => activateTab(\"openai\"));\n\n  // Provider selection buttons\n  el(\"providerGemini\").addEventListener(\"click\", async () => {\n    setProviderButtons(PROVIDERS.GEMINI);\n    await saveCommon();\n  });\n\n  el(\"providerOpenAI\").addEventListener(\"click\", async () => {\n    setProviderButtons(PROVIDERS.OPENAI);\n    await saveCommon();\n  });\n\n  // Max tokens slider\n  el(\"maxTokensRange\").addEventListener(\"input\", () => {\n    updateMaxTokensValue();\n  });\n\n  el(\"maxTokensRange\").addEventListener(\"change\", async () => {\n    await saveCommon();\n  });\n\n  const geminiEffortEl = el(\"geminiReasoningEffort\");\n  if (geminiEffortEl) {\n    geminiEffortEl.addEventListener(\"input\", () => {\n      const modelEl = el(\"geminiModel\");\n      syncGeminiReasoningEffort(modelEl ? modelEl.value : \"\", geminiEffortEl.value);\n    });\n    geminiEffortEl.addEventListener(\"change\", async () => {\n      await saveGeminiReasoningEffort();\n    });\n  }\n\n  const effortEl = el(\"openaiReasoningEffort\");\n  if (effortEl) {\n    effortEl.addEventListener(\"input\", () => {\n      const allowNone = effortEl.dataset.allowNone !== \"0\";\n      let label = getReasoningEffortLabel(effortEl.value);\n      if (!allowNone && label === \"none\") {\n        effortEl.value = \"1\";\n        label = getReasoningEffortLabel(effortEl.value);\n      }\n      effortEl.setAttribute(\"aria-valuetext\", label);\n    });\n    effortEl.addEventListener(\"change\", async () => {\n      await saveOpenAIReasoningEffort();\n    });\n  }\n\n  const geminiModelEl = el(\"geminiModel\");\n  if (geminiModelEl) {\n    geminiModelEl.addEventListener(\"change\", async () => {\n      await saveProviderModel(PROVIDERS.GEMINI);\n    });\n  }\n\n  const openaiModelEl = el(\"openaiModel\");\n  if (openaiModelEl) {\n    openaiModelEl.addEventListener(\"change\", async () => {\n      await saveProviderModel(PROVIDERS.OPENAI);\n    });\n  }\n\n  document.querySelectorAll(KEY_INPUT_SELECTOR).forEach((input) => {\n    const provider = String(input.dataset.keyInput || \"\").trim().toLowerCase();\n    if (!provider) return;\n    input.addEventListener(\"input\", () => setInputWarning(input, false));\n    input.addEventListener(\"change\", async () => {\n      await saveProviderKey(provider, input);\n    });\n    input.addEventListener(\"keydown\", (event) => {\n      if (event.key !== \"Enter\") return;\n      event.preventDefault();\n      const actionBtn = input.closest(\".input-action\")?.querySelector(KEY_SAVE_SELECTOR);\n      if (actionBtn) actionBtn.click();\n      else void saveProviderKey(provider, input);\n    });\n  });\n\n  document.querySelectorAll(KEY_SAVE_SELECTOR).forEach((btn) => {\n    const provider = String(btn.dataset.keySave || \"\").trim().toLowerCase();\n    if (!provider) return;\n    btn.addEventListener(\"click\", async () => {\n      const input = btn.closest(\".input-action\")?.querySelector(KEY_INPUT_SELECTOR);\n      await saveProviderKey(provider, input);\n      if (btn.dataset.keyConfirm === \"true\") {\n        await confirmOnboardingKeys();\n      }\n    });\n  });\n\n  const licenseModeSubscribe = el(\"licenseModeSubscribe\");\n  const licenseModeHave = el(\"licenseModeHave\");\n  if (licenseModeSubscribe) {\n    licenseModeSubscribe.addEventListener(\"click\", () => setLicenseEntryVisible(false));\n  }\n  if (licenseModeHave) {\n    licenseModeHave.addEventListener(\"click\", () => setLicenseEntryVisible(true, { focus: true }));\n  }\n\n  document.querySelectorAll(LICENSE_INPUT_SELECTOR).forEach((input) => {\n    input.addEventListener(\"input\", () => setInputWarning(input, false));\n    input.addEventListener(\"keydown\", (event) => {\n      if (event.key !== \"Enter\") return;\n      event.preventDefault();\n      const targetBtn =\n        document.querySelector(`[data-license-activate][data-license-target=\"${input.id}\"]`) ||\n        input.closest(\".input-action, .setup-license__row\")?.querySelector(\"[data-license-activate]\");\n      if (targetBtn) {\n        void handleLicenseActivate(input, targetBtn);\n      }\n    });\n  });\n\n  document.querySelectorAll(\"[data-license-activate]\").forEach((btn) => {\n    btn.addEventListener(\"click\", async () => {\n      const targetId = btn.dataset.licenseTarget;\n      const input =\n        (targetId ? el(targetId) : null) ||\n        btn.closest(\".input-action, .setup-license__row\")?.querySelector(LICENSE_INPUT_SELECTOR);\n      await handleLicenseActivate(input, btn);\n    });\n  });\n\n  document.querySelectorAll(\"[data-license-test]\").forEach((btn) => {\n    btn.addEventListener(\"click\", async () => {\n      const targetId = btn.dataset.licenseTarget;\n      const input =\n        (targetId ? el(targetId) : null) ||\n        btn.closest(\".input-action\")?.querySelector(LICENSE_INPUT_SELECTOR);\n      await handleLicenseTest(input, btn);\n    });\n  });\n\n  document.querySelectorAll(\"[data-license-clear]\").forEach((btn) => {\n    btn.addEventListener(\"click\", async () => handleLicenseClear());\n  });\n\n  // Provider clear/test\n  const clearGeminiBtn = el(\"clearGemini\");\n  if (clearGeminiBtn) {\n    clearGeminiBtn.addEventListener(\"click\", async () => clearProvider(PROVIDERS.GEMINI));\n  }\n  const clearOpenAIBtn = el(\"clearOpenAI\");\n  if (clearOpenAIBtn) {\n    clearOpenAIBtn.addEventListener(\"click\", async () => clearProvider(PROVIDERS.OPENAI));\n  }\n\n  const testGeminiBtn = el(\"testGemini\");\n  if (testGeminiBtn) {\n    testGeminiBtn.addEventListener(\"click\", async () => testProvider(PROVIDERS.GEMINI));\n  }\n  const testOpenAIBtn = el(\"testOpenAI\");\n  if (testOpenAIBtn) {\n    testOpenAIBtn.addEventListener(\"click\", async () => testProvider(PROVIDERS.OPENAI));\n  }\n\n  const clearUsageBtn = el(\"clearUsageTotals\");\n  if (clearUsageBtn) {\n    clearUsageBtn.addEventListener(\"click\", async () => {\n      await clearUsageTotals();\n      await refreshUsage();\n      setStatus(\"Utilisation rinitialise\", { ok: true });\n    });\n  }\n\n  el(\"clearLogs\").addEventListener(\"click\", async () => {\n    await clearRequestLog();\n    await refreshUsage();\n    setStatus(\"Journal effac\", { ok: true });\n  });\n\n  el(\"refreshCache\").addEventListener(\"click\", async () => {\n    await refreshCacheStats();\n    setStatus(\"Cache actualis\", { ok: true });\n  });\n\n  el(\"clearCache\").addEventListener(\"click\", async () => {\n    await clearAllCaches();\n    await refreshCacheStats();\n    setStatus(\"Cache vid\", { ok: true });\n  });\n\n  // Default tab\n  activateTab(\"gemini\");\n\n  await refreshUI();\n  await refreshLicenseUI({ silent: true });\n  await refreshUsage();\n  await refreshCacheStats();\n  await maybeShowOnboarding();\n\n  setInterval(refreshUsage, 2000);\n  setInterval(refreshCacheStats, 12000);\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  await safeOfficeReady();\n  await init();\n});\n"],"names":["PROVIDERS","Object","freeze","GEMINI","OPENAI","DEFAULTS","provider","geminiModel","openaiModel","geminiReasoningEffort","openaiReasoningEffort","maxOutputTokens","retry","timeoutMs","cache","cacheTtlSec","webCacheTtlSec","STORAGE_KEYS","DEFAULT_PROVIDER","GEMINI_API_KEY","OPENAI_API_KEY","GEMINI_MODEL","OPENAI_MODEL","GEMINI_REASONING_EFFORT","OPENAI_REASONING_EFFORT","MAX_OUTPUT_TOKENS","ONBOARDING_SEEN","ONBOARDING_KEYS_CONFIRMED","SECTION_ORDER","SECTION_HIDDEN","LICENSE","PRIVACY_MODE","MIGRATION_DONE","REQUEST_LOG","REQUEST_LOG_CLEAR_AT","USAGE_TOTALS","CACHE_INDEX","CACHE_CLEAR_AT","SENSITIVE_KEYS","Set","LEGACY_KEYS","DEFAULT_PROVIDER_V2","GEMINI_API_KEY_V2","OPENAI_API_KEY_V2","GEMINI_MODEL_V2","OPENAI_MODEL_V2","GEMINI_MAX_TOKENS_V2","OPENAI_MAX_TOKENS_V2","_migrationPromise","_officeStorageFailed","_privacyModeCache","_privacyModeCacheAt","markOfficeStorageFailed","getRuntimeStorage","OfficeRuntime","storage","getItem","kind","window","localStorage","mem","Map","async","k","has","get","setItem","v","set","String","removeItem","delete","getLocalStorageSafe","localGet","local","key","localSet","value","localRemove","rawGet","options","sensitive","isSensitiveKey","allowLocalFallback","result","localValue","rawSet","stored","rawRemove","removed","ensureMigrated","normalizeProvider","legacyProvider","legacy","candidates","map","x","parseInt","trim","filter","n","Number","isFinite","migrated","length","Math","max","p","s","toLowerCase","GEMINI_REASONING_EFFORTS","OPENAI_REASONING_EFFORTS","normalizeGeminiReasoningEffort","normalizeReasoningEffort","getDefaultProvider","keyKey","getApiKey","hasApiKey","modelKey","getModel","raw","getGeminiReasoningEffort","getOpenAIReasoningEffort","setOpenAIReasoningEffort","setGeminiReasoningEffort","getMaxOutputTokens","clampInt","setMaxOutputTokens","getOnboardingKeysConfirmed","setOnboardingKeysConfirmed","confirmed","getPrivacyMode","now","nowMs","enabled","loadPrivacyMode","normalizeSectionList","Array","isArray","out","seen","item","add","push","setHiddenSections","list","normalized","JSON","stringify","setLicense","license","clearLicense","Date","sleep","ms","Promise","resolve","setTimeout","min","fallback","REDACT_PATTERNS","redactSensitiveText","text","pattern","replace","redactSensitiveValue","entry","entries","parseTimestampMs","CACHE_ENTRY_PREFIX","_cacheClearMs","syncCacheClearMarker","clearedAt","loadCacheIndex","arr","parse","saveCacheIndex","pruneCacheIndex","kept","removedKeys","savedAt","savedAtMs","expiresAtMs","sort","a","b","over","toRemove","slice","r","removeCacheEntry","removeFromCacheIndex","index","next","setPersistentCache","cacheKey","ttlMs","meta","model","size","updated","pruned","sortKeysDeep","prototype","toString","call","keys","REQUEST_LOG_TTL_MS","Infinity","_requestLog","_requestLogLoading","_requestLogLoaded","_requestLogLastLoadedMs","_requestLogClearMs","_usageTotals","createEmptyUsageTotals","_usageTotalsLoading","_usageTotalsLoaded","_usageTotalsLastLoadedMs","syncRequestLogClearMarker","reset","loadRequestLog","force","parsed","e","ts","sanitizeLogEntry","persistRequestLog","pruneRequestLog","toNonNegInt","floor","inputTokens","outputTokens","reasoningTokens","cachedInputTokens","requests","byProvider","models","loadUsageTotals","base","providers","rawProvider","target","rawModels","label","normalizeUsageTotals","logRequest","logEntry","modelLabel","providerTotals","existing","persistUsageTotals","updateUsageTotals","logRequestAsync","clearRequestLog","CACHE","constructor","maxEntries","this","oldestKey","clear","_cacheClearLocalMs","INFLIGHT","active","queue","isNonEmptyString","normalizeBoolean","def","includes","normalizeTimeoutMs","toLowerMsg","looksLikeStructuredOutputUnsupported","message","looksLikeWebSearchUnsupported","ensureJsonInstruction","system","test","getFormulaForLog","fnName","match","formula","startsWith","extractFormulaFromText","aiGenerate","req","start","apiKey","functionName","functionCall","reasoningEffort","reasoningEffortLabel","fn","ok","undefined","code","user","webSearch","cfgMax","normalizeMaxOutputTokens","thinkingConfig","effort","level","modelId","thinkingLevel","toUpperCase","budget","minimal","low","medium","high","thinkingBudget","resolveGeminiThinkingConfig","cacheEnabled","ttlSec","getCacheClearAt","cacheKeyPayload","responseMimeType","responseJsonSchema","input","crypto","subtle","digest","TextEncoder","bytes","encode","from","Uint8Array","padStart","join","str","h","i","charCodeAt","imul","fnv1a32","hashKey","cached","cacheKind","totalTokens","persisted","Error","getPersistentCache","attempt","lastErr","callProvider","url","body","max_output_tokens","store","reasoning","sysText","instructions","format","type","name","strict","schema","tools","include","res","fetchWithTimeout","method","headers","Authorization","json","safeJson","msg","error","extractOpenAIError","status","output_text","output","texts","content","part","choices","extractOpenAIText","sources","action","src","title","dedupeSources","extractOpenAISources","usage","u","rawOutputTokens","toInt","output_tokens","output_tokens_details","reasoning_tokens","input_tokens","total_tokens","input_tokens_details","cached_tokens","extractOpenAIUsage","callOpenAI","opts","encodeURIComponent","geminiEndpoint","contents","role","parts","generationConfig","systemInstruction","responseSchema","google_search","extractGeminiError","c","extractGeminiText","md","groundingMetadata","chunks","groundingChunks","ch","web","uri","extractGeminiSources","usageMetadata","promptTokenCount","candidatesTokenCount","thoughtsTokenCount","totalTokenCount","cachedContentTokenCount","extractGeminiUsage","callGemini","baseOpts","wantsStructured","normalizeUsage","shift","withConcurrencyLimit","reportedTotal","computedTotal","clearAllCaches","clearPersistentCache","t","AbortController","fetch","ctrl","id","abort","signal","clearTimeout","INSTANCE_NAME","normalizeKey","normalizeExpiresAt","toISOString","extractError","data","errors","first","detail","postLicense","endpoint","payload","formData","FormData","forEach","append","response","buildLicense","overrides","instanceId","instance","instance_id","instanceName","expiresAt","license_key","expires_at","valid","activatedAt","lastCheckedAt","normalizeLicense","getStoredLicense","getLicense","saveStoredLicense","isLicenseValid","el","document","getElementById","setStatus","line","detailsObj","safeLine","textContent","safeDetails","formatNumber","round","toLocaleString","CURRENCY_SYMBOL","formatCost","toFixed","formatDuration","formatTime","toLocaleTimeString","hour","minute","getSectionKey","section","dataset","isSectionLocked","sectionLocked","applySectionOrder","order","sectionMain","querySelector","settingsCard","SECTION_SETTINGS_SELECTOR","sectionElements","insertBefore","appendChild","applySectionVisibility","hidden","locked","shouldHide","classList","toggle","SECTION_HIDDEN_CLASS","pruneHiddenSections","changed","hiddenSections","updateSectionOrder","nextOrder","persist","sectionOrder","renderSectionManager","setSectionOrder","updateHiddenSections","nextHidden","updateOnboardingVisibility","moveSection","delta","idx","indexOf","nextIdx","splice","clearDragState","querySelectorAll","row","remove","innerHTML","sectionTitle","getSectionTitle","visible","createElement","className","sectionKey","setAttribute","handle","draggable","labelEl","controls","upBtn","disabled","addEventListener","downBtn","toggleWrap","toggleInput","checked","toggleSlider","lockTag","GEMINI_REASONING_LEVELS","OPENAI_REASONING_LEVELS","HELP_SELECTOR","SECTION_SELECTOR","KEY_INPUT_SELECTOR","KEY_SAVE_SELECTOR","LICENSE_INPUT_SELECTOR","LICENSE_STATUS_SELECTOR","keyState","gemini","openai","licenseState","licenseEntryChoice","keysLoaded","licenseLoaded","onboardingKeysConfirmed","onboardingKeysLoaded","privacyModeEnabled","defaultSectionOrder","draggingSectionKey","expandedLogKeys","toastTimer","DEFAULT_MODELS","MODEL_CATALOG","prices","cachedInput","costLevel","reasoningLevel","warning","recommended","supportsReasoningNone","MODEL_LOOKUP","m","PROVIDER_LABELS","repeatIcon","icon","count","getModelMeta","syncGeminiReasoningEffort","preferred","effortEl","allowed","getGeminiAllowedReasoningLevels","getReasoningEffortLabel","levels","best","bestDist","POSITIVE_INFINITY","option","optIdx","dist","abs","coerceReasoningLabel","syncOpenAIReasoningEffort","allowNone","openaiModelAllowsNone","wrap","closest","formatRate","decimals","modelIndicators","cost","modelOptionLabel","indicators","favorite","updateModelWarningBadge","isGemini","selectEl","warningEl","show","estimateCost","billableOutputTokens","uncached","coerceCount","normalizeUsageEntry","populateModelSelect","currentModel","requested","requestedKey","matched","style","color","fontWeight","selected","setModalOpen","isOpen","modal","isModalOpen","contains","setSettingsModalOpen","setPricingModalOpen","setOnboardingModalOpen","setOnboardingKeysModalOpen","closePricingModal","setKeyStatus","hasKey","node","updateKeyPlaceholders","keyInput","placeholder","hasAnyApiKey","shouldShow","setModelGate","modelEl","gateEl","updateModelGates","geminiBtn","openaiBtn","hasGemini","hasOpenAI","textEl","updateConfigProviderGate","parseLicenseExpiryMs","formatLicenseExpiry","toLocaleDateString","year","month","day","formatDate","setLicenseStatus","setLicenseStatusAll","setLicenseEntryVisible","isVisible","focus","subscribe","subscribeBtn","haveBtn","refreshLicenseUI","silent","summary","expiry","licenseStatusSummary","updateLicenseStatusNodes","autoVisible","updateLicensePlaceholders","nodes","updateLicenseMeta","step","updateLicenseStepVisibility","clampExp","expToTokens","exp","setProviderButtons","activateTab","tab","refreshUI","preserveKeyInputs","maxTok","gemModel","oaiModel","gemKeyPresent","oaiKeyPresent","gemReasoningEffort","oaiReasoningEffort","keysConfirmed","all","tokens","log2","tokensToExp","normalizedTokens","geminiModelEl","openaiModelEl","selectedGeminiModel","selectedOpenAIModel","safeGeminiEffort","safeEffort","effectiveEffort","defaultProvider","buildBreakdownRow","isSub","tokensEl","costEl","refreshUsage","logs","fresh","getRequestLog","usageTotals","cloneUsageTotals","getUsageTotals","total","breakdown","totals","safeTotals","providerSums","providerTokens","providerCost","modelInput","modelOutput","modelReasoning","modelCached","rawLabel","isUnknown","mapKey","modelEntry","buildUsageFromTotals","container","values","localeCompare","renderUsageBreakdown","empty","buildTokenFlow","iconText","val","activeKeys","cacheClass","top","titleText","formulaText","entryKey","logEntryKey","chevron","tags","display","gap","providerTag","statusTag","cacheTag","tokensTotal","effortLabel","durationLabel","modelEffortLabel","Boolean","right","baseMeta","detailMeta","cacheNote","tokensWrap","tokensLine","heatDot","getTokenHeatClass","tokensTotalEl","tokensDetailEl","createTextNode","renderLogList","canvas","ctx","getContext","width","clientWidth","height","clientHeight","dpr","devicePixelRatio","setTransform","buckets","fill","maxValue","lineColor","getComputedStyle","documentElement","getPropertyValue","clearRect","strokeStyle","lineWidth","y","beginPath","moveTo","lineTo","stroke","gradient","createLinearGradient","addColorStop","closePath","fillStyle","drawUsageChart","updatePrivacyModeUI","hint","cacheStatus","refreshPrivacyMode","refreshCacheStats","stats","sizeBytes","oldestMs","newestMs","getPersistentCacheStats","formatBytes","saveCommon","savedProvider","setDefaultProvider","savedTokens","openOnboardingSection","focusKey","scrollIntoView","behavior","block","closeAllHelpPopups","help","btn","confirmOnboardingKeys","persistApiKey","trimmed","setApiKey","saveProviderKey","inputEl","saveProviderModel","newModel","setModel","setInputWarning","isWarning","handleLicenseActivate","buttonEl","originalLabel","success","instance_name","activated","activateLicense","duration","toast","showToast","errorText","dismissOnboarding","markSeen","setOnboardingSeen","clearProvider","clearApiKey","testProvider","providerOverride","aiMinimalTest","init","targetId","getAttribute","collapsed","nextCollapsed","queued","triggerRefresh","onChanged","addListener","attachStorageListeners","event","stopPropagation","wasOpen","nextOpen","sections","storedOrder","getSectionOrder","domKeys","keysInDom","normalizeSectionOrder","getHiddenSections","dataTransfer","effectAllowed","setData","preventDefault","clearDropIndicators","rect","getBoundingClientRect","before","clientY","targetKey","draggedKey","targetIndex","insertIndex","reorderSectionList","moveSectionToEnd","initSectionDrag","initSectionManager","setPrivacyMode","privacyMode","initPrivacyMode","settingsButton","sectionReset","pricingHelp","gemBody","oaiBody","renderProvider","cellModel","cellInput","cellOutput","cellCost","cellReason","renderPricingTable","onboardingClose","onboardingDone","onboardingKeysButton","onboardingKeysSave","geminiInput","openaiInput","geminiKey","openaiKey","saveOnboardingKeys","onboardingKeysLater","updateMaxTokensValue","geminiEffortEl","saveGeminiReasoningEffort","saveOpenAIReasoningEffort","actionBtn","click","keySave","keyConfirm","licenseModeSubscribe","licenseModeHave","targetBtn","licenseTarget","inputKey","keyToTest","validateLicense","handleLicenseTest","clearStoredLicense","handleLicenseClear","clearGeminiBtn","clearOpenAIBtn","testGeminiBtn","testOpenAIBtn","clearUsageBtn","clearUsageTotals","getOnboardingSeen","maybeShowOnboarding","setInterval","Office","onReady","safeOfficeReady"],"ignoreList":[],"sourceRoot":""}