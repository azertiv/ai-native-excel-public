{"version":3,"file":"taskpane.js","mappings":"mBASO,MAAMA,EAAYC,OAAOC,OAAO,CACrCC,OAAQ,SACRC,OAAQ,WAGGC,EAAWJ,OAAOC,OAAO,CACpCI,SAAUN,EAAUG,OAEpBI,YAAa,yBACbC,YAAa,aACbC,sBAAuB,UACvBC,sBAAuB,MACvBC,gBAAiB,KAGjBC,MAAO,EACPC,UAAW,KAGXC,OAAO,EACPC,YAAa,OACbC,eAAgB,OAGZC,EAAehB,OAAOC,OAAO,CACjCgB,iBAAkB,yBAClBC,eAAgB,uBAChBC,eAAgB,uBAChBC,aAAc,qBACdC,aAAc,qBACdC,wBAAyB,gCACzBC,wBAAyB,gCACzBC,kBAAmB,0BACnBC,gBAAiB,wBACjBC,cAAe,sBACfC,eAAgB,uBAChBC,QAAS,gBAGTC,eAAgB,uBAGhBC,YAAa,oBACbC,qBAAsB,6BACtBC,YAAa,oBACbC,eAAgB,yBAIZC,EAAclC,OAAOC,OAAO,CAChCiB,eAAgB,iBAChBM,kBAAmB,oBAEnBW,oBAAqB,yBACrBC,kBAAmB,uBACnBC,kBAAmB,uBACnBC,gBAAiB,qBACjBC,gBAAiB,qBAEjBC,qBAAsB,iCACtBC,qBAAsB,mCAGxB,IAAIC,EAAoB,KAExB,SAASC,IACP,IACE,GAA6B,oBAAlBC,eAAiCA,eAAeC,SAASC,QAClE,MAAO,CAAEC,KAAM,SAAUF,QAASD,cAAcC,QAEpD,CAAE,MACA,CAGF,IACE,GAAsB,oBAAXG,QAA0BA,QAAQC,cAAcH,QACzD,MAAO,CAAEC,KAAM,QAASF,QAASG,OAAOC,aAE5C,CAAE,MACA,CAIF,MAAMC,EAAM,IAAIC,IAChB,MAAO,CACLJ,KAAM,SACNF,QAAS,CACPO,QAAaN,MAACO,GACLH,EAAII,IAAID,GAAKH,EAAIK,IAAIF,GAAK,KAEnC,aAAMG,CAAQH,EAAGI,GACfP,EAAIQ,IAAIL,EAAGM,OAAOF,GACpB,EACA,gBAAMG,CAAWP,GACfH,EAAIW,OAAOR,EACb,GAGN,CAEA,SAASS,IACP,IACE,GAAsB,oBAAXd,QAA0BA,QAAQC,cAAcH,QACzD,OAAOE,OAAOC,YAElB,CAAE,MACA,OAAO,IACT,CACA,OAAO,IACT,CAMAG,eAAeW,EAAOC,GACpB,MAAM,KAAEjB,EAAI,QAAEF,GAAYF,IAC1B,GAAa,UAATI,EACF,IACE,OAAOF,EAAQC,QAAQkB,EACzB,CAAE,MACA,OAAO,IACT,CAGF,GAAa,WAATjB,EACF,IACE,MAAMkB,QAAepB,EAAQC,QAAQkB,GACrC,GAAc,MAAVC,EAAgB,CAClB,MAAMC,EAAQJ,IACd,IAAKI,EAAO,OAAO,KACnB,IACE,MAAMC,EAAaD,EAAMpB,QAAQkB,GACjC,OAAqB,MAAdG,EAAqB,KAAOA,CACrC,CAAE,MACA,OAAO,IACT,CACF,CACA,OAAOF,CACT,CAAE,MACA,MAAMC,EAAQJ,IACd,IAAKI,EAAO,OAAO,KACnB,IACE,OAAOA,EAAMpB,QAAQkB,EACvB,CAAE,MACA,OAAO,IACT,CACF,CAGF,IACE,aAAanB,EAAQC,QAAQkB,EAC/B,CAAE,MACA,OAAO,IACT,CACF,CAEAZ,eAAegB,EAAOJ,EAAKK,GACzB,MAAM,KAAEtB,EAAI,QAAEF,GAAYF,IACpBc,EAAa,MAATY,EAAgB,GAAKV,OAAOU,GACtC,GAAa,UAATtB,EACF,IAEE,YADAF,EAAQW,QAAQQ,EAAKP,EAEvB,CAAE,MACA,MACF,CAGF,GAAa,WAATV,EAAmB,CACrB,UACQF,EAAQW,QAAQQ,EAAKP,EAC7B,CAAE,MACA,CAEF,MAAMS,EAAQJ,IACd,IAAKI,EAAO,OACZ,IACEA,EAAMV,QAAQQ,EAAKP,EACrB,CAAE,MACA,CAEF,MACF,CAEA,UACQZ,EAAQW,QAAQQ,EAAKP,EAC7B,CAAE,MACA,CAEJ,CAEAL,eAAekB,EAAUN,GACvB,MAAM,KAAEjB,EAAI,QAAEF,GAAYF,IAC1B,GAAa,UAATI,EACF,IAEE,YADAF,EAAQe,WAAWI,EAErB,CAAE,MACA,MACF,CAGF,GAAa,WAATjB,EAAmB,CACrB,UACQF,EAAQe,WAAWI,EAC3B,CAAE,MACA,CAEF,MAAME,EAAQJ,IACd,IAAKI,EAAO,OACZ,IACEA,EAAMN,WAAWI,EACnB,CAAE,MACA,CAEF,MACF,CAEA,UACQnB,EAAQe,WAAWI,EAC3B,CAAE,MACA,CAEJ,CAEAZ,eAAemB,IACb,GAAI7B,EAAmB,OAAOA,EAE9BA,EAAoB,WAGlB,GAAa,YADMqB,EAAO/C,EAAaa,gBACvC,CAIA,IADwB2C,QAAwBT,EAAO/C,EAAaC,mBAC9C,CACpB,MAAMwD,EAAiBD,QAAwBT,EAAO7B,EAAYC,4BAC5DiC,EAAOpD,EAAaC,iBAAkBwD,GAAkBrE,EAASC,SACzE,CAIA,UADmB0D,EAAO/C,EAAaE,gBAC5B,CACT,MAAMwD,QAAgBX,EAAO7B,EAAYE,0BAA8B2B,EAAO7B,EAAYhB,gBACtFwD,SAAcN,EAAOpD,EAAaE,eAAgBwD,EACxD,CAGA,UADmBX,EAAO/C,EAAaG,gBAC5B,CACT,MAAMuD,QAAeX,EAAO7B,EAAYG,mBACpCqC,SAAcN,EAAOpD,EAAaG,eAAgBuD,EACxD,CAIA,UADqBX,EAAO/C,EAAaI,cAC5B,CACX,MAAMsD,QAAeX,EAAO7B,EAAYI,uBAClC8B,EAAOpD,EAAaI,aAAcsD,GAAUtE,EAASE,YAC7D,CAGA,UADqByD,EAAO/C,EAAaK,cAC5B,CACX,MAAMqD,QAAeX,EAAO7B,EAAYK,uBAClC6B,EAAOpD,EAAaK,aAAcqD,GAAUtE,EAASG,YAC7D,CAIA,UADkBwD,EAAO/C,EAAaQ,mBAC5B,CACR,MAIMmD,EAAa,OAJSZ,EAAO7B,EAAYV,yBACvBuC,EAAO7B,EAAYM,4BACnBuB,EAAO7B,EAAYO,uBAGxCmC,IAAKC,GAAMC,SAASnB,OAAOkB,GAAK,IAAIE,OAAQ,KAC5CC,OAAQC,GAAMC,OAAOC,SAASF,IAAMA,EAAI,GAErCG,EAAWT,EAAWU,OAASC,KAAKC,OAAOZ,GAAcvE,EAASM,sBAClE0D,EAAOpD,EAAaQ,kBAAmBmC,OAAOyB,GACtD,OAEMhB,EAAOpD,EAAaa,eAAgB,IAlDlB,CAmDzB,EAtDmB,GAwDpB,UACQa,CACR,CAAE,QACAA,EAAoB,IACtB,CACF,CAEO,SAAS8B,EAAkBgB,GAChC,IAAKA,EAAG,MAAO,GACf,MAAMC,EAAI9B,OAAO6B,GAAGT,OAAOW,cAC3B,OAAID,IAAM1F,EAAUG,OAAeH,EAAUG,OACzCuF,IAAM1F,EAAUI,OAAeJ,EAAUI,OAEnC,WAANsF,GAAwB,QAANA,EAAoB1F,EAAUG,OAC1C,QAANuF,GAAqB,YAANA,EAAwB1F,EAAUI,OAC9C,EACT,CAEA,MAAMwF,EAA2B,IAAIC,IAAI,CAAC,OAAQ,UAAW,MAAO,SAAU,SACxEC,EAA2B,IAAID,IAAI,CAAC,OAAQ,UAAW,MAAO,SAAU,SAE9E,SAASE,EAA+BzB,GACtC,MAAMZ,EAAIE,OAAOU,GAAS,IAAIU,OAAOW,cACrC,OAAKjC,GACEkC,EAAyBrC,IAAIG,GAAKA,EAD1BrD,EAASI,qBAE1B,CAEA,SAASuF,EAAyB1B,GAChC,MAAMZ,EAAIE,OAAOU,GAAS,IAAIU,OAAOW,cACrC,OAAKjC,GACEoC,EAAyBvC,IAAIG,GAAKA,EAD1BrD,EAASK,qBAE1B,CAEO2C,eAAe4C,IAGpB,aAFMzB,IACIC,QAAwBT,EAAO/C,EAAaC,oBAC1Cb,EAASC,QACvB,CAQA,SAAS4F,EAAO5F,GAEd,OADUmE,EAAkBnE,KAClBN,EAAUI,OAAea,EAAaG,eACzCH,EAAaE,cACtB,CAEOkC,eAAe8C,EAAU7F,GAG9B,aAFMkE,WACUR,EAAOkC,EAAO5F,KACjB,IAAI0E,MACnB,CAYA,SAASoB,EAAS9F,GAEhB,OADUmE,EAAkBnE,KAClBN,EAAUI,OAAea,EAAaK,aACzCL,EAAaI,YACtB,CAEOgC,eAAegD,EAAS/F,SACvBkE,IACN,MAAMiB,EAAIhB,EAAkBnE,GACtBgG,QAAYtC,EAAOoC,EAASX,IAClC,OAAIa,GAAO1C,OAAO0C,GAAKtB,OAAepB,OAAO0C,GAAKtB,OAC3CS,IAAMzF,EAAUI,OAASC,EAASG,YAAcH,EAASE,WAClE,CAEO8C,eAAekD,IAGpB,aAFM/B,IAECuB,QADW/B,EAAO/C,EAAaM,0BACOlB,EAASI,sBACxD,CAEO4C,eAAemD,IAGpB,aAFMhC,IAECwB,QADWhC,EAAO/C,EAAaO,0BACCnB,EAASK,sBAClD,CAaO2C,eAAeoD,EAAyBnC,GAC7C,MAAMZ,EAAIsC,EAAyB1B,GAEnC,aADMD,EAAOpD,EAAaO,wBAAyBkC,GAC5CA,CACT,CAEOL,eAAeqD,EAAyBpC,GAC7C,MAAMZ,EAAIqC,EAA+BzB,GAEzC,aADMD,EAAOpD,EAAaM,wBAAyBmC,GAC5CA,CACT,CAEOL,eAAesD,UACdnC,IACN,MAAM8B,QAAYtC,EAAO/C,EAAaQ,mBAEtC,OAAOmF,EADG7B,SAASnB,OAAO0C,GAAO,IAAItB,OAAQ,IAC1B,EAAG,MAAQ3E,EAASM,gBACzC,CAEO0C,eAAewD,EAAmBvC,GACvC,MAAMY,EAAI0B,EAAStC,EAAO,EAAG,MAAQjE,EAASM,iBAE9C,aADM0D,EAAOpD,EAAaQ,kBAAmBmC,OAAOsB,IAC7CA,CACT,CAaA,SAAS4B,EAAqBxC,GAC5B,IAAKyC,MAAMC,QAAQ1C,GAAQ,MAAO,GAClC,MAAM2C,EAAM,GACNC,EAAO,IAAIrB,IACjB,IAAK,MAAMsB,KAAQ7C,EAAO,CACxB,MAAML,EAAML,OAAOuD,GAAQ,IAAInC,OAC1Bf,IAAOiD,EAAK3D,IAAIU,KACrBiD,EAAKE,IAAInD,GACTgD,EAAII,KAAKpD,GACX,CACA,OAAOgD,CACT,CA8BO5D,eAAeiE,EAAkBC,GACtC,MAAMC,EAAaV,EAAqBS,GAExC,aADMlD,EAAOpD,EAAaW,eAAgB6F,KAAKC,UAAUF,IAClDA,CACT,CAaOnE,eAAesE,EAAWC,GAC/B,OAAKA,SAICvD,EAAOpD,EAAaY,QAAS4F,KAAKC,UAAUE,IAC3CA,UAJCrD,EAAUtD,EAAaY,SACtB,KAIX,CAEOwB,eAAewE,UACdtD,EAAUtD,EAAaY,QAC/B,CAGO,SAASiG,IACd,OAAOC,KAAKC,KACd,CAEO,SAASC,EAAMC,GACpB,OAAO,IAAIC,QAASC,GAAYC,WAAWD,EAASF,GACtD,CAQO,SAAStB,EAAStC,EAAOgE,EAAK9C,EAAK+C,EAAWD,GACnD,MAAMpD,EAAIH,SAASnB,OAAOU,GAAQ,IAClC,OAAKa,OAAOC,SAASF,GACdK,KAAKC,IAAI8C,EAAK/C,KAAK+C,IAAI9C,EAAKN,IADHqD,CAElC,CAEA,SAASC,EAAiBlC,GACxB,MAAMpB,EAAIH,SAASnB,OAAO0C,GAAO,IAAItB,OAAQ,IAC7C,OAAOG,OAAOC,SAASF,IAAMA,EAAI,EAAIA,EAAI,CAC3C,CA0CA,MAAMuD,EAAqB,qBAE3B,IAAIC,EAAgB,EAEpBrF,eAAesF,IACb,MAAMC,EAAYJ,QAAuBxE,EAAO/C,EAAaiB,iBAE7D,OADI0G,EAAYF,IAAeA,EAAgBE,GACxCF,CACT,CAMArF,eAAewF,IACb,MAAMvC,QAAYtC,EAAO/C,EAAagB,aACtC,IAAKqE,EAAK,MAAO,GACjB,IACE,MAAMwC,EAAMrB,KAAKsB,MAAMzC,GACvB,OAAOS,MAAMC,QAAQ8B,GAAOA,EAAM,EACpC,CAAE,MACA,MAAO,EACT,CACF,CAEAzF,eAAe2F,EAAeC,GAC5B,UACQ5E,EAAOpD,EAAagB,YAAawF,KAAKC,UAAUuB,GACxD,CAAE,MACA,CAEJ,CAEA,SAASC,EAAgBD,EAASL,EAAY,GAC5C,MAAMZ,EAAMF,IACNqB,EAAO,GACPC,EAAc,GAEpB,IAAK,MAAMC,KAASJ,GAAW,GAAI,CACjC,IAAKI,IAAUA,EAAMpF,IAAK,SAC1B,MAAMqF,EAAUnE,OAAOkE,EAAME,WAAa,GACtCX,KAAezD,OAAOC,SAASkE,IAAYA,GAAWV,IAItDS,EAAMG,aAAeH,EAAMG,aAAexB,EAH5CoB,EAAY/B,KAAKgC,EAAMpF,KAOzBkF,EAAK9B,KAAKgC,EACZ,CAEA,GAAIF,EAAK7D,OAnDa,IAmDa,CACjC6D,EAAKM,KAAK,CAACC,EAAGC,KAAOD,EAAEH,WAAa,IAAMI,EAAEJ,WAAa,IACzD,MAAMK,EAAOT,EAAK7D,OArDE,IAsDduE,EAAWV,EAAKW,MAAM,EAAGF,GAC/B,IAAK,MAAMG,KAAKF,EAAUT,EAAY/B,KAAK0C,EAAE9F,KAC7C,MAAO,CAAEsD,KAAM4B,EAAKW,MAAMF,GAAOR,cACnC,CAEA,MAAO,CAAE7B,KAAM4B,EAAMC,cACvB,CAEA/F,eAAe2G,EAAiB/F,GACzBA,SACCM,EAAUkE,EAAqBxE,EACvC,CAEAZ,eAAe4G,EAAqBhG,GAClC,MAAMiG,QAAcrB,IACdsB,GAAQD,GAAS,IAAIjF,OAAQkC,GAASA,GAAMlD,MAAQA,GACtDkG,EAAK7E,SAAW4E,EAAM5E,cAAc0D,EAAemB,EACzD,CAiCO9G,eAAe+G,EAAmBC,EAAU/F,EAAOgG,EAAOC,EAAO,CAAC,GACvE,IAAKF,EAAU,OACf,MAAMrC,EAAMF,IACNc,QAAkBD,IAClBY,EAAYX,GAAaZ,GAAOY,EAAYA,EAAY,EAAIZ,EAC5DwB,EAA+B,iBAAVc,GAAsBA,EAAQ,EAAIf,EAAYe,EAAQ,KAC3EjB,EAAQ,CACZ3F,EAAG,EACH6F,YACAC,cACAlF,SAGIgC,EAAMmB,KAAKC,UAAU2B,SACrBhF,EAAOoE,EAAqB4B,EAAU/D,GAE5C,MAAM4D,QAAcrB,IACdvI,EAAWiK,EAAKjK,UAAYgE,GAAOhE,UAAY,GAC/CkK,EAAQD,EAAKC,OAASlG,GAAOkG,OAAS,GACtCC,EAAOnE,EAAIhB,OAEjB,IAAIoF,GAAU,EACd,MAAMP,GAAQD,GAAS,IAAIrF,IAAKsC,GAC1BA,GAAMlD,MAAQoG,EAAiBlD,GACnCuD,GAAU,EACH,CACLzG,IAAKoG,EACL/J,WACAkK,QACAC,OACAlB,YACAC,iBAICkB,GACHP,EAAK9C,KAAK,CACRpD,IAAKoG,EACL/J,WACAkK,QACAC,OACAlB,YACAC,gBAIJ,MAAMmB,EAASzB,EAAgBiB,EAAMvB,GACrC,IAAK,MAAM3E,KAAO0G,EAAOvB,kBAAmBY,EAAiB/F,SACvD+E,EAAe2B,EAAOpD,KAC9B,CAkEA,SAASqD,EAAatG,GACpB,GAAIyC,MAAMC,QAAQ1C,GAAQ,OAAOA,EAAMO,IAAI+F,GAC3C,GAVqBlH,EAUHY,EAT2B,oBAAtCrE,OAAO4K,UAAUC,SAASC,KAAKrH,GASZ,CACxB,MAAMuD,EAAM,CAAC,EACb,IAAK,MAAM3D,KAAKrD,OAAO+K,KAAK1G,GAAOmF,OAAQxC,EAAI3D,GAAKsH,EAAatG,EAAMhB,IACvE,OAAO2D,CACT,CAdF,IAAuBvD,EAerB,OAAOY,CACT,CAgCA,MACM2G,EAAqB,MAC3B,IAAIC,EAAc,GACdC,EAAqB,KACrBC,GAAoB,EACpBC,EAA0B,EAC1BC,EAAqB,EAEzBjI,eAAekI,EAA0BC,EAAU,CAAC,GAClD,MAAM5C,EAAYJ,QAAuBxE,EAAO/C,EAAae,uBAY7D,OAXI4G,EAAY0C,IACdA,EAAqB1C,EACrBsC,EAAc,GACVM,EAAQC,OACVL,GAAoB,EACpBD,EAAqB,KACrBE,EAA0BvD,KAE1BsD,GAAoB,GAGjBE,CACT,CAEAjI,eAAeqI,EAAeC,GAAQ,GACpC,GAAIR,EAAoB,OAAOA,EAE/BA,EAAqB,WACnB,MAAMvC,QAAkB2C,IACxB,IAAKI,GAASP,EAAmB,OAAOF,EACxC,MAAM5E,QAAYtC,EAAO/C,EAAac,aACtC,IAAI+G,EAAM,GACV,GAAIxC,EACF,IACE,MAAMsF,EAASnE,KAAKsB,MAAMzC,GACtBS,MAAMC,QAAQ4E,KAAS9C,EAAM8C,EACnC,CAAE,MACA9C,EAAM,EACR,CAEF,MAAMd,EAAMF,IAgBZ,OAfAgB,EAAMA,EACHjE,IAAKgH,IACJ,IAAKA,EAAG,OAAO,KACf,IAAIC,EAAKD,EAAEC,GACX,GAAkB,iBAAPA,EAAiB,CAC1B,MAAMF,EAAS7D,KAAKgB,MAAM+C,GACtB3G,OAAOC,SAASwG,KAASE,EAAKF,EACpC,CACA,MAAkB,iBAAPE,EAAwB,KAC5B,IAAKD,EAAGC,QAEhB7G,OAAQ4G,GAAMA,GAAqB,iBAATA,EAAEC,IAAmBD,EAAEC,GAAKlD,GAAaZ,EAAM6D,EAAEC,IAAMb,GACpFC,EAAcpC,EAAIgB,OAAM,KACxBsB,GAAoB,EACpBC,EAA0BvD,IACnBoD,CACR,EA9BoB,GAgCrB,IACE,aAAaC,CACf,CAAE,QACAA,EAAqB,IACvB,CACF,CAEA9H,eAAe0I,IACb,UACQ1H,EAAOpD,EAAac,YAAa0F,KAAKC,UAAUwD,EAAYpB,OAAM,MAC1E,CAAE,MACA,CAEJ,CAEA,SAASkC,KACP,MAAMhE,EAAMF,IACNc,EAAY0C,GAAsB,EACxCJ,GAAeA,GAAe,IAAIjG,OAC/B4G,GAAMA,GAAqB,iBAATA,EAAEC,IAAmBD,EAAEC,GAAKlD,GAAaZ,EAAM6D,EAAEC,IAAMb,GAExEC,EAAY5F,OAhFM,MAiFpB4F,EAAcA,EAAYpB,OAAM,KAEpC,CAEO,SAASmC,GAAW5C,IAI3BhG,eAA+BgG,GAC7B,UACQkC,EAA0B,CAAEE,OAAO,IACzC,MAAMS,EAAW,CAAEJ,GAAIhE,OAAYuB,GAEnC,GAAI+B,EAKF,OAJAF,EAAY7D,KAAK6E,GACjBF,KACAX,EAA0BvD,eACpBiE,UAIFL,IACNR,EAAY7D,KAAK6E,GACjBF,KACAX,EAA0BvD,UACpBiE,GACR,CAAE,MACA,CAEJ,CAxBOI,CAAgB9C,EACvB,CCn3BA,MAAM+C,GAAQ,IDifP,MACLC,WAAAA,CAAYC,EAAa,KACvBC,KAAKD,WAAaA,EAClBC,KAAK1H,IAAM,IAAIzB,GACjB,CAEAI,GAAAA,CAAIS,GACF,IAAKsI,KAAK1H,IAAItB,IAAIU,GAAM,OAAO,KAC/B,MAAMoF,EAAQkD,KAAK1H,IAAIrB,IAAIS,GAE3B,OAAIoF,GAAOG,aAAeH,EAAMG,aAAe1B,KAC7CyE,KAAK1H,IAAIf,OAAOG,GACT,OAITsI,KAAK1H,IAAIf,OAAOG,GAChBsI,KAAK1H,IAAIlB,IAAIM,EAAKoF,GACXA,EAAM/E,MACf,CAEAX,GAAAA,CAAIM,EAAKK,EAAOgG,GACd,MAAMd,EAA+B,iBAAVc,GAAsBA,EAAQ,EAAIxC,IAAUwC,EAAQ,KAK/E,IAJIiC,KAAK1H,IAAItB,IAAIU,IAAMsI,KAAK1H,IAAIf,OAAOG,GACvCsI,KAAK1H,IAAIlB,IAAIM,EAAK,CAAEK,QAAOkF,gBAGpB+C,KAAK1H,IAAI4F,KAAO8B,KAAKD,YAAY,CACtC,MAAME,EAAYD,KAAK1H,IAAImG,OAAOb,OAAO7F,MACzCiI,KAAK1H,IAAIf,OAAO0I,EAClB,CACF,CAEAC,KAAAA,GACEF,KAAK1H,IAAI4H,OACX,GCphByB,KAC3B,IAAIC,GAAqB,EAWzB,MAAMC,GAAW,IAAIvJ,IAIrB,IAAIwJ,GAAS,EACb,MAAMC,GAAQ,GAcd,SAASC,GAAiBpH,GACxB,MAAoB,iBAANA,GAAkBA,EAAEV,OAAOM,OAAS,CACpD,CAEA,SAASyH,GAAiBrJ,EAAGsJ,GAAM,GACjC,GAAiB,kBAANtJ,EAAiB,OAAOA,EACnC,GAAiB,iBAANA,EAAgB,OAAa,IAANA,EAClC,GAAiB,iBAANA,EAAgB,CACzB,MAAMgC,EAAIhC,EAAEsB,OAAOW,cACnB,GAAI,CAAC,IAAK,OAAQ,MAAO,IAAK,MAAMsH,SAASvH,GAAI,OAAO,EACxD,GAAI,CAAC,IAAK,QAAS,KAAM,IAAK,OAAOuH,SAASvH,GAAI,OAAO,CAC3D,CACA,OAAOsH,CACT,CAEA,SAASE,GAAmBxJ,GAC1B,OAAOkD,EAASlD,EAAG,IAAM,KAAQrD,EAASQ,UAC5C,CAUA,SAASsM,GAAWzJ,GAClB,OAAOE,OAAOF,GAAK,IAAIiC,aACzB,CAEA,SAASyH,GAAqCC,GAC5C,MAAM3H,EAAIyH,GAAWE,GACrB,QAAK3H,IAEHA,EAAEuH,SAAS,mBACXvH,EAAEuH,SAAS,oBACXvH,EAAEuH,SAAS,oBACXvH,EAAEuH,SAAS,iBACXvH,EAAEuH,SAAS,kBACXvH,EAAEuH,SAAS,kBACXvH,EAAEuH,SAAS,uBACXvH,EAAEuH,SAAS,gBACXvH,EAAEuH,SAAS,oBACXvH,EAAEuH,SAAS,eAEf,CAEA,SAASK,GAA8BD,GACrC,MAAM3H,EAAIyH,GAAWE,GACrB,QAAK3H,MACCA,EAAEuH,SAAS,eAAiBvH,EAAEuH,SAAS,kBAAoBvH,EAAEuH,SAAS,eAAiBvH,EAAEuH,SAAS,oBAItGvH,EAAEuH,SAAS,kBACXvH,EAAEuH,SAAS,gBACXvH,EAAEuH,SAAS,YACXvH,EAAEuH,SAAS,iBACXvH,EAAEuH,SAAS,YACXvH,EAAEuH,SAAS,gBACXvH,EAAEuH,SAAS,iBAEf,CAEA,SAASM,GAAsBC,GAE7B,IAAKV,GAAiBU,GAAS,MAAO,0BACtC,MAAM9H,EAAI9B,OAAO4J,GAAQxI,OACzB,MAAI,QAAQyI,KAAK/H,GAAWA,EACrBA,EAJQ,0BAKjB,CAWA,SAASgI,GAAiBC,EAAQC,GAChC,MAAe,eAAXD,EAAgC,GAVtC,SAAgCC,GAC9B,IAAKd,GAAiBc,GAAO,MAAO,GACpC,MAAMtH,EAAM1C,OAAOgK,GAAM5I,OACnB6I,EAAQvH,EAAIuH,MAAM,aAClBC,GAAWD,EAAQA,EAAM,GAAKvH,GAAKtB,OACzC,OAAK8I,EAAQC,WAAW,KACjBD,EAD8B,EAEvC,CAISE,CAAuBJ,EAChC,CAmEOvK,eAAe4K,GAAWC,GAC/B,MAAMC,EAAQrG,IACRxH,EAAWmE,EAAkByJ,GAAK5N,iBAAoB2F,IACtDuE,QAAcnE,EAAS/F,GACvB8N,QAAejI,EAAU7F,GACzBqN,EAASO,GAAKG,cAAgB,aAC9BC,EAAexB,GAAiBoB,GAAKI,cAAgB1K,OAAOsK,EAAII,cAAgB,GAChFC,EAAkBjO,IAAaN,EAAUI,aAAeoG,IAA6B,GACrF/F,EAAwBH,IAAaN,EAAUG,aAAeoG,IAA6B,GAC3FiI,EAAuBlO,IAAaN,EAAUI,OAASmO,EAAkB9N,EAE/E,IAAK2N,EAaH,OAZAnC,GAAW,CACTwC,GAAId,EACJrN,WACAkK,QACAkE,IAAI,EACJxG,GAAIJ,IAAUqG,EACdrN,OAAO,EACPyN,gBAAiBC,QAAwBG,EACzC5D,KAAMuD,QAAgBK,EACtBC,KAAM,kBACNvB,QAAS,yCAAyC/M,OAE7C,CACLoO,IAAI,EACJpO,WACAkK,QACAoE,KAAM,kBACNvB,QAAS,yCAAyC/M,MAItD,MAAMuO,EAAOjL,OAAOsK,GAAKW,MAAQ,IAC3BrB,EAASV,GAAiBoB,GAAKV,QAAU5J,OAAOsK,EAAIV,QAAU,GAE9DsB,EAAY/B,GAAiBmB,GAAKY,WAAW,GAC7CjO,EAAYqM,GAAmBgB,GAAKrN,WACpCD,GA3KgB8C,EA2KOwK,GAAKtN,MA1K3BgG,EAASlD,EAAG,EAAG,EAAGrD,EAASO,QADpC,IAAwB8C,EA6KtB,MAAMqL,QAAepI,IACfhG,EA1KR,SAAkC+C,GAChC,OAAOkD,EAASlD,EAAG,EAAG,MAAQrD,EAASM,gBACzC,CAwK0BqO,CAAyBd,GAAKvN,iBAAmBoO,GACnEE,EAAiB3O,IAAaN,EAAUG,OA3GhD,SAAqCqK,EAAO0E,GAC1C,MAAMC,EAAQvL,OAAOsL,GAAU,IAAIlK,OAAOW,cAC1C,IAAKwJ,GAAmB,SAAVA,GAA8B,SAAVA,EAAkB,OAAO,KAE3D,MAAMC,EAAUxL,OAAO4G,GAAS,IAAIxF,OAAOW,cAC3C,IAAKyJ,EAAQnC,SAAS,UAAW,OAAO,KAExC,GAAImC,EAAQnC,SAAS,YACnB,OAAImC,EAAQnC,SAAS,SAGZ,CAAEoC,eAFO,IAAIxJ,IAAI,CAAC,UAAW,MAAO,SAAU,SAC1BtC,IAAI4L,GAASA,EAAQ,OACbG,eAG9B,CAAED,eADoB,SAAVF,GAA8B,WAAVA,EAAqB,OAAS,OAClCG,eAGrC,GAAIF,EAAQnC,SAAS,cAAe,CAOlC,IAAIsC,EANY,CACdC,QAAS,IACTC,IAAK,KACLC,OAAQ,KACRC,KAAM,OAEaR,GACrB,OAAKI,GACDH,EAAQnC,SAAS,gBAAesC,EAAShK,KAAKC,IAAI,IAAK+J,IACvDH,EAAQnC,SAAS,SAAQsC,EAAShK,KAAKC,IAAI,IAAK+J,IAC7C,CAAEK,eAAgBL,IAHL,IAItB,CAEA,OAAO,IACT,CA2EyDM,CAA4BrF,EAAO/J,GAAyB,KAE7GqP,EAAe/C,GAAiBmB,GAAKpN,MAAOT,EAASS,OACrDiP,EAASnJ,EACbsH,GAAKnN,cAAgB+N,EAAYzO,EAASW,eAAiBX,EAASU,aACpE,EACA,QACA+N,EAAYzO,EAASW,eAAiBX,EAASU,mBArOnDsC,iBACE,MAAMuF,QD8hBDvF,iBACL,aAAasF,GACf,CChiB0BqH,GACpBpH,EAAY8D,KACdA,GAAqB9D,EACrBwD,GAAMK,QAEV,CAkOQ9D,GAGN,MAAMsH,EAAkB,CACtBvM,EAAG,EACHpD,WACAkK,QACA7J,kBACA4N,kBACA9N,wBACAqO,YACAtB,SACAqB,OACAqB,iBAAkBhC,GAAKgC,kBAAoB,GAC3CC,mBAAoBjC,GAAKiC,oBAAsB,MAG3C9F,QD4gBDhH,eAAuB+M,GAC5B,MAAMxC,EAAwB,iBAAVwC,EAAqBA,GAzBX9L,EAyBmC8L,EAxB1D3I,KAAKC,UAAUkD,EAAatG,KAD9B,IAAyBA,EA4B9B,IACE,GAAsB,oBAAX+L,QAA0BA,QAAQC,QAAQC,QAAiC,oBAAhBC,YAA6B,CACjG,MACMC,GADM,IAAID,aACEE,OAAO9C,GACnB2C,QAAeF,OAAOC,OAAOC,OAAO,UAAWE,GAErD,OADY1J,MAAM4J,KAAK,IAAIC,WAAWL,IAC3B1L,IAAK8E,GAAMA,EAAEmB,SAAS,IAAI+F,SAAS,EAAG,MAAMC,KAAK,GAC9D,CACF,CAAE,MACA,CAGF,MAAO,SA1BT,SAAiBC,GACf,IAAIC,EAAI,WACR,IAAK,IAAIC,EAAI,EAAGA,EAAIF,EAAIzL,OAAQ2L,IAC9BD,GAAKD,EAAIG,WAAWD,GACpBD,EAAIzL,KAAK4L,KAAKH,EAAG,UAGnB,OAAQA,IAAM,GAAGlG,SAAS,IAAI+F,SAAS,EAAG,IAC5C,CAkBkBO,CAAQxD,IAC1B,CC7hByByD,CAAQpB,GAE/B,GAAIH,EAAc,CAChB,MAAMwB,EAASlF,GAAM5I,IAAI6G,GACzB,GAAIiH,EAAQ,CACV,MAAMxD,EAAUJ,GAAiBC,EAAQ2D,GAAQ1D,MAiBjD,OAhBA3B,GAAW,CACTwC,GAAId,EACJrN,WACAkK,QACAkE,IAAI,EACJxG,GAAIJ,IAAUqG,EACdrN,OAAO,EACPyQ,UAAW,SACXhD,gBAAiBC,QAAwBG,EACzC5D,KAAMuD,QAAgBK,EACtB6C,YAAa,EACbC,aAAc,EACdC,gBAAiB,EACjBC,YAAa,EACb7D,QAASA,QAAWa,IAEf,IAAK2C,EAAQA,QAAQ,EAAMC,UAAW,SAC/C,CACA,MAAMK,QD8UHvO,eAAkCgH,GACvC,IAAKA,EAAU,OAAO,KACtB,MAAMzB,QAAkBD,IAClBrC,QAAYtC,EAAOyE,EAAqB4B,GAC9C,IAAK/D,EAEH,aADM2D,EAAqBI,GACpB,KAGT,IACE,MAAMhB,EAAQ5B,KAAKsB,MAAMzC,GACzB,IAAK+C,GAA0B,iBAAVA,EAAoB,MAAM,IAAIwI,MAAM,iBACzD,MAAMvI,EAAUnE,OAAOkE,EAAME,WAAa,GAC1C,OAAIX,KAAezD,OAAOC,SAASkE,IAAYA,GAAWV,IAKtDS,EAAMG,aAAeH,EAAMG,aAAe1B,WAJtCkC,EAAiBK,SACjBJ,EAAqBI,GACpB,MAOFhB,EAAM/E,OAAS,IACxB,CAAE,MAGA,aAFM0F,EAAiBK,SACjBJ,EAAqBI,GACpB,IACT,CACF,CC3W4ByH,CAAmBzH,GAC3C,GAAIuH,EAAW,CACb,MAAM9D,EAAUJ,GAAiBC,EAAQiE,GAAWhE,MAkBpD,OAjBAxB,GAAMzI,IAAI0G,EAAUuH,EAAoB,IAAT7B,GAC/B9D,GAAW,CACTwC,GAAId,EACJrN,WACAkK,QACAkE,IAAI,EACJxG,GAAIJ,IAAUqG,EACdrN,OAAO,EACPyQ,UAAW,aACXhD,gBAAiBC,QAAwBG,EACzC5D,KAAMuD,QAAgBK,EACtB6C,YAAa,EACbC,aAAc,EACdC,gBAAiB,EACjBC,YAAa,EACb7D,QAASA,QAAWa,IAEf,IAAKiD,EAAWN,QAAQ,EAAMC,UAAW,aAClD,CACF,CAEA,GAAI5E,GAASpJ,IAAI8G,GAAW,OAAOsC,GAASnJ,IAAI6G,GAEhD,MAAM5E,EA3RRpC,iBACMuJ,IALkB,SAKe,IAAIzE,QAASC,GAAYyE,GAAMxF,KAAKe,IACzEwE,KACA,IACE,YAuR6BvJ,WAC7B,IAAI0O,EAAU,EACVC,EAAU,KAEd,MAAMC,EAAe5O,SACnB/C,IAAaN,EAAUI,OA0Q7BiD,gBAA0B,OACxB+K,EAAM,MACN5D,EAAK,OACLgD,EAAM,KACNqB,EAAI,gBACJlO,EAAe,gBACf4N,EAAe,UACf1N,EAAS,UACTiO,EAAS,iBACToB,EAAgB,mBAChBC,IAEA,MAAM+B,EAAM,sCAENC,EAAO,CACX3H,QACA4F,MAAOvB,EACPuD,kBAAmBzR,EACnB0R,OAAO,GAQT,GALIvF,GAAiByB,KACnB4D,EAAKG,UAAY,CAAEpD,OAAQX,IAIzBzB,GAAiBU,GAAS,CAC5B,MAAM+E,EAAgC,qBAArBrC,GAA2CC,EACxD3C,EAAS,+BACTA,EACJ2E,EAAKK,aAAeD,CACtB,CAKIpC,EAIFgC,EAAKvE,KAAO,CACV6E,OAAQ,CACNC,KAAM,cACNC,KAAM,kBACNC,QAAQ,EACRC,OAAQ1C,IAGkB,qBAArBD,IACTiC,EAAKvE,KAAO,CAAE6E,OAAQ,CAAEC,KAAM,iBAI5B5D,IACFqD,EAAKW,MAAQ,CAAC,CAAEJ,KAAM,eACtBP,EAAKY,QAAU,CAAC,mCAGlB,MAAMC,QAAYC,GAAiBf,EAAK,CACtCgB,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChBC,cAAe,UAAUhF,KAE3B+D,KAAM1K,KAAKC,UAAUyK,IACpBtR,GAEGwS,QAAaC,GAASN,GAE5B,IAAKA,EAAItE,GAAI,CACX,MAAM6E,EAiFV,SAA4BF,GAC1B,IACE,MAAME,EAAMF,GAAMG,OAAOnG,QACzB,OAAOkG,EAAM3P,OAAO2P,GAAO,EAC7B,CAAE,MACA,MAAO,EACT,CACF,CAxFgBE,CAAmBJ,IAAS,qBAAqBL,EAAIU,WACjE,MAAO,CAAEhF,IAAI,EAAOpO,SAAUN,EAAUI,OAAQoK,QAAOoE,KAAM,YAAavB,QAASkG,EACrF,CAEA,MAAM3F,EAiBR,SAA2ByF,GAEzB,IACE,GAAiC,iBAAtBA,GAAMM,aAA4BN,EAAKM,YAAY3O,OAC5D,OAAOqO,EAAKM,WAEhB,CAAE,MACA,CAIF,IACE,MAAM1M,EAAMoM,GAAMO,OAClB,GAAI7M,MAAMC,QAAQC,GAAM,CACtB,MAAM4M,EAAQ,GACd,IAAK,MAAM1M,KAAQF,EAAK,CAOtB,GAN0B,iBAAfE,GAAMyG,MAAqBzG,EAAKyG,KAAK5I,QAAQ6O,EAAMxM,KAAKF,EAAKyG,MACvC,iBAAtBzG,GAAMwM,aAA4BxM,EAAKwM,YAAY3O,QAAQ6O,EAAMxM,KAAKF,EAAKwM,aACnE,gBAAfxM,GAAMuL,MAAgD,iBAAfvL,GAAMyG,MAAmBiG,EAAMxM,KAAKF,EAAKyG,MACjE,SAAfzG,GAAMuL,MAAyC,iBAAfvL,GAAMyG,MAAmBiG,EAAMxM,KAAKF,EAAKyG,MAG1D,YAAfzG,GAAMuL,KAAoB,CAC5B,MAAMoB,EAAU3M,GAAM2M,QACtB,GAAI/M,MAAMC,QAAQ8M,GAChB,IAAK,MAAMC,KAAQD,EACE,SAAfC,GAAMrB,MAAmBqB,GAAMnG,MAAMiG,EAAMxM,KAAK0M,EAAKnG,MACtC,gBAAfmG,GAAMrB,MAA0BqB,GAAMnG,MAAMiG,EAAMxM,KAAK0M,EAAKnG,UAEtC,iBAAZkG,GAChBD,EAAMxM,KAAKyM,EAEf,CAEA,GAAmB,YAAf3M,GAAMuL,KAAoB,CAC5B,MAAMoB,EAAU3M,GAAM2M,QACtB,GAAI/M,MAAMC,QAAQ8M,GAChB,IAAK,MAAMC,KAAQD,EACE,SAAfC,GAAMrB,MAAmBqB,GAAMnG,MAAMiG,EAAMxM,KAAK0M,EAAKnG,MACtC,gBAAfmG,GAAMrB,MAA0BqB,GAAMnG,MAAMiG,EAAMxM,KAAK0M,EAAKnG,UAEtC,iBAAZkG,GAChBD,EAAMxM,KAAKyM,EAEf,CACF,CACA,GAAID,EAAMvO,OAAS,EAAG,OAAOuO,EAAM/C,KAAK,MAAM9L,MAChD,CACF,CAAE,MACA,CAIF,IACE,OAAOqO,GAAMW,UAAU,IAAI3G,SAASyG,SAAW,EACjD,CAAE,MACA,MAAO,EACT,CACF,CA3EeG,CAAkBZ,GACzBa,EAAUpF,EAqFlB,SAA8BuE,GAC5B,IACE,MAAMpM,EAAMoM,GAAMO,OAClB,IAAK7M,MAAMC,QAAQC,GAAM,MAAO,GAEhC,MAAMiN,EAAU,GAChB,IAAK,MAAM/M,KAAQF,EAAK,CACtB,GAAmB,oBAAfE,GAAMuL,KAA4B,SACtC,MAAMhN,EAAIyB,GAAMgN,QAAQD,QACxB,GAAKnN,MAAMC,QAAQtB,GACnB,IAAK,MAAM0O,KAAO1O,EACX0O,GAAKlC,KACVgC,EAAQ7M,KAAK,CAAEgN,MAAOD,GAAKC,OAAS,GAAInC,IAAKkC,EAAIlC,KAErD,CAEA,OAAOoC,GAAcJ,EACvB,CAAE,MACA,MAAO,EACT,CACF,CAzG8BK,CAAqBlB,GAAQ,GACnDmB,EA0HR,SAA4BnB,GAC1B,IACE,MAAMoB,EAAIpB,GAAMmB,MAChB,IAAKC,EAAG,OAAO,KACf,MAAMC,EAAkBC,GAAMF,GAAGG,eAC3BlD,EAAkBiD,GAAMF,GAAGI,uBAAuBC,kBAClDrD,EAAelM,KAAKC,IAAI,EAAGkP,EAAkBhD,GACnD,MAAO,CACLF,YAAamD,GAAMF,GAAGM,cACtBtD,eACAC,kBACAC,YAAagD,GAAMF,GAAGO,cACtBC,kBAAmBN,GAAMF,GAAGS,sBAAsBC,eAEtD,CAAE,MACA,OAAO,IACT,CACF,CA3IgBC,CAAmB/B,GAEjC,OAAKvG,GAAiBc,GAUf,CAAEc,IAAI,EAAMpO,SAAUN,EAAUI,OAAQoK,QAAOoD,KAAMA,EAAK5I,OAAQkP,UAASM,SATzE,CACL9F,IAAI,EACJpO,SAAUN,EAAUI,OACpBoK,QACAoE,KAAM,iBACNvB,QAAS,yBAKf,CAnWsCgI,CAAWC,GAqJjDjS,gBAA0B,OACxB+K,EAAM,MACN5D,EAAK,OACLgD,EAAM,KACNqB,EAAI,gBACJlO,EAAe,eACfsO,EAAc,UACdpO,EAAS,UACTiO,EAAS,iBACToB,EAAgB,mBAChBC,IAEA,MAAM+B,EAhBR,SAAwB1H,EAAO4D,GAC7B,MAAO,2DAA2DmH,mBAAmB/K,0BAA8B+K,mBAAmBnH,IACxI,CAccoH,CAAehL,EAAO4D,GAE5B+D,EAAO,CACXsD,SAAU,CAAC,CAAEC,KAAM,OAAQC,MAAO,CAAC,CAAE/H,KAAMiB,MAC3C+G,iBAAkB,CAChBjV,oBAQJ,GAJIsO,GAA4C,iBAAnBA,IAC3BkD,EAAKyD,iBAAiB3G,eAAiBA,GAGrCnC,GAAiBU,GAAS,CAG5B,MAAM+E,EAAgC,qBAArBrC,GAA2CC,EACxD3C,EAAS,+BACTA,EACJ2E,EAAK0D,kBAAoB,CAAEH,KAAM,SAAUC,MAAO,CAAC,CAAE/H,KAAM2E,IAC7D,CAGIrC,IACFiC,EAAKyD,iBAAiB1F,iBAAmBA,GAEvCC,IACFgC,EAAKyD,iBAAiBE,eAAiB3F,GAIrCrB,IAGFqD,EAAKW,MAAQ,CAAC,CAAEiD,cAAe,CAAC,KAGlC,MAAM/C,QAAYC,GAAiBf,EAAK,CACtCgB,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BhB,KAAM1K,KAAKC,UAAUyK,IACpBtR,GAEGwS,QAAaC,GAASN,GAE5B,IAAKA,EAAItE,GAAI,CACX,MAAM6E,EA4BV,SAA4BF,GAC1B,IACE,MAAME,EAAMF,GAAMG,OAAOnG,QACzB,OAAOkG,EAAM3P,OAAO2P,GAAO,EAC7B,CAAE,MACA,MAAO,EACT,CACF,CAnCgByC,CAAmB3C,IAAS,qBAAqBL,EAAIU,WACjE,MAAO,CAAEhF,IAAI,EAAOpO,SAAUN,EAAUG,OAAQqK,QAAOoE,KAAM,YAAavB,QAASkG,EACrF,CAEA,MAAM3F,EAWR,SAA2ByF,GACzB,IACE,MAAM4C,EAAI5C,GAAMzO,aAAa,GACvB+Q,EAAQM,GAAGnC,SAAS6B,MAC1B,OAAI5O,MAAMC,QAAQ2O,GACTA,EAAM9Q,IAAKY,GAAMA,GAAGmI,MAAQ,IAAIkD,KAAK,IAEvC,EACT,CAAE,MACA,MAAO,EACT,CACF,CAtBeoF,CAAkB7C,GACzBa,EAgCR,SAA8Bb,GAC5B,IACE,MAAM4C,EAAI5C,GAAMzO,aAAa,GACvBuR,EAAKF,GAAGG,kBACRC,EAASF,GAAIG,gBACnB,IAAKvP,MAAMC,QAAQqP,GAAS,MAAO,GAEnC,MAAMpP,EAAM,GACZ,IAAK,MAAMsP,KAAMF,EAAQ,CACvB,MAAMG,EAAMD,GAAIC,IACXA,GAAKC,KACVxP,EAAII,KAAK,CAAEgN,MAAOmC,GAAKnC,OAAS,GAAInC,IAAKsE,EAAIC,KAC/C,CAEA,OAAOnC,GAAcrN,EACvB,CAAE,MACA,MAAO,EACT,CACF,CAlDkByP,CAAqBrD,GAC/BmB,EA2OR,SAA4BnB,GAC1B,IACE,MAAMoB,EAAIpB,GAAMsD,cAChB,OAAKlC,EACE,CACLjD,YAAamD,GAAMF,GAAGmC,kBACtBnF,aAAckD,GAAMF,GAAGoC,sBACvBnF,gBAAiBiD,GAAMF,GAAGqC,oBAC1BnF,YAAagD,GAAMF,GAAGsC,iBACtB9B,kBAAmBN,GAAMF,GAAGuC,0BANf,IAQjB,CAAE,MACA,OAAO,IACT,CACF,CAzPgBC,CAAmB5D,GAEjC,OAAKvG,GAAiBc,GAIf,CAAEc,IAAI,EAAMpO,SAAUN,EAAUG,OAAQqK,QAAOoD,KAAMA,EAAK5I,OAAQkP,UAASM,SAHzE,CAAE9F,IAAI,EAAOpO,SAAUN,EAAUG,OAAQqK,QAAOoE,KAAM,iBAAkBvB,QAAS,0BAI5F,CA5NyD6J,CAAW5B,GAEhE,KAAOvD,GAAWnR,GAAO,CACvBmR,IACA,IACE,MAAMoF,EAAW,CACf/I,SACA5D,QACAgD,SACAqB,OACAlO,kBACA4N,kBACAU,iBACApO,YACAiO,YACAoB,iBAAkBhC,GAAKgC,iBACvBC,mBAAoBjC,GAAKiC,oBAG3B,IAAIjM,QAAe+N,EAAakF,GAEhC,IAAKjT,EAAOwK,GAAI,CACd,IAAI4G,EAAO6B,EAGP7B,EAAKxG,YAELxB,GAA8BpJ,EAAOmJ,UAA4B,cAAhBnJ,EAAO0K,MAAwC,mBAAhB1K,EAAO0K,QAEvF0G,EAAO,IAAKA,EAAMxG,WAAW,GAC7B5K,QAAe+N,EAAaqD,IAKhC,MAAM8B,EAAkB9B,EAAKpF,kBAAoBoF,EAAKnF,oBACjDjM,EAAOwK,IAAM0I,IAEdhK,GAAqClJ,EAAOmJ,UAC5B,cAAhBnJ,EAAO0K,MACS,mBAAhB1K,EAAO0K,QAEP0G,EAAO,IACFA,EACHpF,sBAAkBvB,EAClBwB,wBAAoBxB,EACpBnB,OAAQD,GAAsB+H,EAAK9H,SAErCtJ,QAAe+N,EAAaqD,GAGlC,CAGA,MAAMd,EAAQ6C,GAAenT,GAAQsQ,OAC/B1G,EAAU5J,EAAOwK,GAAKhB,GAAiBC,EAAQzJ,EAAO0J,MAAQ,GA0BpE,OAzBA3B,GAAW,CACTwC,GAAId,EACJrN,WACAkK,QACAkE,GAAIxK,EAAOwK,GACXxG,GAAIJ,IAAUqG,EACd4D,UACAjR,OAAO,EACPyN,gBAAiBC,QAAwBG,EACzC5D,KAAMuD,QAAgBK,EACtB6C,YAAagD,EAAMhD,YACnBC,aAAc+C,EAAM/C,aACpBC,gBAAiB8C,EAAM9C,gBACvBuD,kBAAmBT,EAAMS,kBACzBtD,YAAa6C,EAAM7C,YACnB/C,KAAM1K,EAAO0K,KACbvB,QAASnJ,EAAOmJ,QAChBS,QAASA,QAAWa,IAGlBzK,EAAOwK,IAAMoB,IACf1D,GAAMzI,IAAI0G,EAAUnG,EAAiB,IAAT6L,SACtB3F,EAAmBC,EAAUnG,EAAiB,IAAT6L,EAAe,CAAEzP,WAAUkK,WAGjEtG,CACT,CAAE,MAAO2H,GACPmG,EAAUnG,EACNkG,GAAWnR,SAAaqH,EAAM,IAAM8J,EAC1C,CACF,CAEA,MAAMwB,EAAMvB,GAAS3E,QAAUzJ,OAAOoO,EAAQ3E,SAAW,mBAazD,OAZApB,GAAW,CACTwC,GAAId,EACJrN,WACAkK,QACAkE,IAAI,EACJxG,GAAIJ,IAAUqG,EACdrN,OAAO,EACPyN,gBAAiBC,QAAwBG,EACzC5D,KAAMuD,QAAgBK,EACtBC,KAAM,YACNvB,QAASkG,IAEJ,CAAE7E,IAAI,EAAOpO,WAAUkK,QAAOoE,KAAM,YAAavB,QAASkG,IAjYpD9E,EACf,CAAE,QACA7B,KACA,MAAMzC,EAAO0C,GAAMyK,QACfnN,GAAMA,GACZ,CACF,CAiRYoN,GA6GV5K,GAAShJ,IAAI0G,EAAU5E,GAEvB,IACE,aAAaA,CACf,CAAE,QACAkH,GAAS7I,OAAOuG,EAClB,CACF,CAoXA,SAASgN,GAAe7C,GACtB,IAAKA,GAA0B,iBAAVA,EACnB,MAAO,CAAEhD,YAAa,EAAGC,aAAc,EAAGC,gBAAiB,EAAGC,YAAa,EAAGsD,kBAAmB,GAEnG,MAAMzD,EAAcmD,GAAMH,EAAMhD,aAC1BC,EAAekD,GAAMH,EAAM/C,cAC3BC,EAAkBiD,GAAMH,EAAM9C,iBAC9BuD,EAAoBN,GAAMH,EAAMS,mBAChCuC,EAAgB7C,GAAMH,EAAM7C,aAC5B8F,EAAgBjG,EAAcC,EAAeC,EAEnD,MAAO,CACLF,cACAC,eACAC,kBACAC,YALkBpM,KAAKC,IAAIgS,EAAeC,GAM1CxC,oBAEJ,CAEA,SAASN,GAAMrQ,GACb,MAAMY,EAAIC,OAAOb,GACjB,OAAKa,OAAOC,SAASF,IAAMA,GAAK,EAAU,EACnCK,KAAKmS,MAAMxS,EACpB,CAOA,SAASoP,GAAc/M,GACrB,MAAML,EAAO,IAAIrB,IACXoB,EAAM,GACZ,IAAK,MAAMvB,KAAK6B,GAAQ,GAAI,CAC1B,MAAM2K,EAAMtO,OAAO8B,GAAGwM,KAAO,IAAIlN,OACjC,IAAKkN,EAAK,SACV,MAAMjO,EAAMiO,EAAIvM,cACZuB,EAAK3D,IAAIU,KACbiD,EAAKE,IAAInD,GACTgD,EAAII,KAAK,CAAEgN,MAAOzQ,OAAO8B,GAAG2O,OAAS,IAAIrP,OAAQkN,QACnD,CACA,OAAOjL,CACT,CAIA5D,eAAe4P,GAAiBf,EAAK1G,EAAS3K,GAC5C,MAAM8W,EAAIzK,GAAmBrM,GAE7B,GAA+B,oBAApB+W,gBAET,aAAaC,MAAM3F,EAAK1G,GAG1B,MAAMsM,EAAO,IAAIF,gBACXG,EAAK1P,WAAW,IAAMyP,EAAKE,QAASL,GAE1C,IACE,aAAaE,MAAM3F,EAAK,IAAK1G,EAASyM,OAAQH,EAAKG,QACrD,CAAE,QACAC,aAAaH,EACf,CACF,CAEA1U,eAAeiQ,GAASN,GACtB,IACE,aAAaA,EAAIK,MACnB,CAAE,MACA,MAAO,CAAC,CACV,CACF,CC33BA,MAEM8E,GAAgB,gBAGtB,SAASC,GAAanU,GACpB,OAAOL,OAAOK,GAAO,IAAIe,MAC3B,CAEA,SAASqT,GAAmB/T,GAC1B,MAAMgC,EAAM1C,OAAOU,GAAS,IAAIU,OAChC,IAAKsB,EAAK,MAAO,GACjB,MAAMwF,EAAK/D,KAAKgB,MAAMzC,GACtB,OAAKnB,OAAOC,SAAS0G,GACd,IAAI/D,KAAK+D,GAAIwM,cADa,EAEnC,CAEA,SAASC,GAAaC,EAAMjQ,GAC1B,IAAKiQ,EAAM,OAAOjQ,EAClB,GAA0B,iBAAfiQ,EAAKhF,OAAsBgF,EAAKhF,MAAMxO,OAAQ,OAAOwT,EAAKhF,MAAMxO,OAC3E,GAA4B,iBAAjBwT,EAAKnL,SAAwBmL,EAAKnL,QAAQrI,OAAQ,OAAOwT,EAAKnL,QAAQrI,OACjF,GAAI+B,MAAMC,QAAQwR,EAAKC,SAAWD,EAAKC,OAAOnT,OAAQ,CACpD,MAAMoT,EAAQF,EAAKC,OAAO,IAAM,CAAC,EAC3BE,EAASD,EAAMC,QAAUD,EAAMrE,OAASqE,EAAMrL,QACpD,GAAIsL,EAAQ,OAAO/U,OAAO+U,GAAQ3T,MACpC,CACA,OAAOuD,CACT,CAEAlF,eAAeuV,GAAYC,EAAUC,GACnC,MAAMC,EAAW,IAAIC,SACrB/Y,OAAOgJ,QAAQ6P,GAAW,CAAC,GAAGG,QAAQ,EAAEhV,EAAKK,MAC9B,MAATA,GAA2B,KAAVA,GACrByU,EAASG,OAAOjV,EAAKK,KAGvB,MAAM6U,QAAiBtB,MAAMgB,EAAU,CAAE3F,OAAQ,OAAQf,KAAM4G,IAC/D,IAAIP,EAAO,KACX,IACEA,QAAaW,EAAS9F,MACxB,CAAE,MACAmF,EAAO,IACT,CACA,MAAO,CAAE9J,GAAIyK,EAASzK,GAAIgF,OAAQyF,EAASzF,OAAQ8E,OACrD,CAEA,SAASY,GAAanV,EAAKuU,EAAMa,EAAY,CAAC,GAC5C,MAAMC,EAAaD,EAAUC,YAAcd,GAAMe,UAAUxB,IAAMS,GAAMgB,aAAe,GAChFC,EAAejB,GAAMe,UAAU5G,MAAQ0G,EAAUI,cAAgBtB,GACjEuB,EAAYrB,GAAmBG,GAAMmB,aAAaC,YAAcP,EAAUK,WAC1E1R,GAAM,IAAID,MAAOuQ,cAEvB,MAAO,CACLrU,MACAqV,aACAG,eACAC,YACAG,OAAO,EACPC,YAAaT,EAAUS,aAAe9R,EACtC+R,cAAe/R,EAEnB,CAEA,SAASgS,GAAiB1T,GACxB,IAAKA,GAAsB,iBAARA,EAAkB,OAAO,KAC5C,MAAMrC,EAAMmU,GAAa9R,EAAIrC,KAC7B,OAAKA,EAEE,CACLA,MACAqV,WAAY1V,OAAO0C,EAAIgT,YAAc,IAAItU,OACzCyU,aAAc7V,OAAO0C,EAAImT,cAAgBtB,IAAenT,OACxD0U,UAAWrB,GAAmB/R,EAAIoT,WAClCG,OAAqB,IAAdvT,EAAIuT,MACXC,YAAalW,OAAO0C,EAAIwT,aAAe,IAAI9U,OAC3C+U,cAAenW,OAAO0C,EAAIyT,eAAiB,IAAI/U,QAThC,IAWnB,CAEO3B,eAAe4W,KAEpB,OAAOD,SF2YF3W,uBACCmB,IACN,MAAM8B,QAAYtC,EAAO/C,EAAaY,SACtC,IAAKyE,EAAK,OAAO,KACjB,IACE,OAAOmB,KAAKsB,MAAMzC,EACpB,CAAE,MACA,OAAO,IACT,CACF,CErZuB4T,GAEvB,CAEO7W,eAAe8W,GAAkBvS,GACtC,MAAMJ,EAAawS,GAAiBpS,GACpC,OAAKJ,SAICG,EAAWH,GACVA,UAJCK,IACC,KAIX,CAMO,SAASuS,GAAexS,GAC7B,IAAKA,IAAYA,EAAQ3D,IAAK,OAAO,EACrC,IAAsB,IAAlB2D,EAAQiS,MAAiB,OAAO,EACpC,GAAIjS,EAAQ8R,UAAW,CACrB,MAAM5N,EAAK/D,KAAKgB,MAAMnB,EAAQ8R,WAC9B,GAAIvU,OAAOC,SAAS0G,IAAOA,GAAM/D,KAAKC,MAAO,OAAO,CACtD,CACA,OAAO,CACT,CC/DA,SAASqS,GAAGtC,GACV,OAAOuC,SAASC,eAAexC,EACjC,CAEA,SAASyC,GAAUC,EAAMC,GAEvB,GADAL,GAAG,cAAcM,YAAcF,GAAQ,GACnCC,EACF,IACEL,GAAG,iBAAiBM,YAAclT,KAAKC,UAAUgT,EAAY,KAAM,EACrE,CAAE,MACAL,GAAG,iBAAiBM,YAAc/W,OAAO8W,EAC3C,MAEAL,GAAG,iBAAiBM,YAAc,EAEtC,CAEA,SAASC,GAAatW,GACpB,MAAMY,EAAIC,OAAOb,GACjB,OAAKa,OAAOC,SAASF,GACdK,KAAKsV,MAAM3V,GAAG4V,eAAe,SADJ,GAElC,CAEA,MAAMC,GAAkB,IAUxB,SAASC,GAAW1W,GAClB,MAAMY,EAAIC,OAAOb,GACjB,OAAKa,OAAOC,SAASF,GACd,GAAG6V,KAAkB7V,EAAE+V,QAAQ,KADN,GAAGF,UAErC,CAEA,SAASG,GAAehT,GACtB,MAAMhD,EAAIC,OAAO+C,GACjB,OAAK/C,OAAOC,SAASF,GACd,IAAIA,EAAI,KAAM+V,QAAQ,MADG,OAElC,CAEA,SAASE,GAAWrP,GAClB,IAEE,OADU,IAAI/D,KAAK+D,GACVsP,mBAAmB,QAAS,CAAEC,KAAM,UAAWC,OAAQ,WAClE,CAAE,MACA,MAAO,OACT,CACF,CAmBA,SAASC,GAAcC,GACrB,OAAO5X,OAAO4X,GAASC,SAASD,SAAW,IAAIxW,MACjD,CASA,SAAS0W,GAAgBF,GACvB,MAA2C,SAApCA,GAASC,SAASE,aAC3B,CAoBA,SAASC,GAAkBC,GAEzB,GADKC,KAAaA,GAAcxB,SAASyB,cAAc,gBAClDD,GAAa,OAClB,MAAME,EAAe1B,SAASyB,cAAcE,IAC5C,IAAK,MAAMhY,KAAO4X,EAAO,CACvB,MAAML,EAAUU,GAAgB1Y,IAAIS,GAC/BuX,IACDQ,EAAcF,GAAYK,aAAaX,EAASQ,GAC/CF,GAAYM,YAAYZ,GAC/B,CACF,CAEA,SAASa,GAAuBC,GAC9BJ,GAAgBjD,QAAQ,CAACuC,EAASvX,KAChC,MAAMsY,EAASb,GAAgBF,GACzBgB,EAAaF,EAAO/Y,IAAIU,KAASsY,EACvCf,EAAQiB,UAAUC,OAAOC,GAAsBH,IAEnD,CAEA,SAASI,KACP,IAAIC,GAAU,EACd,IAAK,MAAM5Y,KAAO8C,MAAM4J,KAAKmM,IAAiB,CAC5C,MAAMtB,EAAUU,GAAgB1Y,IAAIS,GAC/BuX,IAAWE,GAAgBF,KAC9BsB,GAAehZ,OAAOG,GACtB4Y,GAAU,EAEd,CACIA,GAAcvV,EAAkBP,MAAM4J,KAAKmM,IACjD,CAEA,SAASC,GAAmBC,EAAWxR,EAAU,CAAC,GAChD,MAAM,QAAEyR,GAAU,GAASzR,EAC3B0R,GAAeF,EAAUlT,QACzB8R,GAAkBsB,IAClBC,KACIF,GH6QC5Z,eAA+BwY,GACpC,MAAMrU,EAAaV,EAAqB+U,SAClCxX,EAAOpD,EAAaU,cAAe8F,KAAKC,UAAUF,GAE1D,CGjRoB4V,CAAgBF,GACpC,CAOA,SAASG,GAAqBC,EAAY9R,EAAU,CAAC,GACnD,MAAM,QAAEyR,GAAU,GAASzR,EAC3BsR,GAAiB,IAAIjX,IAAIyX,GACzBV,KACAP,GAAuBS,IACvBK,KACIF,GAAc3V,EAAkBP,MAAM4J,KAAKmM,KAC/CS,IACF,CAEA,SAASC,GAAYvZ,EAAKwZ,GACxB,MAAMC,EAAMR,GAAaS,QAAQ1Z,GACjC,GAAIyZ,EAAM,EAAG,OACb,MAAME,EAAUF,EAAMD,EACtB,GAAIG,EAAU,GAAKA,GAAWV,GAAa5X,OAAQ,OACnD,MAAM6E,EAAO+S,GAAapT,QAC1BK,EAAK0T,OAAOH,EAAK,GACjBvT,EAAK0T,OAAOD,EAAS,EAAG3Z,GACxB8Y,GAAmB5S,EACrB,CA0BA,SAAS2T,GAAevW,GACtBA,EAAKwW,iBAAiB,gBAAgB9E,QAAS+E,IAC7CA,EAAIvB,UAAUwB,OAAO,iBAAkB,gBAAiB,gBAE5D,CAEA,SAASd,KACP,MAAM5V,EAAO8S,GAAG,sBAChB,IAAK9S,EAAM,OACXA,EAAK2W,UAAY,GAEjB,MAAMrC,EAAQqB,GAAa5X,OAAS4X,GAAenW,MAAM4J,KAAKuL,GAAgBlR,QAC9E6Q,EAAM5C,QAAQ,CAAChV,EAAKiG,KAClB,MAAMsR,EAAUU,GAAgB1Y,IAAIS,GACpC,IAAKuX,EAAS,OAEd,MAAM2C,EAvIV,SAAyB3C,GACvB,MAAM2C,EAAQ3C,GAASC,SAAS2C,aAChC,GAAID,EAAO,OAAOA,EAClB,MAAM9J,EAAQmH,GAASO,gBAAgB,gBACvC,OAAO1H,EAAQA,EAAMsG,YAAY3V,OAASuW,GAAcC,EAC1D,CAkIkB6C,CAAgB7C,GACxBe,EAASb,GAAgBF,GACzB8C,GAAWxB,GAAevZ,IAAIU,IAAQsY,EAEtCyB,EAAM1D,SAASiE,cAAc,OACnCP,EAAIQ,UAAY,cAChBR,EAAIvC,QAAQgD,WAAaxa,EACzB+Z,EAAIU,aAAa,OAAQ,YAEzB,MAAMC,EAASrE,SAASiE,cAAc,UACtCI,EAAOjM,KAAO,SACdiM,EAAOH,UAAY,sBACnBG,EAAOC,WAAY,EACnBD,EAAOD,aAAa,QAAS,yBAC7BC,EAAOD,aAAa,aAAc,YAAYP,KAE9C,MAAMU,EAAUvE,SAASiE,cAAc,OACvCM,EAAQL,UAAY,qBACpBK,EAAQlE,YAAcwD,EAEtB,MAAMW,EAAWxE,SAASiE,cAAc,OACxCO,EAASN,UAAY,wBAErB,MAAMO,EAAQzE,SAASiE,cAAc,UACrCQ,EAAMrM,KAAO,SACbqM,EAAMP,UAAY,wBAClBO,EAAMC,SAAqB,IAAV9U,EACjB6U,EAAML,aAAa,QAAS,UAC5BK,EAAML,aAAa,aAAc,UAAUP,KAC3CY,EAAME,iBAAiB,QAAS,IAAMzB,GAAYvZ,GAAM,IAExD,MAAMib,EAAU5E,SAASiE,cAAc,UACvCW,EAAQxM,KAAO,SACfwM,EAAQV,UAAY,0BACpBU,EAAQF,SAAW9U,IAAU2R,EAAMvW,OAAS,EAC5C4Z,EAAQR,aAAa,QAAS,aAC9BQ,EAAQR,aAAa,aAAc,aAAaP,KAChDe,EAAQD,iBAAiB,QAAS,IAAMzB,GAAYvZ,EAAK,IAEzD,MAAMkb,EAAa7E,SAASiE,cAAc,SAC1CY,EAAWX,UAAY,oBACvBW,EAAWT,aAAa,QAASnC,EAAS,mBAAqB+B,EAAU,UAAY,YACrF,MAAMc,EAAc9E,SAASiE,cAAc,SAC3Ca,EAAY1M,KAAO,WACnB0M,EAAYC,QAAUf,EACtBc,EAAYJ,SAAWzC,EACvB6C,EAAYV,aAAa,aAAcnC,EAAS,GAAG4B,qBAA2B,YAAYA,KAC1F,MAAMmB,EAAehF,SAASiE,cAAc,QAe5C,GAdAe,EAAad,UAAY,4BACzBW,EAAW/C,YAAYgD,GACvBD,EAAW/C,YAAYkD,GACvBF,EAAYH,iBAAiB,SAAU,KACjC1C,IACA6C,EAAYC,QAASvC,GAAehZ,OAAOG,GAC1C6Y,GAAe1V,IAAInD,GACxBoY,GAAuBS,IAClBxV,EAAkBP,MAAM4J,KAAKmM,KAClCK,QAGF2B,EAAS1C,YAAY2C,GACrBD,EAAS1C,YAAY8C,GACjB3C,EAAQ,CACV,MAAMgD,EAAUjF,SAASiE,cAAc,QACvCgB,EAAQf,UAAY,oBACpBe,EAAQ5E,YAAc,OACtB4E,EAAQb,aAAa,QAAS,oBAC9BI,EAAS1C,YAAYmD,EACvB,CACAT,EAAS1C,YAAY+C,GAErBnB,EAAI5B,YAAYuC,GAChBX,EAAI5B,YAAYyC,GAChBb,EAAI5B,YAAY0C,GAChBvX,EAAK6U,YAAY4B,IAErB,CAuFA,MAGMwB,GAA0B,CAAC,OAAQ,UAAW,MAAO,SAAU,QAC/DC,GAA0B,CAAC,OAAQ,UAAW,MAAO,SAAU,QAC/DC,GAAgB,cAChBC,GAAmB,iBACnB1D,GAA4B,0BAC5BU,GAAuB,oBAE7B,IAAIiD,GAAW,CAAEC,OAAQ,GAAIC,OAAQ,IACjCC,GAAe,KACfC,GAAqB,KACrBC,IAAa,EACbC,IAAgB,EAChBhD,GAAe,GACfiD,GAAsB,GACtBrD,GAAiB,IAAIjX,IACrBqW,GAAkB,IAAI9Y,IACtBgd,GAAqB,GACrBtE,GAAc,KAClB,MAAMuE,GAAkB,IAAIxa,IAEtBya,GAAiB,CACrBT,OAAQxf,EAASE,YACjBuf,OAAQzf,EAASG,aAGb+f,GAAgB,CACpBV,OAAQ,CACN,CACE9H,GAAI,uBACJoG,MAAO,uBACPqC,OAAQ,CAAEpQ,MAAO,EAAGwD,OAAQ,GAAI6M,YAAa,IAC7CC,UAAW,EACXC,eAAgB,EAChBC,SAAS,GAEX,CACE7I,GAAI,yBACJoG,MAAO,yBACPqC,OAAQ,CAAEpQ,MAAO,GAAKwD,OAAQ,EAAG6M,YAAa,KAC9CC,UAAW,EACXC,eAAgB,EAChBE,aAAa,GAEf,CACE9I,GAAI,wBACJoG,MAAO,wBACPqC,OAAQ,CAAEpQ,MAAO,GAAKwD,OAAQ,GAAK6M,YAAa,KAChDC,UAAW,EACXC,eAAgB,IAGpBb,OAAQ,CACN,CACE/H,GAAI,UACJoG,MAAO,UACPqC,OAAQ,CAAEpQ,MAAO,KAAMwD,OAAQ,GAAI6M,YAAa,MAChDC,UAAW,EACXC,eAAgB,EAChBG,uBAAuB,EACvBF,SAAS,GAEX,CACE7I,GAAI,aACJoG,MAAO,aACPqC,OAAQ,CAAEpQ,MAAO,IAAMwD,OAAQ,EAAG6M,YAAa,MAC/CC,UAAW,EACXC,eAAgB,EAChBE,aAAa,EACbC,uBAAuB,GAEzB,CACE/I,GAAI,aACJoG,MAAO,aACPqC,OAAQ,CAAEpQ,MAAO,IAAMwD,OAAQ,GAAK6M,YAAa,MACjDC,UAAW,EACXC,eAAgB,EAChBG,uBAAuB,KAKvBC,GAAe,CACnBlB,OAAQ,IAAIzc,IAAImd,GAAcV,OAAOhb,IAAKmc,GAAM,CAACA,EAAEjJ,GAAGpS,cAAeqb,KACrElB,OAAQ,IAAI1c,IAAImd,GAAcT,OAAOjb,IAAKmc,GAAM,CAACA,EAAEjJ,GAAGpS,cAAeqb,MAGjEC,GAAkB,CACtBpB,OAAQ,SACRC,OAAQ,UAGV,SAASoB,GAAWC,EAAMhS,GACxB,MAAMiS,EAAQ7b,KAAKC,IAAI,EAAGL,OAAOgK,IAAU,GAC3C,OAAO,IAAIpI,MAAMqa,EAAQ,GAAGtQ,KAAKqQ,EACnC,CAEA,SAASE,GAAa/gB,EAAUkK,GAC9B,MAAM/E,EAAI7B,OAAOtD,GAAY,IAAIqF,cAC3B1B,EAAML,OAAO4G,GAAS,IAAIxF,OAAOW,cACjCd,EAAMkc,GAAatb,GACzB,GAAIZ,GAAOZ,GAAOY,EAAItB,IAAIU,GAAM,OAAOY,EAAIrB,IAAIS,GAC/C,MAAMsE,EAAW+X,GAAe7a,GAChC,OAAIZ,GAAO0D,GAAY1D,EAAItB,IAAIgF,EAAS5C,eAAuBd,EAAIrB,IAAI+E,EAAS5C,eACzE,IACT,CA0CA,SAAS2b,GAA0BlS,EAASmS,GAC1C,MAAMC,EAAWnH,GAAG,yBACpB,IAAKmH,EAAU,MAAO,GACtB,MAAMC,EApCR,SAAyCrS,GACvC,MAAMnL,EAAML,OAAOwL,GAAW,IAAIpK,OAAOW,cACzC,OAAI1B,EAAIgJ,SAAS,aAAehJ,EAAIgJ,SAAS,SACpC,CAAC,OAAQ,UAAW,MAAO,SAAU,QAE1ChJ,EAAIgJ,SAAS,YACR,CAAC,OAAQ,MAAO,QAErBhJ,EAAIgJ,SAAS,cACR,CAAC,OAAQ,UAAW,MAAO,SAAU,QAEvC,CAAC,OAAQ,MAAO,OACzB,CAwBkByU,CAAgCtS,GAChD,IAAI+O,EAAQwD,GAAwBJ,EAAW/B,IAC1CrB,IAAOA,EAAQqB,GAAwB,IACvCiC,EAAQxU,SAASkR,KACN,YAAVA,IAAqBA,EAAQ,OACnB,WAAVA,IAAoBA,EAAQ,SAElCA,EA7BF,SAA8BA,EAAOsD,EAASG,GAC5C,IAAKzD,EAAO,OAAOsD,EAAQ,IAAM,GACjC,GAAIA,EAAQxU,SAASkR,GAAQ,OAAOA,EACpC,MAAMT,EAAMkE,EAAOjE,QAAQQ,GAC3B,GAAIT,EAAM,EAAG,OAAO+D,EAAQ,IAAM,GAClC,IAAII,EAAOJ,EAAQ,IAAM,GACrBK,EAAW3c,OAAO4c,kBACtB,IAAK,MAAMC,KAAUP,EAAS,CAC5B,MAAMQ,EAASL,EAAOjE,QAAQqE,GAC9B,GAAIC,EAAS,EAAG,SAChB,MAAMC,EAAO3c,KAAK4c,IAAIF,EAASvE,GAC3BwE,EAAOJ,IACTA,EAAWI,EACXL,EAAOG,EAEX,CACA,OAAOH,CACT,CAYUO,CAAqBjE,EAAOsD,EAASjC,IAC7C,MAAMtV,EAAQsV,GAAwB7B,QAAQQ,GAG9C,OAFAqD,EAASld,MAAQV,OAAOsG,GAAS,EAAIA,EAAQ,GAC7CsX,EAAS9C,aAAa,iBAAkBP,GACjCA,CACT,CAEA,SAASwD,GAAwBrd,EAAOsd,EAASnC,IAC/C,MAAMnZ,EAAM1C,OAAOU,GAAS,IAAIU,OAAOW,cACvC,IAAKW,EAAK,MAAO,GACjB,MAAMoX,EAAMvY,OAAOmB,GACnB,OAAInB,OAAOC,SAASsY,GAEXkE,EADSrc,KAAK+C,IAAIsZ,EAAOtc,OAAS,EAAGC,KAAKC,IAAI,EAAGD,KAAKsV,MAAM6C,OACzC,GAErBpX,CACT,CAEA,SAAS+b,GAA0BjT,EAASmS,GAC1C,MAAMC,EAAWnH,GAAG,yBACpB,IAAKmH,EAAU,MAAO,GACtB,MAAMc,EAvER,SAA+B9X,GAC7B,MAAMvG,EAAML,OAAO4G,GAAS,IAAIxF,OAAOW,cACjC4E,EAAOwW,GAAajB,QAAQtc,IAAIS,GACtC,OAAIsG,GAA8C,kBAA/BA,EAAKuW,uBAA4CvW,EAAKuW,qBAE3E,CAkEoByB,CAAsBnT,GAClCoT,EAAOhB,EAASiB,QAAQ,cAC1BD,GAAMA,EAAK/F,UAAUC,OAAO,sBAAuB4F,GACvDd,EAAS/F,QAAQ6G,UAAYA,EAAY,IAAM,IAE/C,MAAMb,EAAUa,EAAY7C,GAA0BA,GAAwB3V,MAAM,GACpF,IAAIK,EAAOwX,GAAwBJ,GAC9BE,EAAQxU,SAAS9C,KACpBA,EAAOsX,EAAQ,IAAM,WAEvB,MAAMvX,EAAQuV,GAAwB9B,QAAQxT,GAG9C,OAFAqX,EAASld,MAAQV,OAAOsG,GAAS,EAAIA,EAAQ,GAC7CsX,EAAS9C,aAAa,iBAAkBvU,GACjCA,CACT,CAEA,SAASuY,GAAWpe,GAClB,MAAMY,EAAIC,OAAOb,GACjB,IAAKa,OAAOC,SAASF,GAAI,MAAO,GAAG6V,MACnC,MAAM4H,EAAWzd,GAAK,EAAI,EAAI,EAC9B,IAAI0I,EAAO1I,EAAE+V,QAAQ0H,GAErB,OADA/U,EAAOA,EAAKgV,QAAQ,SAAU,IACvB,GAAG7H,KAAkBnN,GAC9B,CAEA,SAASiV,GAAgBtY,GACvB,MAAO,CACLuY,KAAM5B,GA5iBQ,IA4iBc3W,EAAKmW,WACjCpO,UAAW4O,GA5iBK,KA4iBmB3W,EAAKoW,gBAE5C,CAEA,SAASoC,GAAiBxY,GACxB,MAAMyY,EAAaH,GAAgBtY,GAC7B0Y,EAAW1Y,EAAKsW,YAAc,KAAsB,GAE1D,MAAO,GADStW,EAAKqW,QAAU,KAAO,KAClBqC,IAAW1Y,EAAKwN,QAAQiL,EAAWF,UAAUE,EAAW1Q,WAC9E,CAEA,SAAS4Q,GAAwB5iB,EAAU8O,GACzC,MAAM+T,EAAW7iB,IAAaN,EAAUG,OAClCijB,EAAsB/I,GAAX8I,EAAc,cAAoB,eAC7CE,EAAuBhJ,GAAX8I,EAAc,qBAA2B,sBAC3D,IAAKC,IAAaC,EAAW,OAC7B,MAAM9Y,EAAO8W,GAAa/gB,EAAU8O,GAAWgU,EAAS9e,OAClDgf,IAAS/Y,GAAMqW,QACrByC,EAAU5G,UAAUC,OAAO,aAAc4G,GACzCF,EAAS3G,UAAUC,OAAO,iBAAkB4G,EAC9C,CAEA,SAASC,GAAala,GACpB,IAAKA,EAAO,OAAO,EACnB,MACMkB,EAAO8W,GADIzd,OAAOyF,EAAM/I,UAAY,IAAIqF,cACV0D,EAAMmB,OAC1C,IAAKD,EAAM,OAAO,EAElB,MAAMiH,EAAcjM,KAAKC,IAAI,EAAGL,OAAOkE,EAAMmI,aAAe,IACtDC,EAAelM,KAAKC,IAAI,EAAGL,OAAOkE,EAAMoI,cAAgB,IACxDC,EAAkBnM,KAAKC,IAAI,EAAGL,OAAOkE,EAAMqI,iBAAmB,IAC9DuD,EAAoB1P,KAAKC,IAAI,EAAGL,OAAOkE,EAAM4L,mBAAqB,IAClEuO,EAAuB/R,EAAeC,EAEtCJ,EAAS/L,KAAK+C,IAAI2M,EAAmBzD,GACrCiS,EAAWle,KAAKC,IAAI,EAAGgM,EAAcF,GAErCkP,EAASjW,EAAKiW,QAAU,CAAC,EAK/B,OAAQiD,EAAW,IAJDte,OAAOqb,EAAOpQ,OAAS,GAIFkB,EAAS,IAH7BnM,OAAOqb,EAAOC,aAAeD,EAAOpQ,OAAS,GAGKoT,EAAuB,IAFzEre,OAAOqb,EAAO5M,QAAU,EAG7C,CAEA,SAAS8P,GAAoBra,GAC3B,MAAO,CACL/I,SAAU+I,GAAO/I,UAAY,GAC7BkR,YAAarM,OAAOkE,GAAOmI,aAAe,GAC1CC,aAActM,OAAOkE,GAAOoI,cAAgB,GAC5CC,gBAAiBvM,OAAOkE,GAAOqI,iBAAmB,GAClDuD,kBAAmB9P,OAAOkE,GAAO4L,mBAAqB,GACtDtD,YAAaxM,OAAOkE,GAAOsI,aAAe,GAC1CjD,KAAMrF,GAAOqF,GACb5N,QAASuI,GAAOvI,MAChBoH,GAAI/C,OAAOkE,GAAOnB,IAAM,GACxBuG,GAAIpF,GAAOoF,IAAM,KACjBjE,MAAOnB,GAAOmB,OAAS,GACvBsB,GAAI3G,OAAOkE,GAAOyC,IAAM,GACxBuB,QAAShE,GAAOgE,SAAW,GAC3BkB,gBAAiBlF,GAAOkF,iBAAmB,GAC3CxD,KAAM1B,GAAO0B,MAAQ,GACrB+C,QAASzE,GAAOyE,SAAW,GAE/B,CAEA,SAAS6V,GAAoBrjB,EAAU8iB,EAAUQ,GAC/C,IAAKR,EAAU,OACf,MAAM7b,EAAOgZ,GAAcjgB,IAAa,GAClCujB,EAAYjgB,OAAOggB,GAAgB,IAAI5e,OACvC8e,EAAeD,EAAUle,cACzB4C,EAAW+X,GAAehgB,IAAa,GAE7C8iB,EAASlF,UAAY,GACrB,IAAI6F,GAAU,EAEd,IAAK,MAAMxZ,KAAQhD,EAAM,CACvB,MAAMya,EAAS1H,SAASiE,cAAc,UACtCyD,EAAO1d,MAAQiG,EAAKwN,GACpBiK,EAAOrH,YAAcoI,GAAiBxY,GAClCA,EAAKqW,UACPoB,EAAOvG,QAAQmF,QAAU,IACzBoB,EAAOgC,MAAMC,MAAQ,UACrBjC,EAAOgC,MAAME,WAAa,OAExB3Z,EAAKwN,GAAGpS,gBAAkBme,IAC5B9B,EAAOmC,UAAW,EAClBJ,GAAU,GAEZX,EAAShH,YAAY4F,EACvB,CAEA,GAAI6B,IAAcE,EAAS,CACzB,MAAM/B,EAAS1H,SAASiE,cAAc,UAKtC,OAJAyD,EAAO1d,MAAQuf,EACf7B,EAAOrH,YAAc,GAAGkJ,iBACxB7B,EAAOmC,UAAW,OAClBf,EAAShH,YAAY4F,EAEvB,EAEK6B,GAAatb,IAChB6a,EAAS9e,MAAQiE,EAErB,CAgDA,SAAS6b,GAAarM,EAAIsM,GACxB,MAAMC,EAAQjK,GAAGtC,GACZuM,IACLA,EAAM7H,UAAUC,OAAO,UAAW2H,GAClCC,EAAM5F,aAAa,cAAe2F,EAAS,QAAU,QACvD,CAEA,SAASE,GAAYxM,GACnB,MAAMuM,EAAQjK,GAAGtC,GACjB,QAASuM,GAASA,EAAM7H,UAAU+H,SAAS,UAC7C,CAEA,SAASC,GAAqBJ,GAC5BD,GAAa,gBAAiBC,EAChC,CAEA,SAASK,GAAoBL,GAC3BD,GAAa,eAAgBC,EAC/B,CAEA,SAASM,GAAuBN,GAC9BD,GAAa,kBAAmBC,EAClC,CAEA,SAASO,GAA2BP,GAClCD,GAAa,sBAAuBC,EACtC,CAOA,SAASQ,KACPH,IAAoB,EACtB,CAEA,SAASI,GAAa/M,EAAIgN,GACxB,MAAMC,EAAO3K,GAAGtC,GAChB,IAAKiN,EAAM,OACX,MAAMtW,IAAOqW,EACbC,EAAKrK,YAAcjM,EAAK,kBAAoB,gBAC5CsW,EAAKvI,UAAUC,OAAO,iBAAkBhO,GACxCsW,EAAKvI,UAAUC,OAAO,uBAAwBhO,EAChD,CAEA,SAASuW,KACP,MAAMC,EAAc7K,GAAG,aACjB8K,EAAc9K,GAAG,aACnB6K,IACFA,EAAYE,YAAcxF,GAASC,OAAS,gDAAkD,WAE5FsF,IACFA,EAAYC,YAAcxF,GAASE,OAAS,gDAAkD,SAElG,CAkBA,SAASvC,KACP,MAAM/B,EAAUlB,SAASyB,cAAc,+BACvC,IAAKP,EAAS,OACd,IAAK0E,KAAkBD,GAAY,OACnC,MAAMoF,IAPItF,IAAgBA,GAAa9b,KAAOmW,GAAe2F,MAJpDH,GAASC,QAAYD,GAASE,SAYvCtE,EAAQiB,UAAUC,OAAO,aAAc2I,GACnCA,GAAc7J,EAAQiB,UAAU+H,SAAS7H,MAC3CG,GAAehZ,OAAO,cACtBuZ,GAAqBtW,MAAM4J,KAAKmM,KAEpC,CAEA,SAASwI,GAAahlB,EAAUykB,GAC9B,MAAM5B,EAAW7iB,IAAaN,EAAUG,OAClColB,EAAUlL,GAAG8I,EAAW,cAAgB,eACxC3B,EAAWnH,GAAG8I,EAAW,wBAA0B,yBACnDqC,EAASnL,GAAG8I,EAAW,kBAAoB,mBAC3CnE,GAAY+F,EACdQ,IAASA,EAAQvG,SAAWA,GAC5BwC,IAAUA,EAASxC,SAAWA,GAC9BwG,GAAQA,EAAO/I,UAAUC,OAAO,aAAcsC,EACpD,CAEA,SAASyG,KACPH,GAAatlB,EAAUG,SAAUyf,GAASC,QAC1CyF,GAAatlB,EAAUI,SAAUwf,GAASE,OAC5C,CAEA,SAAS4F,GAAqBhM,GAC5B,MAAMpT,EAAM1C,OAAO8V,GAAa,IAAI1U,OACpC,IAAKsB,EAAK,OAAO,EACjB,MAAMwF,EAAK/D,KAAKgB,MAAMzC,GACtB,OAAOnB,OAAOC,SAAS0G,GAAMA,EAAK,CACpC,CAEA,SAAS6Z,GAAoBjM,GAC3B,MAAM5N,EAAK4Z,GAAqBhM,GAChC,OAAK5N,EArxBP,SAAoBA,GAClB,IAEE,OADU,IAAI/D,KAAK+D,GACV8Z,mBAAmB,QAAS,CAAEC,KAAM,UAAWC,MAAO,QAASC,IAAK,WAC/E,CAAE,MACA,MAAO,EACT,CACF,CA+wBSC,CAAWla,GADF,EAElB,CAkBA,SAASma,GAAiBjB,EAAMpX,EAAMc,GAC/BsW,IACLA,EAAKrK,YAAc/M,GAAQ,GAC3BoX,EAAKvI,UAAUC,OAAO,iBAAkBhO,GACxCsW,EAAKvI,UAAUC,OAAO,uBAAwBhO,GAChD,CAOA,SAASwX,GAAuBC,EAAW3a,EAAU,CAAC,GACpD,MAAM,MAAE4a,GAAQ,EAAK,QAAEnJ,GAAU,GAASzR,EACpCnC,EAAQgR,GAAG,gBACjB,IAAKhR,EAAO,OACZA,EAAMoT,UAAUC,OAAO,aAAcyJ,GACjClJ,IAAS+C,GAAqBmG,GAClC,MAAMzJ,EAASrC,GAAG,oBAKlB,GAJIqC,IACFA,EAAOgC,aAAa,gBAAiByH,EAAY,OAAS,SAC1DzJ,EAAO/B,YAAcwL,EAAY,oBAAsB,yBAErDA,GAAaC,EAAO,CACtB,MAAMhW,EAAQiK,GAAG,mBACbjK,GAAOA,EAAMgW,OACnB,CACF,CAwBA/iB,eAAegjB,GAAiB7a,EAAU,CAAC,GACzC,MAAM,OAAE8a,GAAS,GAAU9a,EACrB+a,QAAetM,KACrB8F,GAAewG,EACfrG,IAAgB,EAhDlB,SAAkCtY,GAChC,MAAM4e,EAxBR,SAA8B5e,GAC5B,IAAKA,IAAYA,EAAQ3D,IACvB,MAAO,CAAEyK,IAAI,EAAOd,KAAM,8BAG5B,GAAIwM,GAAexS,GAAU,CAC3B,MAAM6e,EAASd,GAAoB/d,EAAQ8R,WAE3C,MAAO,CAAEhL,IAAI,EAAMd,KAAM,kBADV6Y,EAAS,wBAAwBA,IAAW,IAE7D,CAEA,MAAM/M,EAAYgM,GAAqB9d,EAAQ8R,WAE/C,MAAO,CAAEhL,IAAI,EAAOd,KADJ8L,GAAaA,GAAa3R,KAAKC,MACX,kBAAoB,mBAC1D,CAUkB0e,CAAqB9e,GACrCqe,GAAiB5L,GAAG,oBAAqBmM,EAAQ5Y,KAAM4Y,EAAQ9X,GACjE,CA8CEiY,CAAyBJ,GACzB,MAAMK,KAAiBL,IAAUA,EAAOtiB,KAExCiiB,GAD0C,OAAvBlG,GAA8B4G,EAAc5G,GAC5B,CAAE/C,SAAS,IA9BhD,SAAmCrV,GACjC,MAAMwd,EAAcxd,GAAS3D,IAAM,gDAh2BT,sBAi2BpBmM,EAAQiK,GAAG,mBACbjK,IAAOA,EAAMgV,YAAcA,EACjC,CA2BEyB,CAA0BN,GAzB5B,SAA2B3e,GACzB,MAAM2C,EAAO8P,GAAG,kBAChB,GAAK9P,EAAL,CACA,GAAI3C,GAAWwS,GAAexS,IAAYA,EAAQ8R,UAAW,CAC3D,MAAM+M,EAASd,GAAoB/d,EAAQ8R,WAE3C,YADAnP,EAAKoQ,YAAc8L,EAAS,qBAAqBA,IAAW,iBAE9D,CACA,GAAI7e,IAAYwS,GAAexS,GAAU,CACvC,MAAM6e,EAASd,GAAoB/d,EAAQ8R,WAE3C,YADAnP,EAAKoQ,YAAc8L,EAAS,sBAAsBA,IAAW,mBAE/D,CACAlc,EAAKoQ,YAAc,qDAXF,CAYnB,CAYEmM,CAAkBP,GAClBhJ,MACK+I,GAAUC,GAAUnM,GAAemM,IACtC/L,GAAU,iBAAkB,CAAEd,UAAW6M,EAAO7M,WAAa,OAEjE,CAEA,SAASqN,GAASziB,GAChB,MAAMY,EAAIC,OAAOb,GACjB,OAAKa,OAAOC,SAASF,GACdK,KAAK+C,IAhjBQ,GAgjBW/C,KAAKC,IAjjBhB,EAijBmCD,KAAKsV,MAAM3V,KAjjB9C,CAkjBtB,CAEA,SAAS8hB,GAAYC,GACnB,OAAO,GAAKF,GAASE,EACvB,CAQA,SAASC,GAAmB5mB,GAC1B,MAAM6iB,EAAW7iB,IAAaN,EAAUG,OACxCka,GAAG,kBAAkBoC,UAAUC,OAAO,yBAA0ByG,GAChE9I,GAAG,kBAAkBoC,UAAUC,OAAO,0BAA2ByG,GACjE9I,GAAG,kBAAkBqE,aAAa,eAAgByE,EAAW,OAAS,SACtE9I,GAAG,kBAAkBqE,aAAa,eAAiByE,EAAoB,QAAT,OAChE,CAcA,SAASgE,GAAYC,GACnB,MAAMjE,EAAmB,WAARiE,EACjB/M,GAAG,aAAaoC,UAAUC,OAAO,cAAeyG,GAChD9I,GAAG,aAAaoC,UAAUC,OAAO,eAAgByG,GAEjD9I,GAAG,aAAaqE,aAAa,gBAAiByE,EAAW,OAAS,SAClE9I,GAAG,aAAaqE,aAAa,gBAAkByE,EAAoB,QAAT,QAE1D9I,GAAG,eAAeoC,UAAUC,OAAO,oBAAqByG,GACxD9I,GAAG,eAAeoC,UAAUC,OAAO,qBAAsByG,EAC3D,CAEA9f,eAAegkB,GAAU7b,EAAU,CAAC,GAClC,MAAM,kBAAE8b,GAAoB,EAAK,OAAEhB,GAAS,GAAU9a,EACtD6O,GAAG,kBAAkBM,YH54Bd/X,IAAoBI,KG84B3B,MAAO1C,EAAUinB,EAAQC,EAAUC,EAAUC,EAAQC,EAAQC,EAAoBC,SAA4B1f,QAAQ2f,IAAI,CACvH7hB,IACAU,IACAN,EAASrG,EAAUG,QACnBkG,EAASrG,EAAUI,QACnB+F,EAAUnG,EAAUG,QACpBgG,EAAUnG,EAAUI,QACpBmG,IACAC,MAGF0gB,GAAmB5mB,GAEnB,MAAM2mB,EAvDR,SAAqBc,GACnB,MAAM7iB,EAAIC,OAAO4iB,GACjB,OAAK5iB,OAAOC,SAASF,IAAMA,GAAK,EA1jBZ,EA2jBb6hB,GAASxhB,KAAKyiB,KAAK9iB,GAC5B,CAmDc+iB,CAAYV,GAClBW,EAAmBlB,GAAYC,GACrC5M,GAAG,kBAAkB/V,MAAQV,OAAOqjB,GACpC5M,GAAG,kBAAkBM,YAAcC,GAAasN,GAC5CA,IAAqBX,SACjB1gB,EAAmBqhB,GAI3B,MAAMC,EAAgB9N,GAAG,eACnB+N,EAAgB/N,GAAG,eACzBsJ,GAAoB3jB,EAAUG,OAAQgoB,EAAeX,GACrD7D,GAAoB3jB,EAAUI,OAAQgoB,EAAeX,GACrD,MAAMY,EAAsBF,EAAgBA,EAAc7jB,MAAQkjB,EAC5Dc,EAAsBF,EAAgBA,EAAc9jB,MAAQmjB,EAC5Dc,EAAmBjH,GAA0B+G,EAAqBT,GACpEW,GAAoBA,IAAqBX,SACrClhB,EAAyB6hB,GAEjC,MAAMC,EAAanG,GAA0BiG,EAAqBT,GAC5DY,EAAkBD,GAAcX,EAlOxC,IAAgCa,EAmO1BF,GAAcA,IAAeX,SACzBphB,EAAyB+hB,GAGjCtF,GAAwBljB,EAAUG,OAAQkoB,GAC1CnF,GAAwBljB,EAAUI,OAAQkoB,GAGrChB,IACHjN,GAAG,aAAa/V,MAAQ,GACxB+V,GAAG,aAAa/V,MAAQ,IA7OIokB,EAgPVf,EA/OpB/H,GAAW,CACTC,QA8OU6H,GA9OY,IAAI1iB,OAC1B8a,QAAS4I,GAAa,IAAI1jB,QAE5BigB,KA4OAhF,IAAa,EAEb6E,GAAa,kBAAmB4C,GAChC5C,GAAa,kBAAmB6C,GAChClC,KACAlI,KAEK+I,GACH9L,GAAU,wBAAyB,CACjCmO,gBAAiBroB,EACjBK,gBAAiBunB,EACjBrI,OAAQ,CAAE5b,IAAKyjB,EAAS,MAAQ,UAAWld,MAAOgd,EAAUjZ,gBAAiBga,GAC7EzI,OAAQ,CAAE7b,IAAK0jB,EAAS,MAAQ,UAAWnd,MAAOid,EAAUlZ,gBAAiBka,IAGnF,CAEA,SAASG,GAAkBzK,EAAO4J,EAAQjF,EAAM+F,GAC9C,MAAM7K,EAAM1D,SAASiE,cAAc,OACnCP,EAAIQ,UAAY,mBAAkBqK,EAAQ,sBAAwB,yBAElE,MAAMlW,EAAO2H,SAASiE,cAAc,OAEpC,GADA5L,EAAK6L,UAAY,kBACbqK,EAAO,CACT,MAAMre,EAAQ8P,SAASiE,cAAc,QACrC/T,EAAMgU,UAAY,mBAClBhU,EAAMmQ,YAAcwD,EACpBxL,EAAKyJ,YAAY5R,EACnB,MACEmI,EAAKgI,YAAcwD,EAGrB,MAAM2K,EAAWxO,SAASiE,cAAc,OACxCuK,EAAStK,UAAY,oBACrBsK,EAASnO,YAAc,GAAGC,GAAamN,YAEvC,MAAMgB,EAASzO,SAASiE,cAAc,OAOtC,OANAwK,EAAOvK,UAAY,kBACnBuK,EAAOpO,YAAcK,GAAW8H,GAEhC9E,EAAI5B,YAAYzJ,GAChBqL,EAAI5B,YAAY0M,GAChB9K,EAAI5B,YAAY2M,GACT/K,CACT,CAsBA3a,eAAe2lB,KACb,MACMC,SH5MD5lB,eAA6BmI,EAAU,CAAC,GAC7C,MAAMG,IAAUH,GAAS0d,MACnBlhB,EAAMF,IAMZ,OALI6D,IAAUP,GAAqBpD,EAAMqD,EAA0B,WAC3DK,GAAe,SAEfA,GAAe,GAEhBR,EAAYpB,OACrB,CGkMwBqf,CAAc,CAAED,OAAO,KACxBrkB,IAAI6e,IAAqBja,KAAK,CAACC,EAAGC,IAAMA,EAAEmC,GAAKpC,EAAEoC,IAEhEsd,EAAY,CAChBvJ,OAAQ,CAAEkI,OAAQ,EAAGjF,KAAM,EAAGuG,OAAQ,IAAIjmB,KAC1C0c,OAAQ,CAAEiI,OAAQ,EAAGjF,KAAM,EAAGuG,OAAQ,IAAIjmB,MAGtCkmB,EAAQ,CACZ9X,YAAa,EACbE,gBAAiB,EACjBD,aAAc,EACdwD,kBAAmB,EACnB6N,KAAM,EACNyG,SAAUN,EAAK3jB,OACfkkB,WAAY,CACV3J,OAAQ,CAAEkI,OAAQ,EAAGjF,KAAM,GAC3BhD,OAAQ,CAAEiI,OAAQ,EAAGjF,KAAM,KAI/B,IAAK,MAAMzZ,KAAS4f,EAAM,CACxB,MAAM7Y,EAAQ7K,KAAKC,IAAI,EAAG6D,EAAMmI,aAC1Bc,EAAY/M,KAAKC,IAAI,EAAG6D,EAAMqI,iBAC9BkC,EAASrO,KAAKC,IAAI,EAAG6D,EAAMoI,cAC3BsW,EAAS3X,EAAQkC,EAAYsB,EAC7BkP,EAAOS,GAAala,GAE1BigB,EAAM9X,aAAepB,EACrBkZ,EAAM5X,iBAAmBY,EACzBgX,EAAM7X,cAAgBmC,EACtB0V,EAAMrU,mBAAqB1P,KAAKC,IAAI,EAAG6D,EAAM4L,mBAAqB,GAClEqU,EAAMxG,MAAQA,EAEd,MACM2G,EAASL,EADExlB,OAAOyF,EAAM/I,UAAY,IAAIqF,eAE9C,GAAK8jB,IAELA,EAAO1B,QAAUA,EACjB0B,EAAO3G,MAAQA,EAEXiF,EAAS,GAAKjF,EAAO,GAAG,CAC1B,MACM3E,EADWva,OAAOyF,EAAMmB,OAAS,IAAIxF,QA7vBrB,iBA+vBhBf,EAAMka,EAAMxY,cACZ+jB,EAAaD,EAAOJ,OAAO7lB,IAAIS,IAAQ,CAAEka,QAAO4J,OAAQ,EAAGjF,KAAM,GACvE4G,EAAW3B,QAAUA,EACrB2B,EAAW5G,MAAQA,EACnB2G,EAAOJ,OAAO1lB,IAAIM,EAAKylB,EACzB,CACF,CAEAJ,EAAME,WAAW3J,OAAOkI,OAASqB,EAAUvJ,OAAOkI,OAClDuB,EAAME,WAAW3J,OAAOiD,KAAOsG,EAAUvJ,OAAOiD,KAChDwG,EAAME,WAAW1J,OAAOiI,OAASqB,EAAUtJ,OAAOiI,OAClDuB,EAAME,WAAW1J,OAAOgD,KAAOsG,EAAUtJ,OAAOgD,KAEhDzI,GAAG,oBAAoBM,YAAcC,GAAa0O,EAAM9X,YAAc8X,EAAM5X,gBAAkB4X,EAAM7X,cACpG4I,GAAG,sBAAsBM,YAAcC,GAAa0O,EAAM9X,aAC1D6I,GAAG,6BAA6BM,YAAcC,GAAa0O,EAAM5X,iBACjE2I,GAAG,uBAAuBM,YAAcC,GAAa0O,EAAM7X,cAC3D4I,GAAG,kBAAkBM,YAAcK,GAAWsO,EAAMxG,MACpDzI,GAAG,mBAAmBM,YAAcK,GAAWsO,EAAME,WAAW3J,OAAOiD,MACvEzI,GAAG,mBAAmBM,YAAcK,GAAWsO,EAAME,WAAW1J,OAAOgD,MApFzE,SAA8BsG,GAC5B,MAAMO,EAAYtP,GAAG,kBACrB,IAAKsP,EAAW,OAChBA,EAAUzL,UAAY,GAEtB,MAAM0L,EAAY,CAAC5pB,EAAUG,OAAQH,EAAUI,QAC/C,IAAK,MAAME,KAAYspB,EAAW,CAChC,MAAMpR,EAAO4Q,EAAU9oB,IAAa,CAAEynB,OAAQ,EAAGjF,KAAM,EAAGuG,OAAQ,IAAIjmB,KACtEumB,EAAUvN,YAAYwM,GAAkB3H,GAAgB3gB,IAAaA,EAAUkY,EAAKuP,OAAQvP,EAAKsK,MAAM,IAEvG,MAAMuG,EAAStiB,MAAM4J,KAAK6H,EAAK6Q,OAAOQ,UACnC5kB,OAAQuF,IAAWA,EAAMud,QAAU,GAAK,IAAMvd,EAAMsY,MAAQ,GAAK,GACjErZ,KAAK,CAACC,EAAGC,IAAMA,EAAEoe,OAASre,EAAEqe,QAAUre,EAAEyU,MAAM2L,cAAcngB,EAAEwU,QAEjE,IAAK,MAAM3T,KAAS6e,EAClBM,EAAUvN,YAAYwM,GAAkBpe,EAAM2T,MAAO3T,EAAMud,OAAQvd,EAAMsY,MAAM,GAEnF,CACF,CAoEEiH,CAAqBX,GAkBvB,SAAuBH,GACrB,MAAM1hB,EAAO8S,GAAG,WAGhB,GAFA9S,EAAK2W,UAAY,IAEZ+K,EAAK3jB,OAAQ,CAChB,MAAM0kB,EAAQ1P,SAASiE,cAAc,OAIrC,OAHAyL,EAAMxL,UAAY,WAClBwL,EAAMrP,YAAc,kDACpBpT,EAAK6U,YAAY4N,EAEnB,CAEA,MAAMC,EAAiBA,CAACC,EAAU5lB,KAChC,MAAMke,EAAOlI,SAASiE,cAAc,QACpCiE,EAAKhE,UAAY,aAEjB,MAAM2C,EAAO7G,SAASiE,cAAc,QACpC4C,EAAK3C,UAAY,mBACjB2C,EAAKxG,YAAcuP,EAEnB,MAAMC,EAAM7P,SAASiE,cAAc,QAMnC,OALA4L,EAAI3L,UAAY,oBAChB2L,EAAIxP,YAAcC,GAAatW,GAE/Bke,EAAKpG,YAAY+E,GACjBqB,EAAKpG,YAAY+N,GACV3H,GAGH1Y,EAAQmf,EAAKnf,MAAM,EAAG,IACtBsgB,EAAa,IAAIvkB,IACvB,IAAK,MAAMwD,KAASS,EAAO,CACzB,MAAM3C,EAAOmT,SAASiE,cAAc,OAC9B8L,EAAahhB,EAAMvI,MAAQ,mBAAqB,GACtDqG,EAAKqX,UAAY,YAAYnV,EAAMqF,GAAK,eAAiB,oBAAoB2b,IAE7E,MAAMC,EAAMhQ,SAASiE,cAAc,OACnC+L,EAAI9L,UAAY,gBAEhB,MAAMnK,EAAQiG,SAASiE,cAAc,OACrClK,EAAMmK,UAAY,kBAElB,MAAM+L,EAAYjQ,SAASiE,cAAc,QACzCgM,EAAU/L,UAAY,uBACtB+L,EAAU5P,YAActR,EAAMoF,GAC9B4F,EAAM+H,YAAYmO,GAElB,MAAMC,EAAc5mB,OAAOyF,EAAM0B,MAAQ1B,EAAMyE,SAAW,IAAI9I,OAC9D,IAAI2T,EAAS,KACb,GAAI6R,EAAa,CACf,MAAMC,EAAWC,GAAYrhB,GAC7B+gB,EAAWhjB,IAAIqjB,GACf,MAAM/N,EAASpC,SAASiE,cAAc,UACtC7B,EAAO8B,UAAY,mBACnB9B,EAAOhK,KAAO,SACdgK,EAAOgC,aAAa,gBAAiB,SACrChC,EAAOgC,aAAa,aAAc,wBAElC,MAAMiM,EAAUrQ,SAASiE,cAAc,QACvCoM,EAAQnM,UAAY,oBACpB9B,EAAON,YAAYuO,GAECtK,GAAgB9c,IAAIknB,KAEtCtjB,EAAKsV,UAAUrV,IAAI,sBACnBsV,EAAOgC,aAAa,gBAAiB,QACrChC,EAAOgC,aAAa,aAAc,wBAGpChC,EAAOuC,iBAAiB,QAAS,KAC/B,MAAMoF,EAASld,EAAKsV,UAAUC,OAAO,sBACrCA,EAAOgC,aAAa,gBAAiB2F,EAAS,OAAS,SACvD3H,EAAOgC,aAAa,aAAc2F,EAAS,sBAAwB,wBAC/DA,EAAQhE,GAAgBjZ,IAAIqjB,GAC3BpK,GAAgBvc,OAAO2mB,KAG9BpW,EAAM+H,YAAYM,GAElB/D,EAAS2B,SAASiE,cAAc,OAChC5F,EAAO6F,UAAY,mBACnB7F,EAAOgC,YAAc6P,CACvB,CAEA,MAAMI,EAAOtQ,SAASiE,cAAc,OACpCqM,EAAK5G,MAAM6G,QAAU,OACrBD,EAAK5G,MAAM8G,IAAM,MAEjB,MAAMC,EAAczQ,SAASiE,cAAc,QAC3CwM,EAAYvM,UAAY,MACxBuM,EAAYpQ,YAActR,EAAM/I,SAAW+I,EAAM/I,SAASgP,cAAgB,IAC1Esb,EAAKxO,YAAY2O,GAEjB,MAAMC,EAAY1Q,SAASiE,cAAc,QAKzC,GAJAyM,EAAUxM,UAAY,QAAOnV,EAAMqF,GAAK,GAAK,cAC7Csc,EAAUrQ,YAActR,EAAMqF,GAAK,KAAO,SAC1Ckc,EAAKxO,YAAY4O,GAEb3hB,EAAMvI,MAAO,CACf,MAAMmqB,EAAW3Q,SAASiE,cAAc,QACxC0M,EAASzM,UAAY,iBACrByM,EAAStQ,YAAc,QACvBiQ,EAAKxO,YAAY6O,EACnB,CAEAX,EAAIlO,YAAY/H,GAChBiW,EAAIlO,YAAYwO,GAEhB,MAAMrgB,EAAO+P,SAASiE,cAAc,OACpChU,EAAKiU,UAAY,iBAEjB,MAAM0M,EAAc3lB,KAAKC,IAAI,EAAG6D,EAAMmI,YAAcnI,EAAMqI,gBAAkBrI,EAAMoI,cAC5E0Z,EAAa9hB,EAAMmB,MAAQnB,EAAMmB,MAAQ,GACzC4gB,EAAc/hB,EAAMkF,gBAAkBlF,EAAMkF,gBAAkB,GAC9D8c,EAAgBnQ,GAAe7R,EAAMnB,IACrCojB,EAAmB,CAACH,EAAYC,GAAanmB,OAAOsmB,SAASza,KAAK,OAElE0a,EAAQlR,SAASiE,cAAc,OACrCiN,EAAMhN,UAAY,iBAClB,MAAMiN,EAAW,GAAGtQ,GAAW9R,EAAMyC,SAASuf,IACxCK,EAAaJ,EAAmB,MAAMA,IAAqB,GAOjE,IANKjiB,EAAMqF,IAAMrF,EAAMgE,QACrBme,EAAM7Q,YAAc,GAAG8Q,IAAWC,OAAgBriB,EAAMgE,QAAQvD,MAAM,EAAG,MAEzE0hB,EAAM7Q,YAAc,GAAG8Q,IAAWC,IAGhCriB,EAAMvI,MAAO,CACf,MAAM6qB,EAAYrR,SAASiE,cAAc,OACzCoN,EAAUnN,UAAY,kBACtBmN,EAAUhR,YAAc,cACxBpQ,EAAK6R,YAAYuP,EACnB,KAAO,CACL,MAAMC,EAAatR,SAASiE,cAAc,OAC1CqN,EAAWpN,UAAY,mBAEvB,MAAMqN,EAAavR,SAASiE,cAAc,OAC1CsN,EAAWrN,UAAY,wBAEvB,MAAMsN,EAAUxR,SAASiE,cAAc,QACvCuN,EAAQtN,UAAY,kBAAkBuN,GAAkBb,KAExD,MAAMc,EAAgB1R,SAASiE,cAAc,QAC7CyN,EAAcxN,UAAY,yBAC1BwN,EAAcrR,YAAc,GAAGC,GAAasQ,YAE5C,MAAMe,EAAiB3R,SAASiE,cAAc,QAC9C0N,EAAezN,UAAY,0BAC3ByN,EAAe7P,YAAY9B,SAAS4R,eAAe,MACnDD,EAAe7P,YAAY6N,EAxxCX,KAwxCyC5gB,EAAMmI,cAC/Dya,EAAe7P,YAAY9B,SAAS4R,eAAe,QACnDD,EAAe7P,YAAY6N,EAzxCP,MAyxCyC5gB,EAAMqI,kBACnEua,EAAe7P,YAAY9B,SAAS4R,eAAe,QACnDD,EAAe7P,YAAY6N,EA1xCV,MA0xCyC5gB,EAAMoI,eAChEwa,EAAe7P,YAAY9B,SAAS4R,eAAe,MAEnDL,EAAWzP,YAAY0P,GACvBD,EAAWzP,YAAY4P,GACvBH,EAAWzP,YAAY6P,GACvBL,EAAWxP,YAAYyP,GACvBthB,EAAK6R,YAAYwP,EACnB,CAEArhB,EAAK6R,YAAYoP,GAEjBrkB,EAAKiV,YAAYkO,GACb3R,GAAQxR,EAAKiV,YAAYzD,GAC7BxR,EAAKiV,YAAY7R,GACjBhD,EAAK6U,YAAYjV,EACnB,CAEAkZ,GAAgBpH,QAAShV,IAClBmmB,EAAW7mB,IAAIU,IAAMoc,GAAgBvc,OAAOG,IAErD,CA/LEkoB,CAAclD,GAiMhB,SAAwBA,GACtB,MAAMmD,EAAS/R,GAAG,cAClB,IAAK+R,EAAQ,OACb,MAAMC,EAAMD,EAAOE,WAAW,MAC9B,IAAKD,EAAK,OAEV,MAAME,EAAQH,EAAOI,aAAe,IAC9BC,EAASL,EAAOM,cAAgB,IAChCC,EAAM1pB,OAAO2pB,kBAAoB,EACvCR,EAAOG,MAAQA,EAAQI,EACvBP,EAAOK,OAASA,EAASE,EACzBN,EAAIQ,aAAaF,EAAK,EAAG,EAAGA,EAAK,EAAG,GAEpC,MACMxe,EADMpG,KAAKC,MACG,KACd8kB,EAAU,IAAI/lB,MAAM,IAAIgmB,KAAK,GAEnC,IAAK,MAAM1jB,KAAS4f,EAAM,CACxB,IAAK5f,EAAMyC,IAAMzC,EAAMyC,GAAKqC,EAAO,SACnC,MAAMjE,EAAQ3E,KAAKmS,OAAOrO,EAAMyC,GAAKqC,GAAS,KAC1CjE,GAAS,GAAKA,EAAQ4iB,EAAQxnB,SAChCwnB,EAAQ5iB,IAAU3E,KAAKC,IAAI,EAAG6D,EAAMmI,YAAcnI,EAAMqI,gBAAkBrI,EAAMoI,cAEpF,CAEA,MAAMub,EAAWznB,KAAKC,OAAOsnB,EAAS,GAEhCG,EADSC,iBAAiB5S,SAAS6S,iBAChBC,iBAAiB,cAAcpoB,QAAU,UAGlEqnB,EAAIgB,UAAU,EAAG,EAAGd,EAAOE,GAE3BJ,EAAIiB,YAJc,yBAKlBjB,EAAIkB,UAAY,EAChB,IAAK,IAAItc,EAAI,EAAGA,GAAK,EAAGA,IAAK,CAC3B,MAAMuc,EAAKf,EAAS,EAAKxb,EACzBob,EAAIoB,YACJpB,EAAIqB,OAAO,EAAGF,GACdnB,EAAIsB,OAAOpB,EAAOiB,GAClBnB,EAAIuB,QACN,CAEAvB,EAAIoB,YACJX,EAAQ7T,QAAQ,CAAC3U,EAAO2M,KACtB,MAAMnM,EAAKmM,GAAK6b,EAAQxnB,OAAS,GAAMinB,EACjCiB,EAAIf,EAAUnoB,EAAQ0oB,GAAaP,EAAS,IAAM,EAC9C,IAANxb,EAASob,EAAIqB,OAAO5oB,EAAG0oB,GACtBnB,EAAIsB,OAAO7oB,EAAG0oB,KAGrB,MAAMK,EAAWxB,EAAIyB,qBAAqB,EAAG,EAAG,EAAGrB,GACnDoB,EAASE,aAAa,EAAG,4BACzBF,EAASE,aAAa,EAAG,4BAEzB1B,EAAIkB,UAAY,EAChBlB,EAAIiB,YAAcL,EAClBZ,EAAIuB,SAEJvB,EAAIsB,OAAOpB,EAAOE,GAClBJ,EAAIsB,OAAO,EAAGlB,GACdJ,EAAI2B,YACJ3B,EAAI4B,UAAYJ,EAChBxB,EAAIU,MACN,CA/PEmB,CAAejF,EACjB,CAEA,SAAS8C,GAAkBb,GACzB,MAAMhmB,EAAIC,OAAO+lB,GAAe,GAChC,OAAIhmB,GAAK,IAAa,sBAClBA,GAAK,IAAa,kBAClBA,GAAK,KAAa,mBACf,kBACT,CAEA,SAASwlB,GAAYrhB,GACnB,MAAMmhB,EAAcnhB,EAAM0B,MAAQ1B,EAAMyE,SAAW,GACnD,MAAO,CAACzE,EAAMyC,IAAM,EAAGzC,EAAMoF,IAAM,GAAIpF,EAAM/I,UAAY,GAAI+I,EAAMmB,OAAS,GAAIggB,GAAa1Z,KAAK,IACpG,CAmPAzN,eAAe8qB,KACb,MAAMC,QH5tBD/qB,iBACL,MAEMsH,EAASzB,QAFKL,UACIF,KAExB,GAAIgC,EAAOvB,YAAY9D,OAAQ,CAC7B,IAAK,MAAMrB,KAAO0G,EAAOvB,kBAAmBY,EAAiB/F,SACvD+E,EAAe2B,EAAOpD,KAC9B,CAEA,MAAM6mB,EAAQ,CACZnlB,QAAS,EACTolB,UAAW,EACXzE,UAAW,CACT/J,OAAQ,CAAE5W,QAAS,EAAGolB,UAAW,GACjCvO,OAAQ,CAAE7W,QAAS,EAAGolB,UAAW,IAEnCC,SAAU,KACVC,SAAU,MAGZ,IAAK,MAAMpnB,KAAQwD,EAAOpD,MAAQ,GAAI,CACpC,IAAKJ,GAAMlD,IAAK,SAChBmqB,EAAMnlB,SAAW,EACjBmlB,EAAMC,WAAalpB,OAAOgC,EAAKsD,MAAQ,GACvC,MAAMnK,EAAWsD,OAAOuD,EAAK7G,UAAY,IAAIqF,cACzCrF,IAAaN,EAAUG,QACzBiuB,EAAMxE,UAAU/J,OAAO5W,SAAW,EAClCmlB,EAAMxE,UAAU/J,OAAOwO,WAAalpB,OAAOgC,EAAKsD,MAAQ,IAC/CnK,IAAaN,EAAUI,SAChCguB,EAAMxE,UAAU9J,OAAO7W,SAAW,EAClCmlB,EAAMxE,UAAU9J,OAAOuO,WAAalpB,OAAOgC,EAAKsD,MAAQ,IAG1D,MAAMnB,EAAUnE,OAAOgC,EAAKoC,WAAa,GACrCD,IACF8kB,EAAME,SAA6B,MAAlBF,EAAME,SAAmBhlB,EAAU/D,KAAK+C,IAAI8lB,EAAME,SAAUhlB,GAC7E8kB,EAAMG,SAA6B,MAAlBH,EAAMG,SAAmBjlB,EAAU/D,KAAKC,IAAI4oB,EAAMG,SAAUjlB,GAEjF,CAEA,OAAO8kB,CACT,CGmrBsBI,GACpBnU,GAAG,gBAAgBM,YAAcC,GAAawT,EAAMnlB,SACpDoR,GAAG,aAAaM,YAl1ClB,SAAqBlK,GACnB,MAAMvL,EAAIC,OAAOsL,GACjB,OAAKtL,OAAOC,SAASF,IAAMA,GAAK,EAAU,OACtCA,EAAI,KAAa,GAAGA,MACpBA,EAAI,QAAoB,IAAIA,EAAI,MAAM+V,QAAQ,QAC3C,IAAI/V,EAAI,SAAe+V,QAAQ,OACxC,CA40CgCwT,CAAYL,EAAMC,WAChDhU,GAAG,sBAAsBM,YAAcC,GAAawT,EAAMxE,UAAU/J,OAAO5W,SAC3EoR,GAAG,sBAAsBM,YAAcC,GAAawT,EAAMxE,UAAU9J,OAAO7W,QAC7E,CAEA5F,eAAeqrB,GAAWljB,EAAU,CAAC,GACnC,MAAM,OAAE8a,GAAS,EAAK,QAAEjZ,EAAU,6BAAgC7B,EAC5DlL,EA5de+Z,GAAG,kBAAkBoC,UAAU+H,SAAS,0BACvCxkB,EAAUG,OAASH,EAAUI,OA6d7CmnB,EAASP,GADHD,GAAS1M,GAAG,kBAAkB/V,QAGpCqqB,QH/nCDtrB,eAAkC/C,GACvC,MAAMmF,EAAIhB,EAAkBnE,IAAaD,EAASC,SAElD,aADM+D,EAAOpD,EAAaC,iBAAkBuE,GACrCA,CACT,CG2nC8BmpB,CAAmBtuB,GACzCuuB,QAAoBhoB,EAAmB0gB,GAM7C,OAJKjB,GACH9L,GAAUnN,EAAS,CAAEsb,gBAAiBgG,EAAehuB,gBAAiBkuB,IAGjE,CAAEF,gBAAeE,cAC1B,CAsBA,SAASC,GAAsBtjB,EAAU,CAAC,GACxC,MAAM,SAAEujB,GAAW,GAAUvjB,EACvBgQ,EAAUlB,SAASyB,cAAc,+BACvC,GAAKP,EAAL,CAMA,GALAA,EAAQiB,UAAUwB,OAAO,aACrBzC,EAAQiB,UAAU+H,SAAS7H,MAC7BG,GAAehZ,OAAO,cACtBuZ,GAAqBtW,MAAM4J,KAAKmM,MAE9BtB,EAAQiB,UAAU+H,SAAS,gBAAiB,CAC9ChJ,EAAQiB,UAAUwB,OAAO,gBACzB,MAAMvB,EAASlB,EAAQO,cAAc,0BACjCW,GAAQA,EAAOgC,aAAa,gBAAiB,OACnD,CAIA,GAHsC,mBAA3BlD,EAAQwT,gBACjBxT,EAAQwT,eAAe,CAAEC,SAAU,SAAUC,MAAO,UAElDH,EAAU,CACZ,MAAM3e,EAAQiK,GAAG,cAAgBA,GAAG,aAChCjK,GAAOA,EAAMgW,OACnB,CAjBoB,CAkBtB,CAiCA,SAAS+I,KACP7U,SAASyD,iBAAiB2B,IAAezG,QAASmW,IAChDA,EAAK3S,UAAUwB,OAAO,WACtB,MAAMoR,EAAMD,EAAKrT,cAAc,UAC3BsT,GAAKA,EAAI3Q,aAAa,gBAAiB,UAE/C,CAuBArb,eAAeisB,GAAchvB,EAAUgE,GACrC,MAAMirB,GAAWjrB,GAAS,IAAIU,OAC9B,OAAKuqB,SHhuCAlsB,eAAyB/C,EAAU8N,GACxC,MAAM9K,GAAK8K,GAAU,IAAIpJ,OAEzB,aADMX,EAAO6B,EAAO5F,GAAWgD,GACxBA,CACT,CG6tCQksB,CAAUlvB,EAAUivB,GAC1B3P,GAAStf,GAAYivB,EACrBtP,IAAa,EACbgF,KACAQ,KACAlI,KACOgS,GAPc,EAQvB,CAEAlsB,eAAeosB,GAAgBnvB,EAAUovB,EAASC,GAChD,MAAM1rB,QAAYqrB,GAAchvB,EAAUovB,GAASprB,OAAS,IACvDL,IACDyrB,IAASA,EAAQprB,MAAQ,IACzBqrB,GAAU7K,GAAa6K,EAAU1rB,GACrCuW,GAAU,kBAAmB,CAAEla,aACjC,CAEA+C,eAAeusB,GAAkBtvB,GAC/B,MAAM6iB,EAAW7iB,IAAaN,EAAUG,OAClColB,EAAqBlL,GAAX8I,EAAc,cAAoB,eAClD,IAAKoC,EAAS,OACd,MAAMsK,GAAYtK,EAAQjhB,OAAS,IAAIU,aHltClC3B,eAAwB/C,EAAUkK,GACvC,MAAM/E,EAAIhB,EAAkBnE,GACtBoD,EAAIE,OAAO4G,GAAS,IAAIxF,OACzBtB,QAKCW,EAAO+B,EAASX,GAAI/B,SAHlBW,EAAO+B,EAASX,GAAIA,IAAMzF,EAAUI,OAASC,EAASG,YAAcH,EAASE,YAIvF,CG0sCQuvB,CAASxvB,EAAUuvB,GAEzB,IAAI3gB,EAAS,GACb,GAAIiU,EAAU,CACZ,MAAM3B,EAAWnH,GAAG,yBAEpBnL,EAASoS,GAA0BuO,EADjBrO,EAAWA,EAASld,MAAQ,IAE1C4K,SAAcxI,EAAyBwI,EAC7C,KAAO,CACL,MAAMsS,EAAWnH,GAAG,yBAEpBnL,EAASmT,GAA0BwN,EADjBrO,EAAWA,EAASld,MAAQ,IAE1C4K,SAAczI,EAAyByI,EAC7C,CAEAsL,GAAU,4BAA6B,CACrCla,WACAkK,MAAOqlB,EACPthB,gBAAiBW,QAAUP,IAG7BuU,GAAwB5iB,EAAUuvB,EACpC,CAoBA,SAASE,GAAgBL,EAASM,GAC3BN,GACLA,EAAQjT,UAAUC,OAAO,iBAAkBsT,EAC7C,CAEA3sB,eAAe4sB,GAAsBP,EAASQ,GAC5C,MAAMjsB,GAAOyrB,GAASprB,OAAS,IAAIU,OAGnC,GAFA+qB,GAAgBL,GAAS,IAEpBzrB,EAIH,OAHA8rB,GAAgBL,GAAS,GACzBzJ,GAAiB5L,GAAG,oBAAqB,+BAA+B,QACxEG,GAAU,2BAA4B,CAAE9L,IAAI,IAI9C,MAAMyhB,EAAgBD,GAAUvV,aAAe,GAC3CuV,IACFA,EAASlR,UAAW,EACpBkR,EAASvV,YAAc,iBAGzB,MAAMzW,QDhiDDb,eAA+BY,EAAKuH,EAAU,CAAC,GACpD,MAAM+jB,EAAUnX,GAAanU,GAC7B,IAAKsrB,GAAWA,EAAQjqB,OAhHC,EAiHvB,MAAO,CAAE8qB,SAAS,EAAO5c,MAAO,mBAGlC,MAAM+S,QAAetM,KACrB,IAAKzO,EAAQG,OAAS4a,GAAUA,EAAOtiB,MAAQsrB,GAAWnV,GAAemM,GACvE,MAAO,CAAE6J,SAAS,EAAMxoB,QAAS2e,EAAQjV,QAAQ,GAGnD,IACE,MAAM,GAAE5C,EAAE,OAAEgF,EAAM,KAAE8E,SAAeI,GA7HV,oDA6H4C,CACnEe,YAAa4V,EACbc,cAAelY,KAGjB,IAAKzJ,EACH,MAAO,CAAE0hB,SAAS,EAAO5c,MAAO+E,GAAaC,EAAM,eAAe9E,OAGpE,GAAI8E,GAAM8X,UAAW,CACnB,MAAM1oB,EAAUwR,GAAamW,EAAS/W,EAAM,CAAEsB,YAAayM,GAAQzM,cAEnE,aADMnS,EAAWC,GACV,CAAEwoB,SAAS,EAAMxoB,UAC1B,CAEA,MAAO,CAAEwoB,SAAS,EAAO5c,MAAO+E,GAAaC,EAAM,gBACrD,CAAE,MACA,MAAO,CAAE4X,SAAS,EAAO5c,MAAO,+BAClC,CACF,CCigDuB+c,CAAgBtsB,GAOrC,GALIisB,IACFA,EAASlR,UAAW,EACpBkR,EAASvV,YAAcwV,GAGrBjsB,EAAOksB,QAIT,OAHIV,IAASA,EAAQprB,MAAQ,UACvB+hB,GAAiB,CAAEC,QAAQ,SACjC9L,GAAU,kBAAmB,CAAEd,UAAWxV,EAAO0D,SAAS8R,WAAa,QAIzE,MAAM8W,EAAYtsB,EAAOsP,OAAS,eAClCuc,GAAgBL,GAAS,GACzBzJ,GAAiB5L,GAAG,oBAAqBmW,GAAW,GACpDhW,GAAU,wBAAyB,CAAEhH,MAAOgd,GAC9C,CAiGAntB,eAAeotB,GAAkBC,GAAW,GACtCA,SH71CCrtB,eAAiC6D,GAAO,GAE7C,aADM7C,EAAOpD,EAAaS,gBAAiBwF,EAAO,IAAM,KACjDA,CACT,CG01CsBypB,EAAkB,GACtC/L,IAA2B,GAC3BD,IAAuB,EACzB,CAQAthB,eAAeutB,GAActwB,SHh7CtB+C,eAA2B/C,SAC1BiE,EAAU2B,EAAO5F,GACzB,CG+6CQuwB,CAAYvwB,SACZ+mB,GAAU,CAAEf,QAAQ,IAC1B9L,GAAU,cAAe,CAAEla,YAC7B,CAEA+C,eAAeytB,GAAaxwB,GAC1Bka,GAAU,iBAAkB,CAAEla,aAE9B,MAAMyJ,QFp1CD1G,eAA6B0tB,GAClC,MAAMzwB,EAAWmE,EAAkBssB,UAA4B9qB,IACzDuE,QAAcnE,EAAS/F,GAG7B,aAFqB6F,EAAU7F,SAalB2N,GAAW,CACtB3N,WACAkN,OAAQ,kDACRqB,KAAM,KACNlO,gBAAiB,IACjBG,OAAO,EACPgO,WAAW,EACXT,aAAc,oBAjBP,CACLK,IAAI,EACJpO,WACAkK,QACAoE,KAAM,kBACNvB,QAAS,yCAAyC/M,KAcxD,CE2zCkB0wB,CAAc1wB,GAC1ByJ,EAAE2E,GACJ8L,GAAU,KAAM,CAAEla,SAAUyJ,EAAEzJ,SAAUkK,MAAOT,EAAES,MAAO2O,SAAUpP,EAAE6D,OAEpE4M,GAAU,QAAS,CAAEla,SAAUyJ,EAAEzJ,SAAUkK,MAAOT,EAAES,MAAOgJ,MAAOzJ,EAAEsD,QAASuB,KAAM7E,EAAE6E,MAEzF,CAYAvL,eAAe4tB,KAzVG3W,SAASyD,iBAAiB,0BAClC9E,QAASoW,IACf,MAAM6B,EAAW7B,EAAI8B,aAAa,iBAC5BxH,EAAY0F,EAAI5M,QAAQ,sBAC9B,IAAKyO,IAAavH,EAAW,OAE7B,IADarP,SAASC,eAAe2W,GAC1B,OAEX,MAAME,EAAYzH,EAAUlN,UAAU+H,SAAS,gBAC/C6K,EAAI3Q,aAAa,gBAAiB0S,EAAY,QAAU,QAExD/B,EAAIpQ,iBAAiB,QAAS,KAC5B,MAAMoS,GAAiB1H,EAAUlN,UAAU+H,SAAS,gBACpDmF,EAAUlN,UAAUC,OAAO,eAAgB2U,GAC3ChC,EAAI3Q,aAAa,gBAAiB2S,EAAgB,QAAU,YA4BlE,WACE,IAAIC,GAAS,EACb,MAAMC,EAAiBA,KACjBD,IACJA,GAAS,EACTjpB,WAAWhF,UACTiuB,GAAS,QACHtI,WACAmF,WACA9H,GAAiB,CAAEC,QAAQ,KAChC,OAGL,IACE,GAA6B,oBAAlBzjB,eAAiCA,eAAeC,SAAS0uB,UAAW,CAC7E,MAAMA,EAAY3uB,cAAcC,QAAQ0uB,UACX,mBAAlBA,EAAUpqB,IAAoBoqB,EAAUpqB,IAAI,IAAMmqB,KACnB,mBAA1BC,EAAUC,YAA4BD,EAAUC,YAAY,IAAMF,KACpD,mBAAdC,GAA0BA,EAAU,IAAMD,IAC5D,CACF,CAAE,MACA,CAGF,IACEtuB,OAAOgc,iBAAiB,UAAW,IAAMsS,IAC3C,CAAE,MACA,CAEJ,CAoREG,GAzQApX,SAASyD,iBAAiB2B,IAAezG,QAASmW,IAChD,MAAMC,EAAMD,EAAKrT,cAAc,UAC1BsT,IACLA,EAAI3Q,aAAa,gBAAiB,SAClC2Q,EAAIpQ,iBAAiB,QAAU0S,IAC7BA,EAAMC,kBACN,MAAMC,EAAUzC,EAAK3S,UAAU+H,SAAS,WACxC2K,KACA,MAAM2C,GAAYD,EAClBzC,EAAK3S,UAAUC,OAAO,UAAWoV,GACjCzC,EAAI3Q,aAAa,gBAAiBoT,EAAW,OAAS,cAI1DxX,SAAS2E,iBAAiB,QAAU0S,IAC9BA,EAAMI,OAAOtP,QAAQ/C,KACzByP,aA5qCJ9rB,iBAEE,GADAyY,GAAcxB,SAASyB,cAAc,eAChCD,GAAa,OAClB,MAAMkW,EAAWjrB,MAAM4J,KAAKmL,GAAYiC,iBAAiB4B,KACzDzD,GAAkB,IAAI9Y,IACtB4uB,EAAS/Y,QAASuC,IAChB,MAAMvX,EAAMsX,GAAcC,GACtBvX,GAAKiY,GAAgBvY,IAAIM,EAAKuX,KAGpC,MAAMyW,QHwCD5uB,uBACCmB,IACN,MAAM8B,QAAYtC,EAAO/C,EAAaU,eACtC,IAAK2E,EAAK,MAAO,GACjB,IACE,OAAOQ,EAAqBW,KAAKsB,MAAMzC,GACzC,CAAE,MACA,MAAO,EACT,CACF,CGjD4B4rB,GACpBC,EAAUH,EAASntB,IAAK2W,GAAYD,GAAcC,IAAUvW,OAAOsmB,SACzEpL,GAAsBgS,EAAQroB,QAC9BoT,GApRF,SAA+B+U,EAAaG,GAC1C,MAAMvW,EAAQ,GACR3U,EAAO,IAAIrB,IACjB,GAAIkB,MAAMC,QAAQirB,GAChB,IAAK,MAAMhuB,KAAOguB,EACXhuB,IAAOiD,EAAK3D,IAAIU,IAASiY,GAAgB3Y,IAAIU,KAClDiD,EAAKE,IAAInD,GACT4X,EAAMxU,KAAKpD,IAGf,IAAK,MAAMA,KAAOmuB,EACXnuB,IAAOiD,EAAK3D,IAAIU,KACrBiD,EAAKE,IAAInD,GACT4X,EAAMxU,KAAKpD,IAEb,OAAO4X,CACT,CAoQiBwW,CAAsBJ,EAAaE,GAClDvW,GAAkBsB,IAElBJ,GAAiB,IAAIjX,UHmDhBxC,uBACCmB,IACN,MAAM8B,QAAYtC,EAAO/C,EAAaW,gBACtC,IAAK0E,EAAK,MAAO,GACjB,IACE,OAAOQ,EAAqBW,KAAKsB,MAAMzC,GACzC,CAAE,MACA,MAAO,EACT,CACF,CG5DiCgsB,IAC/B1V,KACAP,GAAuBS,IAEvBK,KAjFF,WACE,MAAM5V,EAAO8S,GAAG,sBACX9S,IAELA,EAAK0X,iBAAiB,YAAc0S,IAClC,MAAMhT,EAASgT,EAAMI,OAAOtP,QAAQ,wBACpC,IAAK9D,EAAQ,OACb,MAAMX,EAAMW,EAAO8D,QAAQ,gBACtBzE,IACLoC,GAAqBpC,EAAIvC,QAAQgD,YAAc,GAC/CT,EAAIvB,UAAUrV,IAAI,eACduqB,EAAMY,eACRZ,EAAMY,aAAaC,cAAgB,OACnCb,EAAMY,aAAaE,QAAQ,aAAcrS,QAI7C7Y,EAAK0X,iBAAiB,WAAa0S,IACjC,IAAKvR,GAAoB,OACzBuR,EAAMe,iBACN,MAAM1U,EAAM2T,EAAMI,OAAOtP,QAAQ,gBACjC,IAAKzE,GAAOA,EAAIvC,QAAQgD,aAAe2B,GAAoB,QAzH/D,SAA6B7Y,GAC3BA,EAAKwW,iBAAiB,gBAAgB9E,QAAS+E,IAC7CA,EAAIvB,UAAUwB,OAAO,iBAAkB,kBAE3C,CAsHI0U,CAAoBprB,GACpB,MAAMqrB,EAAO5U,EAAI6U,wBACXC,EAASnB,EAAMoB,QAAUH,EAAKtI,IAAMsI,EAAKnG,OAAS,EACxDzO,EAAIvB,UAAUC,OAAO,iBAAkBoW,GACvC9U,EAAIvB,UAAUC,OAAO,iBAAkBoW,KAGzCvrB,EAAK0X,iBAAiB,YAAc0S,IAClC,MAAM3T,EAAM2T,EAAMI,OAAOtP,QAAQ,gBAC5BzE,GACLA,EAAIvB,UAAUwB,OAAO,iBAAkB,mBAGzC1W,EAAK0X,iBAAiB,OAAS0S,IAC7B,IAAKvR,GAAoB,OACzBuR,EAAMe,iBACN,MAAM1U,EAAM2T,EAAMI,OAAOtP,QAAQ,gBAC3BuQ,EAAYhV,GAAMA,EAAIvC,QAAQgD,YAAmB,GACjDxa,EAAMmc,GACZA,GAAqB,GACrBtC,GAAevW,GAEf,IAAIyV,EAAYE,GAAapT,QAC7B,GAAKkpB,EAEE,CACL,MAAMJ,EAAO5U,EAAI6U,wBAEjB7V,EAxKN,SAA4BnB,EAAOoX,EAAYD,EAAWF,GACxD,MAAM3oB,EAAO0R,EAAM5W,OAAQhB,GAAQA,IAAQgvB,GACrCC,EAAc/oB,EAAKwT,QAAQqV,GACjC,GAAIE,EAAc,EAEhB,OADA/oB,EAAK9C,KAAK4rB,GACH9oB,EAET,MAAMgpB,EAAcL,EAASI,EAAcA,EAAc,EAEzD,OADA/oB,EAAK0T,OAAOsV,EAAa,EAAGF,GACrB9oB,CACT,CA8JkBipB,CAAmBpW,EAAW/Y,EAAK+uB,EADhCrB,EAAMoB,QAAUH,EAAKtI,IAAMsI,EAAKnG,OAAS,EAE1D,MALEzP,EAxJN,SAA0BnB,EAAO5X,GAC/B,MAAMkG,EAAO0R,EAAM5W,OAAQkC,GAASA,IAASlD,GAE7C,OADAkG,EAAK9C,KAAKpD,GACHkG,CACT,CAoJkBkpB,CAAiBrW,EAAW/Y,GAM1C8Y,GAAmBC,KAGrBzV,EAAK0X,iBAAiB,UAAW,KAC/BmB,GAAqB,GACrBtC,GAAevW,KAEnB,CAuBE+rB,EACF,CAi5CQC,GAEN,MAAMC,EAAiBnZ,GAAG,kBACtBmZ,GACFA,EAAevU,iBAAiB,QAAS,IAAMwF,IAAqB,IAGtEnK,SAASyD,iBAAiB,yBAAyB9E,QAASoW,IAC1DA,EAAIpQ,iBAAiB,QAAS,IAAMwF,IAAqB,MAG3D,MAAMgP,EAAepZ,GAAG,uBACpBoZ,GACFA,EAAaxU,iBAAiB,QAAS,KAhoDpCkB,GAAoB7a,QACzByX,GAAmBoD,MAkoDnB,MAAMuT,EAAcrZ,GAAG,eACnBqZ,GACFA,EAAYzU,iBAAiB,QAAS,KAvmC1C,WACE,MAAM0U,EAAUtZ,GAAG,0BACbuZ,EAAUvZ,GAAG,0BACnB,IAAKsZ,IAAYC,EAAS,OACtBD,IAASA,EAAQzV,UAAY,IAC7B0V,IAASA,EAAQ1V,UAAY,IAEjC,MAAM2V,EAAiBA,CAACvzB,EAAU6R,KAChC,IAAKA,EAAM,OACX,MAAM5K,EAAOgZ,GAAcjgB,IAAa,GACxC,IAAK,MAAMiK,KAAQhD,EAAM,CACvB,MAAMyW,EAAM1D,SAASiE,cAAc,MAC7ByE,EAAaH,GAAgBtY,GAE7BupB,EAAYxZ,SAASiE,cAAc,MACzCuV,EAAUnZ,YAAcpQ,EAAKwN,GAE7B,MAAMgc,EAAYzZ,SAASiE,cAAc,MACzCwV,EAAUvV,UAAY,2BACtBuV,EAAUpZ,YAAc+H,GAAWnY,EAAKiW,QAAQpQ,OAEhD,MAAM4jB,EAAa1Z,SAASiE,cAAc,MAC1CyV,EAAWxV,UAAY,2BACvBwV,EAAWrZ,YAAc+H,GAAWnY,EAAKiW,QAAQ5M,QAEjD,MAAMqgB,EAAW3Z,SAASiE,cAAc,MACxC0V,EAASzV,UAAY,0BACrByV,EAAStZ,YAAcqI,EAAWF,KAElC,MAAMoR,EAAa5Z,SAASiE,cAAc,MAC1C2V,EAAW1V,UAAY,0BACvB0V,EAAWvZ,YAAcqI,EAAW1Q,UAEpC0L,EAAI5B,YAAY0X,GAChB9V,EAAI5B,YAAY2X,GAChB/V,EAAI5B,YAAY4X,GAChBhW,EAAI5B,YAAY6X,GAChBjW,EAAI5B,YAAY8X,GAChB/hB,EAAKiK,YAAY4B,EACnB,GAGF6V,EAAe7zB,EAAUG,OAAQwzB,GACjCE,EAAe7zB,EAAUI,OAAQwzB,EACnC,CA+BEO,QACAzP,IAAoB,KA8hCpBpK,SAASyD,iBAAiB,sBAAsB9E,QAASoW,IACvDA,EAAIpQ,iBAAiB,QAAS,IAAM4F,QAGtCvK,SAASyD,iBAAiB,2BAA2B9E,QAASoW,IAC5DA,EAAIpQ,iBAAiB,QAAS5b,SAAYotB,IAAkB,MAG9DnW,SAASyD,iBAAiB,gCAAgC9E,QAASoW,IACjEA,EAAIpQ,iBAAiB,QAAS,IAAM2F,IAA2B,MAGjE,MAAMwP,EAAkB/Z,GAAG,mBACvB+Z,GACFA,EAAgBnV,iBAAiB,QAAS5b,SAAYotB,IAAkB,IAG1E,MAAM4D,EAAiBha,GAAG,kBACtBga,GACFA,EAAepV,iBAAiB,QAAS5b,SAAYotB,IAAkB,IAGzE,MAAM6D,EAAuBja,GAAG,wBAC5Bia,GACFA,EAAqBrV,iBAAiB,QAAS5b,gBACvCotB,IAAkB,GACxB3B,GAAsB,CAAEC,UAAU,MAItCzU,SAASyD,iBAAiB,0BAA0B9E,QAASoW,IAC3DA,EAAIpQ,iBAAiB,QAAS,KAC5BwF,IAAqB,GACrBqK,GAAsB,CAAEC,UAAU,QAItC,MAAMwF,EAAqBla,GAAG,sBAC1Bka,GACFA,EAAmBtV,iBAAiB,QAAS5b,SA7HjDA,iBACE,MAAM6hB,EAAc7K,GAAG,uBACjB8K,EAAc9K,GAAG,uBAEjBma,QAAkBlF,GAActvB,EAAUG,OAAQ+kB,GAAa5gB,OAAS,IACxEokB,QAAkB4G,GAActvB,EAAUI,OAAQ+kB,GAAa7gB,OAAS,IAE1E4gB,IAAaA,EAAY5gB,MAAQ,IACjC6gB,IAAaA,EAAY7gB,MAAQ,IAErCwgB,GAAa,kBAAmBlF,GAASC,QACzCiF,GAAa,kBAAmBlF,GAASE,SAErC0U,GAAa9L,IACflO,GAAU,oBAAqB,CAAEqF,SAAU2U,EAAW1U,SAAU4I,KAG9D9I,GAASC,QAAUD,GAASE,SAC9B8E,IAA2B,EAE/B,CAyG6D6P,IAG3D,MAAMC,EAAsBra,GAAG,uBAC3Bqa,GACFA,EAAoBzV,iBAAiB,QAAS,IAAM2F,IAA2B,IAGjFtK,SAAS2E,iBAAiB,UAAW5b,UACrB,WAAVwI,EAAE5H,MACNkrB,KACI5K,GAAY,uBACdK,IAA2B,GAGzBL,GAAY,yBACRkM,IAAkB,GAGtBlM,GAAY,iBACdE,IAAqB,GAGnBF,GAAY,iBACdM,QAKJxK,GAAG,aAAa4E,iBAAiB,QAAS,IAAMkI,GAAY,WAC5D9M,GAAG,aAAa4E,iBAAiB,QAAS,IAAMkI,GAAY,WAG5D9M,GAAG,kBAAkB4E,iBAAiB,QAAS5b,UAC7C6jB,GAAmBlnB,EAAUG,cACvBuuB,OAGRrU,GAAG,kBAAkB4E,iBAAiB,QAAS5b,UAC7C6jB,GAAmBlnB,EAAUI,cACvBsuB,OAIRrU,GAAG,kBAAkB4E,iBAAiB,QAAS,MA56BjD,WACE,MACM8I,EAASf,GADHD,GAAS1M,GAAG,kBAAkB/V,QAE1C+V,GAAG,kBAAkBM,YAAcC,GAAamN,EAElD,CAw6BI4M,KAGFta,GAAG,kBAAkB4E,iBAAiB,SAAU5b,gBACxCqrB,OAGR,MAAMkG,EAAiBva,GAAG,yBACtBua,IACFA,EAAe3V,iBAAiB,QAAS,KACvC,MAAMsG,EAAUlL,GAAG,eACnBiH,GAA0BiE,EAAUA,EAAQjhB,MAAQ,GAAIswB,EAAetwB,SAEzEswB,EAAe3V,iBAAiB,SAAU5b,gBA5T9CA,iBACE,MAAMkiB,EAAUlL,GAAG,eACbmH,EAAWnH,GAAG,yBACpB,IAAKmH,EAAU,OACf,MAAMrD,EAAQmD,GAA0BiE,EAAUA,EAAQjhB,MAAQ,GAAIkd,EAASld,OAC3E6Z,SAAazX,EAAyByX,GAC1C3D,GAAU,oCAAqC,CAAE/Z,sBAAuB0d,GAC1E,CAsTY0W,MAIV,MAAMrT,EAAWnH,GAAG,yBAChBmH,IACFA,EAASvC,iBAAiB,QAAS,KACjC,MAAMqD,EAA2C,MAA/Bd,EAAS/F,QAAQ6G,UACnC,IAAInE,EAAQwD,GAAwBH,EAASld,OACxCge,GAAuB,SAAVnE,IAChBqD,EAASld,MAAQ,IACjB6Z,EAAQwD,GAAwBH,EAASld,QAE3Ckd,EAAS9C,aAAa,iBAAkBP,KAE1CqD,EAASvC,iBAAiB,SAAU5b,gBAnUxCA,iBACE,MAAMkiB,EAAUlL,GAAG,eACbmH,EAAWnH,GAAG,yBACpB,IAAKmH,EAAU,OACf,MAAMrD,EAAQkE,GAA0BkD,EAAUA,EAAQjhB,MAAQ,GAAIkd,EAASld,OAC3E6Z,SAAa1X,EAAyB0X,GAC1C3D,GAAU,oCAAqC,CAAE9Z,sBAAuByd,GAC1E,CA6TY2W,MAIV,MAAM3M,EAAgB9N,GAAG,eACrB8N,GACFA,EAAclJ,iBAAiB,SAAU5b,gBACjCusB,GAAkB5vB,EAAUG,UAItC,MAAMioB,EAAgB/N,GAAG,eACrB+N,GACFA,EAAcnJ,iBAAiB,SAAU5b,gBACjCusB,GAAkB5vB,EAAUI,UAItC,MAAM20B,EAAc1a,GAAG,aACnB0a,GACFA,EAAY9V,iBAAiB,SAAU5b,gBAC/BosB,GAAgBzvB,EAAUG,OAAQ40B,EAAa,qBAIzD,MAAMC,EAAc3a,GAAG,aACnB2a,GACFA,EAAY/V,iBAAiB,SAAU5b,gBAC/BosB,GAAgBzvB,EAAUI,OAAQ40B,EAAa,qBAIzD,MAAMC,EAAkB5a,GAAG,mBACrB6a,EAAqB7a,GAAG,sBACxB8a,EAAiB9a,GAAG,kBACpB+a,EAAkB/a,GAAG,mBACrBgb,EAAmBhb,GAAG,oBACxBgb,GACFA,EAAiBpW,iBAAiB,QAAS,KACzC,MAAM5V,EAAQgR,GAAG,gBACXgL,GAAahc,GAAQA,EAAMoT,UAAU+H,SAAS,aACpD0B,GAAuBb,EAAY,CAAEe,MAAOf,MAG5C4P,IACFA,EAAgBhW,iBAAiB,QAAS,IAAM8Q,GAAgBkF,GAAiB,IACjFA,EAAgBhW,iBAAiB,UAAY0S,IACzB,UAAdA,EAAM1tB,MACV0tB,EAAMe,iBACFwC,GACGjF,GAAsBgF,EAAiBC,OAI9CA,GAAsBD,GACxBC,EAAmBjW,iBAAiB,QAAS5b,gBACrC4sB,GAAsBgF,EAAiBC,KAG7CC,GACFA,EAAelW,iBAAiB,QAAS5b,SA7U7CA,iBACE,MAAMqsB,EAAUrV,GAAG,mBACb6V,EAAW7V,GAAG,kBACpB,IAAKqV,IAAYQ,EAAU,OAE3B,MAAMoF,GAAY5F,EAAQprB,OAAS,IAAIU,OACjCuhB,EAASxG,UAAuB9F,KAChCsb,EAAYD,GAAY/O,GAAQtiB,KAAO,GAI7C,GAFA8rB,GAAgBL,GAAS,IAEpB6F,EAGH,OAFAxF,GAAgBL,GAAS,QACzBlV,GAAU,2BAA4B,CAAE9L,IAAI,IAI9C,MAAMyhB,EAAgBD,EAASvV,YAC/BuV,EAASlR,UAAW,EACpBkR,EAASvV,YAAc,UAEvB,MAAMzW,QDxiDDb,eAA+BY,EAAKuH,EAAU,CAAC,GACpD,MAAM+jB,EAAUnX,GAAanU,GAC7B,IAAKsrB,GAAWA,EAAQjqB,OAjJC,EAkJvB,MAAO,CAAE8qB,SAAS,EAAO5c,MAAO,mBAGlC,MAAM+S,QAAetM,KACfX,EAAa9N,EAAQ8N,YAAciN,GAAQjN,YAAc,GAE/D,IACE,MAAM,GAAE5K,EAAE,OAAEgF,EAAM,KAAE8E,SAAeI,GA3JV,oDA2J4C,CACnEe,YAAa4V,EACb/V,YAAaF,QAAc3K,IAG7B,OAAKD,EAID8J,GAAMqB,MAED,CAAEuW,SAAS,EAAMxoB,QADRwR,GAAamW,EAAS/W,EAAM,CAAEc,aAAYQ,YAAayM,GAAQzM,eAI1E,CAAEsW,SAAS,EAAO5c,MAAO+E,GAAaC,EAAM,iBAR1C,CAAE4X,SAAS,EAAO5c,MAAO+E,GAAaC,EAAM,eAAe9E,MAStE,CAAE,MACA,MAAO,CAAE0c,SAAS,EAAO5c,MAAO,+BAClC,CACF,CC4gDuBgiB,CAAgBD,GAKrC,GAHArF,EAASlR,UAAW,EACpBkR,EAASvV,YAAcwV,EAEnBjsB,EAAOksB,QAAS,CAClB,MAAM3J,EAASviB,EAAO0D,SAAS8R,WAAa,MAiB5C,OAhBI6M,GAAUgP,IAAchP,EAAOtiB,WAC3BkW,GAAkB,IACnBoM,KACAriB,EAAO0D,QACViS,OAAO,EACPE,eAAe,IAAIhS,MAAOuQ,sBAEtB+N,GAAiB,CAAEC,QAAQ,KACvBC,GAAWA,EAAOtiB,KAC5BgiB,GAAiB5L,GAAG,oBAAqB,oCAAoC,SAE3Eib,GAAc/O,GAAUgP,IAAchP,EAAOtiB,IAG/CuW,GAAU,iBAAkB,CAAEd,UAAW+M,IAFzCjM,GAAU,0DAA2D,CAAEd,UAAW+M,IAKtF,CAEA,MAAM+J,EAAYtsB,EAAOsP,OAAS,eAClCgH,GAAU,mBAAoB,CAAEhH,MAAOgd,IACnCjK,GAAUgP,IAAchP,EAAOtiB,WAC3BkW,GAAkB,IACnBoM,EACH1M,OAAO,EACPE,eAAe,IAAIhS,MAAOuQ,sBAEtB+N,GAAiB,CAAEC,QAAQ,KACvBC,GAAWA,EAAOtiB,KAC5BgiB,GAAiB5L,GAAG,oBAAqBmW,GAAW,EAExD,CAkRyDiF,IAEnDL,GACFA,EAAgBnW,iBAAiB,QAAS5b,SAnR9CA,uBDpoDOA,uBACCwE,GACR,CCmoDQ6tB,GACN3V,GAAe,KACf,MAAM3P,EAAQiK,GAAG,mBACbjK,IACFA,EAAM9L,MAAQ,GACdyrB,GAAgB3f,GAAO,UAEnBiW,GAAiB,CAAEC,QAAQ,IACjC9L,GAAU,kBAAmB,CAAE9L,IAAI,GACrC,CAyQ0DinB,IAIxDtb,GAAG,eAAe4E,iBAAiB,QAAS5b,SAAYutB,GAAc5wB,EAAUG,SAChFka,GAAG,eAAe4E,iBAAiB,QAAS5b,SAAYutB,GAAc5wB,EAAUI,SAEhFia,GAAG,cAAc4E,iBAAiB,QAAS5b,SAAYytB,GAAa9wB,EAAUG,SAC9Eka,GAAG,cAAc4E,iBAAiB,QAAS5b,SAAYytB,GAAa9wB,EAAUI,SAE9Eia,GAAG,aAAa4E,iBAAiB,QAAS5b,gBH1kCrCA,iBACL,MAAMuF,EAAYd,IAClBoD,EAAc,GACdE,GAAoB,EACpBD,EAAqB,KACrBG,EAAqB1C,EACrByC,EAA0BzC,QACpBvE,EAAOpD,EAAae,qBAAsB4B,OAAOgF,UACjDrE,EAAUtD,EAAac,YAC/B,CGkkCU6zB,SACA5M,KACNxO,GAAU,iBAAkB,CAAE9L,IAAI,MAGpC2L,GAAG,gBAAgB4E,iBAAiB,QAAS5b,gBACrC8qB,KACN3T,GAAU,kBAAmB,CAAE9L,IAAI,MAGrC2L,GAAG,cAAc4E,iBAAiB,QAAS5b,gBF5rCtCA,iBACL+I,GAAMK,cD7HDpJ,iBACL,MAAMuF,EAAYd,IAClBY,EAAgBE,QACVvE,EAAOpD,EAAaiB,eAAgB0B,OAAOgF,IACjD,MAAMsB,QAAcrB,IACpB,IAAK,MAAM1B,KAAQ+C,GAAS,GACrB/C,GAAMlD,WACL+F,EAAiB7C,EAAKlD,WAExBM,EAAUtD,EAAagB,YAC/B,CCoHQ4zB,EACR,CE0rCUC,SACA3H,KACN3T,GAAU,aAAc,CAAE9L,IAAI,MAIhCyY,GAAY,gBAENE,WACAhB,GAAiB,CAAEC,QAAQ,UAC3B0C,WACAmF,WA5QR9qB,uBHx2COA,iBAGL,aAFMmB,IAES,YADGR,EAAO/C,EAAaS,gBAExC,CGq2CqBq0B,IAEnBpR,IAAuB,EACzB,CAyQQqR,GAENC,YAAYjN,GAAc,KAC1BiN,YAAY9H,GAAmB,KACjC,CAEA7T,SAAS2E,iBAAiB,mBAAoB5b,gBA5P9CA,iBACE,IACwB,oBAAX6yB,QAA0BA,QAAQC,eACrCD,OAAOC,SAEjB,CAAE,MACA,CAEJ,CAqPQC,SACAnF,M","sources":["webpack://excel-ai-gemini-addin/./src/shared/core.js","webpack://excel-ai-gemini-addin/./src/shared/providers.js","webpack://excel-ai-gemini-addin/./src/license.js","webpack://excel-ai-gemini-addin/./src/taskpane/taskpane.js"],"sourcesContent":["// src/shared/core.js\n// Shared utilities + persisted configuration for the Neurow add-in.\n//\n// Key design goals:\n// - Two providers (Gemini + OpenAI) can coexist.\n// - The default provider is chosen in the taskpane (not in formulas).\n// - No temperature / sampling controls anywhere (per requirements).\n// - A single \"max output tokens\" setting applies to both providers.\n\nexport const PROVIDERS = Object.freeze({\n  GEMINI: \"gemini\",\n  OPENAI: \"openai\"\n});\n\nexport const DEFAULTS = Object.freeze({\n  provider: PROVIDERS.GEMINI,\n  // Default models (User specified future versions)\n  geminiModel: \"gemini-3-flash-preview\",\n  openaiModel: \"gpt-5-mini\",\n  geminiReasoningEffort: \"minimal\",\n  openaiReasoningEffort: \"low\",\n  maxOutputTokens: 4096,\n\n  // Execution / UX\n  retry: 2,\n  timeoutMs: 120000,\n\n  // In-memory cache (per runtime). Note: Office custom functions can run in a long-lived runtime.\n  cache: true,\n  cacheTtlSec: 7 * 24 * 3600, // 7 days\n  webCacheTtlSec: 3600 // 1 hour (web results change more often)\n});\n\nconst STORAGE_KEYS = Object.freeze({\n  DEFAULT_PROVIDER: \"AI_DEFAULT_PROVIDER_V3\",\n  GEMINI_API_KEY: \"AI_GEMINI_API_KEY_V3\",\n  OPENAI_API_KEY: \"AI_OPENAI_API_KEY_V3\",\n  GEMINI_MODEL: \"AI_GEMINI_MODEL_V3\",\n  OPENAI_MODEL: \"AI_OPENAI_MODEL_V3\",\n  GEMINI_REASONING_EFFORT: \"AI_GEMINI_REASONING_EFFORT_V3\",\n  OPENAI_REASONING_EFFORT: \"AI_OPENAI_REASONING_EFFORT_V3\",\n  MAX_OUTPUT_TOKENS: \"AI_MAX_OUTPUT_TOKENS_V3\",\n  ONBOARDING_SEEN: \"AI_ONBOARDING_SEEN_V1\",\n  SECTION_ORDER: \"AI_SECTION_ORDER_V1\",\n  SECTION_HIDDEN: \"AI_SECTION_HIDDEN_V1\",\n  LICENSE: \"AI_LICENSE_V1\",\n\n  // Prevent re-running migrations each time.\n  MIGRATION_DONE: \"AI_MIGRATION_DONE_V3\",\n\n  // Diagnostics + cache metadata\n  REQUEST_LOG: \"AI_REQUEST_LOG_V1\",\n  REQUEST_LOG_CLEAR_AT: \"AI_REQUEST_LOG_CLEAR_AT_V1\",\n  CACHE_INDEX: \"AI_CACHE_INDEX_V1\",\n  CACHE_CLEAR_AT: \"AI_CACHE_CLEAR_AT_V1\"\n});\n\n// Older keys used by previous versions (best-effort migration).\nconst LEGACY_KEYS = Object.freeze({\n  GEMINI_API_KEY: \"GEMINI_API_KEY\",\n  MAX_OUTPUT_TOKENS: \"MAX_OUTPUT_TOKENS\",\n\n  DEFAULT_PROVIDER_V2: \"AI_DEFAULT_PROVIDER_V2\",\n  GEMINI_API_KEY_V2: \"AI_GEMINI_API_KEY_V2\",\n  OPENAI_API_KEY_V2: \"AI_OPENAI_API_KEY_V2\",\n  GEMINI_MODEL_V2: \"AI_GEMINI_MODEL_V2\",\n  OPENAI_MODEL_V2: \"AI_OPENAI_MODEL_V2\",\n\n  GEMINI_MAX_TOKENS_V2: \"AI_GEMINI_MAX_OUTPUT_TOKENS_V2\",\n  OPENAI_MAX_TOKENS_V2: \"AI_OPENAI_MAX_OUTPUT_TOKENS_V2\"\n});\n\nlet _migrationPromise = null;\n\nfunction getRuntimeStorage() {\n  try {\n    if (typeof OfficeRuntime !== \"undefined\" && OfficeRuntime?.storage?.getItem) {\n      return { kind: \"office\", storage: OfficeRuntime.storage };\n    }\n  } catch {\n    // ignore\n  }\n\n  try {\n    if (typeof window !== \"undefined\" && window?.localStorage?.getItem) {\n      return { kind: \"local\", storage: window.localStorage };\n    }\n  } catch {\n    // ignore\n  }\n\n  // Extremely defensive fallback (in-memory only).\n  const mem = new Map();\n  return {\n    kind: \"memory\",\n    storage: {\n      async getItem(k) {\n        return mem.has(k) ? mem.get(k) : null;\n      },\n      async setItem(k, v) {\n        mem.set(k, String(v));\n      },\n      async removeItem(k) {\n        mem.delete(k);\n      }\n    }\n  };\n}\n\nfunction getLocalStorageSafe() {\n  try {\n    if (typeof window !== \"undefined\" && window?.localStorage?.getItem) {\n      return window.localStorage;\n    }\n  } catch {\n    return null;\n  }\n  return null;\n}\n\nexport function storageBackendName() {\n  return getRuntimeStorage().kind;\n}\n\nasync function rawGet(key) {\n  const { kind, storage } = getRuntimeStorage();\n  if (kind === \"local\") {\n    try {\n      return storage.getItem(key);\n    } catch {\n      return null;\n    }\n  }\n\n  if (kind === \"office\") {\n    try {\n      const result = await storage.getItem(key);\n      if (result == null) {\n        const local = getLocalStorageSafe();\n        if (!local) return null;\n        try {\n          const localValue = local.getItem(key);\n          return localValue == null ? null : localValue;\n        } catch {\n          return null;\n        }\n      }\n      return result;\n    } catch {\n      const local = getLocalStorageSafe();\n      if (!local) return null;\n      try {\n        return local.getItem(key);\n      } catch {\n        return null;\n      }\n    }\n  }\n\n  try {\n    return await storage.getItem(key);\n  } catch {\n    return null;\n  }\n}\n\nasync function rawSet(key, value) {\n  const { kind, storage } = getRuntimeStorage();\n  const v = value == null ? \"\" : String(value);\n  if (kind === \"local\") {\n    try {\n      storage.setItem(key, v);\n      return;\n    } catch {\n      return;\n    }\n  }\n\n  if (kind === \"office\") {\n    try {\n      await storage.setItem(key, v);\n    } catch {\n      // ignore and try local\n    }\n    const local = getLocalStorageSafe();\n    if (!local) return;\n    try {\n      local.setItem(key, v);\n    } catch {\n      // ignore\n    }\n    return;\n  }\n\n  try {\n    await storage.setItem(key, v);\n  } catch {\n    // ignore\n  }\n}\n\nasync function rawRemove(key) {\n  const { kind, storage } = getRuntimeStorage();\n  if (kind === \"local\") {\n    try {\n      storage.removeItem(key);\n      return;\n    } catch {\n      return;\n    }\n  }\n\n  if (kind === \"office\") {\n    try {\n      await storage.removeItem(key);\n    } catch {\n      // ignore and try local\n    }\n    const local = getLocalStorageSafe();\n    if (!local) return;\n    try {\n      local.removeItem(key);\n    } catch {\n      // ignore\n    }\n    return;\n  }\n\n  try {\n    await storage.removeItem(key);\n  } catch {\n    // ignore\n  }\n}\n\nasync function ensureMigrated() {\n  if (_migrationPromise) return _migrationPromise;\n\n  _migrationPromise = (async () => {\n    // Fast exit if already migrated\n    const done = await rawGet(STORAGE_KEYS.MIGRATION_DONE);\n    if (done === \"1\") return;\n\n    // Migrate provider\n    const currentProvider = normalizeProvider(await rawGet(STORAGE_KEYS.DEFAULT_PROVIDER));\n    if (!currentProvider) {\n      const legacyProvider = normalizeProvider(await rawGet(LEGACY_KEYS.DEFAULT_PROVIDER_V2));\n      await rawSet(STORAGE_KEYS.DEFAULT_PROVIDER, legacyProvider || DEFAULTS.provider);\n    }\n\n    // Migrate keys\n    const gKey = await rawGet(STORAGE_KEYS.GEMINI_API_KEY);\n    if (!gKey) {\n      const legacy = (await rawGet(LEGACY_KEYS.GEMINI_API_KEY_V2)) || (await rawGet(LEGACY_KEYS.GEMINI_API_KEY));\n      if (legacy) await rawSet(STORAGE_KEYS.GEMINI_API_KEY, legacy);\n    }\n\n    const oKey = await rawGet(STORAGE_KEYS.OPENAI_API_KEY);\n    if (!oKey) {\n      const legacy = await rawGet(LEGACY_KEYS.OPENAI_API_KEY_V2);\n      if (legacy) await rawSet(STORAGE_KEYS.OPENAI_API_KEY, legacy);\n    }\n\n    // Migrate models\n    const gModel = await rawGet(STORAGE_KEYS.GEMINI_MODEL);\n    if (!gModel) {\n      const legacy = await rawGet(LEGACY_KEYS.GEMINI_MODEL_V2);\n      await rawSet(STORAGE_KEYS.GEMINI_MODEL, legacy || DEFAULTS.geminiModel);\n    }\n\n    const oModel = await rawGet(STORAGE_KEYS.OPENAI_MODEL);\n    if (!oModel) {\n      const legacy = await rawGet(LEGACY_KEYS.OPENAI_MODEL_V2);\n      await rawSet(STORAGE_KEYS.OPENAI_MODEL, legacy || DEFAULTS.openaiModel);\n    }\n\n    // Migrate max tokens (unified)\n    const tok = await rawGet(STORAGE_KEYS.MAX_OUTPUT_TOKENS);\n    if (!tok) {\n      const legacyUnified = await rawGet(LEGACY_KEYS.MAX_OUTPUT_TOKENS);\n      const legacyGem = await rawGet(LEGACY_KEYS.GEMINI_MAX_TOKENS_V2);\n      const legacyOai = await rawGet(LEGACY_KEYS.OPENAI_MAX_TOKENS_V2);\n\n      const candidates = [legacyUnified, legacyGem, legacyOai]\n        .map((x) => parseInt(String(x || \"\").trim(), 10))\n        .filter((n) => Number.isFinite(n) && n > 0);\n\n      const migrated = candidates.length ? Math.max(...candidates) : DEFAULTS.maxOutputTokens;\n      await rawSet(STORAGE_KEYS.MAX_OUTPUT_TOKENS, String(migrated));\n    }\n\n    await rawSet(STORAGE_KEYS.MIGRATION_DONE, \"1\");\n  })();\n\n  try {\n    await _migrationPromise;\n  } finally {\n    _migrationPromise = null;\n  }\n}\n\nexport function normalizeProvider(p) {\n  if (!p) return \"\";\n  const s = String(p).trim().toLowerCase();\n  if (s === PROVIDERS.GEMINI) return PROVIDERS.GEMINI;\n  if (s === PROVIDERS.OPENAI) return PROVIDERS.OPENAI;\n  // Common aliases (defensive)\n  if (s === \"google\" || s === \"gem\") return PROVIDERS.GEMINI;\n  if (s === \"oai\" || s === \"chatgpt\") return PROVIDERS.OPENAI;\n  return \"\";\n}\n\nconst GEMINI_REASONING_EFFORTS = new Set([\"auto\", \"minimal\", \"low\", \"medium\", \"high\"]);\nconst OPENAI_REASONING_EFFORTS = new Set([\"none\", \"minimal\", \"low\", \"medium\", \"high\"]);\n\nfunction normalizeGeminiReasoningEffort(value) {\n  const v = String(value || \"\").trim().toLowerCase();\n  if (!v) return DEFAULTS.geminiReasoningEffort;\n  return GEMINI_REASONING_EFFORTS.has(v) ? v : DEFAULTS.geminiReasoningEffort;\n}\n\nfunction normalizeReasoningEffort(value) {\n  const v = String(value || \"\").trim().toLowerCase();\n  if (!v) return DEFAULTS.openaiReasoningEffort;\n  return OPENAI_REASONING_EFFORTS.has(v) ? v : DEFAULTS.openaiReasoningEffort;\n}\n\nexport async function getDefaultProvider() {\n  await ensureMigrated();\n  const p = normalizeProvider(await rawGet(STORAGE_KEYS.DEFAULT_PROVIDER));\n  return p || DEFAULTS.provider;\n}\n\nexport async function setDefaultProvider(provider) {\n  const p = normalizeProvider(provider) || DEFAULTS.provider;\n  await rawSet(STORAGE_KEYS.DEFAULT_PROVIDER, p);\n  return p;\n}\n\nfunction keyKey(provider) {\n  const p = normalizeProvider(provider);\n  if (p === PROVIDERS.OPENAI) return STORAGE_KEYS.OPENAI_API_KEY;\n  return STORAGE_KEYS.GEMINI_API_KEY;\n}\n\nexport async function getApiKey(provider) {\n  await ensureMigrated();\n  const k = await rawGet(keyKey(provider));\n  return (k || \"\").trim();\n}\n\nexport async function setApiKey(provider, apiKey) {\n  const k = (apiKey || \"\").trim();\n  await rawSet(keyKey(provider), k);\n  return k;\n}\n\nexport async function clearApiKey(provider) {\n  await rawRemove(keyKey(provider));\n}\n\nfunction modelKey(provider) {\n  const p = normalizeProvider(provider);\n  if (p === PROVIDERS.OPENAI) return STORAGE_KEYS.OPENAI_MODEL;\n  return STORAGE_KEYS.GEMINI_MODEL;\n}\n\nexport async function getModel(provider) {\n  await ensureMigrated();\n  const p = normalizeProvider(provider);\n  const raw = await rawGet(modelKey(p));\n  if (raw && String(raw).trim()) return String(raw).trim();\n  return p === PROVIDERS.OPENAI ? DEFAULTS.openaiModel : DEFAULTS.geminiModel;\n}\n\nexport async function getGeminiReasoningEffort() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.GEMINI_REASONING_EFFORT);\n  return normalizeGeminiReasoningEffort(raw || DEFAULTS.geminiReasoningEffort);\n}\n\nexport async function getOpenAIReasoningEffort() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.OPENAI_REASONING_EFFORT);\n  return normalizeReasoningEffort(raw || DEFAULTS.openaiReasoningEffort);\n}\n\nexport async function setModel(provider, model) {\n  const p = normalizeProvider(provider);\n  const v = String(model || \"\").trim();\n  if (!v) {\n    // Reset to default if emptied\n    await rawSet(modelKey(p), p === PROVIDERS.OPENAI ? DEFAULTS.openaiModel : DEFAULTS.geminiModel);\n    return;\n  }\n  await rawSet(modelKey(p), v);\n}\n\nexport async function setOpenAIReasoningEffort(value) {\n  const v = normalizeReasoningEffort(value);\n  await rawSet(STORAGE_KEYS.OPENAI_REASONING_EFFORT, v);\n  return v;\n}\n\nexport async function setGeminiReasoningEffort(value) {\n  const v = normalizeGeminiReasoningEffort(value);\n  await rawSet(STORAGE_KEYS.GEMINI_REASONING_EFFORT, v);\n  return v;\n}\n\nexport async function getMaxOutputTokens() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.MAX_OUTPUT_TOKENS);\n  const n = parseInt(String(raw || \"\").trim(), 10);\n  return clampInt(n, 1, 128000, DEFAULTS.maxOutputTokens);\n}\n\nexport async function setMaxOutputTokens(value) {\n  const n = clampInt(value, 1, 128000, DEFAULTS.maxOutputTokens);\n  await rawSet(STORAGE_KEYS.MAX_OUTPUT_TOKENS, String(n));\n  return n;\n}\n\nexport async function getOnboardingSeen() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.ONBOARDING_SEEN);\n  return raw === \"1\";\n}\n\nexport async function setOnboardingSeen(seen = true) {\n  await rawSet(STORAGE_KEYS.ONBOARDING_SEEN, seen ? \"1\" : \"0\");\n  return seen;\n}\n\nfunction normalizeSectionList(value) {\n  if (!Array.isArray(value)) return [];\n  const out = [];\n  const seen = new Set();\n  for (const item of value) {\n    const key = String(item || \"\").trim();\n    if (!key || seen.has(key)) continue;\n    seen.add(key);\n    out.push(key);\n  }\n  return out;\n}\n\nexport async function getSectionOrder() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.SECTION_ORDER);\n  if (!raw) return [];\n  try {\n    return normalizeSectionList(JSON.parse(raw));\n  } catch {\n    return [];\n  }\n}\n\nexport async function setSectionOrder(order) {\n  const normalized = normalizeSectionList(order);\n  await rawSet(STORAGE_KEYS.SECTION_ORDER, JSON.stringify(normalized));\n  return normalized;\n}\n\nexport async function getHiddenSections() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.SECTION_HIDDEN);\n  if (!raw) return [];\n  try {\n    return normalizeSectionList(JSON.parse(raw));\n  } catch {\n    return [];\n  }\n}\n\nexport async function setHiddenSections(list) {\n  const normalized = normalizeSectionList(list);\n  await rawSet(STORAGE_KEYS.SECTION_HIDDEN, JSON.stringify(normalized));\n  return normalized;\n}\n\nexport async function getLicense() {\n  await ensureMigrated();\n  const raw = await rawGet(STORAGE_KEYS.LICENSE);\n  if (!raw) return null;\n  try {\n    return JSON.parse(raw);\n  } catch {\n    return null;\n  }\n}\n\nexport async function setLicense(license) {\n  if (!license) {\n    await rawRemove(STORAGE_KEYS.LICENSE);\n    return null;\n  }\n  await rawSet(STORAGE_KEYS.LICENSE, JSON.stringify(license));\n  return license;\n}\n\nexport async function clearLicense() {\n  await rawRemove(STORAGE_KEYS.LICENSE);\n}\n\n// ---------- Small utilities ----------\nexport function nowMs() {\n  return Date.now();\n}\n\nexport function sleep(ms) {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nexport function clamp(value, min, max, fallback = min) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return fallback;\n  return Math.max(min, Math.min(max, n));\n}\n\nexport function clampInt(value, min, max, fallback = min) {\n  const n = parseInt(String(value), 10);\n  if (!Number.isFinite(n)) return fallback;\n  return Math.max(min, Math.min(max, n));\n}\n\nfunction parseTimestampMs(raw) {\n  const n = parseInt(String(raw || \"\").trim(), 10);\n  return Number.isFinite(n) && n > 0 ? n : 0;\n}\n\n// ---------- LRU cache with TTL ----------\nexport class LRUCache {\n  constructor(maxEntries = 500) {\n    this.maxEntries = maxEntries;\n    this.map = new Map(); // key => {value, expiresAtMs}\n  }\n\n  get(key) {\n    if (!this.map.has(key)) return null;\n    const entry = this.map.get(key);\n\n    if (entry?.expiresAtMs && entry.expiresAtMs <= nowMs()) {\n      this.map.delete(key);\n      return null;\n    }\n\n    // Refresh key order (most recent)\n    this.map.delete(key);\n    this.map.set(key, entry);\n    return entry.value;\n  }\n\n  set(key, value, ttlMs) {\n    const expiresAtMs = typeof ttlMs === \"number\" && ttlMs > 0 ? nowMs() + ttlMs : null;\n    if (this.map.has(key)) this.map.delete(key);\n    this.map.set(key, { value, expiresAtMs });\n\n    // Evict LRU\n    while (this.map.size > this.maxEntries) {\n      const oldestKey = this.map.keys().next().value;\n      this.map.delete(oldestKey);\n    }\n  }\n\n  clear() {\n    this.map.clear();\n  }\n}\n\n// ---------- Persistent cache (survives reloads) ----------\nconst CACHE_ENTRY_PREFIX = \"AI_CACHE_ENTRY_V1:\";\nconst CACHE_INDEX_MAX = 250;\nlet _cacheClearMs = 0;\n\nasync function syncCacheClearMarker() {\n  const clearedAt = parseTimestampMs(await rawGet(STORAGE_KEYS.CACHE_CLEAR_AT));\n  if (clearedAt > _cacheClearMs) _cacheClearMs = clearedAt;\n  return _cacheClearMs;\n}\n\nexport async function getCacheClearAt() {\n  return await syncCacheClearMarker();\n}\n\nasync function loadCacheIndex() {\n  const raw = await rawGet(STORAGE_KEYS.CACHE_INDEX);\n  if (!raw) return [];\n  try {\n    const arr = JSON.parse(raw);\n    return Array.isArray(arr) ? arr : [];\n  } catch {\n    return [];\n  }\n}\n\nasync function saveCacheIndex(entries) {\n  try {\n    await rawSet(STORAGE_KEYS.CACHE_INDEX, JSON.stringify(entries));\n  } catch {\n    // ignore\n  }\n}\n\nfunction pruneCacheIndex(entries, clearedAt = 0) {\n  const now = nowMs();\n  const kept = [];\n  const removedKeys = [];\n\n  for (const entry of entries || []) {\n    if (!entry || !entry.key) continue;\n    const savedAt = Number(entry.savedAtMs || 0);\n    if (clearedAt && (!Number.isFinite(savedAt) || savedAt <= clearedAt)) {\n      removedKeys.push(entry.key);\n      continue;\n    }\n    if (entry.expiresAtMs && entry.expiresAtMs <= now) {\n      removedKeys.push(entry.key);\n      continue;\n    }\n    kept.push(entry);\n  }\n\n  if (kept.length > CACHE_INDEX_MAX) {\n    kept.sort((a, b) => (a.savedAtMs || 0) - (b.savedAtMs || 0));\n    const over = kept.length - CACHE_INDEX_MAX;\n    const toRemove = kept.slice(0, over);\n    for (const r of toRemove) removedKeys.push(r.key);\n    return { list: kept.slice(over), removedKeys };\n  }\n\n  return { list: kept, removedKeys };\n}\n\nasync function removeCacheEntry(key) {\n  if (!key) return;\n  await rawRemove(CACHE_ENTRY_PREFIX + key);\n}\n\nasync function removeFromCacheIndex(key) {\n  const index = await loadCacheIndex();\n  const next = (index || []).filter((item) => item?.key !== key);\n  if (next.length !== index.length) await saveCacheIndex(next);\n}\n\nexport async function getPersistentCache(cacheKey) {\n  if (!cacheKey) return null;\n  const clearedAt = await syncCacheClearMarker();\n  const raw = await rawGet(CACHE_ENTRY_PREFIX + cacheKey);\n  if (!raw) {\n    await removeFromCacheIndex(cacheKey);\n    return null;\n  }\n\n  try {\n    const entry = JSON.parse(raw);\n    if (!entry || typeof entry !== \"object\") throw new Error(\"Invalid entry\");\n    const savedAt = Number(entry.savedAtMs || 0);\n    if (clearedAt && (!Number.isFinite(savedAt) || savedAt <= clearedAt)) {\n      await removeCacheEntry(cacheKey);\n      await removeFromCacheIndex(cacheKey);\n      return null;\n    }\n    if (entry.expiresAtMs && entry.expiresAtMs <= nowMs()) {\n      await removeCacheEntry(cacheKey);\n      await removeFromCacheIndex(cacheKey);\n      return null;\n    }\n    return entry.value || null;\n  } catch {\n    await removeCacheEntry(cacheKey);\n    await removeFromCacheIndex(cacheKey);\n    return null;\n  }\n}\n\nexport async function setPersistentCache(cacheKey, value, ttlMs, meta = {}) {\n  if (!cacheKey) return;\n  const now = nowMs();\n  const clearedAt = await syncCacheClearMarker();\n  const savedAtMs = clearedAt && now <= clearedAt ? clearedAt + 1 : now;\n  const expiresAtMs = typeof ttlMs === \"number\" && ttlMs > 0 ? savedAtMs + ttlMs : null;\n  const entry = {\n    v: 1,\n    savedAtMs,\n    expiresAtMs,\n    value\n  };\n\n  const raw = JSON.stringify(entry);\n  await rawSet(CACHE_ENTRY_PREFIX + cacheKey, raw);\n\n  const index = await loadCacheIndex();\n  const provider = meta.provider || value?.provider || \"\";\n  const model = meta.model || value?.model || \"\";\n  const size = raw.length;\n\n  let updated = false;\n  const next = (index || []).map((item) => {\n    if (item?.key !== cacheKey) return item;\n    updated = true;\n    return {\n      key: cacheKey,\n      provider,\n      model,\n      size,\n      savedAtMs,\n      expiresAtMs\n    };\n  });\n\n  if (!updated) {\n    next.push({\n      key: cacheKey,\n      provider,\n      model,\n      size,\n      savedAtMs,\n      expiresAtMs\n    });\n  }\n\n  const pruned = pruneCacheIndex(next, clearedAt);\n  for (const key of pruned.removedKeys) await removeCacheEntry(key);\n  await saveCacheIndex(pruned.list);\n}\n\nexport async function clearPersistentCache() {\n  const clearedAt = nowMs();\n  _cacheClearMs = clearedAt;\n  await rawSet(STORAGE_KEYS.CACHE_CLEAR_AT, String(clearedAt));\n  const index = await loadCacheIndex();\n  for (const item of index || []) {\n    if (!item?.key) continue;\n    await removeCacheEntry(item.key);\n  }\n  await rawRemove(STORAGE_KEYS.CACHE_INDEX);\n}\n\nexport async function getPersistentCacheStats() {\n  const index = await loadCacheIndex();\n  const clearedAt = await syncCacheClearMarker();\n  const pruned = pruneCacheIndex(index, clearedAt);\n  if (pruned.removedKeys.length) {\n    for (const key of pruned.removedKeys) await removeCacheEntry(key);\n    await saveCacheIndex(pruned.list);\n  }\n\n  const stats = {\n    entries: 0,\n    sizeBytes: 0,\n    providers: {\n      gemini: { entries: 0, sizeBytes: 0 },\n      openai: { entries: 0, sizeBytes: 0 }\n    },\n    oldestMs: null,\n    newestMs: null\n  };\n\n  for (const item of pruned.list || []) {\n    if (!item?.key) continue;\n    stats.entries += 1;\n    stats.sizeBytes += Number(item.size || 0);\n    const provider = String(item.provider || \"\").toLowerCase();\n    if (provider === PROVIDERS.GEMINI) {\n      stats.providers.gemini.entries += 1;\n      stats.providers.gemini.sizeBytes += Number(item.size || 0);\n    } else if (provider === PROVIDERS.OPENAI) {\n      stats.providers.openai.entries += 1;\n      stats.providers.openai.sizeBytes += Number(item.size || 0);\n    }\n\n    const savedAt = Number(item.savedAtMs || 0);\n    if (savedAt) {\n      stats.oldestMs = stats.oldestMs == null ? savedAt : Math.min(stats.oldestMs, savedAt);\n      stats.newestMs = stats.newestMs == null ? savedAt : Math.max(stats.newestMs, savedAt);\n    }\n  }\n\n  return stats;\n}\n\n// ---------- Stable stringify + hashing (for cache keys) ----------\nfunction isPlainObject(v) {\n  return Object.prototype.toString.call(v) === \"[object Object]\";\n}\n\nexport function stableStringify(value) {\n  return JSON.stringify(sortKeysDeep(value));\n}\n\nfunction sortKeysDeep(value) {\n  if (Array.isArray(value)) return value.map(sortKeysDeep);\n  if (isPlainObject(value)) {\n    const out = {};\n    for (const k of Object.keys(value).sort()) out[k] = sortKeysDeep(value[k]);\n    return out;\n  }\n  return value;\n}\n\nfunction fnv1a32(str) {\n  let h = 2166136261;\n  for (let i = 0; i < str.length; i++) {\n    h ^= str.charCodeAt(i);\n    h = Math.imul(h, 16777619);\n  }\n  // Unsigned\n  return (h >>> 0).toString(16).padStart(8, \"0\");\n}\n\nexport async function hashKey(input) {\n  const text = typeof input === \"string\" ? input : stableStringify(input);\n\n  // Prefer SHA-256 when available (browser/Office runtime)\n  try {\n    if (typeof crypto !== \"undefined\" && crypto?.subtle?.digest && typeof TextEncoder !== \"undefined\") {\n      const enc = new TextEncoder();\n      const bytes = enc.encode(text);\n      const digest = await crypto.subtle.digest(\"SHA-256\", bytes);\n      const arr = Array.from(new Uint8Array(digest));\n      return arr.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\");\n    }\n  } catch {\n    // ignore and fallback\n  }\n\n  return `fnv1a:${fnv1a32(text)}`;\n}\n\n// ---------- Lightweight diagnostics log (persisted) ----------\nconst REQUEST_LOG_MAX = 500;\nconst REQUEST_LOG_TTL_MS = 24 * 60 * 60 * 1000; // 24h\nlet _requestLog = [];\nlet _requestLogLoading = null;\nlet _requestLogLoaded = false;\nlet _requestLogLastLoadedMs = 0;\nlet _requestLogClearMs = 0;\n\nasync function syncRequestLogClearMarker(options = {}) {\n  const clearedAt = parseTimestampMs(await rawGet(STORAGE_KEYS.REQUEST_LOG_CLEAR_AT));\n  if (clearedAt > _requestLogClearMs) {\n    _requestLogClearMs = clearedAt;\n    _requestLog = [];\n    if (options.reset) {\n      _requestLogLoaded = true;\n      _requestLogLoading = null;\n      _requestLogLastLoadedMs = nowMs();\n    } else {\n      _requestLogLoaded = false;\n    }\n  }\n  return _requestLogClearMs;\n}\n\nasync function loadRequestLog(force = false) {\n  if (_requestLogLoading) return _requestLogLoading;\n\n  _requestLogLoading = (async () => {\n    const clearedAt = await syncRequestLogClearMarker();\n    if (!force && _requestLogLoaded) return _requestLog;\n    const raw = await rawGet(STORAGE_KEYS.REQUEST_LOG);\n    let arr = [];\n    if (raw) {\n      try {\n        const parsed = JSON.parse(raw);\n        if (Array.isArray(parsed)) arr = parsed;\n      } catch {\n        arr = [];\n      }\n    }\n    const now = nowMs();\n    arr = arr\n      .map((e) => {\n        if (!e) return null;\n        let ts = e.ts;\n        if (typeof ts === \"string\") {\n          const parsed = Date.parse(ts);\n          if (Number.isFinite(parsed)) ts = parsed;\n        }\n        if (typeof ts !== \"number\") return null;\n        return { ...e, ts };\n      })\n      .filter((e) => e && typeof e.ts === \"number\" && e.ts > clearedAt && now - e.ts <= REQUEST_LOG_TTL_MS);\n    _requestLog = arr.slice(-REQUEST_LOG_MAX);\n    _requestLogLoaded = true;\n    _requestLogLastLoadedMs = nowMs();\n    return _requestLog;\n  })();\n\n  try {\n    return await _requestLogLoading;\n  } finally {\n    _requestLogLoading = null;\n  }\n}\n\nasync function persistRequestLog() {\n  try {\n    await rawSet(STORAGE_KEYS.REQUEST_LOG, JSON.stringify(_requestLog.slice(-REQUEST_LOG_MAX)));\n  } catch {\n    // ignore\n  }\n}\n\nfunction pruneRequestLog() {\n  const now = nowMs();\n  const clearedAt = _requestLogClearMs || 0;\n  _requestLog = (_requestLog || []).filter(\n    (e) => e && typeof e.ts === \"number\" && e.ts > clearedAt && now - e.ts <= REQUEST_LOG_TTL_MS\n  );\n  if (_requestLog.length > REQUEST_LOG_MAX) {\n    _requestLog = _requestLog.slice(-REQUEST_LOG_MAX);\n  }\n}\n\nexport function logRequest(entry) {\n  void logRequestAsync(entry);\n}\n\nasync function logRequestAsync(entry) {\n  try {\n    await syncRequestLogClearMarker({ reset: true });\n    const logEntry = { ts: nowMs(), ...entry };\n\n    if (_requestLogLoaded) {\n      _requestLog.push(logEntry);\n      pruneRequestLog();\n      _requestLogLastLoadedMs = nowMs();\n      await persistRequestLog();\n      return;\n    }\n\n    await loadRequestLog();\n    _requestLog.push(logEntry);\n    pruneRequestLog();\n    _requestLogLastLoadedMs = nowMs();\n    await persistRequestLog();\n  } catch {\n    // ignore\n  }\n}\n\nexport async function getRequestLog(options = {}) {\n  const force = !!options?.fresh;\n  const now = nowMs();\n  if (force || !_requestLogLoaded || now - _requestLogLastLoadedMs > 1500) {\n    await loadRequestLog(true);\n  } else {\n    await loadRequestLog(false);\n  }\n  return _requestLog.slice();\n}\n\nexport async function clearRequestLog() {\n  const clearedAt = nowMs();\n  _requestLog = [];\n  _requestLogLoaded = true;\n  _requestLogLoading = null;\n  _requestLogClearMs = clearedAt;\n  _requestLogLastLoadedMs = clearedAt;\n  await rawSet(STORAGE_KEYS.REQUEST_LOG_CLEAR_AT, String(clearedAt));\n  await rawRemove(STORAGE_KEYS.REQUEST_LOG);\n}\n","// src/shared/providers.js\n// Provider implementations (Gemini + OpenAI) and shared request orchestration.\n//\n// Requirements implemented:\n// - Gemini 3 Flash (via Google Generative Language API)\n// - OpenAI GPT-5 Mini (via OpenAI Responses API)\n// - No temperature / sampling parameters are ever sent\n// - Provider selection happens via taskpane default provider (formulas cannot override)\n// - AI.WEB uses provider-native web search mechanisms:\n//   - Gemini: google_search tool\n//   - OpenAI: web_search tool\n\nimport {\n  PROVIDERS,\n  DEFAULTS,\n  normalizeProvider,\n  getDefaultProvider,\n  getApiKey,\n  getModel,\n  getGeminiReasoningEffort,\n  getOpenAIReasoningEffort,\n  getMaxOutputTokens,\n  clampInt,\n  nowMs,\n  sleep,\n  LRUCache,\n  hashKey,\n  logRequest,\n  getCacheClearAt,\n  getPersistentCache,\n  setPersistentCache,\n  clearPersistentCache\n} from \"./core.js\";\n\n// ---- In-memory cache (per runtime) ----\nconst CACHE = new LRUCache(800);\nlet _cacheClearLocalMs = 0;\n\nasync function syncCacheClearMarker() {\n  const clearedAt = await getCacheClearAt();\n  if (clearedAt > _cacheClearLocalMs) {\n    _cacheClearLocalMs = clearedAt;\n    CACHE.clear();\n  }\n}\n\n// Deduplicate in-flight identical requests to avoid bursts (per runtime)\nconst INFLIGHT = new Map(); // key => Promise<AIResult>\n\n// Basic concurrency limiter (per runtime)\nconst MAX_CONCURRENCY = 4;\nlet active = 0;\nconst queue = [];\n\nasync function withConcurrencyLimit(fn) {\n  if (active >= MAX_CONCURRENCY) await new Promise((resolve) => queue.push(resolve));\n  active++;\n  try {\n    return await fn();\n  } finally {\n    active--;\n    const next = queue.shift();\n    if (next) next();\n  }\n}\n\nfunction isNonEmptyString(s) {\n  return typeof s === \"string\" && s.trim().length > 0;\n}\n\nfunction normalizeBoolean(v, def = false) {\n  if (typeof v === \"boolean\") return v;\n  if (typeof v === \"number\") return v !== 0;\n  if (typeof v === \"string\") {\n    const s = v.trim().toLowerCase();\n    if ([\"1\", \"true\", \"yes\", \"y\", \"on\"].includes(s)) return true;\n    if ([\"0\", \"false\", \"no\", \"n\", \"off\"].includes(s)) return false;\n  }\n  return def;\n}\n\nfunction normalizeTimeoutMs(v) {\n  return clampInt(v, 1000, 120000, DEFAULTS.timeoutMs);\n}\n\nfunction normalizeRetry(v) {\n  return clampInt(v, 0, 5, DEFAULTS.retry);\n}\n\nfunction normalizeMaxOutputTokens(v) {\n  return clampInt(v, 1, 128000, DEFAULTS.maxOutputTokens);\n}\n\nfunction toLowerMsg(v) {\n  return String(v || \"\").toLowerCase();\n}\n\nfunction looksLikeStructuredOutputUnsupported(message) {\n  const s = toLowerMsg(message);\n  if (!s) return false;\n  return (\n    s.includes(\"responseschema\") ||\n    s.includes(\"response schema\") ||\n    s.includes(\"response_schema\") ||\n    s.includes(\"responsemime\") ||\n    s.includes(\"response mime\") ||\n    s.includes(\"response_mime\") ||\n    s.includes(\"response_mime_type\") ||\n    s.includes(\"json_schema\") ||\n    s.includes(\"response_format\") ||\n    s.includes(\"text.format\")\n  );\n}\n\nfunction looksLikeWebSearchUnsupported(message) {\n  const s = toLowerMsg(message);\n  if (!s) return false;\n  if (!(s.includes(\"web_search\") || s.includes(\"google_search\") || s.includes(\"web search\") || s.includes(\"google search\"))) {\n    return false;\n  }\n  return (\n    s.includes(\"not supported\") ||\n    s.includes(\"unsupported\") ||\n    s.includes(\"unknown\") ||\n    s.includes(\"unrecognized\") ||\n    s.includes(\"invalid\") ||\n    s.includes(\"not enabled\") ||\n    s.includes(\"not available\")\n  );\n}\n\nfunction ensureJsonInstruction(system) {\n  const suffix = \" Return valid JSON only.\";\n  if (!isNonEmptyString(system)) return \"Return valid JSON only.\";\n  const s = String(system).trim();\n  if (/json/i.test(s)) return s;\n  return s + suffix;\n}\n\nfunction extractFormulaFromText(text) {\n  if (!isNonEmptyString(text)) return \"\";\n  const raw = String(text).trim();\n  const match = raw.match(/=[^\\n\\r]+/);\n  const formula = (match ? match[0] : raw).trim();\n  if (!formula.startsWith(\"=\")) return \"\";\n  return formula;\n}\n\nfunction getFormulaForLog(fnName, text) {\n  if (fnName !== \"AI.FORMULA\") return \"\";\n  return extractFormulaFromText(text);\n}\n\nfunction resolveGeminiThinkingConfig(model, effort) {\n  const level = String(effort || \"\").trim().toLowerCase();\n  if (!level || level === \"auto\" || level === \"none\") return null;\n\n  const modelId = String(model || \"\").trim().toLowerCase();\n  if (!modelId.includes(\"gemini\")) return null;\n\n  if (modelId.includes(\"gemini-3\")) {\n    if (modelId.includes(\"flash\")) {\n      const allowed = new Set([\"minimal\", \"low\", \"medium\", \"high\"]);\n      const normalized = allowed.has(level) ? level : \"low\";\n      return { thinkingLevel: normalized.toUpperCase() };\n    }\n    const normalized = level === \"high\" || level === \"medium\" ? \"high\" : \"low\";\n    return { thinkingLevel: normalized.toUpperCase() };\n  }\n\n  if (modelId.includes(\"gemini-2.5\")) {\n    const budgets = {\n      minimal: 512,\n      low: 2048,\n      medium: 8192,\n      high: 24576\n    };\n    let budget = budgets[level];\n    if (!budget) return null;\n    if (modelId.includes(\"flash-lite\")) budget = Math.max(512, budget);\n    if (modelId.includes(\"pro\")) budget = Math.max(128, budget);\n    return { thinkingBudget: budget };\n  }\n\n  return null;\n}\n\n// ---- Public API ----\n\n/**\n * @typedef {Object} AIGenerateRequest\n * @property {string=} provider Optional override (should only be used by taskpane tests, not formulas).\n * @property {string=} system System instruction.\n * @property {string} user User prompt.\n * @property {boolean=} webSearch Enable provider web search tool.\n * @property {number=} maxOutputTokens Override max tokens (optional; normally from panel).\n * @property {number=} timeoutMs\n * @property {number=} retry\n * @property {boolean=} cache\n * @property {number=} cacheTtlSec\n * @property {string=} responseMimeType e.g., \"application/json\"\n * @property {Object=} responseJsonSchema JSON schema (strict) for structured output.\n * @property {string=} functionName Name for diagnostics.\n * @property {string=} functionCall Excel-style function call for diagnostics.\n */\n\n/**\n * @typedef {Object} AIResult\n * @property {boolean} ok\n * @property {string=} text\n * @property {Array<{title?: string, url: string}>=} sources\n * @property {string=} provider\n * @property {string=} model\n * @property {Object=} usage\n * @property {string=} code\n * @property {string=} message\n */\n\nexport async function aiGenerate(req) {\n  const start = nowMs();\n  const provider = normalizeProvider(req?.provider) || (await getDefaultProvider());\n  const model = await getModel(provider);\n  const apiKey = await getApiKey(provider);\n  const fnName = req?.functionName || \"aiGenerate\";\n  const functionCall = isNonEmptyString(req?.functionCall) ? String(req.functionCall) : \"\";\n  const reasoningEffort = provider === PROVIDERS.OPENAI ? await getOpenAIReasoningEffort() : \"\";\n  const geminiReasoningEffort = provider === PROVIDERS.GEMINI ? await getGeminiReasoningEffort() : \"\";\n  const reasoningEffortLabel = provider === PROVIDERS.OPENAI ? reasoningEffort : geminiReasoningEffort;\n\n  if (!apiKey) {\n    logRequest({\n      fn: fnName,\n      provider,\n      model,\n      ok: false,\n      ms: nowMs() - start,\n      cache: false,\n      reasoningEffort: reasoningEffortLabel || undefined,\n      call: functionCall || undefined,\n      code: \"API_KEY_MISSING\",\n      message: `Cl API manquante pour le fournisseur ${provider}.`\n    });\n    return {\n      ok: false,\n      provider,\n      model,\n      code: \"API_KEY_MISSING\",\n      message: `Cl API manquante pour le fournisseur ${provider}.`\n    };\n  }\n\n  const user = String(req?.user || \"\");\n  const system = isNonEmptyString(req?.system) ? String(req.system) : \"\";\n\n  const webSearch = normalizeBoolean(req?.webSearch, false);\n  const timeoutMs = normalizeTimeoutMs(req?.timeoutMs);\n  const retry = normalizeRetry(req?.retry);\n\n  const cfgMax = await getMaxOutputTokens();\n  const maxOutputTokens = normalizeMaxOutputTokens(req?.maxOutputTokens ?? cfgMax);\n  const thinkingConfig = provider === PROVIDERS.GEMINI ? resolveGeminiThinkingConfig(model, geminiReasoningEffort) : null;\n\n  const cacheEnabled = normalizeBoolean(req?.cache, DEFAULTS.cache);\n  const ttlSec = clampInt(\n    req?.cacheTtlSec ?? (webSearch ? DEFAULTS.webCacheTtlSec : DEFAULTS.cacheTtlSec),\n    1,\n    365 * 24 * 3600,\n    webSearch ? DEFAULTS.webCacheTtlSec : DEFAULTS.cacheTtlSec\n  );\n\n  await syncCacheClearMarker();\n\n  // Cache key (no temperature anywhere)\n  const cacheKeyPayload = {\n    v: 3,\n    provider,\n    model,\n    maxOutputTokens,\n    reasoningEffort,\n    geminiReasoningEffort,\n    webSearch,\n    system,\n    user,\n    responseMimeType: req?.responseMimeType || \"\",\n    responseJsonSchema: req?.responseJsonSchema || null\n  };\n\n  const cacheKey = await hashKey(cacheKeyPayload);\n\n  if (cacheEnabled) {\n    const cached = CACHE.get(cacheKey);\n    if (cached) {\n      const formula = getFormulaForLog(fnName, cached?.text);\n      logRequest({\n        fn: fnName,\n        provider,\n        model,\n        ok: true,\n        ms: nowMs() - start,\n        cache: true,\n        cacheKind: \"memory\",\n        reasoningEffort: reasoningEffortLabel || undefined,\n        call: functionCall || undefined,\n        inputTokens: 0,\n        outputTokens: 0,\n        reasoningTokens: 0,\n        totalTokens: 0,\n        formula: formula || undefined\n      });\n      return { ...cached, cached: true, cacheKind: \"memory\" };\n    }\n    const persisted = await getPersistentCache(cacheKey);\n    if (persisted) {\n      const formula = getFormulaForLog(fnName, persisted?.text);\n      CACHE.set(cacheKey, persisted, ttlSec * 1000);\n      logRequest({\n        fn: fnName,\n        provider,\n        model,\n        ok: true,\n        ms: nowMs() - start,\n        cache: true,\n        cacheKind: \"persistent\",\n        reasoningEffort: reasoningEffortLabel || undefined,\n        call: functionCall || undefined,\n        inputTokens: 0,\n        outputTokens: 0,\n        reasoningTokens: 0,\n        totalTokens: 0,\n        formula: formula || undefined\n      });\n      return { ...persisted, cached: true, cacheKind: \"persistent\" };\n    }\n  }\n\n  if (INFLIGHT.has(cacheKey)) return INFLIGHT.get(cacheKey);\n\n  const p = withConcurrencyLimit(async () => {\n    let attempt = 0;\n    let lastErr = null;\n\n    const callProvider = async (opts) =>\n      provider === PROVIDERS.OPENAI ? callOpenAI(opts) : callGemini(opts);\n\n    while (attempt <= retry) {\n      attempt++;\n      try {\n        const baseOpts = {\n          apiKey,\n          model,\n          system,\n          user,\n          maxOutputTokens,\n          reasoningEffort,\n          thinkingConfig,\n          timeoutMs,\n          webSearch,\n          responseMimeType: req?.responseMimeType,\n          responseJsonSchema: req?.responseJsonSchema\n        };\n\n        let result = await callProvider(baseOpts);\n\n        if (!result.ok) {\n          let opts = baseOpts;\n\n          // Fallback #1: if web search fails, retry without tools.\n          if (opts.webSearch) {\n            const shouldRetryNoWeb =\n              looksLikeWebSearchUnsupported(result.message) || result.code === \"API_ERROR\" || result.code === \"EMPTY_RESPONSE\";\n            if (shouldRetryNoWeb) {\n              opts = { ...opts, webSearch: false };\n              result = await callProvider(opts);\n            }\n          }\n\n          // Fallback #2: if structured output fails, retry without schema/responseMimeType.\n          const wantsStructured = opts.responseMimeType || opts.responseJsonSchema;\n          if (!result.ok && wantsStructured) {\n            const shouldRetryPlainJson =\n              looksLikeStructuredOutputUnsupported(result.message) ||\n              result.code === \"API_ERROR\" ||\n              result.code === \"EMPTY_RESPONSE\";\n            if (shouldRetryPlainJson) {\n              opts = {\n                ...opts,\n                responseMimeType: undefined,\n                responseJsonSchema: undefined,\n                system: ensureJsonInstruction(opts.system)\n              };\n              result = await callProvider(opts);\n            }\n          }\n        }\n\n        // Log (best-effort)\n        const usage = normalizeUsage(result?.usage);\n        const formula = result.ok ? getFormulaForLog(fnName, result.text) : \"\";\n        logRequest({\n          fn: fnName,\n          provider,\n          model,\n          ok: result.ok,\n          ms: nowMs() - start,\n          attempt,\n          cache: false,\n          reasoningEffort: reasoningEffortLabel || undefined,\n          call: functionCall || undefined,\n          inputTokens: usage.inputTokens,\n          outputTokens: usage.outputTokens,\n          reasoningTokens: usage.reasoningTokens,\n          cachedInputTokens: usage.cachedInputTokens,\n          totalTokens: usage.totalTokens,\n          code: result.code,\n          message: result.message,\n          formula: formula || undefined\n        });\n\n        if (result.ok && cacheEnabled) {\n          CACHE.set(cacheKey, result, ttlSec * 1000);\n          await setPersistentCache(cacheKey, result, ttlSec * 1000, { provider, model });\n        }\n\n        return result;\n      } catch (e) {\n        lastErr = e;\n        if (attempt <= retry) await sleep(250 * attempt);\n      }\n    }\n\n    const msg = lastErr?.message ? String(lastErr.message) : \"Erreur inconnue.\";\n    logRequest({\n      fn: fnName,\n      provider,\n      model,\n      ok: false,\n      ms: nowMs() - start,\n      cache: false,\n      reasoningEffort: reasoningEffortLabel || undefined,\n      call: functionCall || undefined,\n      code: \"API_ERROR\",\n      message: msg\n    });\n    return { ok: false, provider, model, code: \"API_ERROR\", message: msg };\n  });\n\n  INFLIGHT.set(cacheKey, p);\n\n  try {\n    return await p;\n  } finally {\n    INFLIGHT.delete(cacheKey);\n  }\n}\n\n/**\n * Lightweight connectivity test for a provider (used from taskpane and AI.TEST()).\n */\nexport async function aiMinimalTest(providerOverride) {\n  const provider = normalizeProvider(providerOverride) || (await getDefaultProvider());\n  const model = await getModel(provider);\n  const apiKey = await getApiKey(provider);\n\n  if (!apiKey) {\n    return {\n      ok: false,\n      provider,\n      model,\n      code: \"API_KEY_MISSING\",\n      message: `Cl API manquante pour le fournisseur ${provider}.`\n    };\n  }\n\n  // Tiny request\n  return await aiGenerate({\n    provider,\n    system: \"You are a test endpoint. Reply with exactly: OK\",\n    user: \"OK\",\n    maxOutputTokens: 500,\n    cache: false,\n    webSearch: false,\n    functionName: \"AI.MINIMAL_TEST\"\n  });\n}\n\n// ---- Provider: Gemini (Google Generative Language API) ----\n\nfunction geminiEndpoint(model, apiKey) {\n  return `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(model)}:generateContent?key=${encodeURIComponent(apiKey)}`;\n}\n\nasync function callGemini({\n  apiKey,\n  model,\n  system,\n  user,\n  maxOutputTokens,\n  thinkingConfig,\n  timeoutMs,\n  webSearch,\n  responseMimeType,\n  responseJsonSchema\n}) {\n  const url = geminiEndpoint(model, apiKey);\n\n  const body = {\n    contents: [{ role: \"user\", parts: [{ text: user }] }],\n    generationConfig: {\n      maxOutputTokens\n    }\n  };\n\n  if (thinkingConfig && typeof thinkingConfig === \"object\") {\n    body.generationConfig.thinkingConfig = thinkingConfig;\n  }\n\n  if (isNonEmptyString(system)) {\n    // API uses lowerCamelCase for this field in JSON representation\n    // Force explicit JSON instruction for robustness\n    const sysText = (responseMimeType === \"application/json\" || responseJsonSchema)\n      ? system + \" You must return valid JSON.\"\n      : system;\n    body.systemInstruction = { role: \"system\", parts: [{ text: sysText }] };\n  }\n\n  // Structured output (JSON) when requested\n  if (responseMimeType) {\n    body.generationConfig.responseMimeType = responseMimeType;\n  }\n  if (responseJsonSchema) {\n    body.generationConfig.responseSchema = responseJsonSchema;\n  }\n\n  // Web grounding tool\n  if (webSearch) {\n    // For REST v1beta, the tool name is usually google_search (snake_case).\n    // Note: Some newer endpoints might respect googleSearch, but snake_case is safer for REST.\n    body.tools = [{ google_search: {} }];\n  }\n\n  const res = await fetchWithTimeout(url, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(body)\n  }, timeoutMs);\n\n  const json = await safeJson(res);\n\n  if (!res.ok) {\n    const msg = extractGeminiError(json) || `Gemini API error (${res.status}).`;\n    return { ok: false, provider: PROVIDERS.GEMINI, model, code: \"API_ERROR\", message: msg };\n  }\n\n  const text = extractGeminiText(json);\n  const sources = extractGeminiSources(json);\n  const usage = extractGeminiUsage(json);\n\n  if (!isNonEmptyString(text)) {\n    return { ok: false, provider: PROVIDERS.GEMINI, model, code: \"EMPTY_RESPONSE\", message: \"Rponse vide de Gemini.\" };\n  }\n\n  return { ok: true, provider: PROVIDERS.GEMINI, model, text: text.trim(), sources, usage };\n}\n\nfunction extractGeminiText(json) {\n  try {\n    const c = json?.candidates?.[0];\n    const parts = c?.content?.parts;\n    if (Array.isArray(parts)) {\n      return parts.map((p) => p?.text || \"\").join(\"\");\n    }\n    return \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nfunction extractGeminiError(json) {\n  try {\n    const msg = json?.error?.message;\n    return msg ? String(msg) : \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nfunction extractGeminiSources(json) {\n  try {\n    const c = json?.candidates?.[0];\n    const md = c?.groundingMetadata;\n    const chunks = md?.groundingChunks;\n    if (!Array.isArray(chunks)) return [];\n\n    const out = [];\n    for (const ch of chunks) {\n      const web = ch?.web;\n      if (!web?.uri) continue;\n      out.push({ title: web?.title || \"\", url: web.uri });\n    }\n\n    return dedupeSources(out);\n  } catch {\n    return [];\n  }\n}\n\n// ---- Provider: OpenAI (Responses API) ----\n\nasync function callOpenAI({\n  apiKey,\n  model,\n  system,\n  user,\n  maxOutputTokens,\n  reasoningEffort,\n  timeoutMs,\n  webSearch,\n  responseMimeType,\n  responseJsonSchema\n}) {\n  const url = \"https://api.openai.com/v1/responses\";\n\n  const body = {\n    model,\n    input: user, // Responses API uses 'input' (string or array of objects)\n    max_output_tokens: maxOutputTokens,\n    store: false\n  };\n\n  if (isNonEmptyString(reasoningEffort)) {\n    body.reasoning = { effort: reasoningEffort };\n  }\n\n  // System prompt\n  if (isNonEmptyString(system)) {\n    const sysText = (responseMimeType === \"application/json\" || responseJsonSchema)\n      ? system + \" You must return valid JSON.\"\n      : system;\n    body.instructions = sysText;\n  }\n\n  // Structured output (JSON)\n  // - If a JSON schema is provided: use json_schema strict mode.\n  // - Else if responseMimeType is JSON: request a json_object.\n  if (responseJsonSchema) {\n    // For GPT-5 Mini / v1/responses, we try to use the most standard way if possible.\n    // If body.text format fails, we rely on the prompt.\n    // We kept the previous implementation but added prompt reinforcement.\n    body.text = {\n      format: {\n        type: \"json_schema\",\n        name: \"excel_ai_schema\",\n        strict: true,\n        schema: responseJsonSchema\n      }\n    };\n  } else if (responseMimeType === \"application/json\") {\n    body.text = { format: { type: \"json_object\" } };\n  }\n\n  // Web search tool\n  if (webSearch) {\n    body.tools = [{ type: \"web_search\" }];\n    body.include = [\"web_search_call.action.sources\"];\n  }\n\n  const res = await fetchWithTimeout(url, {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      Authorization: `Bearer ${apiKey}`\n    },\n    body: JSON.stringify(body)\n  }, timeoutMs);\n\n  const json = await safeJson(res);\n\n  if (!res.ok) {\n    const msg = extractOpenAIError(json) || `OpenAI API error (${res.status}).`;\n    return { ok: false, provider: PROVIDERS.OPENAI, model, code: \"API_ERROR\", message: msg };\n  }\n\n  const text = extractOpenAIText(json);\n  const sources = webSearch ? extractOpenAISources(json) : [];\n  const usage = extractOpenAIUsage(json);\n\n  if (!isNonEmptyString(text)) {\n    return {\n      ok: false,\n      provider: PROVIDERS.OPENAI,\n      model,\n      code: \"EMPTY_RESPONSE\",\n      message: \"Rponse vide d'OpenAI.\"\n    };\n  }\n\n  return { ok: true, provider: PROVIDERS.OPENAI, model, text: text.trim(), sources, usage };\n}\n\nfunction extractOpenAIText(json) {\n  // 1. Try direct output_text (common in simple Responses)\n  try {\n    if (typeof json?.output_text === \"string\" && json.output_text.trim()) {\n      return json.output_text;\n    }\n  } catch {\n    // ignore\n  }\n\n  // 2. Try iterating over 'output' items (complex/agentic responses)\n  try {\n    const out = json?.output;\n    if (Array.isArray(out)) {\n      const texts = [];\n      for (const item of out) {\n        if (typeof item?.text === \"string\" && item.text.trim()) texts.push(item.text);\n        if (typeof item?.output_text === \"string\" && item.output_text.trim()) texts.push(item.output_text);\n        if (item?.type === \"output_text\" && typeof item?.text === \"string\") texts.push(item.text);\n        if (item?.type === \"text\" && typeof item?.text === \"string\") texts.push(item.text);\n\n        // Standard message output\n        if (item?.type === \"message\") {\n          const content = item?.content;\n          if (Array.isArray(content)) {\n            for (const part of content) {\n              if (part?.type === \"text\" && part?.text) texts.push(part.text);\n              if (part?.type === \"output_text\" && part?.text) texts.push(part.text);\n            }\n          } else if (typeof content === \"string\") {\n            texts.push(content);\n          }\n        }\n\n        if (item?.type !== \"message\") {\n          const content = item?.content;\n          if (Array.isArray(content)) {\n            for (const part of content) {\n              if (part?.type === \"text\" && part?.text) texts.push(part.text);\n              if (part?.type === \"output_text\" && part?.text) texts.push(part.text);\n            }\n          } else if (typeof content === \"string\") {\n            texts.push(content);\n          }\n        }\n      }\n      if (texts.length > 0) return texts.join(\"\\n\").trim();\n    }\n  } catch {\n    // ignore\n  }\n\n  // 3. Fallback: Chat Completions style (just in case model acts differently)\n  try {\n    return json?.choices?.[0]?.message?.content || \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nfunction extractOpenAIError(json) {\n  try {\n    const msg = json?.error?.message;\n    return msg ? String(msg) : \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nfunction extractOpenAISources(json) {\n  try {\n    const out = json?.output;\n    if (!Array.isArray(out)) return [];\n\n    const sources = [];\n    for (const item of out) {\n      if (item?.type !== \"web_search_call\") continue;\n      const s = item?.action?.sources;\n      if (!Array.isArray(s)) continue;\n      for (const src of s) {\n        if (!src?.url) continue;\n        sources.push({ title: src?.title || \"\", url: src.url });\n      }\n    }\n\n    return dedupeSources(sources);\n  } catch {\n    return [];\n  }\n}\n\nfunction extractGeminiUsage(json) {\n  try {\n    const u = json?.usageMetadata;\n    if (!u) return null;\n    return {\n      inputTokens: toInt(u?.promptTokenCount),\n      outputTokens: toInt(u?.candidatesTokenCount),\n      reasoningTokens: toInt(u?.thoughtsTokenCount),\n      totalTokens: toInt(u?.totalTokenCount),\n      cachedInputTokens: toInt(u?.cachedContentTokenCount)\n    };\n  } catch {\n    return null;\n  }\n}\n\nfunction extractOpenAIUsage(json) {\n  try {\n    const u = json?.usage;\n    if (!u) return null;\n    const rawOutputTokens = toInt(u?.output_tokens);\n    const reasoningTokens = toInt(u?.output_tokens_details?.reasoning_tokens);\n    const outputTokens = Math.max(0, rawOutputTokens - reasoningTokens);\n    return {\n      inputTokens: toInt(u?.input_tokens),\n      outputTokens,\n      reasoningTokens,\n      totalTokens: toInt(u?.total_tokens),\n      cachedInputTokens: toInt(u?.input_tokens_details?.cached_tokens)\n    };\n  } catch {\n    return null;\n  }\n}\n\nfunction normalizeUsage(usage) {\n  if (!usage || typeof usage !== \"object\") {\n    return { inputTokens: 0, outputTokens: 0, reasoningTokens: 0, totalTokens: 0, cachedInputTokens: 0 };\n  }\n  const inputTokens = toInt(usage.inputTokens);\n  const outputTokens = toInt(usage.outputTokens);\n  const reasoningTokens = toInt(usage.reasoningTokens);\n  const cachedInputTokens = toInt(usage.cachedInputTokens);\n  const reportedTotal = toInt(usage.totalTokens);\n  const computedTotal = inputTokens + outputTokens + reasoningTokens;\n  const totalTokens = Math.max(reportedTotal, computedTotal);\n  return {\n    inputTokens,\n    outputTokens,\n    reasoningTokens,\n    totalTokens,\n    cachedInputTokens\n  };\n}\n\nfunction toInt(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n) || n <= 0) return 0;\n  return Math.floor(n);\n}\n\nexport async function clearAllCaches() {\n  CACHE.clear();\n  await clearPersistentCache();\n}\n\nfunction dedupeSources(list) {\n  const seen = new Set();\n  const out = [];\n  for (const s of list || []) {\n    const url = String(s?.url || \"\").trim();\n    if (!url) continue;\n    const key = url.toLowerCase();\n    if (seen.has(key)) continue;\n    seen.add(key);\n    out.push({ title: String(s?.title || \"\").trim(), url });\n  }\n  return out;\n}\n\n// ---- Helpers: fetch + timeout + JSON parsing ----\n\nasync function fetchWithTimeout(url, options, timeoutMs) {\n  const t = normalizeTimeoutMs(timeoutMs);\n\n  if (typeof AbortController === \"undefined\") {\n    // Basic fetch without cancellation (should be rare in modern Office runtimes)\n    return await fetch(url, options);\n  }\n\n  const ctrl = new AbortController();\n  const id = setTimeout(() => ctrl.abort(), t);\n\n  try {\n    return await fetch(url, { ...options, signal: ctrl.signal });\n  } finally {\n    clearTimeout(id);\n  }\n}\n\nasync function safeJson(res) {\n  try {\n    return await res.json();\n  } catch {\n    return {};\n  }\n}\n","// src/license.js\n// Lemon Squeezy license activation + validation helpers.\n\nimport { getLicense, setLicense, clearLicense } from \"./shared/core\";\n\nconst LS_ACTIVATE_ENDPOINT = \"https://api.lemonsqueezy.com/v1/licenses/activate\";\nconst LS_VALIDATE_ENDPOINT = \"https://api.lemonsqueezy.com/v1/licenses/validate\";\nconst INSTANCE_NAME = \"Neurow Add-in\";\nconst MIN_LICENSE_LENGTH = 5;\n\nfunction normalizeKey(key) {\n  return String(key || \"\").trim();\n}\n\nfunction normalizeExpiresAt(value) {\n  const raw = String(value || \"\").trim();\n  if (!raw) return \"\";\n  const ts = Date.parse(raw);\n  if (!Number.isFinite(ts)) return \"\";\n  return new Date(ts).toISOString();\n}\n\nfunction extractError(data, fallback) {\n  if (!data) return fallback;\n  if (typeof data.error === \"string\" && data.error.trim()) return data.error.trim();\n  if (typeof data.message === \"string\" && data.message.trim()) return data.message.trim();\n  if (Array.isArray(data.errors) && data.errors.length) {\n    const first = data.errors[0] || {};\n    const detail = first.detail || first.title || first.message;\n    if (detail) return String(detail).trim();\n  }\n  return fallback;\n}\n\nasync function postLicense(endpoint, payload) {\n  const formData = new FormData();\n  Object.entries(payload || {}).forEach(([key, value]) => {\n    if (value == null || value === \"\") return;\n    formData.append(key, value);\n  });\n\n  const response = await fetch(endpoint, { method: \"POST\", body: formData });\n  let data = null;\n  try {\n    data = await response.json();\n  } catch {\n    data = null;\n  }\n  return { ok: response.ok, status: response.status, data };\n}\n\nfunction buildLicense(key, data, overrides = {}) {\n  const instanceId = overrides.instanceId || data?.instance?.id || data?.instance_id || \"\";\n  const instanceName = data?.instance?.name || overrides.instanceName || INSTANCE_NAME;\n  const expiresAt = normalizeExpiresAt(data?.license_key?.expires_at || overrides.expiresAt);\n  const now = new Date().toISOString();\n\n  return {\n    key,\n    instanceId,\n    instanceName,\n    expiresAt,\n    valid: true,\n    activatedAt: overrides.activatedAt || now,\n    lastCheckedAt: now\n  };\n}\n\nfunction normalizeLicense(raw) {\n  if (!raw || typeof raw !== \"object\") return null;\n  const key = normalizeKey(raw.key);\n  if (!key) return null;\n\n  return {\n    key,\n    instanceId: String(raw.instanceId || \"\").trim(),\n    instanceName: String(raw.instanceName || INSTANCE_NAME).trim(),\n    expiresAt: normalizeExpiresAt(raw.expiresAt),\n    valid: raw.valid !== false,\n    activatedAt: String(raw.activatedAt || \"\").trim(),\n    lastCheckedAt: String(raw.lastCheckedAt || \"\").trim()\n  };\n}\n\nexport async function getStoredLicense() {\n  const stored = await getLicense();\n  return normalizeLicense(stored);\n}\n\nexport async function saveStoredLicense(license) {\n  const normalized = normalizeLicense(license);\n  if (!normalized) {\n    await clearLicense();\n    return null;\n  }\n  await setLicense(normalized);\n  return normalized;\n}\n\nexport async function clearStoredLicense() {\n  await clearLicense();\n}\n\nexport function isLicenseValid(license) {\n  if (!license || !license.key) return false;\n  if (license.valid === false) return false;\n  if (license.expiresAt) {\n    const ts = Date.parse(license.expiresAt);\n    if (Number.isFinite(ts) && ts <= Date.now()) return false;\n  }\n  return true;\n}\n\nexport async function hasValidLicense() {\n  const stored = await getStoredLicense();\n  return isLicenseValid(stored);\n}\n\nexport async function activateLicense(key, options = {}) {\n  const trimmed = normalizeKey(key);\n  if (!trimmed || trimmed.length < MIN_LICENSE_LENGTH) {\n    return { success: false, error: \"Cle trop courte\" };\n  }\n\n  const stored = await getStoredLicense();\n  if (!options.force && stored && stored.key === trimmed && isLicenseValid(stored)) {\n    return { success: true, license: stored, cached: true };\n  }\n\n  try {\n    const { ok, status, data } = await postLicense(LS_ACTIVATE_ENDPOINT, {\n      license_key: trimmed,\n      instance_name: INSTANCE_NAME\n    });\n\n    if (!ok) {\n      return { success: false, error: extractError(data, `Erreur API (${status})`) };\n    }\n\n    if (data?.activated) {\n      const license = buildLicense(trimmed, data, { activatedAt: stored?.activatedAt });\n      await setLicense(license);\n      return { success: true, license };\n    }\n\n    return { success: false, error: extractError(data, \"Cle invalide\") };\n  } catch {\n    return { success: false, error: \"Erreur de connexion internet\" };\n  }\n}\n\nexport async function validateLicense(key, options = {}) {\n  const trimmed = normalizeKey(key);\n  if (!trimmed || trimmed.length < MIN_LICENSE_LENGTH) {\n    return { success: false, error: \"Cle trop courte\" };\n  }\n\n  const stored = await getStoredLicense();\n  const instanceId = options.instanceId || stored?.instanceId || \"\";\n\n  try {\n    const { ok, status, data } = await postLicense(LS_VALIDATE_ENDPOINT, {\n      license_key: trimmed,\n      instance_id: instanceId || undefined\n    });\n\n    if (!ok) {\n      return { success: false, error: extractError(data, `Erreur API (${status})`) };\n    }\n\n    if (data?.valid) {\n      const license = buildLicense(trimmed, data, { instanceId, activatedAt: stored?.activatedAt });\n      return { success: true, license };\n    }\n\n    return { success: false, error: extractError(data, \"Cle invalide\") };\n  } catch {\n    return { success: false, error: \"Erreur de connexion internet\" };\n  }\n}\n","// src/taskpane/taskpane.js\n// Taskpane logic: provider selection + keys/models + shared max tokens.\n//\n// Requirements implemented:\n// - Default provider selection only in panel (not in formulas)\n// - Two tabs: Gemini and OpenAI\n// - Single max output tokens setting shared by both providers\n// - No temperature/top-p controls\n\nimport {\n  PROVIDERS,\n  DEFAULTS,\n  storageBackendName,\n  getDefaultProvider,\n  setDefaultProvider,\n  getMaxOutputTokens,\n  setMaxOutputTokens,\n  getOnboardingSeen,\n  setOnboardingSeen,\n  getSectionOrder,\n  setSectionOrder,\n  getHiddenSections,\n  setHiddenSections,\n  getApiKey,\n  setApiKey,\n  clearApiKey,\n  getModel,\n  setModel,\n  getGeminiReasoningEffort,\n  setGeminiReasoningEffort,\n  getOpenAIReasoningEffort,\n  setOpenAIReasoningEffort,\n  getRequestLog,\n  clearRequestLog,\n  getPersistentCacheStats\n} from \"../shared/core\";\n\nimport { aiMinimalTest, clearAllCaches } from \"../shared/providers\";\n\nimport {\n  activateLicense,\n  validateLicense,\n  getStoredLicense,\n  saveStoredLicense,\n  clearStoredLicense,\n  isLicenseValid\n} from \"../license\";\n\nfunction el(id) {\n  return document.getElementById(id);\n}\n\nfunction setStatus(line, detailsObj) {\n  el(\"statusLine\").textContent = line || \"\";\n  if (detailsObj) {\n    try {\n      el(\"statusDetails\").textContent = JSON.stringify(detailsObj, null, 2);\n    } catch {\n      el(\"statusDetails\").textContent = String(detailsObj);\n    }\n  } else {\n    el(\"statusDetails\").textContent = \"\";\n  }\n}\n\nfunction formatNumber(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return \"0\";\n  return Math.round(n).toLocaleString(\"en-US\");\n}\n\nconst CURRENCY_SYMBOL = \"\";\nconst COST_ICON = \"$\";\nconst REASON_ICON = \"\\uD83E\\uDDE0\";\nconst TOKEN_IN_ICON = \"IN\";\nconst TOKEN_REASON_ICON = \"REF\";\nconst TOKEN_OUT_ICON = \"OUT\";\nconst LICENSE_PLACEHOLDER = \"AAAA-BBBB-CCCC-DDDD\";\n\nconst FAVORITE_ICON = \"\\u2605\";\n\nfunction formatCost(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return `${CURRENCY_SYMBOL}0.0000`;\n  return `${CURRENCY_SYMBOL}${n.toFixed(4)}`;\n}\n\nfunction formatDuration(ms) {\n  const n = Number(ms);\n  if (!Number.isFinite(n)) return \"0.00s\";\n  return `${(n / 1000).toFixed(2)}s`;\n}\n\nfunction formatTime(ts) {\n  try {\n    const d = new Date(ts);\n    return d.toLocaleTimeString(\"fr-FR\", { hour: \"2-digit\", minute: \"2-digit\" });\n  } catch {\n    return \"--:--\";\n  }\n}\n\nfunction formatDate(ts) {\n  try {\n    const d = new Date(ts);\n    return d.toLocaleDateString(\"fr-FR\", { year: \"numeric\", month: \"short\", day: \"2-digit\" });\n  } catch {\n    return \"\";\n  }\n}\n\nfunction formatBytes(bytes) {\n  const n = Number(bytes);\n  if (!Number.isFinite(n) || n <= 0) return \"0 KB\";\n  if (n < 1024) return `${n} B`;\n  if (n < 1024 * 1024) return `${(n / 1024).toFixed(1)} KB`;\n  return `${(n / (1024 * 1024)).toFixed(2)} MB`;\n}\n\nfunction getSectionKey(section) {\n  return String(section?.dataset?.section || \"\").trim();\n}\n\nfunction getSectionTitle(section) {\n  const label = section?.dataset?.sectionTitle;\n  if (label) return label;\n  const title = section?.querySelector?.(\".card__title\");\n  return title ? title.textContent.trim() : getSectionKey(section);\n}\n\nfunction isSectionLocked(section) {\n  return section?.dataset?.sectionLocked === \"true\";\n}\n\nfunction normalizeSectionOrder(storedOrder, keysInDom) {\n  const order = [];\n  const seen = new Set();\n  if (Array.isArray(storedOrder)) {\n    for (const key of storedOrder) {\n      if (!key || seen.has(key) || !sectionElements.has(key)) continue;\n      seen.add(key);\n      order.push(key);\n    }\n  }\n  for (const key of keysInDom) {\n    if (!key || seen.has(key)) continue;\n    seen.add(key);\n    order.push(key);\n  }\n  return order;\n}\n\nfunction applySectionOrder(order) {\n  if (!sectionMain) sectionMain = document.querySelector(\".app__main\");\n  if (!sectionMain) return;\n  const settingsCard = document.querySelector(SECTION_SETTINGS_SELECTOR);\n  for (const key of order) {\n    const section = sectionElements.get(key);\n    if (!section) continue;\n    if (settingsCard) sectionMain.insertBefore(section, settingsCard);\n    else sectionMain.appendChild(section);\n  }\n}\n\nfunction applySectionVisibility(hidden) {\n  sectionElements.forEach((section, key) => {\n    const locked = isSectionLocked(section);\n    const shouldHide = hidden.has(key) && !locked;\n    section.classList.toggle(SECTION_HIDDEN_CLASS, shouldHide);\n  });\n}\n\nfunction pruneHiddenSections() {\n  let changed = false;\n  for (const key of Array.from(hiddenSections)) {\n    const section = sectionElements.get(key);\n    if (!section || isSectionLocked(section)) {\n      hiddenSections.delete(key);\n      changed = true;\n    }\n  }\n  if (changed) void setHiddenSections(Array.from(hiddenSections));\n}\n\nfunction updateSectionOrder(nextOrder, options = {}) {\n  const { persist = true } = options;\n  sectionOrder = nextOrder.slice();\n  applySectionOrder(sectionOrder);\n  renderSectionManager();\n  if (persist) void setSectionOrder(sectionOrder);\n}\n\nfunction resetSectionOrder() {\n  if (!defaultSectionOrder.length) return;\n  updateSectionOrder(defaultSectionOrder);\n}\n\nfunction updateHiddenSections(nextHidden, options = {}) {\n  const { persist = true } = options;\n  hiddenSections = new Set(nextHidden);\n  pruneHiddenSections();\n  applySectionVisibility(hiddenSections);\n  renderSectionManager();\n  if (persist) void setHiddenSections(Array.from(hiddenSections));\n  updateOnboardingVisibility();\n}\n\nfunction moveSection(key, delta) {\n  const idx = sectionOrder.indexOf(key);\n  if (idx < 0) return;\n  const nextIdx = idx + delta;\n  if (nextIdx < 0 || nextIdx >= sectionOrder.length) return;\n  const next = sectionOrder.slice();\n  next.splice(idx, 1);\n  next.splice(nextIdx, 0, key);\n  updateSectionOrder(next);\n}\n\nfunction reorderSectionList(order, draggedKey, targetKey, before) {\n  const next = order.filter((key) => key !== draggedKey);\n  const targetIndex = next.indexOf(targetKey);\n  if (targetIndex < 0) {\n    next.push(draggedKey);\n    return next;\n  }\n  const insertIndex = before ? targetIndex : targetIndex + 1;\n  next.splice(insertIndex, 0, draggedKey);\n  return next;\n}\n\nfunction moveSectionToEnd(order, key) {\n  const next = order.filter((item) => item !== key);\n  next.push(key);\n  return next;\n}\n\nfunction clearDropIndicators(list) {\n  list.querySelectorAll(\".section-row\").forEach((row) => {\n    row.classList.remove(\"is-drop-before\", \"is-drop-after\");\n  });\n}\n\nfunction clearDragState(list) {\n  list.querySelectorAll(\".section-row\").forEach((row) => {\n    row.classList.remove(\"is-drop-before\", \"is-drop-after\", \"is-dragging\");\n  });\n}\n\nfunction renderSectionManager() {\n  const list = el(\"sectionManagerList\");\n  if (!list) return;\n  list.innerHTML = \"\";\n\n  const order = sectionOrder.length ? sectionOrder : Array.from(sectionElements.keys());\n  order.forEach((key, index) => {\n    const section = sectionElements.get(key);\n    if (!section) return;\n\n    const label = getSectionTitle(section);\n    const locked = isSectionLocked(section);\n    const visible = !hiddenSections.has(key) || locked;\n\n    const row = document.createElement(\"div\");\n    row.className = \"section-row\";\n    row.dataset.sectionKey = key;\n    row.setAttribute(\"role\", \"listitem\");\n\n    const handle = document.createElement(\"button\");\n    handle.type = \"button\";\n    handle.className = \"section-row__handle\";\n    handle.draggable = true;\n    handle.setAttribute(\"title\", \"Glisser pour dplacer\");\n    handle.setAttribute(\"aria-label\", `Dplacer ${label}`);\n\n    const labelEl = document.createElement(\"div\");\n    labelEl.className = \"section-row__label\";\n    labelEl.textContent = label;\n\n    const controls = document.createElement(\"div\");\n    controls.className = \"section-row__controls\";\n\n    const upBtn = document.createElement(\"button\");\n    upBtn.type = \"button\";\n    upBtn.className = \"move-btn move-btn--up\";\n    upBtn.disabled = index === 0;\n    upBtn.setAttribute(\"title\", \"Monter\");\n    upBtn.setAttribute(\"aria-label\", `Monter ${label}`);\n    upBtn.addEventListener(\"click\", () => moveSection(key, -1));\n\n    const downBtn = document.createElement(\"button\");\n    downBtn.type = \"button\";\n    downBtn.className = \"move-btn move-btn--down\";\n    downBtn.disabled = index === order.length - 1;\n    downBtn.setAttribute(\"title\", \"Descendre\");\n    downBtn.setAttribute(\"aria-label\", `Descendre ${label}`);\n    downBtn.addEventListener(\"click\", () => moveSection(key, 1));\n\n    const toggleWrap = document.createElement(\"label\");\n    toggleWrap.className = \"visibility-toggle\";\n    toggleWrap.setAttribute(\"title\", locked ? \"Toujours visible\" : visible ? \"Masquer\" : \"Afficher\");\n    const toggleInput = document.createElement(\"input\");\n    toggleInput.type = \"checkbox\";\n    toggleInput.checked = visible;\n    toggleInput.disabled = locked;\n    toggleInput.setAttribute(\"aria-label\", locked ? `${label} toujours visible` : `Afficher ${label}`);\n    const toggleSlider = document.createElement(\"span\");\n    toggleSlider.className = \"visibility-toggle__slider\";\n    toggleWrap.appendChild(toggleInput);\n    toggleWrap.appendChild(toggleSlider);\n    toggleInput.addEventListener(\"change\", () => {\n      if (locked) return;\n      if (toggleInput.checked) hiddenSections.delete(key);\n      else hiddenSections.add(key);\n      applySectionVisibility(hiddenSections);\n      void setHiddenSections(Array.from(hiddenSections));\n      renderSectionManager();\n    });\n\n    controls.appendChild(upBtn);\n    controls.appendChild(downBtn);\n    if (locked) {\n      const lockTag = document.createElement(\"span\");\n      lockTag.className = \"section-row__lock\";\n      lockTag.textContent = \"Fixe\";\n      lockTag.setAttribute(\"title\", \"Toujours visible\");\n      controls.appendChild(lockTag);\n    }\n    controls.appendChild(toggleWrap);\n\n    row.appendChild(handle);\n    row.appendChild(labelEl);\n    row.appendChild(controls);\n    list.appendChild(row);\n  });\n}\n\nfunction initSectionDrag() {\n  const list = el(\"sectionManagerList\");\n  if (!list) return;\n\n  list.addEventListener(\"dragstart\", (event) => {\n    const handle = event.target.closest(\".section-row__handle\");\n    if (!handle) return;\n    const row = handle.closest(\".section-row\");\n    if (!row) return;\n    draggingSectionKey = row.dataset.sectionKey || \"\";\n    row.classList.add(\"is-dragging\");\n    if (event.dataTransfer) {\n      event.dataTransfer.effectAllowed = \"move\";\n      event.dataTransfer.setData(\"text/plain\", draggingSectionKey);\n    }\n  });\n\n  list.addEventListener(\"dragover\", (event) => {\n    if (!draggingSectionKey) return;\n    event.preventDefault();\n    const row = event.target.closest(\".section-row\");\n    if (!row || row.dataset.sectionKey === draggingSectionKey) return;\n    clearDropIndicators(list);\n    const rect = row.getBoundingClientRect();\n    const before = event.clientY < rect.top + rect.height / 2;\n    row.classList.toggle(\"is-drop-before\", before);\n    row.classList.toggle(\"is-drop-after\", !before);\n  });\n\n  list.addEventListener(\"dragleave\", (event) => {\n    const row = event.target.closest(\".section-row\");\n    if (!row) return;\n    row.classList.remove(\"is-drop-before\", \"is-drop-after\");\n  });\n\n  list.addEventListener(\"drop\", (event) => {\n    if (!draggingSectionKey) return;\n    event.preventDefault();\n    const row = event.target.closest(\".section-row\");\n    const targetKey = row ? row.dataset.sectionKey || \"\" : \"\";\n    const key = draggingSectionKey;\n    draggingSectionKey = \"\";\n    clearDragState(list);\n\n    let nextOrder = sectionOrder.slice();\n    if (!targetKey) {\n      nextOrder = moveSectionToEnd(nextOrder, key);\n    } else {\n      const rect = row.getBoundingClientRect();\n      const before = event.clientY < rect.top + rect.height / 2;\n      nextOrder = reorderSectionList(nextOrder, key, targetKey, before);\n    }\n    updateSectionOrder(nextOrder);\n  });\n\n  list.addEventListener(\"dragend\", () => {\n    draggingSectionKey = \"\";\n    clearDragState(list);\n  });\n}\n\nasync function initSectionManager() {\n  sectionMain = document.querySelector(\".app__main\");\n  if (!sectionMain) return;\n  const sections = Array.from(sectionMain.querySelectorAll(SECTION_SELECTOR));\n  sectionElements = new Map();\n  sections.forEach((section) => {\n    const key = getSectionKey(section);\n    if (key) sectionElements.set(key, section);\n  });\n\n  const storedOrder = await getSectionOrder();\n  const domKeys = sections.map((section) => getSectionKey(section)).filter(Boolean);\n  defaultSectionOrder = domKeys.slice();\n  sectionOrder = normalizeSectionOrder(storedOrder, domKeys);\n  applySectionOrder(sectionOrder);\n\n  hiddenSections = new Set(await getHiddenSections());\n  pruneHiddenSections();\n  applySectionVisibility(hiddenSections);\n\n  renderSectionManager();\n  initSectionDrag();\n}\n\nconst TOKEN_EXP_MIN = 7;\nconst TOKEN_EXP_MAX = 17;\nconst UNKNOWN_MODEL_LABEL = \"modele inconnu\";\nconst GEMINI_REASONING_LEVELS = [\"auto\", \"minimal\", \"low\", \"medium\", \"high\"];\nconst OPENAI_REASONING_LEVELS = [\"none\", \"minimal\", \"low\", \"medium\", \"high\"];\nconst HELP_SELECTOR = \"[data-help]\";\nconst SECTION_SELECTOR = \"[data-section]\";\nconst SECTION_SETTINGS_SELECTOR = \"[data-section-settings]\";\nconst SECTION_HIDDEN_CLASS = \"is-section-hidden\";\n\nlet keyState = { gemini: \"\", openai: \"\" };\nlet licenseState = null;\nlet licenseEntryChoice = null;\nlet keysLoaded = false;\nlet licenseLoaded = false;\nlet sectionOrder = [];\nlet defaultSectionOrder = [];\nlet hiddenSections = new Set();\nlet sectionElements = new Map();\nlet draggingSectionKey = \"\";\nlet sectionMain = null;\nconst expandedLogKeys = new Set();\n\nconst DEFAULT_MODELS = {\n  gemini: DEFAULTS.geminiModel,\n  openai: DEFAULTS.openaiModel\n};\n\nconst MODEL_CATALOG = {\n  gemini: [\n    {\n      id: \"gemini-3-pro-preview\",\n      label: \"Gemini 3 Pro Preview\",\n      prices: { input: 2, output: 12, cachedInput: 0.2 },\n      costLevel: 3,\n      reasoningLevel: 3,\n      warning: true\n    },\n    {\n      id: \"gemini-3-flash-preview\",\n      label: \"Gemini 3 Flash Preview\",\n      prices: { input: 0.5, output: 3, cachedInput: 0.05 },\n      costLevel: 2,\n      reasoningLevel: 2,\n      recommended: true\n    },\n    {\n      id: \"gemini-2.5-flash-lite\",\n      label: \"Gemini 2.5 Flash Lite\",\n      prices: { input: 0.1, output: 0.4, cachedInput: 0.01 },\n      costLevel: 1,\n      reasoningLevel: 1\n    }\n  ],\n  openai: [\n    {\n      id: \"gpt-5.2\",\n      label: \"GPT-5.2\",\n      prices: { input: 1.75, output: 14, cachedInput: 0.175 },\n      costLevel: 3,\n      reasoningLevel: 3,\n      supportsReasoningNone: true,\n      warning: true\n    },\n    {\n      id: \"gpt-5-mini\",\n      label: \"GPT-5 Mini\",\n      prices: { input: 0.25, output: 2, cachedInput: 0.025 },\n      costLevel: 2,\n      reasoningLevel: 2,\n      recommended: true,\n      supportsReasoningNone: false\n    },\n    {\n      id: \"gpt-5-nano\",\n      label: \"GPT-5 Nano\",\n      prices: { input: 0.05, output: 0.4, cachedInput: 0.005 },\n      costLevel: 1,\n      reasoningLevel: 1,\n      supportsReasoningNone: false\n    }\n  ]\n};\n\nconst MODEL_LOOKUP = {\n  gemini: new Map(MODEL_CATALOG.gemini.map((m) => [m.id.toLowerCase(), m])),\n  openai: new Map(MODEL_CATALOG.openai.map((m) => [m.id.toLowerCase(), m]))\n};\n\nconst PROVIDER_LABELS = {\n  gemini: \"Gemini\",\n  openai: \"OpenAI\"\n};\n\nfunction repeatIcon(icon, level) {\n  const count = Math.max(1, Number(level) || 1);\n  return new Array(count + 1).join(icon);\n}\n\nfunction getModelMeta(provider, model) {\n  const p = String(provider || \"\").toLowerCase();\n  const key = String(model || \"\").trim().toLowerCase();\n  const map = MODEL_LOOKUP[p];\n  if (map && key && map.has(key)) return map.get(key);\n  const fallback = DEFAULT_MODELS[p];\n  if (map && fallback && map.has(fallback.toLowerCase())) return map.get(fallback.toLowerCase());\n  return null;\n}\n\nfunction openaiModelAllowsNone(model) {\n  const key = String(model || \"\").trim().toLowerCase();\n  const meta = MODEL_LOOKUP.openai?.get(key);\n  if (meta && typeof meta.supportsReasoningNone === \"boolean\") return meta.supportsReasoningNone;\n  return true;\n}\n\nfunction getGeminiAllowedReasoningLevels(modelId) {\n  const key = String(modelId || \"\").trim().toLowerCase();\n  if (key.includes(\"gemini-3\") && key.includes(\"flash\")) {\n    return [\"auto\", \"minimal\", \"low\", \"medium\", \"high\"];\n  }\n  if (key.includes(\"gemini-3\")) {\n    return [\"auto\", \"low\", \"high\"];\n  }\n  if (key.includes(\"gemini-2.5\")) {\n    return [\"auto\", \"minimal\", \"low\", \"medium\", \"high\"];\n  }\n  return [\"auto\", \"low\", \"high\"];\n}\n\nfunction coerceReasoningLabel(label, allowed, levels) {\n  if (!label) return allowed[0] || \"\";\n  if (allowed.includes(label)) return label;\n  const idx = levels.indexOf(label);\n  if (idx < 0) return allowed[0] || \"\";\n  let best = allowed[0] || \"\";\n  let bestDist = Number.POSITIVE_INFINITY;\n  for (const option of allowed) {\n    const optIdx = levels.indexOf(option);\n    if (optIdx < 0) continue;\n    const dist = Math.abs(optIdx - idx);\n    if (dist < bestDist) {\n      bestDist = dist;\n      best = option;\n    }\n  }\n  return best;\n}\n\nfunction syncGeminiReasoningEffort(modelId, preferred) {\n  const effortEl = el(\"geminiReasoningEffort\");\n  if (!effortEl) return \"\";\n  const allowed = getGeminiAllowedReasoningLevels(modelId);\n  let label = getReasoningEffortLabel(preferred, GEMINI_REASONING_LEVELS);\n  if (!label) label = GEMINI_REASONING_LEVELS[0];\n  if (!allowed.includes(label)) {\n    if (label === \"minimal\") label = \"low\";\n    if (label === \"medium\") label = \"high\";\n  }\n  label = coerceReasoningLabel(label, allowed, GEMINI_REASONING_LEVELS);\n  const index = GEMINI_REASONING_LEVELS.indexOf(label);\n  effortEl.value = String(index >= 0 ? index : 0);\n  effortEl.setAttribute(\"aria-valuetext\", label);\n  return label;\n}\n\nfunction getReasoningEffortLabel(value, levels = OPENAI_REASONING_LEVELS) {\n  const raw = String(value || \"\").trim().toLowerCase();\n  if (!raw) return \"\";\n  const idx = Number(raw);\n  if (Number.isFinite(idx)) {\n    const clamped = Math.min(levels.length - 1, Math.max(0, Math.round(idx)));\n    return levels[clamped] || \"\";\n  }\n  return raw;\n}\n\nfunction syncOpenAIReasoningEffort(modelId, preferred) {\n  const effortEl = el(\"openaiReasoningEffort\");\n  if (!effortEl) return \"\";\n  const allowNone = openaiModelAllowsNone(modelId);\n  const wrap = effortEl.closest(\".reasoning\");\n  if (wrap) wrap.classList.toggle(\"reasoning--no-none\", !allowNone);\n  effortEl.dataset.allowNone = allowNone ? \"1\" : \"0\";\n\n  const allowed = allowNone ? OPENAI_REASONING_LEVELS : OPENAI_REASONING_LEVELS.slice(1);\n  let next = getReasoningEffortLabel(preferred);\n  if (!allowed.includes(next)) {\n    next = allowed[0] || \"minimal\";\n  }\n  const index = OPENAI_REASONING_LEVELS.indexOf(next);\n  effortEl.value = String(index >= 0 ? index : 0);\n  effortEl.setAttribute(\"aria-valuetext\", next);\n  return next;\n}\n\nfunction formatRate(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return `${CURRENCY_SYMBOL}0`;\n  const decimals = n >= 1 ? 2 : 3;\n  let text = n.toFixed(decimals);\n  text = text.replace(/\\.?0+$/, \"\");\n  return `${CURRENCY_SYMBOL}${text}`;\n}\n\nfunction modelIndicators(meta) {\n  return {\n    cost: repeatIcon(COST_ICON, meta.costLevel),\n    reasoning: repeatIcon(REASON_ICON, meta.reasoningLevel)\n  };\n}\n\nfunction modelOptionLabel(meta) {\n  const indicators = modelIndicators(meta);\n  const favorite = meta.recommended ? `${FAVORITE_ICON} ` : \"\";\n  const warning = meta.warning ? \"! \" : \"\";\n  return `${warning}${favorite}${meta.id} | ${indicators.cost} | ${indicators.reasoning}`;\n}\n\nfunction updateModelWarningBadge(provider, modelId) {\n  const isGemini = provider === PROVIDERS.GEMINI;\n  const selectEl = isGemini ? el(\"geminiModel\") : el(\"openaiModel\");\n  const warningEl = isGemini ? el(\"geminiModelWarning\") : el(\"openaiModelWarning\");\n  if (!selectEl || !warningEl) return;\n  const meta = getModelMeta(provider, modelId || selectEl.value);\n  const show = !!meta?.warning;\n  warningEl.classList.toggle(\"is-hidden\", !show);\n  selectEl.classList.toggle(\"input--warning\", show);\n}\n\nfunction estimateCost(entry) {\n  if (!entry) return 0;\n  const provider = String(entry.provider || \"\").toLowerCase();\n  const meta = getModelMeta(provider, entry.model);\n  if (!meta) return 0;\n\n  const inputTokens = Math.max(0, Number(entry.inputTokens || 0));\n  const outputTokens = Math.max(0, Number(entry.outputTokens || 0));\n  const reasoningTokens = Math.max(0, Number(entry.reasoningTokens || 0));\n  const cachedInputTokens = Math.max(0, Number(entry.cachedInputTokens || 0));\n  const billableOutputTokens = outputTokens + reasoningTokens;\n\n  const cached = Math.min(cachedInputTokens, inputTokens);\n  const uncached = Math.max(0, inputTokens - cached);\n\n  const prices = meta.prices || {};\n  const inputRate = Number(prices.input || 0);\n  const cachedRate = Number(prices.cachedInput ?? prices.input ?? 0);\n  const outputRate = Number(prices.output || 0);\n\n  return (uncached / 1e6) * inputRate + (cached / 1e6) * cachedRate + (billableOutputTokens / 1e6) * outputRate;\n}\n\nfunction normalizeUsageEntry(entry) {\n  return {\n    provider: entry?.provider || \"\",\n    inputTokens: Number(entry?.inputTokens || 0),\n    outputTokens: Number(entry?.outputTokens || 0),\n    reasoningTokens: Number(entry?.reasoningTokens || 0),\n    cachedInputTokens: Number(entry?.cachedInputTokens || 0),\n    totalTokens: Number(entry?.totalTokens || 0),\n    ok: !!entry?.ok,\n    cache: !!entry?.cache,\n    ms: Number(entry?.ms || 0),\n    fn: entry?.fn || \"AI\",\n    model: entry?.model || \"\",\n    ts: Number(entry?.ts || 0),\n    message: entry?.message || \"\",\n    reasoningEffort: entry?.reasoningEffort || \"\",\n    call: entry?.call || \"\",\n    formula: entry?.formula || \"\"\n  };\n}\n\nfunction populateModelSelect(provider, selectEl, currentModel) {\n  if (!selectEl) return;\n  const list = MODEL_CATALOG[provider] || [];\n  const requested = String(currentModel || \"\").trim();\n  const requestedKey = requested.toLowerCase();\n  const fallback = DEFAULT_MODELS[provider] || \"\";\n\n  selectEl.innerHTML = \"\";\n  let matched = false;\n\n  for (const meta of list) {\n    const option = document.createElement(\"option\");\n    option.value = meta.id;\n    option.textContent = modelOptionLabel(meta);\n    if (meta.warning) {\n      option.dataset.warning = \"1\";\n      option.style.color = \"#b03524\";\n      option.style.fontWeight = \"700\";\n    }\n    if (meta.id.toLowerCase() === requestedKey) {\n      option.selected = true;\n      matched = true;\n    }\n    selectEl.appendChild(option);\n  }\n\n  if (requested && !matched) {\n    const option = document.createElement(\"option\");\n    option.value = requested;\n    option.textContent = `${requested} | hors liste`;\n    option.selected = true;\n    selectEl.appendChild(option);\n    return;\n  }\n\n  if (!requested && fallback) {\n    selectEl.value = fallback;\n  }\n}\n\nfunction renderPricingTable() {\n  const gemBody = el(\"pricingTableBodyGemini\");\n  const oaiBody = el(\"pricingTableBodyOpenAI\");\n  if (!gemBody && !oaiBody) return;\n  if (gemBody) gemBody.innerHTML = \"\";\n  if (oaiBody) oaiBody.innerHTML = \"\";\n\n  const renderProvider = (provider, body) => {\n    if (!body) return;\n    const list = MODEL_CATALOG[provider] || [];\n    for (const meta of list) {\n      const row = document.createElement(\"tr\");\n      const indicators = modelIndicators(meta);\n\n      const cellModel = document.createElement(\"td\");\n      cellModel.textContent = meta.id;\n\n      const cellInput = document.createElement(\"td\");\n      cellInput.className = \"pricing-table__col-price\";\n      cellInput.textContent = formatRate(meta.prices?.input);\n\n      const cellOutput = document.createElement(\"td\");\n      cellOutput.className = \"pricing-table__col-price\";\n      cellOutput.textContent = formatRate(meta.prices?.output);\n\n      const cellCost = document.createElement(\"td\");\n      cellCost.className = \"pricing-table__col-icon\";\n      cellCost.textContent = indicators.cost;\n\n      const cellReason = document.createElement(\"td\");\n      cellReason.className = \"pricing-table__col-icon\";\n      cellReason.textContent = indicators.reasoning;\n\n      row.appendChild(cellModel);\n      row.appendChild(cellInput);\n      row.appendChild(cellOutput);\n      row.appendChild(cellCost);\n      row.appendChild(cellReason);\n      body.appendChild(row);\n    }\n  };\n\n  renderProvider(PROVIDERS.GEMINI, gemBody);\n  renderProvider(PROVIDERS.OPENAI, oaiBody);\n}\n\nfunction setModalOpen(id, isOpen) {\n  const modal = el(id);\n  if (!modal) return;\n  modal.classList.toggle(\"is-open\", isOpen);\n  modal.setAttribute(\"aria-hidden\", isOpen ? \"false\" : \"true\");\n}\n\nfunction isModalOpen(id) {\n  const modal = el(id);\n  return !!modal && modal.classList.contains(\"is-open\");\n}\n\nfunction setSettingsModalOpen(isOpen) {\n  setModalOpen(\"settingsModal\", isOpen);\n}\n\nfunction setPricingModalOpen(isOpen) {\n  setModalOpen(\"pricingModal\", isOpen);\n}\n\nfunction setOnboardingModalOpen(isOpen) {\n  setModalOpen(\"onboardingModal\", isOpen);\n}\n\nfunction setOnboardingKeysModalOpen(isOpen) {\n  setModalOpen(\"onboardingKeysModal\", isOpen);\n}\n\nfunction openPricingModal() {\n  renderPricingTable();\n  setPricingModalOpen(true);\n}\n\nfunction closePricingModal() {\n  setPricingModalOpen(false);\n}\n\nfunction setKeyStatus(id, hasKey) {\n  const node = el(id);\n  if (!node) return;\n  const ok = !!hasKey;\n  node.textContent = ok ? \"Cl enregistre\" : \"Cl manquante\";\n  node.classList.toggle(\"key-status--ok\", ok);\n  node.classList.toggle(\"key-status--missing\", !ok);\n}\n\nfunction updateKeyPlaceholders() {\n  const geminiInput = el(\"geminiKey\");\n  const openaiInput = el(\"openaiKey\");\n  if (geminiInput) {\n    geminiInput.placeholder = keyState.gemini ? \"Cl enregistre (laisser vide pour conserver)\" : \"AIza...\";\n  }\n  if (openaiInput) {\n    openaiInput.placeholder = keyState.openai ? \"Cl enregistre (laisser vide pour conserver)\" : \"sk-...\";\n  }\n}\n\nfunction setKeyState(geminiKey, openaiKey) {\n  keyState = {\n    gemini: (geminiKey || \"\").trim(),\n    openai: (openaiKey || \"\").trim()\n  };\n  updateKeyPlaceholders();\n}\n\nfunction hasAnyApiKey() {\n  return !!keyState.gemini || !!keyState.openai;\n}\n\nfunction hasStoredLicense() {\n  return !!(licenseState && licenseState.key && isLicenseValid(licenseState));\n}\n\nfunction updateOnboardingVisibility() {\n  const section = document.querySelector('[data-section=\"onboarding\"]');\n  if (!section) return;\n  if (!licenseLoaded || !keysLoaded) return;\n  const shouldShow = !hasStoredLicense() || !hasAnyApiKey();\n  section.classList.toggle(\"is-hidden\", !shouldShow);\n  if (shouldShow && section.classList.contains(SECTION_HIDDEN_CLASS)) {\n    hiddenSections.delete(\"onboarding\");\n    updateHiddenSections(Array.from(hiddenSections));\n  }\n}\n\nfunction setModelGate(provider, hasKey) {\n  const isGemini = provider === PROVIDERS.GEMINI;\n  const modelEl = el(isGemini ? \"geminiModel\" : \"openaiModel\");\n  const effortEl = el(isGemini ? \"geminiReasoningEffort\" : \"openaiReasoningEffort\");\n  const gateEl = el(isGemini ? \"geminiModelGate\" : \"openaiModelGate\");\n  const disabled = !hasKey;\n  if (modelEl) modelEl.disabled = disabled;\n  if (effortEl) effortEl.disabled = disabled;\n  if (gateEl) gateEl.classList.toggle(\"is-hidden\", !disabled);\n}\n\nfunction updateModelGates() {\n  setModelGate(PROVIDERS.GEMINI, !!keyState.gemini);\n  setModelGate(PROVIDERS.OPENAI, !!keyState.openai);\n}\n\nfunction parseLicenseExpiryMs(expiresAt) {\n  const raw = String(expiresAt || \"\").trim();\n  if (!raw) return 0;\n  const ts = Date.parse(raw);\n  return Number.isFinite(ts) ? ts : 0;\n}\n\nfunction formatLicenseExpiry(expiresAt) {\n  const ts = parseLicenseExpiryMs(expiresAt);\n  if (!ts) return \"\";\n  return formatDate(ts);\n}\n\nfunction licenseStatusSummary(license) {\n  if (!license || !license.key) {\n    return { ok: false, text: \"Aucune licence enregistre\" };\n  }\n\n  if (isLicenseValid(license)) {\n    const expiry = formatLicenseExpiry(license.expiresAt);\n    const suffix = expiry ? `  renouvellement le ${expiry}` : \"\";\n    return { ok: true, text: `Licence active${suffix}` };\n  }\n\n  const expiresAt = parseLicenseExpiryMs(license.expiresAt);\n  const expired = expiresAt && expiresAt <= Date.now();\n  return { ok: false, text: expired ? \"Licence expire\" : \"Licence invalide\" };\n}\n\nfunction setLicenseStatus(node, text, ok) {\n  if (!node) return;\n  node.textContent = text || \"\";\n  node.classList.toggle(\"key-status--ok\", ok);\n  node.classList.toggle(\"key-status--missing\", !ok);\n}\n\nfunction updateLicenseStatusNodes(license) {\n  const summary = licenseStatusSummary(license);\n  setLicenseStatus(el(\"licenseKeyStatus\"), summary.text, summary.ok);\n}\n\nfunction setLicenseEntryVisible(isVisible, options = {}) {\n  const { focus = false, persist = true } = options;\n  const entry = el(\"licenseEntry\");\n  if (!entry) return;\n  entry.classList.toggle(\"is-hidden\", !isVisible);\n  if (persist) licenseEntryChoice = isVisible;\n  const toggle = el(\"licenseRevealBtn\");\n  if (toggle) {\n    toggle.setAttribute(\"aria-expanded\", isVisible ? \"true\" : \"false\");\n    toggle.textContent = isVisible ? \"Masquer la saisie\" : \"J'ai dj une licence\";\n  }\n  if (isVisible && focus) {\n    const input = el(\"licenseKeyInput\");\n    if (input) input.focus();\n  }\n}\n\nfunction updateLicensePlaceholders(license) {\n  const placeholder = license?.key ? \"Cl enregistre (laisser vide pour conserver)\" : LICENSE_PLACEHOLDER;\n  const input = el(\"licenseKeyInput\");\n  if (input) input.placeholder = placeholder;\n}\n\nfunction updateLicenseMeta(license) {\n  const meta = el(\"licenseKeyMeta\");\n  if (!meta) return;\n  if (license && isLicenseValid(license) && license.expiresAt) {\n    const expiry = formatLicenseExpiry(license.expiresAt);\n    meta.textContent = expiry ? `Renouvellement le ${expiry}` : \"Licence active\";\n    return;\n  }\n  if (license && !isLicenseValid(license)) {\n    const expiry = formatLicenseExpiry(license.expiresAt);\n    meta.textContent = expiry ? `Licence expire le ${expiry}` : \"Licence invalide\";\n    return;\n  }\n  meta.textContent = \"Cl reue par email aprs achat (mensuel ou annuel)\";\n}\n\nasync function refreshLicenseUI(options = {}) {\n  const { silent = false } = options;\n  const stored = await getStoredLicense();\n  licenseState = stored;\n  licenseLoaded = true;\n  updateLicenseStatusNodes(stored);\n  const autoVisible = !!(stored && stored.key);\n  const shouldShow = licenseEntryChoice === null ? autoVisible : licenseEntryChoice;\n  setLicenseEntryVisible(shouldShow, { persist: false });\n  updateLicensePlaceholders(stored);\n  updateLicenseMeta(stored);\n  updateOnboardingVisibility();\n  if (!silent && stored && isLicenseValid(stored)) {\n    setStatus(\"Licence active\", { expiresAt: stored.expiresAt || \"n/a\" });\n  }\n}\n\nfunction clampExp(value) {\n  const n = Number(value);\n  if (!Number.isFinite(n)) return TOKEN_EXP_MIN;\n  return Math.min(TOKEN_EXP_MAX, Math.max(TOKEN_EXP_MIN, Math.round(n)));\n}\n\nfunction expToTokens(exp) {\n  return 2 ** clampExp(exp);\n}\n\nfunction tokensToExp(tokens) {\n  const n = Number(tokens);\n  if (!Number.isFinite(n) || n <= 0) return TOKEN_EXP_MIN;\n  return clampExp(Math.log2(n));\n}\n\nfunction setProviderButtons(provider) {\n  const isGemini = provider === PROVIDERS.GEMINI;\n  el(\"providerGemini\").classList.toggle(\"segmented__btn--active\", isGemini);\n  el(\"providerOpenAI\").classList.toggle(\"segmented__btn--active\", !isGemini);\n  el(\"providerGemini\").setAttribute(\"aria-pressed\", isGemini ? \"true\" : \"false\");\n  el(\"providerOpenAI\").setAttribute(\"aria-pressed\", !isGemini ? \"true\" : \"false\");\n}\n\nfunction getSelectedProvider() {\n  const geminiActive = el(\"providerGemini\").classList.contains(\"segmented__btn--active\");\n  return geminiActive ? PROVIDERS.GEMINI : PROVIDERS.OPENAI;\n}\n\nfunction updateMaxTokensValue() {\n  const exp = clampExp(el(\"maxTokensRange\").value);\n  const tokens = expToTokens(exp);\n  el(\"maxTokensValue\").textContent = formatNumber(tokens);\n  return tokens;\n}\n\nfunction activateTab(tab) {\n  const isGemini = tab === \"gemini\";\n  el(\"tabGemini\").classList.toggle(\"tab--active\", isGemini);\n  el(\"tabOpenAI\").classList.toggle(\"tab--active\", !isGemini);\n\n  el(\"tabGemini\").setAttribute(\"aria-selected\", isGemini ? \"true\" : \"false\");\n  el(\"tabOpenAI\").setAttribute(\"aria-selected\", !isGemini ? \"true\" : \"false\");\n\n  el(\"panelGemini\").classList.toggle(\"tab-panel--active\", isGemini);\n  el(\"panelOpenAI\").classList.toggle(\"tab-panel--active\", !isGemini);\n}\n\nasync function refreshUI(options = {}) {\n  const { preserveKeyInputs = false, silent = false } = options;\n  el(\"storageBackend\").textContent = storageBackendName();\n\n  const [provider, maxTok, gemModel, oaiModel, gemKey, oaiKey, gemReasoningEffort, oaiReasoningEffort] = await Promise.all([\n    getDefaultProvider(),\n    getMaxOutputTokens(),\n    getModel(PROVIDERS.GEMINI),\n    getModel(PROVIDERS.OPENAI),\n    getApiKey(PROVIDERS.GEMINI),\n    getApiKey(PROVIDERS.OPENAI),\n    getGeminiReasoningEffort(),\n    getOpenAIReasoningEffort()\n  ]);\n\n  setProviderButtons(provider);\n\n  const exp = tokensToExp(maxTok);\n  const normalizedTokens = expToTokens(exp);\n  el(\"maxTokensRange\").value = String(exp);\n  el(\"maxTokensValue\").textContent = formatNumber(normalizedTokens);\n  if (normalizedTokens !== maxTok) {\n    await setMaxOutputTokens(normalizedTokens);\n  }\n\n  // Models\n  const geminiModelEl = el(\"geminiModel\");\n  const openaiModelEl = el(\"openaiModel\");\n  populateModelSelect(PROVIDERS.GEMINI, geminiModelEl, gemModel);\n  populateModelSelect(PROVIDERS.OPENAI, openaiModelEl, oaiModel);\n  const selectedGeminiModel = geminiModelEl ? geminiModelEl.value : gemModel;\n  const selectedOpenAIModel = openaiModelEl ? openaiModelEl.value : oaiModel;\n  const safeGeminiEffort = syncGeminiReasoningEffort(selectedGeminiModel, gemReasoningEffort);\n  if (safeGeminiEffort && safeGeminiEffort !== gemReasoningEffort) {\n    await setGeminiReasoningEffort(safeGeminiEffort);\n  }\n  const safeEffort = syncOpenAIReasoningEffort(selectedOpenAIModel, oaiReasoningEffort);\n  const effectiveEffort = safeEffort || oaiReasoningEffort;\n  if (safeEffort && safeEffort !== oaiReasoningEffort) {\n    await setOpenAIReasoningEffort(safeEffort);\n  }\n\n  updateModelWarningBadge(PROVIDERS.GEMINI, selectedGeminiModel);\n  updateModelWarningBadge(PROVIDERS.OPENAI, selectedOpenAIModel);\n\n  // Keys are not displayed back (security / UX). Use placeholder to indicate presence.\n  if (!preserveKeyInputs) {\n    el(\"geminiKey\").value = \"\";\n    el(\"openaiKey\").value = \"\";\n  }\n\n  setKeyState(gemKey, oaiKey);\n  keysLoaded = true;\n\n  setKeyStatus(\"geminiKeyStatus\", gemKey);\n  setKeyStatus(\"openaiKeyStatus\", oaiKey);\n  updateModelGates();\n  updateOnboardingVisibility();\n\n  if (!silent) {\n    setStatus(\"Configuration charge\", {\n      defaultProvider: provider,\n      maxOutputTokens: normalizedTokens,\n      gemini: { key: gemKey ? \"set\" : \"missing\", model: gemModel, reasoningEffort: safeGeminiEffort },\n      openai: { key: oaiKey ? \"set\" : \"missing\", model: oaiModel, reasoningEffort: effectiveEffort }\n    });\n  }\n}\n\nfunction buildBreakdownRow(label, tokens, cost, isSub) {\n  const row = document.createElement(\"div\");\n  row.className = `breakdown__row ${isSub ? \"breakdown__row--sub\" : \"breakdown__row--total\"}`;\n\n  const name = document.createElement(\"div\");\n  name.className = \"breakdown__name\";\n  if (isSub) {\n    const model = document.createElement(\"span\");\n    model.className = \"breakdown__model\";\n    model.textContent = label;\n    name.appendChild(model);\n  } else {\n    name.textContent = label;\n  }\n\n  const tokensEl = document.createElement(\"div\");\n  tokensEl.className = \"breakdown__tokens\";\n  tokensEl.textContent = `${formatNumber(tokens)} tokens`;\n\n  const costEl = document.createElement(\"div\");\n  costEl.className = \"breakdown__cost\";\n  costEl.textContent = formatCost(cost);\n\n  row.appendChild(name);\n  row.appendChild(tokensEl);\n  row.appendChild(costEl);\n  return row;\n}\n\nfunction renderUsageBreakdown(breakdown) {\n  const container = el(\"usageBreakdown\");\n  if (!container) return;\n  container.innerHTML = \"\";\n\n  const providers = [PROVIDERS.GEMINI, PROVIDERS.OPENAI];\n  for (const provider of providers) {\n    const data = breakdown[provider] || { tokens: 0, cost: 0, models: new Map() };\n    container.appendChild(buildBreakdownRow(PROVIDER_LABELS[provider] || provider, data.tokens, data.cost, false));\n\n    const models = Array.from(data.models.values())\n      .filter((model) => (model.tokens || 0) > 0 || (model.cost || 0) > 0)\n      .sort((a, b) => b.tokens - a.tokens || a.label.localeCompare(b.label));\n\n    for (const model of models) {\n      container.appendChild(buildBreakdownRow(model.label, model.tokens, model.cost, true));\n    }\n  }\n}\n\nasync function refreshUsage() {\n  const rawLogs = await getRequestLog({ fresh: true });\n  const logs = rawLogs.map(normalizeUsageEntry).sort((a, b) => b.ts - a.ts);\n\n  const breakdown = {\n    gemini: { tokens: 0, cost: 0, models: new Map() },\n    openai: { tokens: 0, cost: 0, models: new Map() }\n  };\n\n  const total = {\n    inputTokens: 0,\n    reasoningTokens: 0,\n    outputTokens: 0,\n    cachedInputTokens: 0,\n    cost: 0,\n    requests: logs.length,\n    byProvider: {\n      gemini: { tokens: 0, cost: 0 },\n      openai: { tokens: 0, cost: 0 }\n    }\n  };\n\n  for (const entry of logs) {\n    const input = Math.max(0, entry.inputTokens);\n    const reasoning = Math.max(0, entry.reasoningTokens);\n    const output = Math.max(0, entry.outputTokens);\n    const tokens = input + reasoning + output;\n    const cost = estimateCost(entry);\n\n    total.inputTokens += input;\n    total.reasoningTokens += reasoning;\n    total.outputTokens += output;\n    total.cachedInputTokens += Math.max(0, entry.cachedInputTokens || 0);\n    total.cost += cost;\n\n    const provider = String(entry.provider || \"\").toLowerCase();\n    const bucket = breakdown[provider];\n    if (!bucket) continue;\n\n    bucket.tokens += tokens;\n    bucket.cost += cost;\n\n    if (tokens > 0 || cost > 0) {\n      const rawModel = String(entry.model || \"\").trim();\n      const label = rawModel || UNKNOWN_MODEL_LABEL;\n      const key = label.toLowerCase();\n      const modelEntry = bucket.models.get(key) || { label, tokens: 0, cost: 0 };\n      modelEntry.tokens += tokens;\n      modelEntry.cost += cost;\n      bucket.models.set(key, modelEntry);\n    }\n  }\n\n  total.byProvider.gemini.tokens = breakdown.gemini.tokens;\n  total.byProvider.gemini.cost = breakdown.gemini.cost;\n  total.byProvider.openai.tokens = breakdown.openai.tokens;\n  total.byProvider.openai.cost = breakdown.openai.cost;\n\n  el(\"usageTokensTotal\").textContent = formatNumber(total.inputTokens + total.reasoningTokens + total.outputTokens);\n  el(\"usageTokensInTotal\").textContent = formatNumber(total.inputTokens);\n  el(\"usageTokensReasoningTotal\").textContent = formatNumber(total.reasoningTokens);\n  el(\"usageTokensOutTotal\").textContent = formatNumber(total.outputTokens);\n  el(\"usageCostTotal\").textContent = formatCost(total.cost);\n  el(\"usageCostGemini\").textContent = formatCost(total.byProvider.gemini.cost);\n  el(\"usageCostOpenAI\").textContent = formatCost(total.byProvider.openai.cost);\n\n  renderUsageBreakdown(breakdown);\n  renderLogList(logs);\n  drawUsageChart(logs);\n}\n\nfunction getTokenHeatClass(tokensTotal) {\n  const n = Number(tokensTotal || 0);\n  if (n >= 8000) return \"token-heat--extreme\";\n  if (n >= 4000) return \"token-heat--hot\";\n  if (n >= 1500) return \"token-heat--warm\";\n  return \"token-heat--cool\";\n}\n\nfunction logEntryKey(entry) {\n  const formulaText = entry.call || entry.formula || \"\";\n  return [entry.ts || 0, entry.fn || \"\", entry.provider || \"\", entry.model || \"\", formulaText].join(\"|\");\n}\n\nfunction renderLogList(logs) {\n  const list = el(\"logList\");\n  list.innerHTML = \"\";\n\n  if (!logs.length) {\n    const empty = document.createElement(\"div\");\n    empty.className = \"log-item\";\n    empty.textContent = \"Aucune activit enregistre pour le moment\";\n    list.appendChild(empty);\n    return;\n  }\n\n  const buildTokenFlow = (iconText, value) => {\n    const wrap = document.createElement(\"span\");\n    wrap.className = \"token-flow\";\n\n    const icon = document.createElement(\"span\");\n    icon.className = \"token-flow__icon\";\n    icon.textContent = iconText;\n\n    const val = document.createElement(\"span\");\n    val.className = \"token-flow__value\";\n    val.textContent = formatNumber(value);\n\n    wrap.appendChild(icon);\n    wrap.appendChild(val);\n    return wrap;\n  };\n\n  const slice = logs.slice(0, 40);\n  const activeKeys = new Set();\n  for (const entry of slice) {\n    const item = document.createElement(\"div\");\n    const cacheClass = entry.cache ? \" log-item--cache\" : \"\";\n    item.className = `log-item ${entry.ok ? \"log-item--ok\" : \"log-item--error\"}${cacheClass}`;\n\n    const top = document.createElement(\"div\");\n    top.className = \"log-item__top\";\n\n    const title = document.createElement(\"div\");\n    title.className = \"log-item__title\";\n\n    const titleText = document.createElement(\"span\");\n    titleText.className = \"log-item__title-text\";\n    titleText.textContent = entry.fn;\n    title.appendChild(titleText);\n\n    const formulaText = String(entry.call || entry.formula || \"\").trim();\n    let detail = null;\n    if (formulaText) {\n      const entryKey = logEntryKey(entry);\n      activeKeys.add(entryKey);\n      const toggle = document.createElement(\"button\");\n      toggle.className = \"log-item__toggle\";\n      toggle.type = \"button\";\n      toggle.setAttribute(\"aria-expanded\", \"false\");\n      toggle.setAttribute(\"aria-label\", \"Afficher la fonction\");\n\n      const chevron = document.createElement(\"span\");\n      chevron.className = \"log-item__chevron\";\n      toggle.appendChild(chevron);\n\n      const wasExpanded = expandedLogKeys.has(entryKey);\n      if (wasExpanded) {\n        item.classList.add(\"log-item--expanded\");\n        toggle.setAttribute(\"aria-expanded\", \"true\");\n        toggle.setAttribute(\"aria-label\", \"Masquer la fonction\");\n      }\n\n      toggle.addEventListener(\"click\", () => {\n        const isOpen = item.classList.toggle(\"log-item--expanded\");\n        toggle.setAttribute(\"aria-expanded\", isOpen ? \"true\" : \"false\");\n        toggle.setAttribute(\"aria-label\", isOpen ? \"Masquer la fonction\" : \"Afficher la fonction\");\n        if (isOpen) expandedLogKeys.add(entryKey);\n        else expandedLogKeys.delete(entryKey);\n      });\n\n      title.appendChild(toggle);\n\n      detail = document.createElement(\"div\");\n      detail.className = \"log-item__detail\";\n      detail.textContent = formulaText;\n    }\n\n    const tags = document.createElement(\"div\");\n    tags.style.display = \"flex\";\n    tags.style.gap = \"6px\";\n\n    const providerTag = document.createElement(\"span\");\n    providerTag.className = \"tag\";\n    providerTag.textContent = entry.provider ? entry.provider.toUpperCase() : \"\";\n    tags.appendChild(providerTag);\n\n    const statusTag = document.createElement(\"span\");\n    statusTag.className = `tag ${entry.ok ? \"\" : \"tag--error\"}`;\n    statusTag.textContent = entry.ok ? \"OK\" : \"Erreur\";\n    tags.appendChild(statusTag);\n\n    if (entry.cache) {\n      const cacheTag = document.createElement(\"span\");\n      cacheTag.className = \"tag tag--cache\";\n      cacheTag.textContent = \"Cache\";\n      tags.appendChild(cacheTag);\n    }\n\n    top.appendChild(title);\n    top.appendChild(tags);\n\n    const meta = document.createElement(\"div\");\n    meta.className = \"log-item__meta\";\n\n    const tokensTotal = Math.max(0, entry.inputTokens + entry.reasoningTokens + entry.outputTokens);\n    const modelLabel = entry.model ? entry.model : \"\";\n    const effortLabel = entry.reasoningEffort ? entry.reasoningEffort : \"\";\n    const durationLabel = formatDuration(entry.ms);\n    const modelEffortLabel = [modelLabel, effortLabel].filter(Boolean).join(\"  \");\n\n    const right = document.createElement(\"div\");\n    right.className = \"log-item__info\";\n    const baseMeta = `${formatTime(entry.ts)}  ${durationLabel}`;\n    const detailMeta = modelEffortLabel ? `  ${modelEffortLabel}` : \"\";\n    if (!entry.ok && entry.message) {\n      right.textContent = `${baseMeta}${detailMeta}  ${entry.message.slice(0, 60)}`;\n    } else {\n      right.textContent = `${baseMeta}${detailMeta}`;\n    }\n\n    if (entry.cache) {\n      const cacheNote = document.createElement(\"div\");\n      cacheNote.className = \"log-item__cache\";\n      cacheNote.textContent = \"Cache local\";\n      meta.appendChild(cacheNote);\n    } else {\n      const tokensWrap = document.createElement(\"div\");\n      tokensWrap.className = \"log-item__tokens\";\n\n      const tokensLine = document.createElement(\"div\");\n      tokensLine.className = \"log-item__tokens-line\";\n\n      const heatDot = document.createElement(\"span\");\n      heatDot.className = `log-item__heat ${getTokenHeatClass(tokensTotal)}`;\n\n      const tokensTotalEl = document.createElement(\"span\");\n      tokensTotalEl.className = \"log-item__tokens-total\";\n      tokensTotalEl.textContent = `${formatNumber(tokensTotal)} tokens`;\n\n      const tokensDetailEl = document.createElement(\"span\");\n      tokensDetailEl.className = \"log-item__tokens-detail\";\n      tokensDetailEl.appendChild(document.createTextNode(\"(\"));\n      tokensDetailEl.appendChild(buildTokenFlow(TOKEN_IN_ICON, entry.inputTokens));\n      tokensDetailEl.appendChild(document.createTextNode(\" / \"));\n      tokensDetailEl.appendChild(buildTokenFlow(TOKEN_REASON_ICON, entry.reasoningTokens));\n      tokensDetailEl.appendChild(document.createTextNode(\" / \"));\n      tokensDetailEl.appendChild(buildTokenFlow(TOKEN_OUT_ICON, entry.outputTokens));\n      tokensDetailEl.appendChild(document.createTextNode(\")\"));\n\n      tokensLine.appendChild(heatDot);\n      tokensLine.appendChild(tokensTotalEl);\n      tokensLine.appendChild(tokensDetailEl);\n      tokensWrap.appendChild(tokensLine);\n      meta.appendChild(tokensWrap);\n    }\n\n    meta.appendChild(right);\n\n    item.appendChild(top);\n    if (detail) item.appendChild(detail);\n    item.appendChild(meta);\n    list.appendChild(item);\n  }\n\n  expandedLogKeys.forEach((key) => {\n    if (!activeKeys.has(key)) expandedLogKeys.delete(key);\n  });\n}\n\nfunction drawUsageChart(logs) {\n  const canvas = el(\"usageChart\");\n  if (!canvas) return;\n  const ctx = canvas.getContext(\"2d\");\n  if (!ctx) return;\n\n  const width = canvas.clientWidth || 320;\n  const height = canvas.clientHeight || 140;\n  const dpr = window.devicePixelRatio || 1;\n  canvas.width = width * dpr;\n  canvas.height = height * dpr;\n  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);\n\n  const now = Date.now();\n  const start = now - 60 * 60 * 1000;\n  const buckets = new Array(60).fill(0);\n\n  for (const entry of logs) {\n    if (!entry.ts || entry.ts < start) continue;\n    const index = Math.floor((entry.ts - start) / 60000);\n    if (index >= 0 && index < buckets.length) {\n      buckets[index] += Math.max(0, entry.inputTokens + entry.reasoningTokens + entry.outputTokens);\n    }\n  }\n\n  const maxValue = Math.max(...buckets, 1);\n  const styles = getComputedStyle(document.documentElement);\n  const lineColor = styles.getPropertyValue(\"--accent-2\").trim() || \"#2a9d8f\";\n  const gridColor = \"rgba(38, 70, 83, 0.12)\";\n\n  ctx.clearRect(0, 0, width, height);\n\n  ctx.strokeStyle = gridColor;\n  ctx.lineWidth = 1;\n  for (let i = 1; i <= 3; i++) {\n    const y = (height / 4) * i;\n    ctx.beginPath();\n    ctx.moveTo(0, y);\n    ctx.lineTo(width, y);\n    ctx.stroke();\n  }\n\n  ctx.beginPath();\n  buckets.forEach((value, i) => {\n    const x = (i / (buckets.length - 1)) * width;\n    const y = height - (value / maxValue) * (height - 12) - 6;\n    if (i === 0) ctx.moveTo(x, y);\n    else ctx.lineTo(x, y);\n  });\n\n  const gradient = ctx.createLinearGradient(0, 0, 0, height);\n  gradient.addColorStop(0, \"rgba(42, 157, 143, 0.35)\");\n  gradient.addColorStop(1, \"rgba(42, 157, 143, 0.02)\");\n\n  ctx.lineWidth = 2;\n  ctx.strokeStyle = lineColor;\n  ctx.stroke();\n\n  ctx.lineTo(width, height);\n  ctx.lineTo(0, height);\n  ctx.closePath();\n  ctx.fillStyle = gradient;\n  ctx.fill();\n}\n\nasync function refreshCacheStats() {\n  const stats = await getPersistentCacheStats();\n  el(\"cacheEntries\").textContent = formatNumber(stats.entries);\n  el(\"cacheSize\").textContent = formatBytes(stats.sizeBytes);\n  el(\"cacheGeminiEntries\").textContent = formatNumber(stats.providers.gemini.entries);\n  el(\"cacheOpenAIEntries\").textContent = formatNumber(stats.providers.openai.entries);\n}\n\nasync function saveCommon(options = {}) {\n  const { silent = false, message = \"Configuration enregistre\" } = options;\n  const provider = getSelectedProvider();\n  const exp = clampExp(el(\"maxTokensRange\").value);\n  const maxTok = expToTokens(exp);\n\n  const savedProvider = await setDefaultProvider(provider);\n  const savedTokens = await setMaxOutputTokens(maxTok);\n\n  if (!silent) {\n    setStatus(message, { defaultProvider: savedProvider, maxOutputTokens: savedTokens });\n  }\n\n  return { savedProvider, savedTokens };\n}\n\nfunction initCollapsibles() {\n  const toggles = document.querySelectorAll(\"[data-collapse-toggle]\");\n  toggles.forEach((btn) => {\n    const targetId = btn.getAttribute(\"aria-controls\");\n    const container = btn.closest(\"[data-collapsible]\");\n    if (!targetId || !container) return;\n    const body = document.getElementById(targetId);\n    if (!body) return;\n\n    const collapsed = container.classList.contains(\"is-collapsed\");\n    btn.setAttribute(\"aria-expanded\", collapsed ? \"false\" : \"true\");\n\n    btn.addEventListener(\"click\", () => {\n      const nextCollapsed = !container.classList.contains(\"is-collapsed\");\n      container.classList.toggle(\"is-collapsed\", nextCollapsed);\n      btn.setAttribute(\"aria-expanded\", nextCollapsed ? \"false\" : \"true\");\n    });\n  });\n}\n\nfunction openOnboardingSection(options = {}) {\n  const { focusKey = false } = options;\n  const section = document.querySelector('[data-section=\"onboarding\"]');\n  if (!section) return;\n  section.classList.remove(\"is-hidden\");\n  if (section.classList.contains(SECTION_HIDDEN_CLASS)) {\n    hiddenSections.delete(\"onboarding\");\n    updateHiddenSections(Array.from(hiddenSections));\n  }\n  if (section.classList.contains(\"is-collapsed\")) {\n    section.classList.remove(\"is-collapsed\");\n    const toggle = section.querySelector(\"[data-collapse-toggle]\");\n    if (toggle) toggle.setAttribute(\"aria-expanded\", \"true\");\n  }\n  if (typeof section.scrollIntoView === \"function\") {\n    section.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\n  }\n  if (focusKey) {\n    const input = el(\"geminiKey\") || el(\"openaiKey\");\n    if (input) input.focus();\n  }\n}\n\nfunction attachStorageListeners() {\n  let queued = false;\n  const triggerRefresh = () => {\n    if (queued) return;\n    queued = true;\n    setTimeout(async () => {\n      queued = false;\n      await refreshUsage();\n      await refreshCacheStats();\n      await refreshLicenseUI({ silent: true });\n    }, 250);\n  };\n\n  try {\n    if (typeof OfficeRuntime !== \"undefined\" && OfficeRuntime?.storage?.onChanged) {\n      const onChanged = OfficeRuntime.storage.onChanged;\n      if (typeof onChanged.add === \"function\") onChanged.add(() => triggerRefresh());\n      else if (typeof onChanged.addListener === \"function\") onChanged.addListener(() => triggerRefresh());\n      else if (typeof onChanged === \"function\") onChanged(() => triggerRefresh());\n    }\n  } catch {\n    // ignore\n  }\n\n  try {\n    window.addEventListener(\"storage\", () => triggerRefresh());\n  } catch {\n    // ignore\n  }\n}\n\nfunction closeAllHelpPopups() {\n  document.querySelectorAll(HELP_SELECTOR).forEach((help) => {\n    help.classList.remove(\"is-open\");\n    const btn = help.querySelector(\"button\");\n    if (btn) btn.setAttribute(\"aria-expanded\", \"false\");\n  });\n}\n\nfunction initHelpPopups() {\n  document.querySelectorAll(HELP_SELECTOR).forEach((help) => {\n    const btn = help.querySelector(\"button\");\n    if (!btn) return;\n    btn.setAttribute(\"aria-expanded\", \"false\");\n    btn.addEventListener(\"click\", (event) => {\n      event.stopPropagation();\n      const wasOpen = help.classList.contains(\"is-open\");\n      closeAllHelpPopups();\n      const nextOpen = !wasOpen;\n      help.classList.toggle(\"is-open\", nextOpen);\n      btn.setAttribute(\"aria-expanded\", nextOpen ? \"true\" : \"false\");\n    });\n  });\n\n  document.addEventListener(\"click\", (event) => {\n    if (event.target.closest(HELP_SELECTOR)) return;\n    closeAllHelpPopups();\n  });\n}\n\nasync function persistApiKey(provider, value) {\n  const trimmed = (value || \"\").trim();\n  if (!trimmed) return \"\";\n  await setApiKey(provider, trimmed);\n  keyState[provider] = trimmed;\n  keysLoaded = true;\n  updateKeyPlaceholders();\n  updateModelGates();\n  updateOnboardingVisibility();\n  return trimmed;\n}\n\nasync function saveProviderKey(provider, inputEl, statusId) {\n  const key = await persistApiKey(provider, inputEl?.value || \"\");\n  if (!key) return;\n  if (inputEl) inputEl.value = \"\";\n  if (statusId) setKeyStatus(statusId, key);\n  setStatus(\"Cl enregistre\", { provider });\n}\n\nasync function saveProviderModel(provider) {\n  const isGemini = provider === PROVIDERS.GEMINI;\n  const modelEl = isGemini ? el(\"geminiModel\") : el(\"openaiModel\");\n  if (!modelEl) return;\n  const newModel = (modelEl.value || \"\").trim();\n  await setModel(provider, newModel);\n\n  let effort = \"\";\n  if (isGemini) {\n    const effortEl = el(\"geminiReasoningEffort\");\n    const rawEffort = effortEl ? effortEl.value : \"\";\n    effort = syncGeminiReasoningEffort(newModel, rawEffort);\n    if (effort) await setGeminiReasoningEffort(effort);\n  } else {\n    const effortEl = el(\"openaiReasoningEffort\");\n    const rawEffort = effortEl ? effortEl.value : \"\";\n    effort = syncOpenAIReasoningEffort(newModel, rawEffort);\n    if (effort) await setOpenAIReasoningEffort(effort);\n  }\n\n  setStatus(\"Configuration enregistre\", {\n    provider,\n    model: newModel,\n    reasoningEffort: effort || undefined\n  });\n\n  updateModelWarningBadge(provider, newModel);\n}\n\nasync function saveGeminiReasoningEffort() {\n  const modelEl = el(\"geminiModel\");\n  const effortEl = el(\"geminiReasoningEffort\");\n  if (!effortEl) return;\n  const label = syncGeminiReasoningEffort(modelEl ? modelEl.value : \"\", effortEl.value);\n  if (label) await setGeminiReasoningEffort(label);\n  setStatus(\"Effort de raisonnement enregistr\", { geminiReasoningEffort: label });\n}\n\nasync function saveOpenAIReasoningEffort() {\n  const modelEl = el(\"openaiModel\");\n  const effortEl = el(\"openaiReasoningEffort\");\n  if (!effortEl) return;\n  const label = syncOpenAIReasoningEffort(modelEl ? modelEl.value : \"\", effortEl.value);\n  if (label) await setOpenAIReasoningEffort(label);\n  setStatus(\"Effort de raisonnement enregistr\", { openaiReasoningEffort: label });\n}\n\nfunction setInputWarning(inputEl, isWarning) {\n  if (!inputEl) return;\n  inputEl.classList.toggle(\"input--warning\", isWarning);\n}\n\nasync function handleLicenseActivate(inputEl, buttonEl) {\n  const key = (inputEl?.value || \"\").trim();\n  setInputWarning(inputEl, false);\n\n  if (!key) {\n    setInputWarning(inputEl, true);\n    setLicenseStatus(el(\"licenseKeyStatus\"), \"Entrez votre cl de licence\", false);\n    setStatus(\"Cl de licence manquante\", { ok: false });\n    return;\n  }\n\n  const originalLabel = buttonEl?.textContent || \"\";\n  if (buttonEl) {\n    buttonEl.disabled = true;\n    buttonEl.textContent = \"Activation...\";\n  }\n\n  const result = await activateLicense(key);\n\n  if (buttonEl) {\n    buttonEl.disabled = false;\n    buttonEl.textContent = originalLabel;\n  }\n\n  if (result.success) {\n    if (inputEl) inputEl.value = \"\";\n    await refreshLicenseUI({ silent: true });\n    setStatus(\"Licence active\", { expiresAt: result.license?.expiresAt || \"n/a\" });\n    return;\n  }\n\n  const errorText = result.error || \"Cl invalide\";\n  setInputWarning(inputEl, true);\n  setLicenseStatus(el(\"licenseKeyStatus\"), errorText, false);\n  setStatus(\"chec de l'activation\", { error: errorText });\n}\n\nasync function handleLicenseTest() {\n  const inputEl = el(\"licenseKeyInput\");\n  const buttonEl = el(\"licenseTestBtn\");\n  if (!inputEl || !buttonEl) return;\n\n  const inputKey = (inputEl.value || \"\").trim();\n  const stored = licenseState || (await getStoredLicense());\n  const keyToTest = inputKey || stored?.key || \"\";\n\n  setInputWarning(inputEl, false);\n\n  if (!keyToTest) {\n    setInputWarning(inputEl, true);\n    setStatus(\"Cl de licence manquante\", { ok: false });\n    return;\n  }\n\n  const originalLabel = buttonEl.textContent;\n  buttonEl.disabled = true;\n  buttonEl.textContent = \"Test...\";\n\n  const result = await validateLicense(keyToTest);\n\n  buttonEl.disabled = false;\n  buttonEl.textContent = originalLabel;\n\n  if (result.success) {\n    const expiry = result.license?.expiresAt || \"n/a\";\n    if (stored && keyToTest === stored.key) {\n      await saveStoredLicense({\n        ...stored,\n        ...result.license,\n        valid: true,\n        lastCheckedAt: new Date().toISOString()\n      });\n      await refreshLicenseUI({ silent: true });\n    } else if (!stored || !stored.key) {\n      setLicenseStatus(el(\"licenseKeyStatus\"), \"Licence valide (non enregistre)\", true);\n    }\n    if (inputKey && (!stored || keyToTest !== stored.key)) {\n      setStatus(\"Licence valide. Cliquez sur Activer pour l'enregistrer.\", { expiresAt: expiry });\n    } else {\n      setStatus(\"Licence valide\", { expiresAt: expiry });\n    }\n    return;\n  }\n\n  const errorText = result.error || \"Cl invalide\";\n  setStatus(\"Licence invalide\", { error: errorText });\n  if (stored && keyToTest === stored.key) {\n    await saveStoredLicense({\n      ...stored,\n      valid: false,\n      lastCheckedAt: new Date().toISOString()\n    });\n    await refreshLicenseUI({ silent: true });\n  } else if (!stored || !stored.key) {\n    setLicenseStatus(el(\"licenseKeyStatus\"), errorText, false);\n  }\n}\n\nasync function handleLicenseClear() {\n  await clearStoredLicense();\n  licenseState = null;\n  const input = el(\"licenseKeyInput\");\n  if (input) {\n    input.value = \"\";\n    setInputWarning(input, false);\n  }\n  await refreshLicenseUI({ silent: true });\n  setStatus(\"Licence efface\", { ok: true });\n}\n\nasync function saveOnboardingKeys() {\n  const geminiInput = el(\"onboardingGeminiKey\");\n  const openaiInput = el(\"onboardingOpenAIKey\");\n\n  const geminiKey = await persistApiKey(PROVIDERS.GEMINI, geminiInput?.value || \"\");\n  const openaiKey = await persistApiKey(PROVIDERS.OPENAI, openaiInput?.value || \"\");\n\n  if (geminiInput) geminiInput.value = \"\";\n  if (openaiInput) openaiInput.value = \"\";\n\n  setKeyStatus(\"geminiKeyStatus\", keyState.gemini);\n  setKeyStatus(\"openaiKeyStatus\", keyState.openai);\n\n  if (geminiKey || openaiKey) {\n    setStatus(\"Cls enregistres\", { gemini: !!geminiKey, openai: !!openaiKey });\n  }\n\n  if (keyState.gemini || keyState.openai) {\n    setOnboardingKeysModalOpen(false);\n  }\n}\n\nasync function dismissOnboarding(markSeen = true) {\n  if (markSeen) await setOnboardingSeen(true);\n  setOnboardingKeysModalOpen(false);\n  setOnboardingModalOpen(false);\n}\n\nasync function maybeShowOnboarding() {\n  const seen = await getOnboardingSeen();\n  if (seen) return;\n  setOnboardingModalOpen(true);\n}\n\nasync function clearProvider(provider) {\n  await clearApiKey(provider);\n  await refreshUI({ silent: true });\n  setStatus(\"Cl efface\", { provider });\n}\n\nasync function testProvider(provider) {\n  setStatus(\"Test en cours\", { provider });\n\n  const r = await aiMinimalTest(provider);\n  if (r.ok) {\n    setStatus(\"OK\", { provider: r.provider, model: r.model, response: r.text });\n  } else {\n    setStatus(\"chec\", { provider: r.provider, model: r.model, error: r.message, code: r.code });\n  }\n}\n\nasync function safeOfficeReady() {\n  try {\n    if (typeof Office !== \"undefined\" && Office?.onReady) {\n      await Office.onReady();\n    }\n  } catch {\n    // Running outside Office host (e.g., direct browser open)\n  }\n}\n\nasync function init() {\n  initCollapsibles();\n  attachStorageListeners();\n  initHelpPopups();\n  await initSectionManager();\n\n  const settingsButton = el(\"settingsButton\");\n  if (settingsButton) {\n    settingsButton.addEventListener(\"click\", () => setSettingsModalOpen(true));\n  }\n\n  document.querySelectorAll(\"[data-settings-close]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => setSettingsModalOpen(false));\n  });\n\n  const sectionReset = el(\"sectionManagerReset\");\n  if (sectionReset) {\n    sectionReset.addEventListener(\"click\", () => resetSectionOrder());\n  }\n\n  const pricingHelp = el(\"pricingHelp\");\n  if (pricingHelp) {\n    pricingHelp.addEventListener(\"click\", () => openPricingModal());\n  }\n\n  document.querySelectorAll(\"[data-modal-close]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => closePricingModal());\n  });\n\n  document.querySelectorAll(\"[data-onboarding-close]\").forEach((btn) => {\n    btn.addEventListener(\"click\", async () => dismissOnboarding(true));\n  });\n\n  document.querySelectorAll(\"[data-onboarding-keys-close]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => setOnboardingKeysModalOpen(false));\n  });\n\n  const onboardingClose = el(\"onboardingClose\");\n  if (onboardingClose) {\n    onboardingClose.addEventListener(\"click\", async () => dismissOnboarding(true));\n  }\n\n  const onboardingDone = el(\"onboardingDone\");\n  if (onboardingDone) {\n    onboardingDone.addEventListener(\"click\", async () => dismissOnboarding(true));\n  }\n\n  const onboardingKeysButton = el(\"onboardingKeysButton\");\n  if (onboardingKeysButton) {\n    onboardingKeysButton.addEventListener(\"click\", async () => {\n      await dismissOnboarding(true);\n      openOnboardingSection({ focusKey: true });\n    });\n  }\n\n  document.querySelectorAll(\"[data-onboarding-open]\").forEach((btn) => {\n    btn.addEventListener(\"click\", () => {\n      setSettingsModalOpen(false);\n      openOnboardingSection({ focusKey: true });\n    });\n  });\n\n  const onboardingKeysSave = el(\"onboardingKeysSave\");\n  if (onboardingKeysSave) {\n    onboardingKeysSave.addEventListener(\"click\", async () => saveOnboardingKeys());\n  }\n\n  const onboardingKeysLater = el(\"onboardingKeysLater\");\n  if (onboardingKeysLater) {\n    onboardingKeysLater.addEventListener(\"click\", () => setOnboardingKeysModalOpen(false));\n  }\n\n  document.addEventListener(\"keydown\", async (e) => {\n    if (e.key !== \"Escape\") return;\n    closeAllHelpPopups();\n    if (isModalOpen(\"onboardingKeysModal\")) {\n      setOnboardingKeysModalOpen(false);\n      return;\n    }\n    if (isModalOpen(\"onboardingModal\")) {\n      await dismissOnboarding(true);\n      return;\n    }\n    if (isModalOpen(\"settingsModal\")) {\n      setSettingsModalOpen(false);\n      return;\n    }\n    if (isModalOpen(\"pricingModal\")) {\n      closePricingModal();\n    }\n  });\n\n  // Tabs\n  el(\"tabGemini\").addEventListener(\"click\", () => activateTab(\"gemini\"));\n  el(\"tabOpenAI\").addEventListener(\"click\", () => activateTab(\"openai\"));\n\n  // Provider selection buttons\n  el(\"providerGemini\").addEventListener(\"click\", async () => {\n    setProviderButtons(PROVIDERS.GEMINI);\n    await saveCommon();\n  });\n\n  el(\"providerOpenAI\").addEventListener(\"click\", async () => {\n    setProviderButtons(PROVIDERS.OPENAI);\n    await saveCommon();\n  });\n\n  // Max tokens slider\n  el(\"maxTokensRange\").addEventListener(\"input\", () => {\n    updateMaxTokensValue();\n  });\n\n  el(\"maxTokensRange\").addEventListener(\"change\", async () => {\n    await saveCommon();\n  });\n\n  const geminiEffortEl = el(\"geminiReasoningEffort\");\n  if (geminiEffortEl) {\n    geminiEffortEl.addEventListener(\"input\", () => {\n      const modelEl = el(\"geminiModel\");\n      syncGeminiReasoningEffort(modelEl ? modelEl.value : \"\", geminiEffortEl.value);\n    });\n    geminiEffortEl.addEventListener(\"change\", async () => {\n      await saveGeminiReasoningEffort();\n    });\n  }\n\n  const effortEl = el(\"openaiReasoningEffort\");\n  if (effortEl) {\n    effortEl.addEventListener(\"input\", () => {\n      const allowNone = effortEl.dataset.allowNone !== \"0\";\n      let label = getReasoningEffortLabel(effortEl.value);\n      if (!allowNone && label === \"none\") {\n        effortEl.value = \"1\";\n        label = getReasoningEffortLabel(effortEl.value);\n      }\n      effortEl.setAttribute(\"aria-valuetext\", label);\n    });\n    effortEl.addEventListener(\"change\", async () => {\n      await saveOpenAIReasoningEffort();\n    });\n  }\n\n  const geminiModelEl = el(\"geminiModel\");\n  if (geminiModelEl) {\n    geminiModelEl.addEventListener(\"change\", async () => {\n      await saveProviderModel(PROVIDERS.GEMINI);\n    });\n  }\n\n  const openaiModelEl = el(\"openaiModel\");\n  if (openaiModelEl) {\n    openaiModelEl.addEventListener(\"change\", async () => {\n      await saveProviderModel(PROVIDERS.OPENAI);\n    });\n  }\n\n  const geminiKeyEl = el(\"geminiKey\");\n  if (geminiKeyEl) {\n    geminiKeyEl.addEventListener(\"change\", async () => {\n      await saveProviderKey(PROVIDERS.GEMINI, geminiKeyEl, \"geminiKeyStatus\");\n    });\n  }\n\n  const openaiKeyEl = el(\"openaiKey\");\n  if (openaiKeyEl) {\n    openaiKeyEl.addEventListener(\"change\", async () => {\n      await saveProviderKey(PROVIDERS.OPENAI, openaiKeyEl, \"openaiKeyStatus\");\n    });\n  }\n\n  const licenseKeyInput = el(\"licenseKeyInput\");\n  const licenseActivateBtn = el(\"licenseActivateBtn\");\n  const licenseTestBtn = el(\"licenseTestBtn\");\n  const licenseClearBtn = el(\"licenseClearBtn\");\n  const licenseRevealBtn = el(\"licenseRevealBtn\");\n  if (licenseRevealBtn) {\n    licenseRevealBtn.addEventListener(\"click\", () => {\n      const entry = el(\"licenseEntry\");\n      const shouldShow = entry ? entry.classList.contains(\"is-hidden\") : true;\n      setLicenseEntryVisible(shouldShow, { focus: shouldShow });\n    });\n  }\n  if (licenseKeyInput) {\n    licenseKeyInput.addEventListener(\"input\", () => setInputWarning(licenseKeyInput, false));\n    licenseKeyInput.addEventListener(\"keydown\", (event) => {\n      if (event.key !== \"Enter\") return;\n      event.preventDefault();\n      if (licenseActivateBtn) {\n        void handleLicenseActivate(licenseKeyInput, licenseActivateBtn);\n      }\n    });\n  }\n  if (licenseActivateBtn && licenseKeyInput) {\n    licenseActivateBtn.addEventListener(\"click\", async () => {\n      await handleLicenseActivate(licenseKeyInput, licenseActivateBtn);\n    });\n  }\n  if (licenseTestBtn) {\n    licenseTestBtn.addEventListener(\"click\", async () => handleLicenseTest());\n  }\n  if (licenseClearBtn) {\n    licenseClearBtn.addEventListener(\"click\", async () => handleLicenseClear());\n  }\n\n  // Provider clear/test\n  el(\"clearGemini\").addEventListener(\"click\", async () => clearProvider(PROVIDERS.GEMINI));\n  el(\"clearOpenAI\").addEventListener(\"click\", async () => clearProvider(PROVIDERS.OPENAI));\n\n  el(\"testGemini\").addEventListener(\"click\", async () => testProvider(PROVIDERS.GEMINI));\n  el(\"testOpenAI\").addEventListener(\"click\", async () => testProvider(PROVIDERS.OPENAI));\n\n  el(\"clearLogs\").addEventListener(\"click\", async () => {\n    await clearRequestLog();\n    await refreshUsage();\n    setStatus(\"Journal effac\", { ok: true });\n  });\n\n  el(\"refreshCache\").addEventListener(\"click\", async () => {\n    await refreshCacheStats();\n    setStatus(\"Cache actualis\", { ok: true });\n  });\n\n  el(\"clearCache\").addEventListener(\"click\", async () => {\n    await clearAllCaches();\n    await refreshCacheStats();\n    setStatus(\"Cache vid\", { ok: true });\n  });\n\n  // Default tab\n  activateTab(\"gemini\");\n\n  await refreshUI();\n  await refreshLicenseUI({ silent: true });\n  await refreshUsage();\n  await refreshCacheStats();\n  await maybeShowOnboarding();\n\n  setInterval(refreshUsage, 2000);\n  setInterval(refreshCacheStats, 12000);\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  await safeOfficeReady();\n  await init();\n});\n"],"names":["PROVIDERS","Object","freeze","GEMINI","OPENAI","DEFAULTS","provider","geminiModel","openaiModel","geminiReasoningEffort","openaiReasoningEffort","maxOutputTokens","retry","timeoutMs","cache","cacheTtlSec","webCacheTtlSec","STORAGE_KEYS","DEFAULT_PROVIDER","GEMINI_API_KEY","OPENAI_API_KEY","GEMINI_MODEL","OPENAI_MODEL","GEMINI_REASONING_EFFORT","OPENAI_REASONING_EFFORT","MAX_OUTPUT_TOKENS","ONBOARDING_SEEN","SECTION_ORDER","SECTION_HIDDEN","LICENSE","MIGRATION_DONE","REQUEST_LOG","REQUEST_LOG_CLEAR_AT","CACHE_INDEX","CACHE_CLEAR_AT","LEGACY_KEYS","DEFAULT_PROVIDER_V2","GEMINI_API_KEY_V2","OPENAI_API_KEY_V2","GEMINI_MODEL_V2","OPENAI_MODEL_V2","GEMINI_MAX_TOKENS_V2","OPENAI_MAX_TOKENS_V2","_migrationPromise","getRuntimeStorage","OfficeRuntime","storage","getItem","kind","window","localStorage","mem","Map","async","k","has","get","setItem","v","set","String","removeItem","delete","getLocalStorageSafe","rawGet","key","result","local","localValue","rawSet","value","rawRemove","ensureMigrated","normalizeProvider","legacyProvider","legacy","candidates","map","x","parseInt","trim","filter","n","Number","isFinite","migrated","length","Math","max","p","s","toLowerCase","GEMINI_REASONING_EFFORTS","Set","OPENAI_REASONING_EFFORTS","normalizeGeminiReasoningEffort","normalizeReasoningEffort","getDefaultProvider","keyKey","getApiKey","modelKey","getModel","raw","getGeminiReasoningEffort","getOpenAIReasoningEffort","setOpenAIReasoningEffort","setGeminiReasoningEffort","getMaxOutputTokens","clampInt","setMaxOutputTokens","normalizeSectionList","Array","isArray","out","seen","item","add","push","setHiddenSections","list","normalized","JSON","stringify","setLicense","license","clearLicense","nowMs","Date","now","sleep","ms","Promise","resolve","setTimeout","min","fallback","parseTimestampMs","CACHE_ENTRY_PREFIX","_cacheClearMs","syncCacheClearMarker","clearedAt","loadCacheIndex","arr","parse","saveCacheIndex","entries","pruneCacheIndex","kept","removedKeys","entry","savedAt","savedAtMs","expiresAtMs","sort","a","b","over","toRemove","slice","r","removeCacheEntry","removeFromCacheIndex","index","next","setPersistentCache","cacheKey","ttlMs","meta","model","size","updated","pruned","sortKeysDeep","prototype","toString","call","keys","REQUEST_LOG_TTL_MS","_requestLog","_requestLogLoading","_requestLogLoaded","_requestLogLastLoadedMs","_requestLogClearMs","syncRequestLogClearMarker","options","reset","loadRequestLog","force","parsed","e","ts","persistRequestLog","pruneRequestLog","logRequest","logEntry","logRequestAsync","CACHE","constructor","maxEntries","this","oldestKey","clear","_cacheClearLocalMs","INFLIGHT","active","queue","isNonEmptyString","normalizeBoolean","def","includes","normalizeTimeoutMs","toLowerMsg","looksLikeStructuredOutputUnsupported","message","looksLikeWebSearchUnsupported","ensureJsonInstruction","system","test","getFormulaForLog","fnName","text","match","formula","startsWith","extractFormulaFromText","aiGenerate","req","start","apiKey","functionName","functionCall","reasoningEffort","reasoningEffortLabel","fn","ok","undefined","code","user","webSearch","cfgMax","normalizeMaxOutputTokens","thinkingConfig","effort","level","modelId","thinkingLevel","toUpperCase","budget","minimal","low","medium","high","thinkingBudget","resolveGeminiThinkingConfig","cacheEnabled","ttlSec","getCacheClearAt","cacheKeyPayload","responseMimeType","responseJsonSchema","input","crypto","subtle","digest","TextEncoder","bytes","encode","from","Uint8Array","padStart","join","str","h","i","charCodeAt","imul","fnv1a32","hashKey","cached","cacheKind","inputTokens","outputTokens","reasoningTokens","totalTokens","persisted","Error","getPersistentCache","attempt","lastErr","callProvider","url","body","max_output_tokens","store","reasoning","sysText","instructions","format","type","name","strict","schema","tools","include","res","fetchWithTimeout","method","headers","Authorization","json","safeJson","msg","error","extractOpenAIError","status","output_text","output","texts","content","part","choices","extractOpenAIText","sources","action","src","title","dedupeSources","extractOpenAISources","usage","u","rawOutputTokens","toInt","output_tokens","output_tokens_details","reasoning_tokens","input_tokens","total_tokens","cachedInputTokens","input_tokens_details","cached_tokens","extractOpenAIUsage","callOpenAI","opts","encodeURIComponent","geminiEndpoint","contents","role","parts","generationConfig","systemInstruction","responseSchema","google_search","extractGeminiError","c","extractGeminiText","md","groundingMetadata","chunks","groundingChunks","ch","web","uri","extractGeminiSources","usageMetadata","promptTokenCount","candidatesTokenCount","thoughtsTokenCount","totalTokenCount","cachedContentTokenCount","extractGeminiUsage","callGemini","baseOpts","wantsStructured","normalizeUsage","shift","withConcurrencyLimit","reportedTotal","computedTotal","floor","t","AbortController","fetch","ctrl","id","abort","signal","clearTimeout","INSTANCE_NAME","normalizeKey","normalizeExpiresAt","toISOString","extractError","data","errors","first","detail","postLicense","endpoint","payload","formData","FormData","forEach","append","response","buildLicense","overrides","instanceId","instance","instance_id","instanceName","expiresAt","license_key","expires_at","valid","activatedAt","lastCheckedAt","normalizeLicense","getStoredLicense","getLicense","saveStoredLicense","isLicenseValid","el","document","getElementById","setStatus","line","detailsObj","textContent","formatNumber","round","toLocaleString","CURRENCY_SYMBOL","formatCost","toFixed","formatDuration","formatTime","toLocaleTimeString","hour","minute","getSectionKey","section","dataset","isSectionLocked","sectionLocked","applySectionOrder","order","sectionMain","querySelector","settingsCard","SECTION_SETTINGS_SELECTOR","sectionElements","insertBefore","appendChild","applySectionVisibility","hidden","locked","shouldHide","classList","toggle","SECTION_HIDDEN_CLASS","pruneHiddenSections","changed","hiddenSections","updateSectionOrder","nextOrder","persist","sectionOrder","renderSectionManager","setSectionOrder","updateHiddenSections","nextHidden","updateOnboardingVisibility","moveSection","delta","idx","indexOf","nextIdx","splice","clearDragState","querySelectorAll","row","remove","innerHTML","label","sectionTitle","getSectionTitle","visible","createElement","className","sectionKey","setAttribute","handle","draggable","labelEl","controls","upBtn","disabled","addEventListener","downBtn","toggleWrap","toggleInput","checked","toggleSlider","lockTag","GEMINI_REASONING_LEVELS","OPENAI_REASONING_LEVELS","HELP_SELECTOR","SECTION_SELECTOR","keyState","gemini","openai","licenseState","licenseEntryChoice","keysLoaded","licenseLoaded","defaultSectionOrder","draggingSectionKey","expandedLogKeys","DEFAULT_MODELS","MODEL_CATALOG","prices","cachedInput","costLevel","reasoningLevel","warning","recommended","supportsReasoningNone","MODEL_LOOKUP","m","PROVIDER_LABELS","repeatIcon","icon","count","getModelMeta","syncGeminiReasoningEffort","preferred","effortEl","allowed","getGeminiAllowedReasoningLevels","getReasoningEffortLabel","levels","best","bestDist","POSITIVE_INFINITY","option","optIdx","dist","abs","coerceReasoningLabel","syncOpenAIReasoningEffort","allowNone","openaiModelAllowsNone","wrap","closest","formatRate","decimals","replace","modelIndicators","cost","modelOptionLabel","indicators","favorite","updateModelWarningBadge","isGemini","selectEl","warningEl","show","estimateCost","billableOutputTokens","uncached","normalizeUsageEntry","populateModelSelect","currentModel","requested","requestedKey","matched","style","color","fontWeight","selected","setModalOpen","isOpen","modal","isModalOpen","contains","setSettingsModalOpen","setPricingModalOpen","setOnboardingModalOpen","setOnboardingKeysModalOpen","closePricingModal","setKeyStatus","hasKey","node","updateKeyPlaceholders","geminiInput","openaiInput","placeholder","shouldShow","setModelGate","modelEl","gateEl","updateModelGates","parseLicenseExpiryMs","formatLicenseExpiry","toLocaleDateString","year","month","day","formatDate","setLicenseStatus","setLicenseEntryVisible","isVisible","focus","refreshLicenseUI","silent","stored","summary","expiry","licenseStatusSummary","updateLicenseStatusNodes","autoVisible","updateLicensePlaceholders","updateLicenseMeta","clampExp","expToTokens","exp","setProviderButtons","activateTab","tab","refreshUI","preserveKeyInputs","maxTok","gemModel","oaiModel","gemKey","oaiKey","gemReasoningEffort","oaiReasoningEffort","all","tokens","log2","tokensToExp","normalizedTokens","geminiModelEl","openaiModelEl","selectedGeminiModel","selectedOpenAIModel","safeGeminiEffort","safeEffort","effectiveEffort","openaiKey","defaultProvider","buildBreakdownRow","isSub","tokensEl","costEl","refreshUsage","logs","fresh","getRequestLog","breakdown","models","total","requests","byProvider","bucket","modelEntry","container","providers","values","localeCompare","renderUsageBreakdown","empty","buildTokenFlow","iconText","val","activeKeys","cacheClass","top","titleText","formulaText","entryKey","logEntryKey","chevron","tags","display","gap","providerTag","statusTag","cacheTag","tokensTotal","modelLabel","effortLabel","durationLabel","modelEffortLabel","Boolean","right","baseMeta","detailMeta","cacheNote","tokensWrap","tokensLine","heatDot","getTokenHeatClass","tokensTotalEl","tokensDetailEl","createTextNode","renderLogList","canvas","ctx","getContext","width","clientWidth","height","clientHeight","dpr","devicePixelRatio","setTransform","buckets","fill","maxValue","lineColor","getComputedStyle","documentElement","getPropertyValue","clearRect","strokeStyle","lineWidth","y","beginPath","moveTo","lineTo","stroke","gradient","createLinearGradient","addColorStop","closePath","fillStyle","drawUsageChart","refreshCacheStats","stats","sizeBytes","oldestMs","newestMs","getPersistentCacheStats","formatBytes","saveCommon","savedProvider","setDefaultProvider","savedTokens","openOnboardingSection","focusKey","scrollIntoView","behavior","block","closeAllHelpPopups","help","btn","persistApiKey","trimmed","setApiKey","saveProviderKey","inputEl","statusId","saveProviderModel","newModel","setModel","setInputWarning","isWarning","handleLicenseActivate","buttonEl","originalLabel","success","instance_name","activated","activateLicense","errorText","dismissOnboarding","markSeen","setOnboardingSeen","clearProvider","clearApiKey","testProvider","providerOverride","aiMinimalTest","init","targetId","getAttribute","collapsed","nextCollapsed","queued","triggerRefresh","onChanged","addListener","attachStorageListeners","event","stopPropagation","wasOpen","nextOpen","target","sections","storedOrder","getSectionOrder","domKeys","keysInDom","normalizeSectionOrder","getHiddenSections","dataTransfer","effectAllowed","setData","preventDefault","clearDropIndicators","rect","getBoundingClientRect","before","clientY","targetKey","draggedKey","targetIndex","insertIndex","reorderSectionList","moveSectionToEnd","initSectionDrag","initSectionManager","settingsButton","sectionReset","pricingHelp","gemBody","oaiBody","renderProvider","cellModel","cellInput","cellOutput","cellCost","cellReason","renderPricingTable","onboardingClose","onboardingDone","onboardingKeysButton","onboardingKeysSave","geminiKey","saveOnboardingKeys","onboardingKeysLater","updateMaxTokensValue","geminiEffortEl","saveGeminiReasoningEffort","saveOpenAIReasoningEffort","geminiKeyEl","openaiKeyEl","licenseKeyInput","licenseActivateBtn","licenseTestBtn","licenseClearBtn","licenseRevealBtn","inputKey","keyToTest","validateLicense","handleLicenseTest","clearStoredLicense","handleLicenseClear","clearRequestLog","clearPersistentCache","clearAllCaches","getOnboardingSeen","maybeShowOnboarding","setInterval","Office","onReady","safeOfficeReady"],"ignoreList":[],"sourceRoot":""}