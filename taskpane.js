(()=>{"use strict";const e=Object.freeze({GEMINI:"gemini",OPENAI:"openai"}),t=Object.freeze({provider:e.GEMINI,geminiModel:"gemini-3-flash-preview",openaiModel:"gpt-5-mini",geminiReasoningEffort:"minimal",openaiReasoningEffort:"low",maxOutputTokens:4096,concurrencyLimit:16,rpmLimit:0,interfaceMode:"advanced",retry:2,timeoutMs:12e4,cache:!0,cacheTtlSec:604800}),n=Object.freeze({DEFAULT_PROVIDER:"AI_DEFAULT_PROVIDER_V3",GEMINI_API_KEY:"AI_GEMINI_API_KEY_V3",OPENAI_API_KEY:"AI_OPENAI_API_KEY_V3",GEMINI_MODEL:"AI_GEMINI_MODEL_V3",OPENAI_MODEL:"AI_OPENAI_MODEL_V3",GEMINI_REASONING_EFFORT:"AI_GEMINI_REASONING_EFFORT_V3",OPENAI_REASONING_EFFORT:"AI_OPENAI_REASONING_EFFORT_V3",MAX_OUTPUT_TOKENS:"AI_MAX_OUTPUT_TOKENS_V3",CONCURRENCY_LIMIT:"AI_CONCURRENCY_LIMIT_V1",RPM_LIMIT:"AI_RPM_LIMIT_V1",INTERFACE_MODE:"AI_INTERFACE_MODE_V1",ONBOARDING_SEEN:"AI_ONBOARDING_SEEN_V1",ONBOARDING_KEYS_CONFIRMED:"AI_ONBOARDING_KEYS_CONFIRMED_V1",SECTION_ORDER:"AI_SECTION_ORDER_V1",SECTION_HIDDEN:"AI_SECTION_HIDDEN_V1",LICENSE:"AI_LICENSE_V1",PRIVACY_MODE:"AI_PRIVACY_MODE_V1",MIGRATION_DONE:"AI_MIGRATION_DONE_V3",REQUEST_LOG:"AI_REQUEST_LOG_V1",REQUEST_LOG_CLEAR_AT:"AI_REQUEST_LOG_CLEAR_AT_V1",USAGE_TOTALS:"AI_USAGE_TOTALS_V1",CACHE_INDEX:"AI_CACHE_INDEX_V1",CACHE_CLEAR_AT:"AI_CACHE_CLEAR_AT_V1",RUNTIME_STATUS:"AI_RUNTIME_STATUS_V1"}),o=new Set([n.GEMINI_API_KEY,n.OPENAI_API_KEY,n.LICENSE]),i=Object.freeze({GEMINI_API_KEY:"GEMINI_API_KEY",MAX_OUTPUT_TOKENS:"MAX_OUTPUT_TOKENS",DEFAULT_PROVIDER_V2:"AI_DEFAULT_PROVIDER_V2",GEMINI_API_KEY_V2:"AI_GEMINI_API_KEY_V2",OPENAI_API_KEY_V2:"AI_OPENAI_API_KEY_V2",GEMINI_MODEL_V2:"AI_GEMINI_MODEL_V2",OPENAI_MODEL_V2:"AI_OPENAI_MODEL_V2",GEMINI_MAX_TOKENS_V2:"AI_GEMINI_MAX_OUTPUT_TOKENS_V2",OPENAI_MAX_TOKENS_V2:"AI_OPENAI_MAX_OUTPUT_TOKENS_V2"});let a=null,s=!1,r=null,c=0;const u=1500;let l=null,d=0,m=null,f=0,p=null,g=0,h=null,E=0,I=null,y=0;const k={gemini:null,openai:null},N={gemini:0,openai:0},T={gemini:null,openai:null},b={gemini:0,openai:0};function A(){s=!0}const _={kind:"memory",storage:(()=>{const e=new Map;return{getItem:async t=>e.has(t)?e.get(t):null,async setItem(t,n){e.set(t,String(n))},async removeItem(t){e.delete(t)}}})()};function v(){if(!s)try{if("undefined"!=typeof OfficeRuntime&&OfficeRuntime?.storage?.getItem)return{kind:"office",storage:OfficeRuntime.storage}}catch{}try{if("undefined"!=typeof window&&window?.localStorage?.getItem)return{kind:"local",storage:window.localStorage}}catch{}return _}function w(){try{if("undefined"!=typeof window&&window?.localStorage?.getItem)return window.localStorage}catch{return null}return null}function M(e,t){try{return e.getItem(t)}catch{return null}}function S(e,t,n){try{return e.setItem(t,n),!0}catch{return!1}}function C(e,t){try{return e.removeItem(t),!0}catch{return!1}}async function L(e,t={}){const{kind:n,storage:i}=v(),a=t.sensitive??function(e){return o.has(e)}(e),r=!1!==t.allowLocalFallback;if("local"===n)return M(i,e);if("office"===n){let t=null;try{t=await i.getItem(e)}catch{A()}if(null!=t){if(a){const t=w();t&&C(t,e)}return t}if(!r)return null;const n=w();if(!n)return null;const o=M(n,e);if(null==o)return null;if(!s)try{await i.setItem(e,String(o)),C(n,e)}catch{A()}return o}try{return await i.getItem(e)}catch{return null}}async function O(e,t,n={}){const{kind:o,storage:i}=v(),a=null==t?"":String(t),s=!1!==n.allowLocalFallback;if("local"!==o){if("office"===o){let t=!1;try{await i.setItem(e,a),t=!0}catch{A()}const n=w();if(t)return void(n&&C(n,e));if(!s||!n)return;return void S(n,e,a)}try{await i.setItem(e,a)}catch{}}else S(i,e,a)}async function x(e){const{kind:t,storage:n}=v();if("local"!==t){if("office"===t){let t=!1;try{await n.removeItem(e),t=!0}catch{A()}const o=w();return void(o&&C(o,e))}try{await n.removeItem(e)}catch{}}else C(n,e)}async function P(){if(a)return a;a=(async()=>{if("1"!==await L(n.MIGRATION_DONE)){if(!R(await L(n.DEFAULT_PROVIDER))){const e=R(await L(i.DEFAULT_PROVIDER_V2));await O(n.DEFAULT_PROVIDER,e||t.provider)}if(!await L(n.GEMINI_API_KEY)){const e=await L(i.GEMINI_API_KEY_V2)||await L(i.GEMINI_API_KEY);e&&await O(n.GEMINI_API_KEY,e)}if(!await L(n.OPENAI_API_KEY)){const e=await L(i.OPENAI_API_KEY_V2);e&&await O(n.OPENAI_API_KEY,e)}if(!await L(n.GEMINI_MODEL)){const e=await L(i.GEMINI_MODEL_V2);await O(n.GEMINI_MODEL,e||t.geminiModel)}if(!await L(n.OPENAI_MODEL)){const e=await L(i.OPENAI_MODEL_V2);await O(n.OPENAI_MODEL,e||t.openaiModel)}if(!await L(n.MAX_OUTPUT_TOKENS)){const e=[await L(i.MAX_OUTPUT_TOKENS),await L(i.GEMINI_MAX_TOKENS_V2),await L(i.OPENAI_MAX_TOKENS_V2)].map(e=>parseInt(String(e||"").trim(),10)).filter(e=>Number.isFinite(e)&&e>0),o=e.length?Math.max(...e):t.maxOutputTokens;await O(n.MAX_OUTPUT_TOKENS,String(o))}await L(n.INTERFACE_MODE)||await O(n.INTERFACE_MODE,t.interfaceMode),await O(n.MIGRATION_DONE,"1")}})();try{await a}finally{a=null}}function R(t){if(!t)return"";const n=String(t).trim().toLowerCase();return n===e.GEMINI?e.GEMINI:n===e.OPENAI?e.OPENAI:"google"===n||"gem"===n?e.GEMINI:"oai"===n||"chatgpt"===n?e.OPENAI:""}function G(e){const n=String(e||"").trim().toLowerCase();return"simple"===n?"simple":"advanced"===n?"advanced":t.interfaceMode}const D=new Set(["auto","minimal","low","medium","high"]),q=new Set(["none","minimal","low","medium","high"]);function F(e){const n=String(e||"").trim().toLowerCase();return n&&D.has(n)?n:t.geminiReasoningEffort}function H(e){const n=String(e||"").trim().toLowerCase();return n&&q.has(n)?n:t.openaiReasoningEffort}async function $(){const e=fe();if(l&&e-d<u)return l;await P();const o=R(await L(n.DEFAULT_PROVIDER))||t.provider;return l=o,d=e,o}function V(t){return R(t)===e.OPENAI?n.OPENAI_API_KEY:n.GEMINI_API_KEY}async function K(t){const n=R(t)===e.OPENAI?e.OPENAI:e.GEMINI,o=fe();if(null!=k[n]&&o-N[n]<u)return(k[n]||"").trim();await P();const i=await L(V(n))||"",a=String(i).trim();return k[n]=a,N[n]=o,a}async function U(e){return!!await K(e)}function j(t){return R(t)===e.OPENAI?n.OPENAI_MODEL:n.GEMINI_MODEL}async function B(n){const o=R(n)===e.OPENAI?e.OPENAI:e.GEMINI,i=fe(),a=T[o];if(a&&i-b[o]<u)return a;await P();const s=await L(j(o)),r=s&&String(s).trim()?String(s).trim():o===e.OPENAI?t.openaiModel:t.geminiModel;return T[o]=r,b[o]=i,r}async function Y(){const e=fe();if(p&&e-g<u)return p;await P();const o=F(await L(n.GEMINI_REASONING_EFFORT)||t.geminiReasoningEffort);return p=o,g=e,o}async function z(){const e=fe();if(h&&e-E<u)return h;await P();const o=H(await L(n.OPENAI_REASONING_EFFORT)||t.openaiReasoningEffort);return h=o,E=e,o}async function J(e){const t=H(e);return await O(n.OPENAI_REASONING_EFFORT,t),h=t,E=fe(),t}async function X(e){const t=F(e);return await O(n.GEMINI_REASONING_EFFORT,t),p=t,g=fe(),t}async function Q(){const e=fe();if(m&&e-f<u)return m;await P();const o=await L(n.MAX_OUTPUT_TOKENS),i=pe(parseInt(String(o||"").trim(),10),1,128e3,t.maxOutputTokens);return m=i,f=e,i}async function Z(e){const o=pe(e,1,128e3,t.maxOutputTokens);return await O(n.MAX_OUTPUT_TOKENS,String(o)),m=o,f=fe(),o}const W=[4,8,16,32,64,128];function ee(e){const n=pe(e,W[0],W[W.length-1],t.concurrencyLimit);if(W.includes(n))return n;let o=W[0],i=Math.abs(n-o);for(const e of W.slice(1)){const t=Math.abs(n-e);t<i&&(o=e,i=t)}return o}async function te(){return await P(),ee(await L(n.CONCURRENCY_LIMIT))}async function ne(e){const t=ee(e);return await O(n.CONCURRENCY_LIMIT,String(t)),t}function oe(e){return pe("string"==typeof e?parseInt(e.trim(),10):Number(e),0,1e5,t.rpmLimit)}async function ie(){return await P(),oe(await L(n.RPM_LIMIT))}async function ae(e){const t=oe(e);return await O(n.RPM_LIMIT,String(t)),t}async function se(){return await P(),"1"===await L(n.ONBOARDING_KEYS_CONFIRMED)}async function re(e=!0){return await O(n.ONBOARDING_KEYS_CONFIRMED,e?"1":"0"),e}function ce(e){return e&&"object"==typeof e?{active:pe(e.active,0,1e5,0),queued:pe(e.queued,0,1e5,0),rpm:pe(e.rpm,0,1e6,0),ts:pe(e.ts,0,Number.MAX_SAFE_INTEGER,0)}:{active:0,queued:0,rpm:0,ts:0}}async function ue(e){const t=ce(e);return await O(n.RUNTIME_STATUS,JSON.stringify(t)),t}async function le(){return await async function(){const e=fe();if(null!=r&&e-c<2e3)return r;const t="1"===await L(n.PRIVACY_MODE);return r=t,c=e,t}()}function de(e){if(!Array.isArray(e))return[];const t=[],n=new Set;for(const o of e){const e=String(o||"").trim();e&&!n.has(e)&&(n.add(e),t.push(e))}return t}async function me(e){const t=de(e);return await O(n.SECTION_HIDDEN,JSON.stringify(t)),t}function fe(){return Date.now()}function pe(e,t,n,o=t){const i=parseInt(String(e),10);return Number.isFinite(i)?Math.max(t,Math.min(n,i)):o}const ge=[/\bsk-[A-Za-z0-9-_]{1,}\b/gi,/\bAIza[0-9A-Za-z_-]{1,}\b/gi,/\b[A-Z0-9]{4}(?:-[A-Z0-9]{4}){1,3}\b/gi];function he(e){if(null==e)return"";let t=String(e);for(const e of ge)t=t.replace(e,"[REDACTED]");return t}function Ee(e){if(null==e)return e;if("string"==typeof e)return he(e);if(Array.isArray(e))return e.map(Ee);if("object"==typeof e){const t={};for(const[n,o]of Object.entries(e))t[n]=Ee(o);return t}return e}function Ie(e){const t=parseInt(String(e||"").trim(),10);return Number.isFinite(t)&&t>0?t:0}const ye=5242880;let ke=0;async function Ne(){const e=await L(n.CACHE_INDEX);if(!e)return[];try{const t=JSON.parse(e);return Array.isArray(t)?t:[]}catch{return[]}}async function Te(e){e&&await x("AI_CACHE_ENTRY_V1:"+e)}const be=1/0;let Ae=[],_e=null,ve=!1,we=0,Me=0,Se=[],Ce=null,Le=null,Oe=Ke(),xe=null,Pe=!1,Re=0,Ge=!1;async function De(e={}){const t=Ie(await L(n.REQUEST_LOG_CLEAR_AT));return t>Me&&(Me=t,Ae=[],e.reset?(ve=!0,_e=null,we=fe()):ve=!1),Me}function qe(e){return!!e&&!1===e.ok}async function Fe(e=!1){if(_e)return _e;_e=(async()=>{if(await le())return!e&&ve||(ve=!0,we=fe()),Ae;const t=await De();if(!e&&ve)return Ae;const o=await L(n.REQUEST_LOG);let i=[];if(o)try{i=function(e){if(Array.isArray(e))return e;if(e&&"object"==typeof e){const t=Array.isArray(e.normal)?e.normal:[],n=Array.isArray(e.errors)?e.errors:[];return t.concat(n)}return[]}(JSON.parse(o))}catch{i=[]}const a=fe();return i=i.map(e=>{if(!e)return null;let t=e.ts;if("string"==typeof t){const e=Date.parse(t);Number.isFinite(e)&&(t=e)}return"number"!=typeof t?null:{...e,ts:t}}).filter(e=>e&&"number"==typeof e.ts&&e.ts>t&&a-e.ts<=be).map(e=>{return(t=e)&&"object"==typeof t?Ee(t):t;var t}),Ae=i,He(),ve=!0,we=fe(),Ae})();try{return await _e}finally{_e=null}}function He(){const e=fe(),t=Me||0,n=(Ae||[]).filter(n=>n&&"number"==typeof n.ts&&n.ts>t&&e-n.ts<=be),o=[],i=[];for(const e of n)qe(e)?i.push(e):o.push(e);o.sort((e,t)=>e.ts-t.ts),i.sort((e,t)=>e.ts-t.ts);const a=o.slice(-50).concat(i.slice(-50));a.sort((e,t)=>e.ts-t.ts),Ae=a}function $e(e){const t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function Ve(e){const t=Number(e);return!Number.isFinite(t)||t<=0?0:t}function Ke(){return{inputTokens:0,outputTokens:0,reasoningTokens:0,cachedInputTokens:0,cacheStorageTokenHours:0,requests:0,batchApplied:{},byProvider:{[e.GEMINI]:{inputTokens:0,outputTokens:0,reasoningTokens:0,cachedInputTokens:0,cacheStorageTokenHours:0,requests:0,models:{}},[e.OPENAI]:{inputTokens:0,outputTokens:0,reasoningTokens:0,cachedInputTokens:0,cacheStorageTokenHours:0,requests:0,models:{}}}}}function Ue(e){if(!e||"object"!=typeof e)return{};const t=fe(),n=Object.entries(e).filter(([,e])=>e&&"object"==typeof e).filter(([,e])=>{const n=Number(e.ts)||0;return!n||t-n<=864e5}).sort((e,t)=>(Number(e[1].ts)||0)-(Number(t[1].ts)||0)).slice(-80),o={};for(const[e,t]of n)o[e]=t;return o}async function je(t=!1){if(xe)return xe;xe=(async()=>{if(await le())return!t&&Pe||(Pe=!0,Re=fe()),Oe;if(!t&&Pe)return Oe;const o=await L(n.USAGE_TOTALS);let i=null;if(o)try{i=JSON.parse(o)}catch{i=null}return Oe=function(t){const n=Ke();if(!t||"object"!=typeof t)return n;n.inputTokens=$e(t.inputTokens),n.outputTokens=$e(t.outputTokens),n.reasoningTokens=$e(t.reasoningTokens),n.cachedInputTokens=$e(t.cachedInputTokens),n.cacheStorageTokenHours=Ve(t.cacheStorageTokenHours),n.requests=$e(t.requests),n.batchApplied=function(t){if(!t||"object"!=typeof t)return{};const n={};for(const[o,i]of Object.entries(t)){if(!i||"object"!=typeof i)continue;const t=i.models&&"object"==typeof i.models?i.models:{},a={};for(const[n,o]of Object.entries(t)){if(!o||"object"!=typeof o)continue;const t=String(o.provider||"").toLowerCase();if(t!==e.GEMINI&&t!==e.OPENAI)continue;const i=String(o.modelKey||o.model||n||"").toLowerCase();i&&(a[n]={provider:t,modelKey:i,label:"string"==typeof o.label?o.label:"",inputTokens:$e(o.inputTokens),outputTokens:$e(o.outputTokens),reasoningTokens:$e(o.reasoningTokens),cachedInputTokens:$e(o.cachedInputTokens),cacheStorageTokenHours:Ve(o.cacheStorageTokenHours),requests:$e(o.requests)})}n[o]={ts:Number(i.ts)||0,models:a}}return Ue(n)}(t.batchApplied);const o=t.byProvider&&"object"==typeof t.byProvider?t.byProvider:{};for(const t of[e.GEMINI,e.OPENAI]){const e=o[t];if(!e||"object"!=typeof e)continue;const i=n.byProvider[t];i.inputTokens=$e(e.inputTokens),i.outputTokens=$e(e.outputTokens),i.reasoningTokens=$e(e.reasoningTokens),i.cachedInputTokens=$e(e.cachedInputTokens),i.cacheStorageTokenHours=Ve(e.cacheStorageTokenHours),i.requests=$e(e.requests);const a=e.models&&"object"==typeof e.models?e.models:{};for(const[e,t]of Object.entries(a)){if(!t||"object"!=typeof t)continue;const n="string"==typeof t.label?t.label:String(e||""),o=String(e||n||"").toLowerCase();o&&(i.models[o]={label:n,inputTokens:$e(t.inputTokens),outputTokens:$e(t.outputTokens),reasoningTokens:$e(t.reasoningTokens),cachedInputTokens:$e(t.cachedInputTokens),cacheStorageTokenHours:Ve(t.cacheStorageTokenHours),requests:$e(t.requests)})}}return n}(i),Pe=!0,Re=fe(),Oe})();try{return await xe}finally{xe=null}}function Be(t){if(!t||"object"!=typeof t)return!1;if(t.batch&&Array.isArray(t.batchModels)){const n=t.batchId?String(t.batchId):"",o=fe(),i={};for(const n of t.batchModels){if(!n||"object"!=typeof n)continue;const t=String(n.provider||"").toLowerCase();if(t!==e.GEMINI&&t!==e.OPENAI)continue;const o=String(n.model||"").trim(),a=(o||"unknown").toLowerCase(),s=`${t}|${a}`,r=i[s]||{provider:t,modelKey:a,label:o,inputTokens:0,outputTokens:0,reasoningTokens:0,cachedInputTokens:0,cacheStorageTokenHours:0,requests:0};r.inputTokens+=$e(n.inputTokens),r.outputTokens+=$e(n.outputTokens),r.reasoningTokens+=$e(n.reasoningTokens),r.cachedInputTokens+=$e(n.cachedInputTokens),r.cacheStorageTokenHours+=Ve(n.cacheStorageTokenHours),r.requests+=$e(n.requests),!r.label&&o&&(r.label=o),i[s]=r}if(!n){let e=!1;for(const t of Object.values(i))ze(t.provider,t.modelKey,t.label,t)&&(e=!0);return e}const a=Oe.batchApplied||{},s=a[n]?.models||{},r=new Set([...Object.keys(s),...Object.keys(i)]);let c=!1;for(const t of r){const n=i[t]||null,o=s[t]||null;if(!n&&!o)continue;const a=(n?.provider||o?.provider||"").toLowerCase(),r=(n?.modelKey||o?.modelKey||"").toLowerCase();if(a!==e.GEMINI&&a!==e.OPENAI)continue;if(!r)continue;const u={inputTokens:(n?.inputTokens||0)-(o?.inputTokens||0),outputTokens:(n?.outputTokens||0)-(o?.outputTokens||0),reasoningTokens:(n?.reasoningTokens||0)-(o?.reasoningTokens||0),cachedInputTokens:(n?.cachedInputTokens||0)-(o?.cachedInputTokens||0),cacheStorageTokenHours:(n?.cacheStorageTokenHours||0)-(o?.cacheStorageTokenHours||0),requests:(n?.requests||0)-(o?.requests||0),label:n?.label||o?.label||""};Ye(u)&&ze(a,r,u.label,u)&&(c=!0)}return a[n]={ts:Number(t.ts)||o,models:i},Oe.batchApplied=Ue(a),c}const n=$e(t.inputTokens),o=$e(t.outputTokens),i=$e(t.reasoningTokens),a=$e(t.cachedInputTokens),s=Ve(t.cacheStorageTokenHours);if(!(n+o+i+a>0||s>0))return!1;const r=String(t.provider||"").toLowerCase();if(r!==e.GEMINI&&r!==e.OPENAI)return!1;const c=String(t.model||"").trim();return ze(r,(c||"unknown").toLowerCase(),c,{inputTokens:n,outputTokens:o,reasoningTokens:i,cachedInputTokens:a,cacheStorageTokenHours:s,requests:1})}function Ye(e){return 0!==Number(e?.inputTokens||0)||0!==Number(e?.outputTokens||0)||0!==Number(e?.reasoningTokens||0)||0!==Number(e?.cachedInputTokens||0)||0!==Number(e?.cacheStorageTokenHours||0)||0!==Number(e?.requests||0)}function ze(e,t,n,o){if(!o)return!1;const i=Number(o.inputTokens||0),a=Number(o.outputTokens||0),s=Number(o.reasoningTokens||0),r=Number(o.cachedInputTokens||0),c=Number(o.cacheStorageTokenHours||0),u=Number(o.requests||0);if(!(i||a||s||r||c||u))return!1;Oe.inputTokens=Math.max(0,Oe.inputTokens+i),Oe.outputTokens=Math.max(0,Oe.outputTokens+a),Oe.reasoningTokens=Math.max(0,Oe.reasoningTokens+s),Oe.cachedInputTokens=Math.max(0,Oe.cachedInputTokens+r),Oe.cacheStorageTokenHours=Math.max(0,Oe.cacheStorageTokenHours+c),Oe.requests=Math.max(0,Oe.requests+u);const l=Oe.byProvider[e];l.inputTokens=Math.max(0,l.inputTokens+i),l.outputTokens=Math.max(0,l.outputTokens+a),l.reasoningTokens=Math.max(0,l.reasoningTokens+s),l.cachedInputTokens=Math.max(0,l.cachedInputTokens+r),l.cacheStorageTokenHours=Math.max(0,l.cacheStorageTokenHours+c),l.requests=Math.max(0,l.requests+u);const d=l.models||{},m=d[t]||{label:n,inputTokens:0,outputTokens:0,reasoningTokens:0,cachedInputTokens:0,cacheStorageTokenHours:0,requests:0};return!m.label&&n&&(m.label=n),m.inputTokens=Math.max(0,m.inputTokens+i),m.outputTokens=Math.max(0,m.outputTokens+a),m.reasoningTokens=Math.max(0,m.reasoningTokens+s),m.cachedInputTokens=Math.max(0,m.cachedInputTokens+r),m.cacheStorageTokenHours=Math.max(0,m.cacheStorageTokenHours+c),m.requests=Math.max(0,m.requests+u),d[t]=m,l.models=d,!0}async function Je(){if(Le)return Le;if(Se.length){Le=(async()=>{try{const e=Se;if(Se=[],!e.length)return;await je();let t=!1;for(const n of e)Be(n)&&(t=!0);if(t&&(Re=fe(),Ge=!0),await le())return Ae.push(...e),He(),ve=!0,void(we=fe());await De({reset:!0}),ve||await Fe();for(const t of e)if(t?.batch&&t?.batchId){const e=Ae.findIndex(e=>e?.batch&&e?.batchId===t.batchId);e>=0?Ae[e]=t:Ae.push(t)}else Ae.push(t);He(),we=fe(),await async function(){try{if(await le())return;He(),await O(n.REQUEST_LOG,JSON.stringify(Ae.slice(-100)))}catch{}}(),Ge&&(await async function(){try{if(await le())return;await O(n.USAGE_TOTALS,JSON.stringify(Oe))}catch{}}(),Ge=!1)}catch{}})();try{await Le}finally{Le=null}}}async function Xe(){const e=fe();Se=[],Ce&&(clearTimeout(Ce),Ce=null),Ae=[],ve=!0,_e=null,Me=e,we=e,await O(n.REQUEST_LOG_CLEAR_AT,String(e)),await x(n.REQUEST_LOG)}const Qe=new class{constructor(e=500){this.maxEntries=e,this.map=new Map}get(e){if(!this.map.has(e))return null;const t=this.map.get(e);return t?.expiresAtMs&&t.expiresAtMs<=fe()?(this.map.delete(e),null):(this.map.delete(e),this.map.set(e,t),t.value)}set(e,t,n){const o="number"==typeof n&&n>0?fe()+n:null;for(this.map.has(e)&&this.map.delete(e),this.map.set(e,{value:t,expiresAtMs:o});this.map.size>this.maxEntries;){const e=this.map.keys().next().value;this.map.delete(e)}}clear(){this.map.clear()}}(800);new Map;const Ze=new Map,We=(new Map,Symbol("queue_cancelled"));t.concurrencyLimit,t.rpmLimit;let et=[];Promise.resolve();const tt=new class{constructor(){this._items=[],this._head=0}get length(){return this._items.length-this._head}push(e){this._items.push(e)}shift(){if(this._head>=this._items.length)return;const e=this._items[this._head++];return this._head>1024&&2*this._head>this._items.length&&(this._items=this._items.slice(this._head),this._head=0),e}drain(){const e=this._items.slice(this._head);return this._items=[],this._head=0,e}};let nt=null,ot=null,it="";function at(){return function(e){const t=e-6e4;for(;et.length&&et[0]<=t;)et.shift()}(fe()),et.length}function st(e){return"string"==typeof e&&e.trim().length>0}function rt(e){try{const t=e?.error?.message;return t?String(t):""}catch{return""}}async function ct(){Qe.clear(),await async function(){const e=fe();ke=e,await O(n.CACHE_CLEAR_AT,String(e));const t=await Ne();for(const e of t||[])e?.key&&await Te(e.key);await x(n.CACHE_INDEX)}()}async function ut(e,n,o){const i=pe(o,1e3,12e4,t.timeoutMs);if("undefined"==typeof AbortController)return await fetch(e,n);const a=new AbortController,s=setTimeout(()=>a.abort(),i);try{return await fetch(e,{...n,signal:a.signal})}finally{clearTimeout(s)}}async function lt(e){try{return await e.json()}catch{return{}}}Number.POSITIVE_INFINITY,ue({active:0,queued:0,rpm:0,ts:fe()});const dt="Neurow Add-in";function mt(e){return String(e||"").trim()}function ft(e){const t=String(e||"").trim();if(!t)return"";const n=Date.parse(t);return Number.isFinite(n)?new Date(n).toISOString():""}function pt(e,t){if(!e)return t;if("string"==typeof e.error&&e.error.trim())return e.error.trim();if("string"==typeof e.message&&e.message.trim())return e.message.trim();if(Array.isArray(e.errors)&&e.errors.length){const t=e.errors[0]||{},n=t.detail||t.title||t.message;if(n)return String(n).trim()}return t}async function gt(){return function(e){if(!e||"object"!=typeof e)return null;const t=mt(e.key);return t?{key:t,instanceId:String(e.instanceId||"").trim(),instanceName:String(e.instanceName||dt).trim(),expiresAt:ft(e.expiresAt),valid:!1!==e.valid,activatedAt:String(e.activatedAt||"").trim(),lastCheckedAt:String(e.lastCheckedAt||"").trim()}:null}(await async function(){await P();const e=await L(n.LICENSE);if(!e)return null;try{return JSON.parse(e)}catch{return null}}())}function ht(e){if(!e||!e.key)return!1;if(!1===e.valid)return!1;if(e.expiresAt){const t=Date.parse(e.expiresAt);if(Number.isFinite(t)&&t<=Date.now())return!1}return!0}async function Et(e,t={}){const o=mt(e);if(!o||o.length<5)return{success:!1,error:"Cle trop courte"};const i=await gt();if(!t.force&&i&&i.key===o&&ht(i))return{success:!0,license:i,cached:!0};try{const{ok:e,status:t,data:a}=await async function(e,t){const n=new FormData;Object.entries(t||{}).forEach(([e,t])=>{null!=t&&""!==t&&n.append(e,t)});const o=await fetch(e,{method:"POST",body:n});let i=null;try{i=await o.json()}catch{i=null}return{ok:o.ok,status:o.status,data:i}}("https://api.lemonsqueezy.com/v1/licenses/activate",{license_key:o,instance_name:dt});if(!e)return{success:!1,error:pt(a,`Erreur API (${t})`)};if(a?.activated){const e=function(e,t,n={}){const o=n.instanceId||t?.instance?.id||t?.instance_id||"",i=t?.instance?.name||n.instanceName||dt,a=ft(t?.license_key?.expires_at||n.expiresAt),s=(new Date).toISOString();return{key:e,instanceId:o,instanceName:i,expiresAt:a,valid:!0,activatedAt:n.activatedAt||s,lastCheckedAt:s}}(o,a,{activatedAt:i?.activatedAt});return await async function(e){return e?(await O(n.LICENSE,JSON.stringify(e)),e):(await x(n.LICENSE),null)}(e),{success:!0,license:e}}return{success:!1,error:pt(a,"Cle invalide")}}catch{return{success:!1,error:"Erreur de connexion internet"}}}function It(e){return document.getElementById(e)}function yt(e,t){const n=It("statusLine"),o=It("statusDetails");if(!n||!o)return;const i=he(e||"");if(n.textContent=i,t)try{const e=Ee(t);o.textContent=JSON.stringify(e,null,2)}catch{o.textContent=he(t)}else o.textContent=""}function kt(e,t={}){const{duration:n=2600}=t,o=It("statusToast");o&&(o.textContent=e||"",o.classList.add("is-visible"),bn&&(clearTimeout(bn),bn=null),bn=setTimeout(()=>{o.classList.remove("is-visible")},n))}function Nt(e){const t=Number(e);return Number.isFinite(t)?Math.round(t).toLocaleString("en-US"):"0"}const Tt="â‚¬";function bt(e){const t=Number(e);return Number.isFinite(t)?`${t.toFixed(2).replace(".",",")}${Tt}`:`0,00${Tt}`}function At(e){const t=Number(e);if(!Number.isFinite(t)||t<=0)return"00c";const n=Math.max(0,100*t);return n>0&&n<.01?"<0,01c":`${n.toFixed(2).replace(".",",")}c`}function _t(t){return String(t||"").toLowerCase()===e.GEMINI}function vt(e){return!!e?.cacheAdjusted||"AI.BATCH"===e?.fn}function wt(e){const t=Number(e?.cachedInputTokens||0);return!(!Number.isFinite(t)||t<=0)&&("AI.BATCH"===e?.fn||_t(e?.provider))}function Mt(e){const t=Math.max(0,Number(e?.inputTokens||0));if(!wt(e))return t;if(vt(e))return t;const n=Math.max(0,Number(e?.cachedInputTokens||0));return Math.max(0,t-n)}function St(e){return Mt(e)+Math.max(0,Number(e?.reasoningTokens||0))+Math.max(0,Number(e?.outputTokens||0))}function Ct(e){const t=Math.max(0,Number(e?.inputTokens||0)),n=Math.max(0,Number(e?.cachedInputTokens||0));if(vt(e))return{uncachedInputTokens:t,cachedInputTokens:n};const o=Math.min(n,t);return{uncachedInputTokens:Math.max(0,t-o),cachedInputTokens:o}}function Lt(e){const t=Number(e);return Number.isFinite(t)?`${(t/1e3).toFixed(2)}s`:"0.00s"}function Ot(e){try{return new Date(e).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}catch{return"--:--"}}function xt(e){try{return new Date(e).toLocaleString("fr-FR",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}}function Pt(e){return String(e||"").trim().toLowerCase()===tn.SIMPLE?tn.SIMPLE:tn.ADVANCED}function Rt(e,t){if(!e)return;e.classList.toggle("is-collapsed",!!t);const n=e.querySelector("[data-collapse-toggle]");n&&n.setAttribute("aria-expanded",t?"false":"true")}function Gt(e,t={}){const{silent:n=!0}=t,o=Pt(e),i=o===tn.SIMPLE;if(gn=o,document.body.classList.toggle("mode-simple",i),document.body.classList.toggle("mode-advanced",!i),document.body.dataset.interfaceMode=o,function(e){const t=e===tn.SIMPLE,n=It("interfaceModeSimple"),o=It("interfaceModeAdvanced");n&&(n.classList.toggle("segmented__btn--active",t),n.setAttribute("aria-pressed",t?"true":"false")),o&&(o.classList.toggle("segmented__btn--active",!t),o.setAttribute("aria-pressed",t?"false":"true"))}(o),function(e){const t=e===tn.SIMPLE,n=It("interfaceModeHint");n&&(n.textContent=t?"Simple: vue epuree, infos essentielles uniquement pour demarrer rapidement.":"AvancÃ©: affichage complet avec logs, cache, diagnostics et rÃ©glages experts.");const o=document.querySelector("#settingsModal .settings-page__subtitle");o&&(o.textContent=t?"Mode simplifiÃ©: licence et clÃ©s API en prioritÃ©":"ClÃ©s API, licence, modÃ¨les et effort de raisonnement");const i=document.querySelector('[data-section="config"] .card__subtitle');i&&(i.textContent=t?"Choisissez un fournisseur et la longueur de rÃ©ponse.":"ModÃ¨le, effort et tokens.");const a=document.querySelector('[data-section="usage"] .card__subtitle');a&&(a.textContent=t?"RÃ©sumÃ© rapide de votre consommation.":"Suivi des tokens et estimation de coÃ»ts");const s=document.querySelector("#configProviderRow label");s&&(s.textContent=t?"Fournisseur AI":"Fournisseur par dÃ©faut");const r=document.querySelector("#configMaxTokensRow label");r&&(r.textContent=t?"Longueur des rÃ©ponses":"Max output tokens")}(o),i&&(Rt(document.querySelector('[data-section="config"]'),!1),Rt(document.querySelector('[data-section="usage"]'),!1),jo()),!n){const e=i?"Simple":"AvancÃ©";yt(`Mode ${e} activÃ©`,{interfaceMode:o}),kt(`Mode ${e} activÃ©`)}}async function Dt(e={}){const{silent:t=!0}=e,o=await async function(){const e=fe();if(I&&e-y<u)return I;await P();const t=G(await L(n.INTERFACE_MODE));return I=t,y=e,t}();return Gt(o,{silent:t}),o}function qt(e){return String(e?.dataset?.section||"").trim()}function Ft(e){return"true"===e?.dataset?.sectionLocked}function Ht(e){if(Nn||(Nn=document.querySelector(".app__main")),!Nn)return;const t=document.querySelector(Wt);for(const n of e){const e=yn.get(n);e&&(t?Nn.insertBefore(e,t):Nn.appendChild(e))}}function $t(e){yn.forEach((t,n)=>{const o=Ft(t),i=e.has(n)&&!o;t.classList.toggle(en,i)})}function Vt(){let e=!1;for(const t of Array.from(In)){const n=yn.get(t);n&&!Ft(n)||(In.delete(t),e=!0)}e&&me(Array.from(In))}function Kt(e,t={}){const{persist:o=!0}=t;hn=e.slice(),Ht(hn),Yt(),o&&async function(e){const t=de(e);await O(n.SECTION_ORDER,JSON.stringify(t))}(hn)}function Ut(e,t={}){const{persist:n=!0}=t;In=new Set(e),Vt(),$t(In),Yt(),n&&me(Array.from(In)),no()}function jt(e,t){const n=hn.indexOf(e);if(n<0)return;const o=n+t;if(o<0||o>=hn.length)return;const i=hn.slice();i.splice(n,1),i.splice(o,0,e),Kt(i)}function Bt(e){e.querySelectorAll(".section-row").forEach(e=>{e.classList.remove("is-drop-before","is-drop-after","is-dragging")})}function Yt(){const e=It("sectionManagerList");if(!e)return;e.innerHTML="";const t=hn.length?hn:Array.from(yn.keys());t.forEach((n,o)=>{const i=yn.get(n);if(!i)return;const a=function(e){const t=e?.dataset?.sectionTitle;if(t)return t;const n=e?.querySelector?.(".card__title");return n?n.textContent.trim():qt(e)}(i),s=Ft(i),r=!In.has(n)||s,c=document.createElement("div");c.className="section-row",c.dataset.sectionKey=n,c.setAttribute("role","listitem");const u=document.createElement("button");u.type="button",u.className="section-row__handle",u.draggable=!0,u.setAttribute("title","Glisser pour dÃ©placer"),u.setAttribute("aria-label",`DÃ©placer ${a}`);const l=document.createElement("div");l.className="section-row__label",l.textContent=a;const d=document.createElement("div");d.className="section-row__controls";const m=document.createElement("button");m.type="button",m.className="move-btn move-btn--up",m.disabled=0===o,m.setAttribute("title","Monter"),m.setAttribute("aria-label",`Monter ${a}`),m.addEventListener("click",()=>jt(n,-1));const f=document.createElement("button");f.type="button",f.className="move-btn move-btn--down",f.disabled=o===t.length-1,f.setAttribute("title","Descendre"),f.setAttribute("aria-label",`Descendre ${a}`),f.addEventListener("click",()=>jt(n,1));const p=document.createElement("label");p.className="visibility-toggle",p.setAttribute("title",s?"Toujours visible":r?"Masquer":"Afficher");const g=document.createElement("input");g.type="checkbox",g.checked=r,g.disabled=s,g.setAttribute("aria-label",s?`${a} toujours visible`:`Afficher ${a}`);const h=document.createElement("span");if(h.className="visibility-toggle__slider",p.appendChild(g),p.appendChild(h),g.addEventListener("change",()=>{s||(g.checked?In.delete(n):In.add(n),$t(In),me(Array.from(In)),Yt())}),d.appendChild(m),d.appendChild(f),s){const e=document.createElement("span");e.className="section-row__lock",e.textContent="Fixe",e.setAttribute("title","Toujours visible"),d.appendChild(e)}d.appendChild(p),c.appendChild(u),c.appendChild(l),c.appendChild(d),e.appendChild(c)})}const zt=[4,8,16,32,64,128],Jt=["auto","minimal","low","medium","high"],Xt=["none","minimal","low","medium","high"],Qt="[data-help]",Zt="[data-section]",Wt="[data-section-settings]",en="is-section-hidden",tn=Object.freeze({SIMPLE:"simple",ADVANCED:"advanced"}),nn="[data-key-input]",on="[data-key-save]",an="[data-license-input]",sn="[data-license-status]";let rn={gemini:!1,openai:!1},cn=null,un=null,ln=!1,dn=!1,mn=!1,fn=!1,pn=!1,gn=tn.ADVANCED,hn=[],En=[],In=new Set,yn=new Map,kn="",Nn=null;const Tn=new Set;let bn=null,An=!1,_n=[],vn=t.rpmLimit;const wn={gemini:t.geminiModel,openai:t.openaiModel},Mn={gemini:[{id:"gemini-3-pro-preview",label:"Gemini 3 Pro Preview",prices:{input:2,output:12,cachedInput:.2},costLevel:3,reasoningLevel:3,warning:!0},{id:"gemini-3-flash-preview",label:"Gemini 3 Flash Preview",prices:{input:.5,output:3,cachedInput:.05},costLevel:2,reasoningLevel:2,recommended:!0},{id:"gemini-2.5-flash-lite",label:"Gemini 2.5 Flash Lite",prices:{input:.1,output:.4,cachedInput:.01},costLevel:1,reasoningLevel:1}],openai:[{id:"gpt-5.2",label:"GPT-5.2",prices:{input:1.75,output:14,cachedInput:.175},costLevel:3,reasoningLevel:3,supportsReasoningNone:!0,warning:!0},{id:"gpt-5-mini",label:"GPT-5 Mini",prices:{input:.25,output:2,cachedInput:.025},costLevel:2,reasoningLevel:2,recommended:!0,supportsReasoningNone:!1},{id:"gpt-5-nano",label:"GPT-5 Nano",prices:{input:.05,output:.4,cachedInput:.005},costLevel:1,reasoningLevel:1,supportsReasoningNone:!1}]},Sn={gemini:new Map(Mn.gemini.map(e=>[e.id.toLowerCase(),e])),openai:new Map(Mn.openai.map(e=>[e.id.toLowerCase(),e]))},Cn={gemini:"Gemini",openai:"OpenAI"};function Ln(e,t){const n=Math.max(1,Number(t)||1);return new Array(n+1).join(e)}function On(e,t){const n=String(e||"").toLowerCase(),o=String(t||"").trim().toLowerCase(),i=Sn[n];if(i&&o&&i.has(o))return i.get(o);const a=wn[n];return i&&a&&i.has(a.toLowerCase())?i.get(a.toLowerCase()):null}function xn(e,t){const n=It("geminiReasoningEffort");if(!n)return"";const o=function(e){const t=String(e||"").trim().toLowerCase();return t.includes("gemini-3")&&t.includes("flash")?["auto","minimal","low","medium","high"]:t.includes("gemini-3")?["auto","low","high"]:t.includes("gemini-2.5")?["auto","minimal","low","medium","high"]:["auto","low","high"]}(e);let i=Pn(t,Jt);i||(i=Jt[0]),o.includes(i)||("minimal"===i&&(i="low"),"medium"===i&&(i="high")),i=function(e,t,n){if(!e)return t[0]||"";if(t.includes(e))return e;const o=n.indexOf(e);if(o<0)return t[0]||"";let i=t[0]||"",a=Number.POSITIVE_INFINITY;for(const e of t){const t=n.indexOf(e);if(t<0)continue;const s=Math.abs(t-o);s<a&&(a=s,i=e)}return i}(i,o,Jt);const a=Jt.indexOf(i);return n.value=String(a>=0?a:0),n.setAttribute("aria-valuetext",i),i}function Pn(e,t=Xt){const n=String(e||"").trim().toLowerCase();if(!n)return"";const o=Number(n);return Number.isFinite(o)?t[Math.min(t.length-1,Math.max(0,Math.round(o)))]||"":n}function Rn(e,t){const n=It("openaiReasoningEffort");if(!n)return"";const o=function(e){const t=String(e||"").trim().toLowerCase(),n=Sn.openai?.get(t);return!n||"boolean"!=typeof n.supportsReasoningNone||n.supportsReasoningNone}(e),i=n.closest(".reasoning");i&&i.classList.toggle("reasoning--no-none",!o),n.dataset.allowNone=o?"1":"0";const a=o?Xt:Xt.slice(1);let s=Pn(t);a.includes(s)||(s=a[0]||"minimal");const r=Xt.indexOf(s);return n.value=String(r>=0?r:0),n.setAttribute("aria-valuetext",s),s}function Gn(e){const t=Number(e);if(!Number.isFinite(t))return`${Tt}0`;const n=t>=1?2:3;let o=t.toFixed(n);return o=o.replace(/\.?0+$/,""),`${Tt}${o}`}function Dn(e){return{cost:Ln("$",e.costLevel),reasoning:Ln("ðŸ§ ",e.reasoningLevel)}}function qn(e){const t=Dn(e),n=e.recommended?"â˜… ":"";return`${e.warning?"! ":""}${n}${e.id} | ${t.cost} | ${t.reasoning}`}function Fn(t,n){const o=t===e.GEMINI,i=It(o?"geminiModel":"openaiModel"),a=It(o?"geminiModelWarning":"openaiModelWarning");if(!i||!a)return;const s=On(t,n||i.value),r=!!s?.warning;a.classList.toggle("is-hidden",!r),i.classList.toggle("input--warning",r)}function Hn(t){if(!t)return 0;if("AI.BATCH"===t.fn){const n=String(t.provider||"").toLowerCase(),o=On(n,t.model);if(!o)return 0;const{uncachedInputTokens:i,cachedInputTokens:a}=Ct(t),s=Math.max(0,Number(t.outputTokens||0)),r=Math.max(0,Number(t.reasoningTokens||0)),c=Math.max(0,Number(t.cacheStorageTokenHours||0)),u=s+r,l=o.prices||{};let d=i/1e6*Number(l.input||0)+a/1e6*Number(l.cachedInput??l.input??0)+u/1e6*Number(l.output||0);return n===e.GEMINI&&c>0&&(d+=c/1e6*1),d}if(t.batch&&Array.isArray(t.batchModels))return t.batchModels.reduce((e,t)=>t?e+Hn({provider:t.provider,model:t.model,inputTokens:t.inputTokens,outputTokens:t.outputTokens,reasoningTokens:t.reasoningTokens,cachedInputTokens:t.cachedInputTokens,cacheStorageTokenHours:t.cacheStorageTokenHours,cacheAdjusted:!!t.cacheAdjusted}):e,0);const n=String(t.provider||"").toLowerCase(),o=On(n,t.model);if(!o)return 0;const i=Math.max(0,Number(t.outputTokens||0)),a=Math.max(0,Number(t.reasoningTokens||0)),s=Math.max(0,Number(t.cacheStorageTokenHours||0)),r=i+a,{uncachedInputTokens:c,cachedInputTokens:u}=Ct(t),l=o.prices||{};let d=c/1e6*Number(l.input||0)+u/1e6*Number(l.cachedInput??l.input??0)+r/1e6*Number(l.output||0);return n===e.GEMINI&&s>0&&(d+=s/1e6*1),d}function $n(e){const t=Number(e);return!Number.isFinite(t)||t<=0?0:Math.floor(t)}function Vn(e){const t=Number(e);return!Number.isFinite(t)||t<=0?0:t}function Kn(e){const t=Array.isArray(e?.batchModels)?e.batchModels.map(e=>({provider:String(e?.provider||"").toLowerCase(),model:String(e?.model||"").trim(),inputTokens:Number(e?.inputTokens||0),outputTokens:Number(e?.outputTokens||0),reasoningTokens:Number(e?.reasoningTokens||0),cachedInputTokens:Number(e?.cachedInputTokens||0),cacheStorageTokenHours:Number(e?.cacheStorageTokenHours||0),requests:Number(e?.requests||0),cacheAdjusted:!!e?.cacheAdjusted})):[],n=e?.batchStats&&"object"==typeof e.batchStats?{totalRequests:Number(e.batchStats.totalRequests||0),ok:Number(e.batchStats.ok||0),error:Number(e.batchStats.error||0),cached:Number(e.batchStats.cached||0),avgMs:Number(e.batchStats.avgMs||0),maxMs:Number(e.batchStats.maxMs||0),minMs:Number(e.batchStats.minMs||0),peakQueued:Number(e.batchStats.peakQueued||0),peakActive:Number(e.batchStats.peakActive||0)}:null;return{provider:e?.provider||"",inputTokens:Number(e?.inputTokens||0),outputTokens:Number(e?.outputTokens||0),reasoningTokens:Number(e?.reasoningTokens||0),cachedInputTokens:Number(e?.cachedInputTokens||0),cacheStorageTokenHours:Number(e?.cacheStorageTokenHours||0),totalTokens:Number(e?.totalTokens||0),ok:!!e?.ok,cache:!!e?.cache,cacheAdjusted:!!e?.cacheAdjusted,ms:Number(e?.ms||0),fn:e?.fn||"AI",model:e?.model||"",ts:Number(e?.ts||0),message:e?.message||"",reasoningEffort:e?.reasoningEffort||"",call:e?.call||"",formula:e?.formula||"",cacheHint:e?.cacheHint||"",batch:!!e?.batch,batchId:String(e?.batchId||""),batchLive:!!e?.batchLive,batchModels:t,batchStats:n}}function Un(e,t,n){if(!t)return;const o=Mn[e]||[],i=String(n||"").trim(),a=i.toLowerCase(),s=wn[e]||"";t.innerHTML="";let r=!1;for(const e of o){const n=document.createElement("option");n.value=e.id,n.textContent=qn(e),e.warning&&(n.dataset.warning="1",n.style.color="#b03524",n.style.fontWeight="700"),e.id.toLowerCase()===a&&(n.selected=!0,r=!0),t.appendChild(n)}if(i&&!r){const e=document.createElement("option");return e.value=i,e.textContent=`${i} | hors liste`,e.selected=!0,void t.appendChild(e)}!i&&s&&(t.value=s)}function jn(e,t){const n=It(e);n&&(n.classList.toggle("is-open",t),n.setAttribute("aria-hidden",t?"false":"true"))}function Bn(e){const t=It(e);return!!t&&t.classList.contains("is-open")}function Yn(e){const t=It("settingsModal");t&&(t.classList.toggle("is-open",!!e),t.setAttribute("aria-hidden",e?"false":"true"),document.body.classList.toggle("is-settings-open",!!e),e?(jo(),It("settingsBackButton")?.focus()):It("settingsButton")?.focus())}function zn(e){jn("pricingModal",e)}function Jn(e){jn("onboardingModal",e)}function Xn(e){jn("onboardingKeysModal",e)}function Qn(){zn(!1)}function Zn(e,t){const n=!!t;document.querySelectorAll(`[data-key-status][data-key-status="${e}"]`).forEach(e=>{e.textContent=n?"ClÃ© enregistrÃ©e":"ClÃ© manquante",e.classList.toggle("key-status--ok",n),e.classList.toggle("key-status--missing",!n)})}function Wn(){document.querySelectorAll(nn).forEach(t=>{const n=String(t.dataset.keyInput||"").trim().toLowerCase();n===e.GEMINI?t.placeholder=rn.gemini?"ClÃ© enregistrÃ©e (laisser vide pour conserver)":"AIza...":n===e.OPENAI&&(t.placeholder=rn.openai?"ClÃ© enregistrÃ©e (laisser vide pour conserver)":"sk-...")})}function eo(){return!!rn.gemini||!!rn.openai}function to(){return!!rn.gemini&&!!rn.openai}function no(){const e=document.querySelector('[data-section="onboarding"]');if(!e)return;if(!dn||!ln||!fn)return;const t=!(cn&&cn.key&&ht(cn)&&(to()||mn&&eo()));e.classList.toggle("is-hidden",!t),t&&e.classList.contains(en)&&(In.delete("onboarding"),Ut(Array.from(In)))}function oo(t,n){const o=t===e.GEMINI,i=It(o?"geminiModel":"openaiModel"),a=It(o?"geminiReasoningEffort":"openaiReasoningEffort"),s=It(o?"geminiModelGate":"openaiModelGate"),r=!n;i&&(i.disabled=r),a&&(a.disabled=r),s&&s.classList.toggle("is-hidden",!r)}function io(){oo(e.GEMINI,!!rn.gemini),oo(e.OPENAI,!!rn.openai),function(){const e=It("providerGemini"),t=It("providerOpenAI"),n=!!rn.gemini,o=!!rn.openai;e&&(e.disabled=!n),t&&(t.disabled=!o);const i=It("configProviderGate");if(!i)return;const a=It("configProviderGateText");let s="";n||o||(s="Ajoutez une clÃ© API pour activer Gemini ou OpenAI."),i.classList.toggle("is-hidden",!s),a&&(a.textContent=s)}()}function ao(e){const t=String(e||"").trim();if(!t)return 0;const n=Date.parse(t);return Number.isFinite(n)?n:0}function so(e){const t=ao(e);return t?function(e){try{return new Date(e).toLocaleDateString("fr-FR",{year:"numeric",month:"short",day:"2-digit"})}catch{return""}}(t):""}function ro(e,t,n){e&&(e.textContent=t||"",e.title=t||"",e.setAttribute("aria-label",t||""),e.classList.toggle("key-status--ok",n),e.classList.toggle("key-status--missing",!n))}function co(e,t){document.querySelectorAll(sn).forEach(n=>{ro(n,e,t)})}function uo(e,t={}){const{focus:n=!1,persist:o=!0}=t,i=It("licenseEntry"),a=It("licenseSubscribe");if(!i)return;i.classList.toggle("is-hidden",!e),o&&(un=e),a&&a.classList.toggle("is-hidden",e);const s=It("licenseModeSubscribe"),r=It("licenseModeHave");if(s&&r&&(s.classList.toggle("segmented__btn--active",!e),r.classList.toggle("segmented__btn--active",e),s.setAttribute("aria-selected",e?"false":"true"),r.setAttribute("aria-selected",e?"true":"false")),e&&n){const e=It("licenseKeyInput");e&&e.focus()}}function lo(){!function(){const e=document.querySelector('[data-onboarding-key-card="gemini"]'),t=document.querySelector('[data-onboarding-key-card="openai"]');e&&e.classList.toggle("is-hidden",!!rn.gemini),t&&t.classList.toggle("is-hidden",!!rn.openai)}();const e=It("setupKeysStep");if(!e)return;const t=to();e.classList.toggle("is-hidden",t)}async function mo(e={}){const{silent:t=!1}=e,n=await gt();cn=n,dn=!0,function(e){const t=function(e){if(!e||!e.key)return{ok:!1,text:"Aucune licence"};if(ht(e)){const t=so(e.expiresAt);return{ok:!0,text:"Licence active"+(t?` Â· renouvellement le ${t}`:"")}}const t=ao(e.expiresAt);return{ok:!1,text:t&&t<=Date.now()?"Licence expirÃ©e":"Licence invalide"}}(e);document.querySelectorAll(sn).forEach(e=>{ro(e,t.text,t.ok)})}(n);const o=!(!n||!n.key||ht(n));uo(null===un?o:un,{persist:!1}),function(e){const t=e?.key?"ClÃ© enregistrÃ©e (laisser vide pour conserver)":"AAAA-BBBB-CCCC-DDDD";document.querySelectorAll(an).forEach(e=>{e.placeholder=t})}(n),function(e){const t=document.querySelectorAll("[data-license-meta]");if(!t.length)return;let n="ClÃ© reÃ§ue par email aprÃ¨s achat (mensuel ou annuel)";if(e&&ht(e)&&e.expiresAt){const t=so(e.expiresAt);n=t?`Renouvellement le ${t}`:"Licence active"}else if(e&&!ht(e)){const t=so(e.expiresAt);n=t?`Licence expirÃ©e le ${t}`:"Licence invalide"}t.forEach(e=>{e.textContent=n})}(n),function(e=cn){const t=It("setupLicenseStep");if(!t)return;const n=!(!e||!ht(e));t.classList.toggle("is-hidden",n)}(n),no(),!t&&n&&ht(n)&&yt("Licence active",{expiresAt:n.expiresAt||"n/a"})}function fo(e){const t=Number(e);return Number.isFinite(t)?Math.min(17,Math.max(7,Math.round(t))):7}function po(e){const t=2**fo(e);return Math.min(t,128e3)}function go(t){const n=t===e.GEMINI;It("providerGemini").classList.toggle("segmented__btn--active",n),It("providerOpenAI").classList.toggle("segmented__btn--active",!n),It("providerGemini").setAttribute("aria-pressed",n?"true":"false"),It("providerOpenAI").setAttribute("aria-pressed",n?"false":"true"),function(e){const t=It("configProviderBadge");if(!t)return;const n=Cn[e]||(e?e.toUpperCase():"â€”");t.textContent=n,t.title=`Fournisseur: ${n}`,t.setAttribute("aria-label",`Fournisseur: ${n}`)}(t),$o(),n&&Vo({force:!0})}function ho(){return It("providerGemini").classList.contains("segmented__btn--active")?e.GEMINI:e.OPENAI}function Eo(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.min(zt.length-1,Math.round(t))):0}function Io(e){return zt[Eo(e)]}function yo(){const e=Io(Eo(It("concurrencyRange").value));return It("concurrencyValue").textContent=Nt(e),e}function ko(e){const n=Number(e);return Number.isFinite(n)?Math.max(0,Math.min(1e5,Math.round(n))):t.rpmLimit}function No(e){const t="gemini"===e;It("tabGemini").classList.toggle("tab--active",t),It("tabOpenAI").classList.toggle("tab--active",!t),It("tabGemini").setAttribute("aria-selected",t?"true":"false"),It("tabOpenAI").setAttribute("aria-selected",t?"false":"true"),It("panelGemini").classList.toggle("tab-panel--active",t),It("panelOpenAI").classList.toggle("tab-panel--active",!t);const n=It("settingsProvider");n&&(n.dataset.activeProvider=t?"gemini":"openai")}function To(e,t,n,o){const i=document.createElement("div");i.className="breakdown__row "+(o?"breakdown__row--sub":"breakdown__row--total");const a=document.createElement("div");if(a.className="breakdown__name",o){const t=document.createElement("span");t.className="breakdown__model",t.textContent=e,a.appendChild(t)}else a.textContent=e;const s=document.createElement("div");s.className="breakdown__tokens",s.textContent=`${Nt(t)} tokens`;const r=document.createElement("div");return r.className="breakdown__cost",r.textContent=function(e){const t=Number(e);return Number.isFinite(t)?`${Tt}${t.toFixed(4)}`:`${Tt}0.0000`}(n),i.appendChild(a),i.appendChild(s),i.appendChild(r),i}async function bo(){!function(e){const t=It("queueStatus");if(!t)return;const n=Number(e?.active||0),o=Number(e?.queued||0),i=Math.max(0,n)+Math.max(0,o),a=Number(e?.rpm||0),s=i>0,r=a>0,c=It("queueStatusMain");c&&c.classList.toggle("is-hidden",!s);const u=It("rpmStatus");if(u&&u.classList.toggle("is-hidden",!r),!s&&!r)return void t.classList.add("is-hidden");t.classList.remove("is-hidden");const l=It("queueStatusText");l&&(l.textContent=function(e){const t=Number(e);return!Number.isFinite(t)||t<=0?"":`${Nt(t)} requete${t>1?"s":""} en cours`}(i));const d=It("rpmStatusText");d&&(d.textContent=function(e,t){const n=Number(e);if(!Number.isFinite(n)||n<=0)return"";const o=Number(t);return Number.isFinite(o)&&o>0?`RPM ${Nt(n)}/${Nt(o)}`:`RPM ${Nt(n)}`}(a,vn));const m=It("queueStop");m&&m.classList.toggle("is-hidden",o<=0)}(await async function(){const e=await L(n.RUNTIME_STATUS);if(!e)return ce(null);try{return ce(JSON.parse(e))}catch{return ce(null)}}())}async function Ao(){const t=(await async function(e={}){Se.length&&await Je();const t=!!e?.fresh,n=fe();return t||!ve||n-we>1500?await Fe(!0):await Fe(!1),Ae.slice()}({fresh:!0})).map(Kn).sort((e,t)=>t.ts-e.ts);_n=t;const n=await async function(e={}){Se.length&&await Je();const t=!!e?.fresh,n=fe();return t||!Pe||n-Re>1500?await je(!0):await je(!1),function(e){try{return JSON.parse(JSON.stringify(e||Ke()))}catch{return Ke()}}(Oe)}({fresh:!0}),{total:o,breakdown:i}=function(t){const n=t&&"object"==typeof t?t:{},o={gemini:{tokens:0,cost:0,models:new Map},openai:{tokens:0,cost:0,models:new Map}},i={inputTokens:$n(n.inputTokens),reasoningTokens:$n(n.reasoningTokens),outputTokens:$n(n.outputTokens),cachedInputTokens:$n(n.cachedInputTokens),cacheStorageTokenHours:Vn(n.cacheStorageTokenHours),cost:0,requests:$n(n.requests),byProvider:{gemini:{tokens:0,cost:0},openai:{tokens:0,cost:0}}},a={gemini:{input:0,output:0,reasoning:0,cached:0,cacheStorageTokenHours:0},openai:{input:0,output:0,reasoning:0,cached:0,cacheStorageTokenHours:0}};for(const t of[e.GEMINI,e.OPENAI]){const s=n.byProvider&&"object"==typeof n.byProvider?n.byProvider[t]:null,r=$n(s?.inputTokens),c=$n(s?.outputTokens),u=$n(s?.reasoningTokens),l=$n(s?.cachedInputTokens),d=Vn(s?.cacheStorageTokenHours);a[t]={input:r,output:c,reasoning:u,cached:l,cacheStorageTokenHours:d};const m=s?.models&&"object"==typeof s.models?s.models:{};let f=0,p=0,g=0;for(const[n,i]of Object.entries(m)){if(!i||"object"!=typeof i)continue;const a=$n(i.inputTokens),s=$n(i.outputTokens),r=$n(i.reasoningTokens),c=$n(i.cachedInputTokens),u=Vn(i.cacheStorageTokenHours),l=a+s+r;if(l<=0&&c<=0)continue;const d="string"==typeof i.label?i.label:"",m=String(n||"").trim(),h=(d||m).trim(),E=!h||"unknown"===h.toLowerCase(),I=E?"modele inconnu":h,y=Hn({provider:t,model:E?"":h,inputTokens:a,outputTokens:s,reasoningTokens:r,cachedInputTokens:c,cacheStorageTokenHours:u,cacheAdjusted:t===e.GEMINI}),k=I.toLowerCase(),N=o[t].models.get(k)||{label:I,tokens:0,cost:0};N.tokens+=l,N.cost+=y,o[t].models.set(k,N),f+=l,p+=y,g+=u}if(t===e.GEMINI){const e=Math.max(0,a[t].cacheStorageTokenHours-g);e>0&&(p+=e/1e6*1)}0===f&&(f=r+c+u),o[t].tokens=f,o[t].cost=p,i.byProvider[t].tokens=f,i.byProvider[t].cost=p}return i.inputTokens||(i.inputTokens=a.gemini.input+a.openai.input),i.outputTokens||(i.outputTokens=a.gemini.output+a.openai.output),i.reasoningTokens||(i.reasoningTokens=a.gemini.reasoning+a.openai.reasoning),i.cachedInputTokens||(i.cachedInputTokens=a.gemini.cached+a.openai.cached),i.cacheStorageTokenHours||(i.cacheStorageTokenHours=a.gemini.cacheStorageTokenHours+a.openai.cacheStorageTokenHours),i.cost=i.byProvider.gemini.cost+i.byProvider.openai.cost,{total:i,breakdown:o}}(n);It("usageTokensTotal").textContent=Nt(o.inputTokens+o.reasoningTokens+o.outputTokens),It("usageTokensInTotal").textContent=Nt(o.inputTokens),It("usageTokensCacheTotal").textContent=Nt(o.cachedInputTokens),It("usageTokensReasoningTotal").textContent=Nt(o.reasoningTokens),It("usageTokensOutTotal").textContent=Nt(o.outputTokens),It("usageCostTotal").textContent=bt(o.cost);const a=It("usageSummary");a&&(a.textContent=bt(o.cost)),It("usageCostGemini").textContent=bt(o.byProvider.gemini.cost),It("usageCostOpenAI").textContent=bt(o.byProvider.openai.cost),function(t){const n=It("usageBreakdown");if(!n)return;n.innerHTML="";const o=[e.GEMINI,e.OPENAI];for(const e of o){const o=t[e]||{tokens:0,cost:0,models:new Map};n.appendChild(To(Cn[e]||e,o.tokens,o.cost,!1));const i=Array.from(o.models.values()).filter(e=>(e.tokens||0)>0||(e.cost||0)>0).sort((e,t)=>t.tokens-e.tokens||e.label.localeCompare(t.label));for(const e of i)n.appendChild(To(e.label,e.tokens,e.cost,!0))}}(i),Ro(t)}function _o(){try{return"undefined"!=typeof document&&document.hidden}catch{return!1}}let vo=null,wo=null,Mo=null;async function So(e={}){const{force:t=!1}=e;if(t||!_o()){if(vo)return vo;vo=(async()=>{await Ao()})();try{return await vo}finally{vo=null}}}async function Co(t={}){const{force:o=!1}=t;if(o||!_o()){if(wo)return wo;wo=(async()=>{await async function(){const t=await async function(){if(await le())return{entries:0,sizeBytes:0,providers:{gemini:{entries:0,sizeBytes:0},openai:{entries:0,sizeBytes:0}},oldestMs:null,newestMs:null};const t=function(e,t=0){const n=fe(),o=[],i=[];for(const a of e||[]){if(!a||!a.key)continue;const e=Number(a.savedAtMs||0);t&&(!Number.isFinite(e)||e<=t)||a.expiresAtMs&&a.expiresAtMs<=n?i.push(a.key):o.push(a)}let a=0;for(const e of o)a+=Number(e?.size||0);if(o.length>5e3||a>ye){o.sort((e,t)=>(e.savedAtMs||0)-(t.savedAtMs||0));let e=0;for(;o.length-e>5e3||a>ye;){const t=o[e];if(!t)break;i.push(t.key),a-=Number(t?.size||0),e+=1}return{list:o.slice(e),removedKeys:i}}return{list:o,removedKeys:i}}(await Ne(),await async function(){const e=Ie(await L(n.CACHE_CLEAR_AT));return e>ke&&(ke=e),ke}());if(t.removedKeys.length){for(const e of t.removedKeys)await Te(e);await async function(e){try{await O(n.CACHE_INDEX,JSON.stringify(e))}catch{}}(t.list)}const o={entries:0,sizeBytes:0,providers:{gemini:{entries:0,sizeBytes:0},openai:{entries:0,sizeBytes:0}},oldestMs:null,newestMs:null};for(const n of t.list||[]){if(!n?.key)continue;o.entries+=1,o.sizeBytes+=Number(n.size||0);const t=String(n.provider||"").toLowerCase();t===e.GEMINI?(o.providers.gemini.entries+=1,o.providers.gemini.sizeBytes+=Number(n.size||0)):t===e.OPENAI&&(o.providers.openai.entries+=1,o.providers.openai.sizeBytes+=Number(n.size||0));const i=Number(n.savedAtMs||0);i&&(o.oldestMs=null==o.oldestMs?i:Math.min(o.oldestMs,i),o.newestMs=null==o.newestMs?i:Math.max(o.newestMs,i))}return o}(),o=It("cacheEntries");o&&(o.textContent=Nt(t.entries));const i=It("cacheSize");i&&(i.textContent=function(e){const t=Number(e);return!Number.isFinite(t)||t<=0?"0 KB":t<1024?`${t} B`:t<1048576?`${(t/1024).toFixed(1)} KB`:`${(t/1048576).toFixed(2)} MB`}(t.sizeBytes));const a=It("cacheGeminiEntries");a&&(a.textContent=Nt(t.providers.gemini.entries));const s=It("cacheOpenAIEntries");s&&(s.textContent=Nt(t.providers.openai.entries))}()})();try{return await wo}finally{wo=null}}}async function Lo(e={}){const{force:t=!1}=e;if(t||!_o()){if(Mo)return Mo;Mo=(async()=>{await bo()})();try{return await Mo}finally{Mo=null}}}function Oo(e){const t=Number(e||0);return t>=8e3?"token-heat--extreme":t>=4e3?"token-heat--hot":t>=1500?"token-heat--warm":"token-heat--cool"}function xo(e){if(e?.batch&&e?.batchId)return`batch:${e.batchId}`;const t=e.call||e.formula||"";return[e.ts||0,e.fn||"",e.provider||"",e.model||"",t].join("|")}function Po(){const e=It("logFilterErrors");e&&(e.classList.toggle("is-active",An),e.setAttribute("aria-pressed",An?"true":"false"))}function Ro(e){const t=It("logList");t.innerHTML="";const n=function(e){return An?e.filter(e=>!e.ok):e}(e||[]);if(!n.length){const e=document.createElement("div");return e.className="log-item log-item--empty",e.textContent=An?"Aucune erreur enregistrÃ©e pour le moment":"Aucune activitÃ© enregistrÃ©e pour le moment",void t.appendChild(e)}const o=(e,t)=>{const n=document.createElement("span");n.className="token-flow";const o=document.createElement("span");o.className="token-flow__icon",o.textContent=e;const i=document.createElement("span");return i.className="token-flow__value",i.textContent=Nt(t),n.appendChild(o),n.appendChild(i),n},i=n.slice(0,40),a=new Set;for(const e of i){const n=document.createElement("div"),i=e.cache?" log-item--cache":"",s=e.batch?" log-item--batch":"";n.className=`log-item ${e.ok?"log-item--ok":"log-item--error"}${i}${s}`;const r=document.createElement("div");r.className="log-item__top";const c=document.createElement("div");c.className="log-item__title";const u=document.createElement("span");u.className="log-item__title-text",u.textContent=e.fn,c.appendChild(u);const l=String(e.call||e.formula||"").trim();let d=null;if(l){const t=xo(e);a.add(t);const o=document.createElement("button");o.className="log-item__toggle",o.type="button",o.setAttribute("aria-expanded","false"),o.setAttribute("aria-label","Afficher la fonction");const i=document.createElement("span");i.className="log-item__chevron",o.appendChild(i),Tn.has(t)&&(n.classList.add("log-item--expanded"),o.setAttribute("aria-expanded","true"),o.setAttribute("aria-label","Masquer la fonction")),o.addEventListener("click",()=>{const e=n.classList.toggle("log-item--expanded");o.setAttribute("aria-expanded",e?"true":"false"),o.setAttribute("aria-label",e?"Masquer la fonction":"Afficher la fonction"),e?Tn.add(t):Tn.delete(t)}),c.appendChild(o),d=document.createElement("div"),d.className="log-item__detail",d.textContent=l}const m=document.createElement("div");m.style.display="flex",m.style.gap="6px";const f=document.createElement("span");f.className="tag",f.textContent=e.batch?"BATCH":e.provider?e.provider.toUpperCase():"â€”",m.appendChild(f);const p=document.createElement("span");if(p.className="tag tag--cost",p.textContent=At(Hn(e)),p.title="CoÃ»t estimÃ© (centimes)",m.appendChild(p),e.batch){const e=document.createElement("span");e.className="tag tag--cache",e.textContent="Lot",m.appendChild(e)}else if(e.cache){const e=document.createElement("span");e.className="tag tag--cache",e.textContent="Cache",m.appendChild(e)}if(_t(e.provider)&&("gemini_cached_content"===e.cacheHint||Number(e.cachedInputTokens||0)>0)){const e=document.createElement("span");e.className="tag tag--cache",e.textContent="Cache Gemini",m.appendChild(e)}r.appendChild(c),r.appendChild(m);const g=document.createElement("div");g.className="log-item__meta";const h=Math.max(0,St(e)),E=e.batch?"":e.model?e.model:"",I=e.reasoningEffort?e.reasoningEffort:"",y=Lt(e.ms),k=[E,I].filter(Boolean).join(" Â· "),N=document.createElement("div");N.className="log-item__info";const T=`${Ot(e.ts)} Â· ${y}`,b=k?` Â· ${k}`:"";if(e.batch&&e.batchStats){const t=e.batchStats,n=[`Lot ${Nt(t.totalRequests)} req`,`Err ${Nt(t.error)}`];t.cached&&n.push(`Cache ${Nt(t.cached)}`),t.avgMs&&n.push(`Moy ${Lt(t.avgMs)}`),t.peakQueued&&n.push(`Pic file ${Nt(t.peakQueued)}`),t.peakActive&&n.push(`Pic actif ${Nt(t.peakActive)}`),N.textContent=`${T}${b} Â· ${n.join(" Â· ")}`}else!e.ok&&e.message?N.textContent=`${T}${b} Â· ${e.message.slice(0,60)}`:N.textContent=`${T}${b}`;if(e.cache){const e=document.createElement("div");e.className="log-item__cache",e.textContent="Cache local",g.appendChild(e)}else{const t=document.createElement("div");t.className="log-item__tokens";const n=document.createElement("div");n.className="log-item__tokens-line";const i=document.createElement("span");i.className=`log-item__heat ${Oo(h)}`;const a=document.createElement("span");a.className="log-item__tokens-total",a.textContent=`${Nt(h)} tokens`;const s=document.createElement("span");s.className="log-item__tokens-detail",s.appendChild(document.createTextNode("(")),s.appendChild(o("IN",Mt(e))),s.appendChild(document.createTextNode(" / ")),s.appendChild(o("REF",e.reasoningTokens)),s.appendChild(document.createTextNode(" / ")),s.appendChild(o("OUT",e.outputTokens)),wt(e)&&(s.appendChild(document.createTextNode(" / ")),s.appendChild(o("CACHE",e.cachedInputTokens))),s.appendChild(document.createTextNode(")")),n.appendChild(i),n.appendChild(a),n.appendChild(s),t.appendChild(n),g.appendChild(t)}g.appendChild(N),n.appendChild(r),d&&n.appendChild(d),n.appendChild(g),t.appendChild(n)}Tn.forEach(e=>{a.has(e)||Tn.delete(e)})}function Go(e){pn=!!e;const t=It("privacyModeToggle");t&&(t.checked=pn);const n=It("privacyModeStatus");n&&(n.textContent=pn?"ActivÃ©":"DÃ©sactivÃ©",n.classList.toggle("is-active",pn));const o=It("privacyModeHint");o&&(o.textContent=pn?"Journal et cache persistants dÃ©sactivÃ©s.":"Journal et cache persistants activÃ©s.");const i=It("cacheStatus");if(i){const e=!pn;i.classList.toggle("status-dot--on",e),i.classList.toggle("status-dot--off",!e),i.setAttribute("aria-label",e?"Cache actif":"Cache dÃ©sactivÃ©"),i.setAttribute("title",e?"Cache actif":"Cache dÃ©sactivÃ©")}}async function Do(){Go(await le())}function qo(e){const t=String(e||"").trim();if(!t)return 0;const n=Date.parse(t);return Number.isFinite(n)?n:0}function Fo(e){const t=String(e?.name||"").trim(),n=String(e?.displayName||e?.display_name||"").trim(),o=String(e?.model||"").trim(),i=function(e){if(!e||"object"!=typeof e)return 0;const t=[e.cachedContentTokenCount,e.cached_content_token_count,e.totalTokenCount,e.total_token_count,e.promptTokenCount,e.prompt_token_count];for(const e of t){const t=Number(e);if(Number.isFinite(t)&&t>0)return Math.floor(t)}return 0}(e?.usageMetadata||e?.usage_metadata||null),a=qo(e?.createTime||e?.create_time),s=qo(e?.updateTime||e?.update_time),r=qo(e?.expireTime||e?.expire_time),c=document.createElement("div");c.className="explicit-cache__item";const u=document.createElement("div");u.className="explicit-cache__main";const l=document.createElement("div");l.className="explicit-cache__title",l.textContent=n||(t?"Cache Gemini":"Cache");const d=document.createElement("div");d.className="explicit-cache__meta";const m=[];o&&m.push(o.replace("models/","")),i>0&&m.push(`${Nt(i)} tokens`),a&&m.push(`CrÃ©Ã© ${xt(a)}`),r&&m.push(`Expire ${xt(r)}`),!r&&s&&m.push(`MAJ ${xt(s)}`),d.textContent=m.join(" Â· ");const f=document.createElement("div");f.className="explicit-cache__name",f.textContent=t,u.appendChild(l),m.length&&u.appendChild(d),t&&u.appendChild(f);const p=document.createElement("div");p.className="explicit-cache__actions";const g=document.createElement("button");return g.className="explicit-cache__delete",g.type="button",g.textContent="Supprimer",g.dataset.cacheName=t,p.appendChild(g),c.appendChild(u),c.appendChild(p),c}let Ho=null;function $o(){const t=document.querySelector('[data-section="gemini-explicit"]');t&&(ho()===e.GEMINI?t.classList.toggle("is-hidden",!1):t.classList.add("is-hidden"))}async function Vo(t={}){const{force:n=!1}=t;if(n||!_o()){if(Ho)return Ho;Ho=(async()=>{await async function(){if(ho()!==e.GEMINI)return void $o();const t=It("geminiExplicitList"),n=It("geminiExplicitEmpty"),o=It("geminiExplicitSummary");if(!t||!n||!o)return;t.innerHTML="",n.textContent="Chargement...",n.classList.remove("is-hidden"),o.textContent="0 cache";const i=await async function(t={}){const n=await K(e.GEMINI);if(!n)return{ok:!1,code:"API_KEY_MISSING",message:"ClÃ© API manquante pour Gemini."};const o=pe(t?.pageSize??50,1,100,50),i=pe(t?.maxPages??3,1,5,3),a=!!t?.all;let s=st(t?.pageToken)?String(t.pageToken):"",r=0;const c=[];for(;r<i;){r+=1;const e=new URL("https://generativelanguage.googleapis.com/v1beta/cachedContents");e.searchParams.set("pageSize",String(o)),s&&e.searchParams.set("pageToken",s);const t=await ut(e.toString(),{method:"GET",headers:{"Content-Type":"application/json","x-goog-api-key":n}},3e4),i=await lt(t);if(!t.ok){const e=rt(i)||`Gemini API error (${t.status}).`;return{ok:!1,status:t.status,code:"API_ERROR",message:he(e)}}const u=Array.isArray(i?.cachedContents)?i.cachedContents:Array.isArray(i?.cachedContent)?i.cachedContent:[];if(c.push(...u),s=st(i?.nextPageToken)?String(i.nextPageToken):"",!a||!s)break}return{ok:!0,caches:c,nextPageToken:s||"",pages:r}}({pageSize:50,all:!0,maxPages:3});if(!i.ok)return n.textContent=i.message||"Impossible de rÃ©cupÃ©rer les caches Gemini.",void $o();const a=Array.isArray(i.caches)?i.caches:[];if(o.textContent=`${Nt(a.length)} cache${a.length>1?"s":""}`,!a.length)return n.textContent="Aucun cache explicite actif.",void $o();n.classList.add("is-hidden"),$o();for(const e of a)t.appendChild(Fo(e));t.querySelectorAll(".explicit-cache__delete").forEach(t=>{t.addEventListener("click",async()=>{const n=t.dataset.cacheName||"";if(!n)return;t.disabled=!0;const o=await async function(t){const n=await K(e.GEMINI);if(!n)return{ok:!1,code:"API_KEY_MISSING",message:"ClÃ© API manquante pour Gemini."};const o=String(t||"").trim();if(!o)return{ok:!1,code:"INVALID_NAME",message:"Nom de cache invalide."};const i=`https://generativelanguage.googleapis.com/v1beta/${encodeURI(o)}`,a=await ut(i,{method:"DELETE",headers:{"Content-Type":"application/json","x-goog-api-key":n}},3e4),s=await lt(a);if(!a.ok){const e=rt(s)||`Gemini API error (${a.status}).`;return{ok:!1,status:a.status,code:"API_ERROR",message:he(e)}}for(const[e,t]of Ze.entries())t?.name&&t.name===o&&Ze.delete(e);return{ok:!0}}(n);o.ok?kt("Cache supprimÃ©"):kt(o.message||"Suppression impossible."),await Vo({force:!0})})})}()})();try{return await Ho}finally{Ho=null}}}async function Ko(e={}){const{silent:o=!1,message:i="Configuration enregistrÃ©e"}=e,a=ho(),s=po(fo(It("maxTokensRange").value)),r=await async function(e){const o=R(e)||t.provider;return await O(n.DEFAULT_PROVIDER,o),l=o,d=fe(),o}(a),c=await Z(s);return o||yt(i,{defaultProvider:r,maxOutputTokens:c}),{savedProvider:r,savedTokens:c}}function Uo(e={}){const{focusKey:t=!1}=e,n=document.querySelector('[data-section="onboarding"]');if(n){if(n.classList.remove("is-hidden"),n.classList.contains(en)&&(In.delete("onboarding"),Ut(Array.from(In))),n.classList.contains("is-collapsed")){n.classList.remove("is-collapsed");const e=n.querySelector("[data-collapse-toggle]");e&&e.setAttribute("aria-expanded","true")}if("function"==typeof n.scrollIntoView&&n.scrollIntoView({behavior:"smooth",block:"start"}),t){const e=n.querySelector(nn);e&&e.focus()}}}function jo(){document.querySelectorAll(Qt).forEach(e=>{e.classList.remove("is-open");const t=e.querySelector("button");t&&t.setAttribute("aria-expanded","false")})}async function Bo(e={}){const{silent:t=!1}=e;return eo()?(mn=!0,fn=!0,await re(!0),no(),!0):(t||yt("Ajoutez au moins une clÃ© API avant de valider",{ok:!1}),!1)}async function Yo(t,n){const o=(n||"").trim();return!!o&&(await async function(t,n){const o=(n||"").trim(),i=R(t)===e.OPENAI?e.OPENAI:e.GEMINI;return await O(V(i),o),k[i]=o,N[i]=fe(),o}(t,o),rn[t]=!0,ln=!0,Wn(),io(),lo(),no(),!0)}async function zo(e,t){const n=await Yo(e,t?.value||"");n&&(t&&(t.value=""),Zn(e,n),yt("ClÃ© enregistrÃ©e",{provider:e}))}async function Jo(n){const o=n===e.GEMINI,i=It(o?"geminiModel":"openaiModel");if(!i)return;const a=(i.value||"").trim();await async function(n,o){const i=R(n)===e.OPENAI?e.OPENAI:e.GEMINI,a=String(o||"").trim();if(!a){const n=i===e.OPENAI?t.openaiModel:t.geminiModel;return await O(j(i),n),T[i]=n,void(b[i]=fe())}await O(j(i),a),T[i]=a,b[i]=fe()}(n,a);let s="";if(o){const e=It("geminiReasoningEffort");s=xn(a,e?e.value:""),s&&await X(s)}else{const e=It("openaiReasoningEffort");s=Rn(a,e?e.value:""),s&&await J(s)}yt("Configuration enregistrÃ©e",{provider:n,model:a,reasoningEffort:s||void 0}),Fn(n,a)}function Xo(e,t){e&&e.classList.toggle("input--warning",t)}async function Qo(e,t){const n=(e?.value||"").trim();if(Xo(e,!1),!n)return Xo(e,!0),co("Entrez votre clÃ© de licence",!1),void yt("ClÃ© de licence manquante",{ok:!1});const o=t?.textContent||"";t&&(t.disabled=!0,t.textContent="Activation...");const i=await Et(n);if(t&&(t.disabled=!1,t.textContent=o),i.success)return e&&(e.value=""),await mo({silent:!0}),yt("Licence activÃ©e",{expiresAt:i.license?.expiresAt||"n/a"}),void kt("Licence enregistrÃ©e");const a=i.error||"ClÃ© invalide";Xo(e,!0),co(a,!1),yt("Ã‰chec de l'activation",{error:a})}async function Zo(e=!0){e&&await async function(e=!0){return await O(n.ONBOARDING_SEEN,e?"1":"0"),e}(!0),Xn(!1),Jn(!1)}async function Wo(){document.querySelectorAll("[data-collapse-toggle]").forEach(e=>{const t=e.getAttribute("aria-controls"),n=e.closest("[data-collapsible]");if(!t||!n)return;if(!document.getElementById(t))return;const o=n.classList.contains("is-collapsed");e.setAttribute("aria-expanded",o?"false":"true"),e.addEventListener("click",()=>{const t=!n.classList.contains("is-collapsed");n.classList.toggle("is-collapsed",t),e.setAttribute("aria-expanded",t?"false":"true")})}),function(){let e=!1;const t=()=>{e||(e=!0,setTimeout(async()=>{e=!1,await Dt({silent:!0}),await So(),await Co(),await Lo(),await Do(),await mo({silent:!0})},250))};try{if("undefined"!=typeof OfficeRuntime&&OfficeRuntime?.storage?.onChanged){const e=OfficeRuntime.storage.onChanged;"function"==typeof e.add?e.add(()=>t()):"function"==typeof e.addListener?e.addListener(()=>t()):"function"==typeof e&&e(()=>t())}}catch{}try{window.addEventListener("storage",()=>t())}catch{}}(),document.querySelectorAll(Qt).forEach(e=>{const t=e.querySelector("button");t&&(t.setAttribute("aria-expanded","false"),t.addEventListener("click",n=>{n.stopPropagation();const o=e.classList.contains("is-open");jo();const i=!o;e.classList.toggle("is-open",i),t.setAttribute("aria-expanded",i?"true":"false")}))}),document.addEventListener("click",e=>{e.target.closest(Qt)||jo()}),await async function(){if(Nn=document.querySelector(".app__main"),!Nn)return;const e=Array.from(Nn.querySelectorAll(Zt));yn=new Map,e.forEach(e=>{const t=qt(e);t&&yn.set(t,e)});const t=await async function(){await P();const e=await L(n.SECTION_ORDER);if(!e)return[];try{return de(JSON.parse(e))}catch{return[]}}(),o=e.map(e=>qt(e)).filter(Boolean);En=o.slice(),hn=function(e,t){const n=[],o=new Set;if(Array.isArray(e))for(const t of e)t&&!o.has(t)&&yn.has(t)&&(o.add(t),n.push(t));for(const e of t)e&&!o.has(e)&&(o.add(e),n.push(e));return n}(t,o),Ht(hn),In=new Set(await async function(){await P();const e=await L(n.SECTION_HIDDEN);if(!e)return[];try{return de(JSON.parse(e))}catch{return[]}}()),Vt(),$t(In),Yt(),function(){const e=It("sectionManagerList");e&&(e.addEventListener("dragstart",e=>{const t=e.target.closest(".section-row__handle");if(!t)return;const n=t.closest(".section-row");n&&(kn=n.dataset.sectionKey||"",n.classList.add("is-dragging"),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",kn)))}),e.addEventListener("dragover",t=>{if(!kn)return;t.preventDefault();const n=t.target.closest(".section-row");if(!n||n.dataset.sectionKey===kn)return;!function(e){e.querySelectorAll(".section-row").forEach(e=>{e.classList.remove("is-drop-before","is-drop-after")})}(e);const o=n.getBoundingClientRect(),i=t.clientY<o.top+o.height/2;n.classList.toggle("is-drop-before",i),n.classList.toggle("is-drop-after",!i)}),e.addEventListener("dragleave",e=>{const t=e.target.closest(".section-row");t&&t.classList.remove("is-drop-before","is-drop-after")}),e.addEventListener("drop",t=>{if(!kn)return;t.preventDefault();const n=t.target.closest(".section-row"),o=n&&n.dataset.sectionKey||"",i=kn;kn="",Bt(e);let a=hn.slice();if(o){const e=n.getBoundingClientRect();a=function(e,t,n,o){const i=e.filter(e=>e!==t),a=i.indexOf(n);if(a<0)return i.push(t),i;const s=o?a:a+1;return i.splice(s,0,t),i}(a,i,o,t.clientY<e.top+e.height/2)}else a=function(e,t){const n=e.filter(e=>e!==t);return n.push(t),n}(a,i);Kt(a)}),e.addEventListener("dragend",()=>{kn="",Bt(e)}))}()}(),await Dt({silent:!0}),await async function(){const e=It("privacyModeToggle");e&&(await Do(),e.addEventListener("change",async()=>{const t=!!e.checked;await async function(e=!1){const t=!!e;return r=t,c=fe(),await O(n.PRIVACY_MODE,t?"1":"0"),t}(t),Go(t),t&&(await Xe(),await ct()),await So({force:!0}),await Co({force:!0}),yt(t?"Mode confidentialitÃ© activÃ©":"Mode confidentialitÃ© dÃ©sactivÃ©",{privacyMode:t})}))}();const o=It("settingsButton");o&&o.addEventListener("click",()=>Yn(!0)),document.querySelectorAll("[data-settings-open]").forEach(e=>{e.addEventListener("click",()=>Yn(!0))}),document.querySelectorAll("[data-settings-close]").forEach(e=>{e.addEventListener("click",()=>Yn(!1))}),document.querySelectorAll("[data-interface-mode]").forEach(e=>{e.addEventListener("click",async()=>{const t=e.dataset.interfaceMode||tn.ADVANCED;await async function(e){const t=Pt(e);if(t===gn)return t;const o=await async function(e){const t=G(e);return await O(n.INTERFACE_MODE,t),I=t,y=fe(),t}(t);return Gt(o,{silent:!1}),o}(t)})});const i=It("sectionManagerReset");i&&i.addEventListener("click",()=>{En.length&&Kt(En)});const a=It("pricingHelp");a&&a.addEventListener("click",()=>(function(){const t=It("pricingTableBodyGemini"),n=It("pricingTableBodyOpenAI");if(!t&&!n)return;t&&(t.innerHTML=""),n&&(n.innerHTML="");const o=(e,t)=>{if(!t)return;const n=Mn[e]||[];for(const e of n){const n=document.createElement("tr"),o=Dn(e),i=document.createElement("td");i.textContent=e.id;const a=document.createElement("td");a.className="pricing-table__col-price",a.textContent=Gn(e.prices?.input);const s=document.createElement("td");s.className="pricing-table__col-price",s.textContent=Gn(e.prices?.output);const r=document.createElement("td");r.className="pricing-table__col-icon",r.textContent=o.cost;const c=document.createElement("td");c.className="pricing-table__col-icon",c.textContent=o.reasoning,n.appendChild(i),n.appendChild(a),n.appendChild(s),n.appendChild(r),n.appendChild(c),t.appendChild(n)}};o(e.GEMINI,t),o(e.OPENAI,n)}(),void zn(!0))),document.querySelectorAll("[data-modal-close]").forEach(e=>{e.addEventListener("click",()=>Qn())}),document.querySelectorAll("[data-onboarding-close]").forEach(e=>{e.addEventListener("click",async()=>Zo(!0))}),document.querySelectorAll("[data-onboarding-keys-close]").forEach(e=>{e.addEventListener("click",()=>Xn(!1))});const s=It("onboardingClose");s&&s.addEventListener("click",async()=>Zo(!0));const u=It("onboardingDone");u&&u.addEventListener("click",async()=>Zo(!0));const l=It("onboardingKeysButton");l&&l.addEventListener("click",async()=>{await Zo(!0),Uo({focusKey:!0})}),document.querySelectorAll("[data-onboarding-open]").forEach(e=>{e.addEventListener("click",()=>{Yn(!1),Uo({focusKey:!0})})});const d=It("onboardingKeysSave");d&&d.addEventListener("click",async()=>async function(){const t=It("onboardingGeminiKey"),n=It("onboardingOpenAIKey"),o=await Yo(e.GEMINI,t?.value||""),i=await Yo(e.OPENAI,n?.value||"");t&&(t.value=""),n&&(n.value=""),Zn(e.GEMINI,rn.gemini),Zn(e.OPENAI,rn.openai),(o||i)&&yt("ClÃ©s enregistrÃ©es",{gemini:!!o,openai:!!i}),(rn.gemini||rn.openai)&&(await Bo({silent:!0}),Xn(!1))}());const m=It("onboardingKeysLater");m&&m.addEventListener("click",()=>Xn(!1)),document.addEventListener("keydown",async e=>{"Escape"===e.key&&(jo(),Bn("onboardingKeysModal")?Xn(!1):Bn("onboardingModal")?await Zo(!0):Bn("settingsModal")?Yn(!1):Bn("pricingModal")&&Qn())}),It("tabGemini").addEventListener("click",()=>No("gemini")),It("tabOpenAI").addEventListener("click",()=>No("openai")),It("providerGemini").addEventListener("click",async()=>{go(e.GEMINI),await Ko()}),It("providerOpenAI").addEventListener("click",async()=>{go(e.OPENAI),await Ko()}),It("maxTokensRange").addEventListener("input",()=>{!function(){const e=po(fo(It("maxTokensRange").value));It("maxTokensValue").textContent=Nt(e)}()}),It("maxTokensRange").addEventListener("change",async()=>{await Ko()}),It("concurrencyRange").addEventListener("input",()=>{yo()}),It("concurrencyRange").addEventListener("change",async()=>{await async function(e={}){const{silent:t=!1,message:n="Concurrence enregistrÃ©e"}=e,o=yo(),i=await ne(o);return t||yt(n,{concurrency:i}),i}()});const f=It("rpmLimitInput");f&&f.addEventListener("change",async()=>{await async function(e={}){const{silent:n=!1,message:o="Limite RPM enregistrÃ©e"}=e,i=function(){const e=It("rpmLimitInput");if(!e)return t.rpmLimit;const n=ko(e.value);return e.value=String(n),n}(),a=await ae(i);return vn=a,n||yt(o,{rpmLimit:a}),a}()});const p=It("geminiReasoningEffort");p&&(p.addEventListener("input",()=>{const e=It("geminiModel");xn(e?e.value:"",p.value)}),p.addEventListener("change",async()=>{await async function(){const e=It("geminiModel"),t=It("geminiReasoningEffort");if(!t)return;const n=xn(e?e.value:"",t.value);n&&await X(n),yt("Effort de raisonnement enregistrÃ©",{geminiReasoningEffort:n})}()}));const g=It("openaiReasoningEffort");g&&(g.addEventListener("input",()=>{const e="0"!==g.dataset.allowNone;let t=Pn(g.value);e||"none"!==t||(g.value="1",t=Pn(g.value)),g.setAttribute("aria-valuetext",t)}),g.addEventListener("change",async()=>{await async function(){const e=It("openaiModel"),t=It("openaiReasoningEffort");if(!t)return;const n=Rn(e?e.value:"",t.value);n&&await J(n),yt("Effort de raisonnement enregistrÃ©",{openaiReasoningEffort:n})}()}));const h=It("geminiModel");h&&h.addEventListener("change",async()=>{await Jo(e.GEMINI)});const E=It("openaiModel");E&&E.addEventListener("change",async()=>{await Jo(e.OPENAI)}),document.querySelectorAll(nn).forEach(e=>{const t=String(e.dataset.keyInput||"").trim().toLowerCase();t&&(e.addEventListener("input",()=>Xo(e,!1)),e.addEventListener("change",async()=>{await zo(t,e)}),e.addEventListener("keydown",n=>{if("Enter"!==n.key)return;n.preventDefault();const o=e.closest(".input-action")?.querySelector(on);o?o.click():zo(t,e)}))}),document.querySelectorAll(on).forEach(e=>{const t=String(e.dataset.keySave||"").trim().toLowerCase();t&&e.addEventListener("click",async()=>{const n=e.closest(".input-action")?.querySelector(nn);await zo(t,n),"true"===e.dataset.keyConfirm&&await Bo()})});const k=It("licenseModeSubscribe"),N=It("licenseModeHave");k&&k.addEventListener("click",()=>uo(!1)),N&&N.addEventListener("click",()=>uo(!0,{focus:!0})),document.querySelectorAll(an).forEach(e=>{e.addEventListener("input",()=>Xo(e,!1)),e.addEventListener("keydown",t=>{if("Enter"!==t.key)return;t.preventDefault();const n=document.querySelector(`[data-license-activate][data-license-target="${e.id}"]`)||e.closest(".input-action, .setup-license__row")?.querySelector("[data-license-activate]");n&&Qo(e,n)})}),document.querySelectorAll("[data-license-activate]").forEach(e=>{e.addEventListener("click",async()=>{const t=e.dataset.licenseTarget,n=(t?It(t):null)||e.closest(".input-action, .setup-license__row")?.querySelector(an);await Qo(n,e)})});const T=It("clearUsageTotals");T&&T.addEventListener("click",async()=>{await async function(){Oe=Ke(),Pe=!0,xe=null,Re=fe(),Ge=!1,await x(n.USAGE_TOTALS)}(),await So({force:!0}),yt("Utilisation rÃ©initialisÃ©e",{ok:!0})});const b=It("logFilterErrors");b&&b.addEventListener("click",()=>{An=!An,Po(),Ro(_n)}),Po(),It("clearLogs").addEventListener("click",async()=>{await Xe(),await So({force:!0}),yt("Journal effacÃ©",{ok:!0})}),It("clearCache").addEventListener("click",async()=>{await ct(),await Co({force:!0}),yt("Cache vidÃ©",{ok:!0})});const A=It("queueStop");A&&A.addEventListener("click",async()=>{!function(){if(!tt.length)return 0;const e=tt.drain();for(const t of e)t(We);(function(){const e={active:0,queued:tt.length,rpm:at()};ot=e,nt||(nt=setTimeout(()=>{nt=null;const e=ot;if(ot=null,!e)return;const t=`${e.active}:${e.queued}:${e.rpm}`;t!==it&&(it=t,ue({...e,ts:fe()}))},120))})(),e.length}(),await Lo({force:!0})}),No("gemini"),await async function(t={}){const{preserveKeyInputs:n=!1,silent:o=!1}=t,i=It("storageBackend");i&&(i.textContent=v().kind);const[a,s,r,c,u,l,d,m,f,p,g]=await Promise.all([$(),Q(),te(),ie(),B(e.GEMINI),B(e.OPENAI),U(e.GEMINI),U(e.OPENAI),Y(),z(),se()]);go(a);const h=function(e){const t=Number(e);return!Number.isFinite(t)||t<=0?7:fo(Math.log2(t))}(s),E=po(h);It("maxTokensRange").value=String(h),It("maxTokensValue").textContent=Nt(E),E!==s&&await Z(E);const I=function(e){const t=Number(e);if(!Number.isFinite(t))return 0;let n=0,o=Math.abs(zt[0]-t);for(let e=1;e<zt.length;e+=1){const i=Math.abs(zt[e]-t);i<o&&(o=i,n=e)}return n}(r),y=Io(I);It("concurrencyRange").value=String(I),It("concurrencyValue").textContent=Nt(y),y!==r&&await ne(y);const k=ko(c);vn=k;const N=It("rpmLimitInput");N&&(N.value=String(k),k!==c&&await ae(k));const T=It("geminiModel"),b=It("openaiModel");Un(e.GEMINI,T,u),Un(e.OPENAI,b,l);const A=T?T.value:u,_=b?b.value:l,w=xn(A,f);w&&w!==f&&await X(w);const M=Rn(_,p),S=M||p;M&&M!==p&&await J(M),Fn(e.GEMINI,A),Fn(e.OPENAI,_),n||document.querySelectorAll(nn).forEach(e=>{e.value=""}),rn={gemini:!!d,openai:!!m},Wn(),mn=!!g,fn=!0,d||m||!g||(mn=!1,await re(!1)),ln=!0,Zn(e.GEMINI,d),Zn(e.OPENAI,m),io(),lo(),no(),o||yt("Configuration chargÃ©e",{defaultProvider:a,maxOutputTokens:E,gemini:{key:d?"set":"missing",model:u,reasoningEffort:w},openai:{key:m?"set":"missing",model:l,reasoningEffort:S}})}(),await mo({silent:!0}),await So({force:!0}),await Co({force:!0}),await Vo({force:!0}),await Lo({force:!0}),await async function(){await async function(){return await P(),"1"===await L(n.ONBOARDING_SEEN)}()||Jn(!0)}(),document.addEventListener("visibilitychange",()=>{_o()||(So(),Co(),Vo(),Lo())}),setInterval(()=>{So()},2e3),setInterval(()=>{Co()},12e3),setInterval(()=>{Vo()},15e3),setInterval(()=>{Lo()},1e3)}document.addEventListener("DOMContentLoaded",async()=>{await async function(){try{"undefined"!=typeof Office&&Office?.onReady&&await Office.onReady()}catch{}}(),await Wo()})})();
//# sourceMappingURL=taskpane.js.map